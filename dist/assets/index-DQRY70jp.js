function h3(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function d3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function f3(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var ww={exports:{}},kd={},bw={exports:{}},_t={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uT;function p3(){if(uT)return _t;uT=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(U){return U===null||typeof U!="object"?null:(U=f&&U[f]||U["@@iterator"],typeof U=="function"?U:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,w={};function x(U,H,ue){this.props=U,this.context=H,this.refs=w,this.updater=ue||g}x.prototype.isReactComponent={},x.prototype.setState=function(U,H){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,H,"setState")},x.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function I(){}I.prototype=x.prototype;function C(U,H,ue){this.props=U,this.context=H,this.refs=w,this.updater=ue||g}var k=C.prototype=new I;k.constructor=C,y(k,x.prototype),k.isPureReactComponent=!0;var E=Array.isArray,_=Object.prototype.hasOwnProperty,L={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function A(U,H,ue){var Ie,be={},ke=null,De=null;if(H!=null)for(Ie in H.ref!==void 0&&(De=H.ref),H.key!==void 0&&(ke=""+H.key),H)_.call(H,Ie)&&!P.hasOwnProperty(Ie)&&(be[Ie]=H[Ie]);var Fe=arguments.length-2;if(Fe===1)be.children=ue;else if(1<Fe){for(var Ae=Array(Fe),Ge=0;Ge<Fe;Ge++)Ae[Ge]=arguments[Ge+2];be.children=Ae}if(U&&U.defaultProps)for(Ie in Fe=U.defaultProps,Fe)be[Ie]===void 0&&(be[Ie]=Fe[Ie]);return{$$typeof:n,type:U,key:ke,ref:De,props:be,_owner:L.current}}function $(U,H){return{$$typeof:n,type:U.type,key:H,ref:U.ref,props:U.props,_owner:U._owner}}function D(U){return typeof U=="object"&&U!==null&&U.$$typeof===n}function R(U){var H={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(ue){return H[ue]})}var M=/\/+/g;function O(U,H){return typeof U=="object"&&U!==null&&U.key!=null?R(""+U.key):H.toString(36)}function Z(U,H,ue,Ie,be){var ke=typeof U;(ke==="undefined"||ke==="boolean")&&(U=null);var De=!1;if(U===null)De=!0;else switch(ke){case"string":case"number":De=!0;break;case"object":switch(U.$$typeof){case n:case e:De=!0}}if(De)return De=U,be=be(De),U=Ie===""?"."+O(De,0):Ie,E(be)?(ue="",U!=null&&(ue=U.replace(M,"$&/")+"/"),Z(be,H,ue,"",function(Ge){return Ge})):be!=null&&(D(be)&&(be=$(be,ue+(!be.key||De&&De.key===be.key?"":(""+be.key).replace(M,"$&/")+"/")+U)),H.push(be)),1;if(De=0,Ie=Ie===""?".":Ie+":",E(U))for(var Fe=0;Fe<U.length;Fe++){ke=U[Fe];var Ae=Ie+O(ke,Fe);De+=Z(ke,H,ue,Ae,be)}else if(Ae=p(U),typeof Ae=="function")for(U=Ae.call(U),Fe=0;!(ke=U.next()).done;)ke=ke.value,Ae=Ie+O(ke,Fe++),De+=Z(ke,H,ue,Ae,be);else if(ke==="object")throw H=String(U),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return De}function q(U,H,ue){if(U==null)return U;var Ie=[],be=0;return Z(U,Ie,"","",function(ke){return H.call(ue,ke,be++)}),Ie}function se(U){if(U._status===-1){var H=U._result;H=H(),H.then(function(ue){(U._status===0||U._status===-1)&&(U._status=1,U._result=ue)},function(ue){(U._status===0||U._status===-1)&&(U._status=2,U._result=ue)}),U._status===-1&&(U._status=0,U._result=H)}if(U._status===1)return U._result.default;throw U._result}var le={current:null},j={transition:null},Q={ReactCurrentDispatcher:le,ReactCurrentBatchConfig:j,ReactCurrentOwner:L};function ee(){throw Error("act(...) is not supported in production builds of React.")}return _t.Children={map:q,forEach:function(U,H,ue){q(U,function(){H.apply(this,arguments)},ue)},count:function(U){var H=0;return q(U,function(){H++}),H},toArray:function(U){return q(U,function(H){return H})||[]},only:function(U){if(!D(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},_t.Component=x,_t.Fragment=t,_t.Profiler=s,_t.PureComponent=C,_t.StrictMode=r,_t.Suspense=l,_t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,_t.act=ee,_t.cloneElement=function(U,H,ue){if(U==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+U+".");var Ie=y({},U.props),be=U.key,ke=U.ref,De=U._owner;if(H!=null){if(H.ref!==void 0&&(ke=H.ref,De=L.current),H.key!==void 0&&(be=""+H.key),U.type&&U.type.defaultProps)var Fe=U.type.defaultProps;for(Ae in H)_.call(H,Ae)&&!P.hasOwnProperty(Ae)&&(Ie[Ae]=H[Ae]===void 0&&Fe!==void 0?Fe[Ae]:H[Ae])}var Ae=arguments.length-2;if(Ae===1)Ie.children=ue;else if(1<Ae){Fe=Array(Ae);for(var Ge=0;Ge<Ae;Ge++)Fe[Ge]=arguments[Ge+2];Ie.children=Fe}return{$$typeof:n,type:U.type,key:be,ref:ke,props:Ie,_owner:De}},_t.createContext=function(U){return U={$$typeof:o,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},U.Provider={$$typeof:i,_context:U},U.Consumer=U},_t.createElement=A,_t.createFactory=function(U){var H=A.bind(null,U);return H.type=U,H},_t.createRef=function(){return{current:null}},_t.forwardRef=function(U){return{$$typeof:a,render:U}},_t.isValidElement=D,_t.lazy=function(U){return{$$typeof:d,_payload:{_status:-1,_result:U},_init:se}},_t.memo=function(U,H){return{$$typeof:c,type:U,compare:H===void 0?null:H}},_t.startTransition=function(U){var H=j.transition;j.transition={};try{U()}finally{j.transition=H}},_t.unstable_act=ee,_t.useCallback=function(U,H){return le.current.useCallback(U,H)},_t.useContext=function(U){return le.current.useContext(U)},_t.useDebugValue=function(){},_t.useDeferredValue=function(U){return le.current.useDeferredValue(U)},_t.useEffect=function(U,H){return le.current.useEffect(U,H)},_t.useId=function(){return le.current.useId()},_t.useImperativeHandle=function(U,H,ue){return le.current.useImperativeHandle(U,H,ue)},_t.useInsertionEffect=function(U,H){return le.current.useInsertionEffect(U,H)},_t.useLayoutEffect=function(U,H){return le.current.useLayoutEffect(U,H)},_t.useMemo=function(U,H){return le.current.useMemo(U,H)},_t.useReducer=function(U,H,ue){return le.current.useReducer(U,H,ue)},_t.useRef=function(U){return le.current.useRef(U)},_t.useState=function(U){return le.current.useState(U)},_t.useSyncExternalStore=function(U,H,ue){return le.current.useSyncExternalStore(U,H,ue)},_t.useTransition=function(){return le.current.useTransition()},_t.version="18.3.1",_t}var cT;function gb(){return cT||(cT=1,bw.exports=p3()),bw.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hT;function m3(){if(hT)return kd;hT=1;var n=gb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var d,f={},p=null,g=null;c!==void 0&&(p=""+c),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)r.call(l,d)&&!i.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:s.current}}return kd.Fragment=t,kd.jsx=o,kd.jsxs=o,kd}var dT;function g3(){return dT||(dT=1,ww.exports=m3()),ww.exports}var te=g3(),ge=gb(),ag={},Iw={exports:{}},Ts={},Cw={exports:{}},Sw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fT;function y3(){return fT||(fT=1,function(n){function e(j,Q){var ee=j.length;j.push(Q);e:for(;0<ee;){var U=ee-1>>>1,H=j[U];if(0<s(H,Q))j[U]=Q,j[ee]=H,ee=U;else break e}}function t(j){return j.length===0?null:j[0]}function r(j){if(j.length===0)return null;var Q=j[0],ee=j.pop();if(ee!==Q){j[0]=ee;e:for(var U=0,H=j.length,ue=H>>>1;U<ue;){var Ie=2*(U+1)-1,be=j[Ie],ke=Ie+1,De=j[ke];if(0>s(be,ee))ke<H&&0>s(De,be)?(j[U]=De,j[ke]=ee,U=ke):(j[U]=be,j[Ie]=ee,U=Ie);else if(ke<H&&0>s(De,ee))j[U]=De,j[ke]=ee,U=ke;else break e}}return Q}function s(j,Q){var ee=j.sortIndex-Q.sortIndex;return ee!==0?ee:j.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],d=1,f=null,p=3,g=!1,y=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(j){for(var Q=t(c);Q!==null;){if(Q.callback===null)r(c);else if(Q.startTime<=j)r(c),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=t(c)}}function E(j){if(w=!1,k(j),!y)if(t(l)!==null)y=!0,se(_);else{var Q=t(c);Q!==null&&le(E,Q.startTime-j)}}function _(j,Q){y=!1,w&&(w=!1,I(A),A=-1),g=!0;var ee=p;try{for(k(Q),f=t(l);f!==null&&(!(f.expirationTime>Q)||j&&!R());){var U=f.callback;if(typeof U=="function"){f.callback=null,p=f.priorityLevel;var H=U(f.expirationTime<=Q);Q=n.unstable_now(),typeof H=="function"?f.callback=H:f===t(l)&&r(l),k(Q)}else r(l);f=t(l)}if(f!==null)var ue=!0;else{var Ie=t(c);Ie!==null&&le(E,Ie.startTime-Q),ue=!1}return ue}finally{f=null,p=ee,g=!1}}var L=!1,P=null,A=-1,$=5,D=-1;function R(){return!(n.unstable_now()-D<$)}function M(){if(P!==null){var j=n.unstable_now();D=j;var Q=!0;try{Q=P(!0,j)}finally{Q?O():(L=!1,P=null)}}else L=!1}var O;if(typeof C=="function")O=function(){C(M)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,q=Z.port2;Z.port1.onmessage=M,O=function(){q.postMessage(null)}}else O=function(){x(M,0)};function se(j){P=j,L||(L=!0,O())}function le(j,Q){A=x(function(){j(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(j){j.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,se(_))},n.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<j?Math.floor(1e3/j):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(j){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var ee=p;p=Q;try{return j()}finally{p=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(j,Q){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var ee=p;p=j;try{return Q()}finally{p=ee}},n.unstable_scheduleCallback=function(j,Q,ee){var U=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?U+ee:U):ee=U,j){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=ee+H,j={id:d++,callback:Q,priorityLevel:j,startTime:ee,expirationTime:H,sortIndex:-1},ee>U?(j.sortIndex=ee,e(c,j),t(l)===null&&j===t(c)&&(w?(I(A),A=-1):w=!0,le(E,ee-U))):(j.sortIndex=H,e(l,j),y||g||(y=!0,se(_))),j},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(j){var Q=p;return function(){var ee=p;p=Q;try{return j.apply(this,arguments)}finally{p=ee}}}}(Sw)),Sw}var pT;function v3(){return pT||(pT=1,Cw.exports=y3()),Cw.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mT;function x3(){if(mT)return Ts;mT=1;var n=gb(),e=v3();function t(u){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+u,m=1;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(u,h){o(u,h),o(u+"Capture",h)}function o(u,h){for(s[u]=h,u=0;u<h.length;u++)r.add(h[u])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(u){return l.call(f,u)?!0:l.call(d,u)?!1:c.test(u)?f[u]=!0:(d[u]=!0,!1)}function g(u,h,m,b){if(m!==null&&m.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return b?!1:m!==null?!m.acceptsBooleans:(u=u.toLowerCase().slice(0,5),u!=="data-"&&u!=="aria-");default:return!1}}function y(u,h,m,b){if(h===null||typeof h>"u"||g(u,h,m,b))return!0;if(b)return!1;if(m!==null)switch(m.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function w(u,h,m,b,S,N,V){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=b,this.attributeNamespace=S,this.mustUseProperty=m,this.propertyName=u,this.type=h,this.sanitizeURL=N,this.removeEmptyString=V}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(u){x[u]=new w(u,0,!1,u,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(u){var h=u[0];x[h]=new w(h,1,!1,u[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(u){x[u]=new w(u,2,!1,u.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(u){x[u]=new w(u,2,!1,u,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(u){x[u]=new w(u,3,!1,u.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(u){x[u]=new w(u,3,!0,u,null,!1,!1)}),["capture","download"].forEach(function(u){x[u]=new w(u,4,!1,u,null,!1,!1)}),["cols","rows","size","span"].forEach(function(u){x[u]=new w(u,6,!1,u,null,!1,!1)}),["rowSpan","start"].forEach(function(u){x[u]=new w(u,5,!1,u.toLowerCase(),null,!1,!1)});var I=/[\-:]([a-z])/g;function C(u){return u[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(u){var h=u.replace(I,C);x[h]=new w(h,1,!1,u,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(u){var h=u.replace(I,C);x[h]=new w(h,1,!1,u,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(u){var h=u.replace(I,C);x[h]=new w(h,1,!1,u,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(u){x[u]=new w(u,1,!1,u.toLowerCase(),null,!1,!1)}),x.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(u){x[u]=new w(u,1,!1,u.toLowerCase(),null,!0,!0)});function k(u,h,m,b){var S=x.hasOwnProperty(h)?x[h]:null;(S!==null?S.type!==0:b||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(y(h,m,S,b)&&(m=null),b||S===null?p(h)&&(m===null?u.removeAttribute(h):u.setAttribute(h,""+m)):S.mustUseProperty?u[S.propertyName]=m===null?S.type===3?!1:"":m:(h=S.attributeName,b=S.attributeNamespace,m===null?u.removeAttribute(h):(S=S.type,m=S===3||S===4&&m===!0?"":""+m,b?u.setAttributeNS(b,h,m):u.setAttribute(h,m))))}var E=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),L=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),R=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),le=Symbol.for("react.offscreen"),j=Symbol.iterator;function Q(u){return u===null||typeof u!="object"?null:(u=j&&u[j]||u["@@iterator"],typeof u=="function"?u:null)}var ee=Object.assign,U;function H(u){if(U===void 0)try{throw Error()}catch(m){var h=m.stack.trim().match(/\n( *(at )?)/);U=h&&h[1]||""}return`
`+U+u}var ue=!1;function Ie(u,h){if(!u||ue)return"";ue=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(me){var b=me}Reflect.construct(u,[],h)}else{try{h.call()}catch(me){b=me}u.call(h.prototype)}else{try{throw Error()}catch(me){b=me}u()}}catch(me){if(me&&b&&typeof me.stack=="string"){for(var S=me.stack.split(`
`),N=b.stack.split(`
`),V=S.length-1,W=N.length-1;1<=V&&0<=W&&S[V]!==N[W];)W--;for(;1<=V&&0<=W;V--,W--)if(S[V]!==N[W]){if(V!==1||W!==1)do if(V--,W--,0>W||S[V]!==N[W]){var K=`
`+S[V].replace(" at new "," at ");return u.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",u.displayName)),K}while(1<=V&&0<=W);break}}}finally{ue=!1,Error.prepareStackTrace=m}return(u=u?u.displayName||u.name:"")?H(u):""}function be(u){switch(u.tag){case 5:return H(u.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return u=Ie(u.type,!1),u;case 11:return u=Ie(u.type.render,!1),u;case 1:return u=Ie(u.type,!0),u;default:return""}}function ke(u){if(u==null)return null;if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case P:return"Fragment";case L:return"Portal";case $:return"Profiler";case A:return"StrictMode";case O:return"Suspense";case Z:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case R:return(u.displayName||"Context")+".Consumer";case D:return(u._context.displayName||"Context")+".Provider";case M:var h=u.render;return u=u.displayName,u||(u=h.displayName||h.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case q:return h=u.displayName||null,h!==null?h:ke(u.type)||"Memo";case se:h=u._payload,u=u._init;try{return ke(u(h))}catch{}}return null}function De(u){var h=u.type;switch(u.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return u=h.render,u=u.displayName||u.name||"",h.displayName||(u!==""?"ForwardRef("+u+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ke(h);case 8:return h===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function Fe(u){switch(typeof u){case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Ae(u){var h=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Ge(u){var h=Ae(u)?"checked":"value",m=Object.getOwnPropertyDescriptor(u.constructor.prototype,h),b=""+u[h];if(!u.hasOwnProperty(h)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var S=m.get,N=m.set;return Object.defineProperty(u,h,{configurable:!0,get:function(){return S.call(this)},set:function(V){b=""+V,N.call(this,V)}}),Object.defineProperty(u,h,{enumerable:m.enumerable}),{getValue:function(){return b},setValue:function(V){b=""+V},stopTracking:function(){u._valueTracker=null,delete u[h]}}}}function st(u){u._valueTracker||(u._valueTracker=Ge(u))}function Et(u){if(!u)return!1;var h=u._valueTracker;if(!h)return!0;var m=h.getValue(),b="";return u&&(b=Ae(u)?u.checked?"true":"false":u.value),u=b,u!==m?(h.setValue(u),!0):!1}function gt(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}function Wt(u,h){var m=h.checked;return ee({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??u._wrapperState.initialChecked})}function Rt(u,h){var m=h.defaultValue==null?"":h.defaultValue,b=h.checked!=null?h.checked:h.defaultChecked;m=Fe(h.value!=null?h.value:m),u._wrapperState={initialChecked:b,initialValue:m,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function kt(u,h){h=h.checked,h!=null&&k(u,"checked",h,!1)}function Ht(u,h){kt(u,h);var m=Fe(h.value),b=h.type;if(m!=null)b==="number"?(m===0&&u.value===""||u.value!=m)&&(u.value=""+m):u.value!==""+m&&(u.value=""+m);else if(b==="submit"||b==="reset"){u.removeAttribute("value");return}h.hasOwnProperty("value")?mr(u,h.type,m):h.hasOwnProperty("defaultValue")&&mr(u,h.type,Fe(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(u.defaultChecked=!!h.defaultChecked)}function qt(u,h,m){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var b=h.type;if(!(b!=="submit"&&b!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+u._wrapperState.initialValue,m||h===u.value||(u.value=h),u.defaultValue=h}m=u.name,m!==""&&(u.name=""),u.defaultChecked=!!u._wrapperState.initialChecked,m!==""&&(u.name=m)}function mr(u,h,m){(h!=="number"||gt(u.ownerDocument)!==u)&&(m==null?u.defaultValue=""+u._wrapperState.initialValue:u.defaultValue!==""+m&&(u.defaultValue=""+m))}var nn=Array.isArray;function pn(u,h,m,b){if(u=u.options,h){h={};for(var S=0;S<m.length;S++)h["$"+m[S]]=!0;for(m=0;m<u.length;m++)S=h.hasOwnProperty("$"+u[m].value),u[m].selected!==S&&(u[m].selected=S),S&&b&&(u[m].defaultSelected=!0)}else{for(m=""+Fe(m),h=null,S=0;S<u.length;S++){if(u[S].value===m){u[S].selected=!0,b&&(u[S].defaultSelected=!0);return}h!==null||u[S].disabled||(h=u[S])}h!==null&&(h.selected=!0)}}function yn(u,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return ee({},h,{value:void 0,defaultValue:void 0,children:""+u._wrapperState.initialValue})}function Tr(u,h){var m=h.value;if(m==null){if(m=h.children,h=h.defaultValue,m!=null){if(h!=null)throw Error(t(92));if(nn(m)){if(1<m.length)throw Error(t(93));m=m[0]}h=m}h==null&&(h=""),m=h}u._wrapperState={initialValue:Fe(m)}}function Dn(u,h){var m=Fe(h.value),b=Fe(h.defaultValue);m!=null&&(m=""+m,m!==u.value&&(u.value=m),h.defaultValue==null&&u.defaultValue!==m&&(u.defaultValue=m)),b!=null&&(u.defaultValue=""+b)}function En(u){var h=u.textContent;h===u._wrapperState.initialValue&&h!==""&&h!==null&&(u.value=h)}function Tt(u){switch(u){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jt(u,h){return u==null||u==="http://www.w3.org/1999/xhtml"?Tt(h):u==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":u}var Pn,Os=function(u){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,m,b,S){MSApp.execUnsafeLocalFunction(function(){return u(h,m,b,S)})}:u}(function(u,h){if(u.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in u)u.innerHTML=h;else{for(Pn=Pn||document.createElement("div"),Pn.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Pn.firstChild;u.firstChild;)u.removeChild(u.firstChild);for(;h.firstChild;)u.appendChild(h.firstChild)}});function Wn(u,h){if(h){var m=u.firstChild;if(m&&m===u.lastChild&&m.nodeType===3){m.nodeValue=h;return}}u.textContent=h}var ys={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zs=["Webkit","ms","Moz","O"];Object.keys(ys).forEach(function(u){Zs.forEach(function(h){h=h+u.charAt(0).toUpperCase()+u.substring(1),ys[h]=ys[u]})});function Ls(u,h,m){return h==null||typeof h=="boolean"||h===""?"":m||typeof h!="number"||h===0||ys.hasOwnProperty(u)&&ys[u]?(""+h).trim():h+"px"}function Bo(u,h){u=u.style;for(var m in h)if(h.hasOwnProperty(m)){var b=m.indexOf("--")===0,S=Ls(m,h[m],b);m==="float"&&(m="cssFloat"),b?u.setProperty(m,S):u[m]=S}}var ro=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function so(u,h){if(h){if(ro[u]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,u));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function _a(u,h){if(u.indexOf("-")===-1)return typeof h.is=="string";switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bi=null;function Ra(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Uo=null,vs=null,Ms=null;function Ii(u){if(u=hd(u)){if(typeof Uo!="function")throw Error(t(280));var h=u.stateNode;h&&(h=Im(h),Uo(u.stateNode,u.type,h))}}function is(u){vs?Ms?Ms.push(u):Ms=[u]:vs=u}function Ul(){if(vs){var u=vs,h=Ms;if(Ms=vs=null,Ii(u),h)for(u=0;u<h.length;u++)Ii(h[u])}}function Wo(u,h){return u(h)}function X(){}var ae=!1;function ye(u,h,m){if(ae)return u(h,m);ae=!0;try{return Wo(u,h,m)}finally{ae=!1,(vs!==null||Ms!==null)&&(X(),Ul())}}function Ce(u,h){var m=u.stateNode;if(m===null)return null;var b=Im(m);if(b===null)return null;m=b[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(u=u.type,b=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!b;break e;default:u=!1}if(u)return null;if(m&&typeof m!="function")throw Error(t(231,h,typeof m));return m}var Be=!1;if(a)try{var He={};Object.defineProperty(He,"passive",{get:function(){Be=!0}}),window.addEventListener("test",He,He),window.removeEventListener("test",He,He)}catch{Be=!1}function ot(u,h,m,b,S,N,V,W,K){var me=Array.prototype.slice.call(arguments,3);try{h.apply(m,me)}catch(Re){this.onError(Re)}}var Ue=!1,Ke=null,Oe=!1,ht=null,xt={onError:function(u){Ue=!0,Ke=u}};function Zt(u,h,m,b,S,N,V,W,K){Ue=!1,Ke=null,ot.apply(xt,arguments)}function Fn(u,h,m,b,S,N,V,W,K){if(Zt.apply(this,arguments),Ue){if(Ue){var me=Ke;Ue=!1,Ke=null}else throw Error(t(198));Oe||(Oe=!0,ht=me)}}function Dt(u){var h=u,m=u;if(u.alternate)for(;h.return;)h=h.return;else{u=h;do h=u,h.flags&4098&&(m=h.return),u=h.return;while(u)}return h.tag===3?m:null}function Gt(u){if(u.tag===13){var h=u.memoizedState;if(h===null&&(u=u.alternate,u!==null&&(h=u.memoizedState)),h!==null)return h.dehydrated}return null}function en(u){if(Dt(u)!==u)throw Error(t(188))}function Ci(u){var h=u.alternate;if(!h){if(h=Dt(u),h===null)throw Error(t(188));return h!==u?null:u}for(var m=u,b=h;;){var S=m.return;if(S===null)break;var N=S.alternate;if(N===null){if(b=S.return,b!==null){m=b;continue}break}if(S.child===N.child){for(N=S.child;N;){if(N===m)return en(S),u;if(N===b)return en(S),h;N=N.sibling}throw Error(t(188))}if(m.return!==b.return)m=S,b=N;else{for(var V=!1,W=S.child;W;){if(W===m){V=!0,m=S,b=N;break}if(W===b){V=!0,b=S,m=N;break}W=W.sibling}if(!V){for(W=N.child;W;){if(W===m){V=!0,m=N,b=S;break}if(W===b){V=!0,b=N,m=S;break}W=W.sibling}if(!V)throw Error(t(189))}}if(m.alternate!==b)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?u:h}function Si(u){return u=Ci(u),u!==null?Wr(u):null}function Wr(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){var h=Wr(u);if(h!==null)return h;u=u.sibling}return null}var _r=e.unstable_scheduleCallback,Go=e.unstable_cancelCallback,io=e.unstable_shouldYield,Ei=e.unstable_requestPaint,tn=e.unstable_now,jo=e.unstable_getCurrentPriorityLevel,Vt=e.unstable_ImmediatePriority,vn=e.unstable_UserBlockingPriority,Rr=e.unstable_NormalPriority,ki=e.unstable_LowPriority,xn=e.unstable_IdlePriority,xs=null,Gr=null;function sc(u){if(Gr&&typeof Gr.onCommitFiberRoot=="function")try{Gr.onCommitFiberRoot(xs,u,void 0,(u.current.flags&128)===128)}catch{}}var os=Math.clz32?Math.clz32:em,Xh=Math.log,Zp=Math.LN2;function em(u){return u>>>=0,u===0?32:31-(Xh(u)/Zp|0)|0}var ic=64,oc=4194304;function Na(u){switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return u&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return u}}function Wl(u,h){var m=u.pendingLanes;if(m===0)return 0;var b=0,S=u.suspendedLanes,N=u.pingedLanes,V=m&268435455;if(V!==0){var W=V&~S;W!==0?b=Na(W):(N&=V,N!==0&&(b=Na(N)))}else V=m&~S,V!==0?b=Na(V):N!==0&&(b=Na(N));if(b===0)return 0;if(h!==0&&h!==b&&!(h&S)&&(S=b&-b,N=h&-h,S>=N||S===16&&(N&4194240)!==0))return h;if(b&4&&(b|=m&16),h=u.entangledLanes,h!==0)for(u=u.entanglements,h&=b;0<h;)m=31-os(h),S=1<<m,b|=u[m],h&=~S;return b}function Yv(u,h){switch(u){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ho(u,h){for(var m=u.suspendedLanes,b=u.pingedLanes,S=u.expirationTimes,N=u.pendingLanes;0<N;){var V=31-os(N),W=1<<V,K=S[V];K===-1?(!(W&m)||W&b)&&(S[V]=Yv(W,h)):K<=h&&(u.expiredLanes|=W),N&=~W}}function Vs(u){return u=u.pendingLanes&-1073741825,u!==0?u:u&1073741824?1073741824:0}function Gl(){var u=ic;return ic<<=1,!(ic&4194240)&&(ic=64),u}function Aa(u){for(var h=[],m=0;31>m;m++)h.push(u);return h}function $a(u,h,m){u.pendingLanes|=h,h!==536870912&&(u.suspendedLanes=0,u.pingedLanes=0),u=u.eventTimes,h=31-os(h),u[h]=m}function cn(u,h){var m=u.pendingLanes&~h;u.pendingLanes=h,u.suspendedLanes=0,u.pingedLanes=0,u.expiredLanes&=h,u.mutableReadLanes&=h,u.entangledLanes&=h,h=u.entanglements;var b=u.eventTimes;for(u=u.expirationTimes;0<m;){var S=31-os(m),N=1<<S;h[S]=0,b[S]=-1,u[S]=-1,m&=~N}}function Da(u,h){var m=u.entangledLanes|=h;for(u=u.entanglements;m;){var b=31-os(m),S=1<<b;S&h|u[b]&h&&(u[b]|=h),m&=~S}}var Pt=0;function Pa(u){return u&=-u,1<u?4<u?u&268435455?16:536870912:4:1}var tm,ac,nm,rm,sm,Yh=!1,oo=[],Nr=null,Ti=null,_i=null,Fa=new Map,ei=new Map,ao=[],Qv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function im(u,h){switch(u){case"focusin":case"focusout":Nr=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":_i=null;break;case"pointerover":case"pointerout":Fa.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":ei.delete(h.pointerId)}}function ws(u,h,m,b,S,N){return u===null||u.nativeEvent!==N?(u={blockedOn:h,domEventName:m,eventSystemFlags:b,nativeEvent:N,targetContainers:[S]},h!==null&&(h=hd(h),h!==null&&ac(h)),u):(u.eventSystemFlags|=b,h=u.targetContainers,S!==null&&h.indexOf(S)===-1&&h.push(S),u)}function Jv(u,h,m,b,S){switch(h){case"focusin":return Nr=ws(Nr,u,h,m,b,S),!0;case"dragenter":return Ti=ws(Ti,u,h,m,b,S),!0;case"mouseover":return _i=ws(_i,u,h,m,b,S),!0;case"pointerover":var N=S.pointerId;return Fa.set(N,ws(Fa.get(N)||null,u,h,m,b,S)),!0;case"gotpointercapture":return N=S.pointerId,ei.set(N,ws(ei.get(N)||null,u,h,m,b,S)),!0}return!1}function om(u){var h=Xl(u.target);if(h!==null){var m=Dt(h);if(m!==null){if(h=m.tag,h===13){if(h=Gt(m),h!==null){u.blockedOn=h,sm(u.priority,function(){nm(m)});return}}else if(h===3&&m.stateNode.current.memoizedState.isDehydrated){u.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}u.blockedOn=null}function qo(u){if(u.blockedOn!==null)return!1;for(var h=u.targetContainers;0<h.length;){var m=lc(u.domEventName,u.eventSystemFlags,h[0],u.nativeEvent);if(m===null){m=u.nativeEvent;var b=new m.constructor(m.type,m);bi=b,m.target.dispatchEvent(b),bi=null}else return h=hd(m),h!==null&&ac(h),u.blockedOn=m,!1;h.shift()}return!0}function jl(u,h,m){qo(u)&&m.delete(h)}function am(){Yh=!1,Nr!==null&&qo(Nr)&&(Nr=null),Ti!==null&&qo(Ti)&&(Ti=null),_i!==null&&qo(_i)&&(_i=null),Fa.forEach(jl),ei.forEach(jl)}function Ri(u,h){u.blockedOn===h&&(u.blockedOn=null,Yh||(Yh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,am)))}function Ni(u){function h(S){return Ri(S,u)}if(0<oo.length){Ri(oo[0],u);for(var m=1;m<oo.length;m++){var b=oo[m];b.blockedOn===u&&(b.blockedOn=null)}}for(Nr!==null&&Ri(Nr,u),Ti!==null&&Ri(Ti,u),_i!==null&&Ri(_i,u),Fa.forEach(h),ei.forEach(h),m=0;m<ao.length;m++)b=ao[m],b.blockedOn===u&&(b.blockedOn=null);for(;0<ao.length&&(m=ao[0],m.blockedOn===null);)om(m),m.blockedOn===null&&ao.shift()}var Ko=E.ReactCurrentBatchConfig,Oa=!0;function kn(u,h,m,b){var S=Pt,N=Ko.transition;Ko.transition=null;try{Pt=1,Qh(u,h,m,b)}finally{Pt=S,Ko.transition=N}}function Zv(u,h,m,b){var S=Pt,N=Ko.transition;Ko.transition=null;try{Pt=4,Qh(u,h,m,b)}finally{Pt=S,Ko.transition=N}}function Qh(u,h,m,b){if(Oa){var S=lc(u,h,m,b);if(S===null)cx(u,h,b,Hl,m),im(u,b);else if(Jv(S,u,h,m,b))b.stopPropagation();else if(im(u,b),h&4&&-1<Qv.indexOf(u)){for(;S!==null;){var N=hd(S);if(N!==null&&tm(N),N=lc(u,h,m,b),N===null&&cx(u,h,b,Hl,m),N===S)break;S=N}S!==null&&b.stopPropagation()}else cx(u,h,b,null,m)}}var Hl=null;function lc(u,h,m,b){if(Hl=null,u=Ra(b),u=Xl(u),u!==null)if(h=Dt(u),h===null)u=null;else if(m=h.tag,m===13){if(u=Gt(h),u!==null)return u;u=null}else if(m===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;u=null}else h!==u&&(u=null);return Hl=u,null}function Jh(u){switch(u){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jo()){case Vt:return 1;case vn:return 4;case Rr:case ki:return 16;case xn:return 536870912;default:return 16}default:return 16}}var zs=null,uc=null,bs=null;function Zh(){if(bs)return bs;var u,h=uc,m=h.length,b,S="value"in zs?zs.value:zs.textContent,N=S.length;for(u=0;u<m&&h[u]===S[u];u++);var V=m-u;for(b=1;b<=V&&h[m-b]===S[N-b];b++);return bs=S.slice(u,1<b?1-b:void 0)}function cc(u){var h=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&h===13&&(u=13)):u=h,u===10&&(u=13),32<=u||u===13?u:0}function lo(){return!0}function ed(){return!1}function Ar(u){function h(m,b,S,N,V){this._reactName=m,this._targetInst=S,this.type=b,this.nativeEvent=N,this.target=V,this.currentTarget=null;for(var W in u)u.hasOwnProperty(W)&&(m=u[W],this[W]=m?m(N):N[W]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?lo:ed,this.isPropagationStopped=ed,this}return ee(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=lo)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=lo)},persist:function(){},isPersistent:lo}),h}var Ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hc=Ar(Ai),uo=ee({},Ai,{view:0,detail:0}),ex=Ar(uo),dc,Xo,La,ql=ee({},uo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:co,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==La&&(La&&u.type==="mousemove"?(dc=u.screenX-La.screenX,Xo=u.screenY-La.screenY):Xo=dc=0,La=u),dc)},movementY:function(u){return"movementY"in u?u.movementY:Xo}}),fc=Ar(ql),td=ee({},ql,{dataTransfer:0}),lm=Ar(td),pc=ee({},uo,{relatedTarget:0}),mc=Ar(pc),um=ee({},Ai,{animationName:0,elapsedTime:0,pseudoElement:0}),Yo=Ar(um),cm=ee({},Ai,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),hm=Ar(cm),dm=ee({},Ai,{data:0}),nd=Ar(dm),gc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},as={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pm(u){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(u):(u=fm[u])?!!h[u]:!1}function co(){return pm}var v=ee({},uo,{key:function(u){if(u.key){var h=gc[u.key]||u.key;if(h!=="Unidentified")return h}return u.type==="keypress"?(u=cc(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?as[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:co,charCode:function(u){return u.type==="keypress"?cc(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?cc(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),T=Ar(v),F=ee({},ql,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),B=Ar(F),ce=ee({},uo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:co}),we=Ar(ce),Le=ee({},Ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),an=Ar(Le),ir=ee({},ql,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),zt=Ar(ir),gr=[9,13,27,32],Kn=a&&"CompositionEvent"in window,ti=null;a&&"documentMode"in document&&(ti=document.documentMode);var Bs=a&&"TextEvent"in window&&!ti,Kl=a&&(!Kn||ti&&8<ti&&11>=ti),yc=" ",rE=!1;function sE(u,h){switch(u){case"keyup":return gr.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iE(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var vc=!1;function uV(u,h){switch(u){case"compositionend":return iE(h);case"keypress":return h.which!==32?null:(rE=!0,yc);case"textInput":return u=h.data,u===yc&&rE?null:u;default:return null}}function cV(u,h){if(vc)return u==="compositionend"||!Kn&&sE(u,h)?(u=Zh(),bs=uc=zs=null,vc=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Kl&&h.locale!=="ko"?null:h.data;default:return null}}var hV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oE(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h==="input"?!!hV[u.type]:h==="textarea"}function aE(u,h,m,b){is(b),h=xm(h,"onChange"),0<h.length&&(m=new hc("onChange","change",null,m,b),u.push({event:m,listeners:h}))}var rd=null,sd=null;function dV(u){EE(u,0)}function mm(u){var h=Cc(u);if(Et(h))return u}function fV(u,h){if(u==="change")return h}var lE=!1;if(a){var tx;if(a){var nx="oninput"in document;if(!nx){var uE=document.createElement("div");uE.setAttribute("oninput","return;"),nx=typeof uE.oninput=="function"}tx=nx}else tx=!1;lE=tx&&(!document.documentMode||9<document.documentMode)}function cE(){rd&&(rd.detachEvent("onpropertychange",hE),sd=rd=null)}function hE(u){if(u.propertyName==="value"&&mm(sd)){var h=[];aE(h,sd,u,Ra(u)),ye(dV,h)}}function pV(u,h,m){u==="focusin"?(cE(),rd=h,sd=m,rd.attachEvent("onpropertychange",hE)):u==="focusout"&&cE()}function mV(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return mm(sd)}function gV(u,h){if(u==="click")return mm(h)}function yV(u,h){if(u==="input"||u==="change")return mm(h)}function vV(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var $i=typeof Object.is=="function"?Object.is:vV;function id(u,h){if($i(u,h))return!0;if(typeof u!="object"||u===null||typeof h!="object"||h===null)return!1;var m=Object.keys(u),b=Object.keys(h);if(m.length!==b.length)return!1;for(b=0;b<m.length;b++){var S=m[b];if(!l.call(h,S)||!$i(u[S],h[S]))return!1}return!0}function dE(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function fE(u,h){var m=dE(u);u=0;for(var b;m;){if(m.nodeType===3){if(b=u+m.textContent.length,u<=h&&b>=h)return{node:m,offset:h-u};u=b}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=dE(m)}}function pE(u,h){return u&&h?u===h?!0:u&&u.nodeType===3?!1:h&&h.nodeType===3?pE(u,h.parentNode):"contains"in u?u.contains(h):u.compareDocumentPosition?!!(u.compareDocumentPosition(h)&16):!1:!1}function mE(){for(var u=window,h=gt();h instanceof u.HTMLIFrameElement;){try{var m=typeof h.contentWindow.location.href=="string"}catch{m=!1}if(m)u=h.contentWindow;else break;h=gt(u.document)}return h}function rx(u){var h=u&&u.nodeName&&u.nodeName.toLowerCase();return h&&(h==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||h==="textarea"||u.contentEditable==="true")}function xV(u){var h=mE(),m=u.focusedElem,b=u.selectionRange;if(h!==m&&m&&m.ownerDocument&&pE(m.ownerDocument.documentElement,m)){if(b!==null&&rx(m)){if(h=b.start,u=b.end,u===void 0&&(u=h),"selectionStart"in m)m.selectionStart=h,m.selectionEnd=Math.min(u,m.value.length);else if(u=(h=m.ownerDocument||document)&&h.defaultView||window,u.getSelection){u=u.getSelection();var S=m.textContent.length,N=Math.min(b.start,S);b=b.end===void 0?N:Math.min(b.end,S),!u.extend&&N>b&&(S=b,b=N,N=S),S=fE(m,N);var V=fE(m,b);S&&V&&(u.rangeCount!==1||u.anchorNode!==S.node||u.anchorOffset!==S.offset||u.focusNode!==V.node||u.focusOffset!==V.offset)&&(h=h.createRange(),h.setStart(S.node,S.offset),u.removeAllRanges(),N>b?(u.addRange(h),u.extend(V.node,V.offset)):(h.setEnd(V.node,V.offset),u.addRange(h)))}}for(h=[],u=m;u=u.parentNode;)u.nodeType===1&&h.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<h.length;m++)u=h[m],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var wV=a&&"documentMode"in document&&11>=document.documentMode,xc=null,sx=null,od=null,ix=!1;function gE(u,h,m){var b=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;ix||xc==null||xc!==gt(b)||(b=xc,"selectionStart"in b&&rx(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),od&&id(od,b)||(od=b,b=xm(sx,"onSelect"),0<b.length&&(h=new hc("onSelect","select",null,h,m),u.push({event:h,listeners:b}),h.target=xc)))}function gm(u,h){var m={};return m[u.toLowerCase()]=h.toLowerCase(),m["Webkit"+u]="webkit"+h,m["Moz"+u]="moz"+h,m}var wc={animationend:gm("Animation","AnimationEnd"),animationiteration:gm("Animation","AnimationIteration"),animationstart:gm("Animation","AnimationStart"),transitionend:gm("Transition","TransitionEnd")},ox={},yE={};a&&(yE=document.createElement("div").style,"AnimationEvent"in window||(delete wc.animationend.animation,delete wc.animationiteration.animation,delete wc.animationstart.animation),"TransitionEvent"in window||delete wc.transitionend.transition);function ym(u){if(ox[u])return ox[u];if(!wc[u])return u;var h=wc[u],m;for(m in h)if(h.hasOwnProperty(m)&&m in yE)return ox[u]=h[m];return u}var vE=ym("animationend"),xE=ym("animationiteration"),wE=ym("animationstart"),bE=ym("transitionend"),IE=new Map,CE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ma(u,h){IE.set(u,h),i(h,[u])}for(var ax=0;ax<CE.length;ax++){var lx=CE[ax],bV=lx.toLowerCase(),IV=lx[0].toUpperCase()+lx.slice(1);Ma(bV,"on"+IV)}Ma(vE,"onAnimationEnd"),Ma(xE,"onAnimationIteration"),Ma(wE,"onAnimationStart"),Ma("dblclick","onDoubleClick"),Ma("focusin","onFocus"),Ma("focusout","onBlur"),Ma(bE,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ad="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CV=new Set("cancel close invalid load scroll toggle".split(" ").concat(ad));function SE(u,h,m){var b=u.type||"unknown-event";u.currentTarget=m,Fn(b,h,void 0,u),u.currentTarget=null}function EE(u,h){h=(h&4)!==0;for(var m=0;m<u.length;m++){var b=u[m],S=b.event;b=b.listeners;e:{var N=void 0;if(h)for(var V=b.length-1;0<=V;V--){var W=b[V],K=W.instance,me=W.currentTarget;if(W=W.listener,K!==N&&S.isPropagationStopped())break e;SE(S,W,me),N=K}else for(V=0;V<b.length;V++){if(W=b[V],K=W.instance,me=W.currentTarget,W=W.listener,K!==N&&S.isPropagationStopped())break e;SE(S,W,me),N=K}}}if(Oe)throw u=ht,Oe=!1,ht=null,u}function wn(u,h){var m=h[gx];m===void 0&&(m=h[gx]=new Set);var b=u+"__bubble";m.has(b)||(kE(h,u,2,!1),m.add(b))}function ux(u,h,m){var b=0;h&&(b|=4),kE(m,u,b,h)}var vm="_reactListening"+Math.random().toString(36).slice(2);function ld(u){if(!u[vm]){u[vm]=!0,r.forEach(function(m){m!=="selectionchange"&&(CV.has(m)||ux(m,!1,u),ux(m,!0,u))});var h=u.nodeType===9?u:u.ownerDocument;h===null||h[vm]||(h[vm]=!0,ux("selectionchange",!1,h))}}function kE(u,h,m,b){switch(Jh(h)){case 1:var S=kn;break;case 4:S=Zv;break;default:S=Qh}m=S.bind(null,h,m,u),S=void 0,!Be||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(S=!0),b?S!==void 0?u.addEventListener(h,m,{capture:!0,passive:S}):u.addEventListener(h,m,!0):S!==void 0?u.addEventListener(h,m,{passive:S}):u.addEventListener(h,m,!1)}function cx(u,h,m,b,S){var N=b;if(!(h&1)&&!(h&2)&&b!==null)e:for(;;){if(b===null)return;var V=b.tag;if(V===3||V===4){var W=b.stateNode.containerInfo;if(W===S||W.nodeType===8&&W.parentNode===S)break;if(V===4)for(V=b.return;V!==null;){var K=V.tag;if((K===3||K===4)&&(K=V.stateNode.containerInfo,K===S||K.nodeType===8&&K.parentNode===S))return;V=V.return}for(;W!==null;){if(V=Xl(W),V===null)return;if(K=V.tag,K===5||K===6){b=N=V;continue e}W=W.parentNode}}b=b.return}ye(function(){var me=N,Re=Ra(m),$e=[];e:{var _e=IE.get(u);if(_e!==void 0){var We=hc,Qe=u;switch(u){case"keypress":if(cc(m)===0)break e;case"keydown":case"keyup":We=T;break;case"focusin":Qe="focus",We=mc;break;case"focusout":Qe="blur",We=mc;break;case"beforeblur":case"afterblur":We=mc;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":We=fc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":We=lm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":We=we;break;case vE:case xE:case wE:We=Yo;break;case bE:We=an;break;case"scroll":We=ex;break;case"wheel":We=zt;break;case"copy":case"cut":case"paste":We=hm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":We=B}var Ze=(h&4)!==0,Gn=!Ze&&u==="scroll",he=Ze?_e!==null?_e+"Capture":null:_e;Ze=[];for(var ne=me,fe;ne!==null;){fe=ne;var Pe=fe.stateNode;if(fe.tag===5&&Pe!==null&&(fe=Pe,he!==null&&(Pe=Ce(ne,he),Pe!=null&&Ze.push(ud(ne,Pe,fe)))),Gn)break;ne=ne.return}0<Ze.length&&(_e=new We(_e,Qe,null,m,Re),$e.push({event:_e,listeners:Ze}))}}if(!(h&7)){e:{if(_e=u==="mouseover"||u==="pointerover",We=u==="mouseout"||u==="pointerout",_e&&m!==bi&&(Qe=m.relatedTarget||m.fromElement)&&(Xl(Qe)||Qe[Qo]))break e;if((We||_e)&&(_e=Re.window===Re?Re:(_e=Re.ownerDocument)?_e.defaultView||_e.parentWindow:window,We?(Qe=m.relatedTarget||m.toElement,We=me,Qe=Qe?Xl(Qe):null,Qe!==null&&(Gn=Dt(Qe),Qe!==Gn||Qe.tag!==5&&Qe.tag!==6)&&(Qe=null)):(We=null,Qe=me),We!==Qe)){if(Ze=fc,Pe="onMouseLeave",he="onMouseEnter",ne="mouse",(u==="pointerout"||u==="pointerover")&&(Ze=B,Pe="onPointerLeave",he="onPointerEnter",ne="pointer"),Gn=We==null?_e:Cc(We),fe=Qe==null?_e:Cc(Qe),_e=new Ze(Pe,ne+"leave",We,m,Re),_e.target=Gn,_e.relatedTarget=fe,Pe=null,Xl(Re)===me&&(Ze=new Ze(he,ne+"enter",Qe,m,Re),Ze.target=fe,Ze.relatedTarget=Gn,Pe=Ze),Gn=Pe,We&&Qe)t:{for(Ze=We,he=Qe,ne=0,fe=Ze;fe;fe=bc(fe))ne++;for(fe=0,Pe=he;Pe;Pe=bc(Pe))fe++;for(;0<ne-fe;)Ze=bc(Ze),ne--;for(;0<fe-ne;)he=bc(he),fe--;for(;ne--;){if(Ze===he||he!==null&&Ze===he.alternate)break t;Ze=bc(Ze),he=bc(he)}Ze=null}else Ze=null;We!==null&&TE($e,_e,We,Ze,!1),Qe!==null&&Gn!==null&&TE($e,Gn,Qe,Ze,!0)}}e:{if(_e=me?Cc(me):window,We=_e.nodeName&&_e.nodeName.toLowerCase(),We==="select"||We==="input"&&_e.type==="file")var et=fV;else if(oE(_e))if(lE)et=yV;else{et=mV;var at=pV}else(We=_e.nodeName)&&We.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(et=gV);if(et&&(et=et(u,me))){aE($e,et,m,Re);break e}at&&at(u,_e,me),u==="focusout"&&(at=_e._wrapperState)&&at.controlled&&_e.type==="number"&&mr(_e,"number",_e.value)}switch(at=me?Cc(me):window,u){case"focusin":(oE(at)||at.contentEditable==="true")&&(xc=at,sx=me,od=null);break;case"focusout":od=sx=xc=null;break;case"mousedown":ix=!0;break;case"contextmenu":case"mouseup":case"dragend":ix=!1,gE($e,m,Re);break;case"selectionchange":if(wV)break;case"keydown":case"keyup":gE($e,m,Re)}var lt;if(Kn)e:{switch(u){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else vc?sE(u,m)&&(dt="onCompositionEnd"):u==="keydown"&&m.keyCode===229&&(dt="onCompositionStart");dt&&(Kl&&m.locale!=="ko"&&(vc||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&vc&&(lt=Zh()):(zs=Re,uc="value"in zs?zs.value:zs.textContent,vc=!0)),at=xm(me,dt),0<at.length&&(dt=new nd(dt,u,null,m,Re),$e.push({event:dt,listeners:at}),lt?dt.data=lt:(lt=iE(m),lt!==null&&(dt.data=lt)))),(lt=Bs?uV(u,m):cV(u,m))&&(me=xm(me,"onBeforeInput"),0<me.length&&(Re=new nd("onBeforeInput","beforeinput",null,m,Re),$e.push({event:Re,listeners:me}),Re.data=lt))}EE($e,h)})}function ud(u,h,m){return{instance:u,listener:h,currentTarget:m}}function xm(u,h){for(var m=h+"Capture",b=[];u!==null;){var S=u,N=S.stateNode;S.tag===5&&N!==null&&(S=N,N=Ce(u,m),N!=null&&b.unshift(ud(u,N,S)),N=Ce(u,h),N!=null&&b.push(ud(u,N,S))),u=u.return}return b}function bc(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5);return u||null}function TE(u,h,m,b,S){for(var N=h._reactName,V=[];m!==null&&m!==b;){var W=m,K=W.alternate,me=W.stateNode;if(K!==null&&K===b)break;W.tag===5&&me!==null&&(W=me,S?(K=Ce(m,N),K!=null&&V.unshift(ud(m,K,W))):S||(K=Ce(m,N),K!=null&&V.push(ud(m,K,W)))),m=m.return}V.length!==0&&u.push({event:h,listeners:V})}var SV=/\r\n?/g,EV=/\u0000|\uFFFD/g;function _E(u){return(typeof u=="string"?u:""+u).replace(SV,`
`).replace(EV,"")}function wm(u,h,m){if(h=_E(h),_E(u)!==h&&m)throw Error(t(425))}function bm(){}var hx=null,dx=null;function fx(u,h){return u==="textarea"||u==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var px=typeof setTimeout=="function"?setTimeout:void 0,kV=typeof clearTimeout=="function"?clearTimeout:void 0,RE=typeof Promise=="function"?Promise:void 0,TV=typeof queueMicrotask=="function"?queueMicrotask:typeof RE<"u"?function(u){return RE.resolve(null).then(u).catch(_V)}:px;function _V(u){setTimeout(function(){throw u})}function mx(u,h){var m=h,b=0;do{var S=m.nextSibling;if(u.removeChild(m),S&&S.nodeType===8)if(m=S.data,m==="/$"){if(b===0){u.removeChild(S),Ni(h);return}b--}else m!=="$"&&m!=="$?"&&m!=="$!"||b++;m=S}while(m);Ni(h)}function Va(u){for(;u!=null;u=u.nextSibling){var h=u.nodeType;if(h===1||h===3)break;if(h===8){if(h=u.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return u}function NE(u){u=u.previousSibling;for(var h=0;u;){if(u.nodeType===8){var m=u.data;if(m==="$"||m==="$!"||m==="$?"){if(h===0)return u;h--}else m==="/$"&&h++}u=u.previousSibling}return null}var Ic=Math.random().toString(36).slice(2),ho="__reactFiber$"+Ic,cd="__reactProps$"+Ic,Qo="__reactContainer$"+Ic,gx="__reactEvents$"+Ic,RV="__reactListeners$"+Ic,NV="__reactHandles$"+Ic;function Xl(u){var h=u[ho];if(h)return h;for(var m=u.parentNode;m;){if(h=m[Qo]||m[ho]){if(m=h.alternate,h.child!==null||m!==null&&m.child!==null)for(u=NE(u);u!==null;){if(m=u[ho])return m;u=NE(u)}return h}u=m,m=u.parentNode}return null}function hd(u){return u=u[ho]||u[Qo],!u||u.tag!==5&&u.tag!==6&&u.tag!==13&&u.tag!==3?null:u}function Cc(u){if(u.tag===5||u.tag===6)return u.stateNode;throw Error(t(33))}function Im(u){return u[cd]||null}var yx=[],Sc=-1;function za(u){return{current:u}}function bn(u){0>Sc||(u.current=yx[Sc],yx[Sc]=null,Sc--)}function mn(u,h){Sc++,yx[Sc]=u.current,u.current=h}var Ba={},jr=za(Ba),Is=za(!1),Yl=Ba;function Ec(u,h){var m=u.type.contextTypes;if(!m)return Ba;var b=u.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===h)return b.__reactInternalMemoizedMaskedChildContext;var S={},N;for(N in m)S[N]=h[N];return b&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=h,u.__reactInternalMemoizedMaskedChildContext=S),S}function Cs(u){return u=u.childContextTypes,u!=null}function Cm(){bn(Is),bn(jr)}function AE(u,h,m){if(jr.current!==Ba)throw Error(t(168));mn(jr,h),mn(Is,m)}function $E(u,h,m){var b=u.stateNode;if(h=h.childContextTypes,typeof b.getChildContext!="function")return m;b=b.getChildContext();for(var S in b)if(!(S in h))throw Error(t(108,De(u)||"Unknown",S));return ee({},m,b)}function Sm(u){return u=(u=u.stateNode)&&u.__reactInternalMemoizedMergedChildContext||Ba,Yl=jr.current,mn(jr,u),mn(Is,Is.current),!0}function DE(u,h,m){var b=u.stateNode;if(!b)throw Error(t(169));m?(u=$E(u,h,Yl),b.__reactInternalMemoizedMergedChildContext=u,bn(Is),bn(jr),mn(jr,u)):bn(Is),mn(Is,m)}var Jo=null,Em=!1,vx=!1;function PE(u){Jo===null?Jo=[u]:Jo.push(u)}function AV(u){Em=!0,PE(u)}function Ua(){if(!vx&&Jo!==null){vx=!0;var u=0,h=Pt;try{var m=Jo;for(Pt=1;u<m.length;u++){var b=m[u];do b=b(!0);while(b!==null)}Jo=null,Em=!1}catch(S){throw Jo!==null&&(Jo=Jo.slice(u+1)),_r(Vt,Ua),S}finally{Pt=h,vx=!1}}return null}var kc=[],Tc=0,km=null,Tm=0,ni=[],ri=0,Ql=null,Zo=1,ea="";function Jl(u,h){kc[Tc++]=Tm,kc[Tc++]=km,km=u,Tm=h}function FE(u,h,m){ni[ri++]=Zo,ni[ri++]=ea,ni[ri++]=Ql,Ql=u;var b=Zo;u=ea;var S=32-os(b)-1;b&=~(1<<S),m+=1;var N=32-os(h)+S;if(30<N){var V=S-S%5;N=(b&(1<<V)-1).toString(32),b>>=V,S-=V,Zo=1<<32-os(h)+S|m<<S|b,ea=N+u}else Zo=1<<N|m<<S|b,ea=u}function xx(u){u.return!==null&&(Jl(u,1),FE(u,1,0))}function wx(u){for(;u===km;)km=kc[--Tc],kc[Tc]=null,Tm=kc[--Tc],kc[Tc]=null;for(;u===Ql;)Ql=ni[--ri],ni[ri]=null,ea=ni[--ri],ni[ri]=null,Zo=ni[--ri],ni[ri]=null}var Us=null,Ws=null,Tn=!1,Di=null;function OE(u,h){var m=ai(5,null,null,0);m.elementType="DELETED",m.stateNode=h,m.return=u,h=u.deletions,h===null?(u.deletions=[m],u.flags|=16):h.push(m)}function LE(u,h){switch(u.tag){case 5:var m=u.type;return h=h.nodeType!==1||m.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(u.stateNode=h,Us=u,Ws=Va(h.firstChild),!0):!1;case 6:return h=u.pendingProps===""||h.nodeType!==3?null:h,h!==null?(u.stateNode=h,Us=u,Ws=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(m=Ql!==null?{id:Zo,overflow:ea}:null,u.memoizedState={dehydrated:h,treeContext:m,retryLane:1073741824},m=ai(18,null,null,0),m.stateNode=h,m.return=u,u.child=m,Us=u,Ws=null,!0):!1;default:return!1}}function bx(u){return(u.mode&1)!==0&&(u.flags&128)===0}function Ix(u){if(Tn){var h=Ws;if(h){var m=h;if(!LE(u,h)){if(bx(u))throw Error(t(418));h=Va(m.nextSibling);var b=Us;h&&LE(u,h)?OE(b,m):(u.flags=u.flags&-4097|2,Tn=!1,Us=u)}}else{if(bx(u))throw Error(t(418));u.flags=u.flags&-4097|2,Tn=!1,Us=u}}}function ME(u){for(u=u.return;u!==null&&u.tag!==5&&u.tag!==3&&u.tag!==13;)u=u.return;Us=u}function _m(u){if(u!==Us)return!1;if(!Tn)return ME(u),Tn=!0,!1;var h;if((h=u.tag!==3)&&!(h=u.tag!==5)&&(h=u.type,h=h!=="head"&&h!=="body"&&!fx(u.type,u.memoizedProps)),h&&(h=Ws)){if(bx(u))throw VE(),Error(t(418));for(;h;)OE(u,h),h=Va(h.nextSibling)}if(ME(u),u.tag===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(t(317));e:{for(u=u.nextSibling,h=0;u;){if(u.nodeType===8){var m=u.data;if(m==="/$"){if(h===0){Ws=Va(u.nextSibling);break e}h--}else m!=="$"&&m!=="$!"&&m!=="$?"||h++}u=u.nextSibling}Ws=null}}else Ws=Us?Va(u.stateNode.nextSibling):null;return!0}function VE(){for(var u=Ws;u;)u=Va(u.nextSibling)}function _c(){Ws=Us=null,Tn=!1}function Cx(u){Di===null?Di=[u]:Di.push(u)}var $V=E.ReactCurrentBatchConfig;function dd(u,h,m){if(u=m.ref,u!==null&&typeof u!="function"&&typeof u!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var b=m.stateNode}if(!b)throw Error(t(147,u));var S=b,N=""+u;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===N?h.ref:(h=function(V){var W=S.refs;V===null?delete W[N]:W[N]=V},h._stringRef=N,h)}if(typeof u!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,u))}return u}function Rm(u,h){throw u=Object.prototype.toString.call(h),Error(t(31,u==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":u))}function zE(u){var h=u._init;return h(u._payload)}function BE(u){function h(he,ne){if(u){var fe=he.deletions;fe===null?(he.deletions=[ne],he.flags|=16):fe.push(ne)}}function m(he,ne){if(!u)return null;for(;ne!==null;)h(he,ne),ne=ne.sibling;return null}function b(he,ne){for(he=new Map;ne!==null;)ne.key!==null?he.set(ne.key,ne):he.set(ne.index,ne),ne=ne.sibling;return he}function S(he,ne){return he=Ya(he,ne),he.index=0,he.sibling=null,he}function N(he,ne,fe){return he.index=fe,u?(fe=he.alternate,fe!==null?(fe=fe.index,fe<ne?(he.flags|=2,ne):fe):(he.flags|=2,ne)):(he.flags|=1048576,ne)}function V(he){return u&&he.alternate===null&&(he.flags|=2),he}function W(he,ne,fe,Pe){return ne===null||ne.tag!==6?(ne=pw(fe,he.mode,Pe),ne.return=he,ne):(ne=S(ne,fe),ne.return=he,ne)}function K(he,ne,fe,Pe){var et=fe.type;return et===P?Re(he,ne,fe.props.children,Pe,fe.key):ne!==null&&(ne.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===se&&zE(et)===ne.type)?(Pe=S(ne,fe.props),Pe.ref=dd(he,ne,fe),Pe.return=he,Pe):(Pe=Zm(fe.type,fe.key,fe.props,null,he.mode,Pe),Pe.ref=dd(he,ne,fe),Pe.return=he,Pe)}function me(he,ne,fe,Pe){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==fe.containerInfo||ne.stateNode.implementation!==fe.implementation?(ne=mw(fe,he.mode,Pe),ne.return=he,ne):(ne=S(ne,fe.children||[]),ne.return=he,ne)}function Re(he,ne,fe,Pe,et){return ne===null||ne.tag!==7?(ne=ou(fe,he.mode,Pe,et),ne.return=he,ne):(ne=S(ne,fe),ne.return=he,ne)}function $e(he,ne,fe){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=pw(""+ne,he.mode,fe),ne.return=he,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case _:return fe=Zm(ne.type,ne.key,ne.props,null,he.mode,fe),fe.ref=dd(he,null,ne),fe.return=he,fe;case L:return ne=mw(ne,he.mode,fe),ne.return=he,ne;case se:var Pe=ne._init;return $e(he,Pe(ne._payload),fe)}if(nn(ne)||Q(ne))return ne=ou(ne,he.mode,fe,null),ne.return=he,ne;Rm(he,ne)}return null}function _e(he,ne,fe,Pe){var et=ne!==null?ne.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return et!==null?null:W(he,ne,""+fe,Pe);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case _:return fe.key===et?K(he,ne,fe,Pe):null;case L:return fe.key===et?me(he,ne,fe,Pe):null;case se:return et=fe._init,_e(he,ne,et(fe._payload),Pe)}if(nn(fe)||Q(fe))return et!==null?null:Re(he,ne,fe,Pe,null);Rm(he,fe)}return null}function We(he,ne,fe,Pe,et){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return he=he.get(fe)||null,W(ne,he,""+Pe,et);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case _:return he=he.get(Pe.key===null?fe:Pe.key)||null,K(ne,he,Pe,et);case L:return he=he.get(Pe.key===null?fe:Pe.key)||null,me(ne,he,Pe,et);case se:var at=Pe._init;return We(he,ne,fe,at(Pe._payload),et)}if(nn(Pe)||Q(Pe))return he=he.get(fe)||null,Re(ne,he,Pe,et,null);Rm(ne,Pe)}return null}function Qe(he,ne,fe,Pe){for(var et=null,at=null,lt=ne,dt=ne=0,xr=null;lt!==null&&dt<fe.length;dt++){lt.index>dt?(xr=lt,lt=null):xr=lt.sibling;var Kt=_e(he,lt,fe[dt],Pe);if(Kt===null){lt===null&&(lt=xr);break}u&&lt&&Kt.alternate===null&&h(he,lt),ne=N(Kt,ne,dt),at===null?et=Kt:at.sibling=Kt,at=Kt,lt=xr}if(dt===fe.length)return m(he,lt),Tn&&Jl(he,dt),et;if(lt===null){for(;dt<fe.length;dt++)lt=$e(he,fe[dt],Pe),lt!==null&&(ne=N(lt,ne,dt),at===null?et=lt:at.sibling=lt,at=lt);return Tn&&Jl(he,dt),et}for(lt=b(he,lt);dt<fe.length;dt++)xr=We(lt,he,dt,fe[dt],Pe),xr!==null&&(u&&xr.alternate!==null&&lt.delete(xr.key===null?dt:xr.key),ne=N(xr,ne,dt),at===null?et=xr:at.sibling=xr,at=xr);return u&&lt.forEach(function(Qa){return h(he,Qa)}),Tn&&Jl(he,dt),et}function Ze(he,ne,fe,Pe){var et=Q(fe);if(typeof et!="function")throw Error(t(150));if(fe=et.call(fe),fe==null)throw Error(t(151));for(var at=et=null,lt=ne,dt=ne=0,xr=null,Kt=fe.next();lt!==null&&!Kt.done;dt++,Kt=fe.next()){lt.index>dt?(xr=lt,lt=null):xr=lt.sibling;var Qa=_e(he,lt,Kt.value,Pe);if(Qa===null){lt===null&&(lt=xr);break}u&&lt&&Qa.alternate===null&&h(he,lt),ne=N(Qa,ne,dt),at===null?et=Qa:at.sibling=Qa,at=Qa,lt=xr}if(Kt.done)return m(he,lt),Tn&&Jl(he,dt),et;if(lt===null){for(;!Kt.done;dt++,Kt=fe.next())Kt=$e(he,Kt.value,Pe),Kt!==null&&(ne=N(Kt,ne,dt),at===null?et=Kt:at.sibling=Kt,at=Kt);return Tn&&Jl(he,dt),et}for(lt=b(he,lt);!Kt.done;dt++,Kt=fe.next())Kt=We(lt,he,dt,Kt.value,Pe),Kt!==null&&(u&&Kt.alternate!==null&&lt.delete(Kt.key===null?dt:Kt.key),ne=N(Kt,ne,dt),at===null?et=Kt:at.sibling=Kt,at=Kt);return u&&lt.forEach(function(c3){return h(he,c3)}),Tn&&Jl(he,dt),et}function Gn(he,ne,fe,Pe){if(typeof fe=="object"&&fe!==null&&fe.type===P&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case _:e:{for(var et=fe.key,at=ne;at!==null;){if(at.key===et){if(et=fe.type,et===P){if(at.tag===7){m(he,at.sibling),ne=S(at,fe.props.children),ne.return=he,he=ne;break e}}else if(at.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===se&&zE(et)===at.type){m(he,at.sibling),ne=S(at,fe.props),ne.ref=dd(he,at,fe),ne.return=he,he=ne;break e}m(he,at);break}else h(he,at);at=at.sibling}fe.type===P?(ne=ou(fe.props.children,he.mode,Pe,fe.key),ne.return=he,he=ne):(Pe=Zm(fe.type,fe.key,fe.props,null,he.mode,Pe),Pe.ref=dd(he,ne,fe),Pe.return=he,he=Pe)}return V(he);case L:e:{for(at=fe.key;ne!==null;){if(ne.key===at)if(ne.tag===4&&ne.stateNode.containerInfo===fe.containerInfo&&ne.stateNode.implementation===fe.implementation){m(he,ne.sibling),ne=S(ne,fe.children||[]),ne.return=he,he=ne;break e}else{m(he,ne);break}else h(he,ne);ne=ne.sibling}ne=mw(fe,he.mode,Pe),ne.return=he,he=ne}return V(he);case se:return at=fe._init,Gn(he,ne,at(fe._payload),Pe)}if(nn(fe))return Qe(he,ne,fe,Pe);if(Q(fe))return Ze(he,ne,fe,Pe);Rm(he,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,ne!==null&&ne.tag===6?(m(he,ne.sibling),ne=S(ne,fe),ne.return=he,he=ne):(m(he,ne),ne=pw(fe,he.mode,Pe),ne.return=he,he=ne),V(he)):m(he,ne)}return Gn}var Rc=BE(!0),UE=BE(!1),Nm=za(null),Am=null,Nc=null,Sx=null;function Ex(){Sx=Nc=Am=null}function kx(u){var h=Nm.current;bn(Nm),u._currentValue=h}function Tx(u,h,m){for(;u!==null;){var b=u.alternate;if((u.childLanes&h)!==h?(u.childLanes|=h,b!==null&&(b.childLanes|=h)):b!==null&&(b.childLanes&h)!==h&&(b.childLanes|=h),u===m)break;u=u.return}}function Ac(u,h){Am=u,Sx=Nc=null,u=u.dependencies,u!==null&&u.firstContext!==null&&(u.lanes&h&&(Ss=!0),u.firstContext=null)}function si(u){var h=u._currentValue;if(Sx!==u)if(u={context:u,memoizedValue:h,next:null},Nc===null){if(Am===null)throw Error(t(308));Nc=u,Am.dependencies={lanes:0,firstContext:u}}else Nc=Nc.next=u;return h}var Zl=null;function _x(u){Zl===null?Zl=[u]:Zl.push(u)}function WE(u,h,m,b){var S=h.interleaved;return S===null?(m.next=m,_x(h)):(m.next=S.next,S.next=m),h.interleaved=m,ta(u,b)}function ta(u,h){u.lanes|=h;var m=u.alternate;for(m!==null&&(m.lanes|=h),m=u,u=u.return;u!==null;)u.childLanes|=h,m=u.alternate,m!==null&&(m.childLanes|=h),m=u,u=u.return;return m.tag===3?m.stateNode:null}var Wa=!1;function Rx(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GE(u,h){u=u.updateQueue,h.updateQueue===u&&(h.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,effects:u.effects})}function na(u,h){return{eventTime:u,lane:h,tag:0,payload:null,callback:null,next:null}}function Ga(u,h,m){var b=u.updateQueue;if(b===null)return null;if(b=b.shared,jt&2){var S=b.pending;return S===null?h.next=h:(h.next=S.next,S.next=h),b.pending=h,ta(u,m)}return S=b.interleaved,S===null?(h.next=h,_x(b)):(h.next=S.next,S.next=h),b.interleaved=h,ta(u,m)}function $m(u,h,m){if(h=h.updateQueue,h!==null&&(h=h.shared,(m&4194240)!==0)){var b=h.lanes;b&=u.pendingLanes,m|=b,h.lanes=m,Da(u,m)}}function jE(u,h){var m=u.updateQueue,b=u.alternate;if(b!==null&&(b=b.updateQueue,m===b)){var S=null,N=null;if(m=m.firstBaseUpdate,m!==null){do{var V={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};N===null?S=N=V:N=N.next=V,m=m.next}while(m!==null);N===null?S=N=h:N=N.next=h}else S=N=h;m={baseState:b.baseState,firstBaseUpdate:S,lastBaseUpdate:N,shared:b.shared,effects:b.effects},u.updateQueue=m;return}u=m.lastBaseUpdate,u===null?m.firstBaseUpdate=h:u.next=h,m.lastBaseUpdate=h}function Dm(u,h,m,b){var S=u.updateQueue;Wa=!1;var N=S.firstBaseUpdate,V=S.lastBaseUpdate,W=S.shared.pending;if(W!==null){S.shared.pending=null;var K=W,me=K.next;K.next=null,V===null?N=me:V.next=me,V=K;var Re=u.alternate;Re!==null&&(Re=Re.updateQueue,W=Re.lastBaseUpdate,W!==V&&(W===null?Re.firstBaseUpdate=me:W.next=me,Re.lastBaseUpdate=K))}if(N!==null){var $e=S.baseState;V=0,Re=me=K=null,W=N;do{var _e=W.lane,We=W.eventTime;if((b&_e)===_e){Re!==null&&(Re=Re.next={eventTime:We,lane:0,tag:W.tag,payload:W.payload,callback:W.callback,next:null});e:{var Qe=u,Ze=W;switch(_e=h,We=m,Ze.tag){case 1:if(Qe=Ze.payload,typeof Qe=="function"){$e=Qe.call(We,$e,_e);break e}$e=Qe;break e;case 3:Qe.flags=Qe.flags&-65537|128;case 0:if(Qe=Ze.payload,_e=typeof Qe=="function"?Qe.call(We,$e,_e):Qe,_e==null)break e;$e=ee({},$e,_e);break e;case 2:Wa=!0}}W.callback!==null&&W.lane!==0&&(u.flags|=64,_e=S.effects,_e===null?S.effects=[W]:_e.push(W))}else We={eventTime:We,lane:_e,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Re===null?(me=Re=We,K=$e):Re=Re.next=We,V|=_e;if(W=W.next,W===null){if(W=S.shared.pending,W===null)break;_e=W,W=_e.next,_e.next=null,S.lastBaseUpdate=_e,S.shared.pending=null}}while(!0);if(Re===null&&(K=$e),S.baseState=K,S.firstBaseUpdate=me,S.lastBaseUpdate=Re,h=S.shared.interleaved,h!==null){S=h;do V|=S.lane,S=S.next;while(S!==h)}else N===null&&(S.shared.lanes=0);nu|=V,u.lanes=V,u.memoizedState=$e}}function HE(u,h,m){if(u=h.effects,h.effects=null,u!==null)for(h=0;h<u.length;h++){var b=u[h],S=b.callback;if(S!==null){if(b.callback=null,b=m,typeof S!="function")throw Error(t(191,S));S.call(b)}}}var fd={},fo=za(fd),pd=za(fd),md=za(fd);function eu(u){if(u===fd)throw Error(t(174));return u}function Nx(u,h){switch(mn(md,h),mn(pd,u),mn(fo,fd),u=h.nodeType,u){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Jt(null,"");break;default:u=u===8?h.parentNode:h,h=u.namespaceURI||null,u=u.tagName,h=Jt(h,u)}bn(fo),mn(fo,h)}function $c(){bn(fo),bn(pd),bn(md)}function qE(u){eu(md.current);var h=eu(fo.current),m=Jt(h,u.type);h!==m&&(mn(pd,u),mn(fo,m))}function Ax(u){pd.current===u&&(bn(fo),bn(pd))}var Nn=za(0);function Pm(u){for(var h=u;h!==null;){if(h.tag===13){var m=h.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if(h.flags&128)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var $x=[];function Dx(){for(var u=0;u<$x.length;u++)$x[u]._workInProgressVersionPrimary=null;$x.length=0}var Fm=E.ReactCurrentDispatcher,Px=E.ReactCurrentBatchConfig,tu=0,An=null,or=null,yr=null,Om=!1,gd=!1,yd=0,DV=0;function Hr(){throw Error(t(321))}function Fx(u,h){if(h===null)return!1;for(var m=0;m<h.length&&m<u.length;m++)if(!$i(u[m],h[m]))return!1;return!0}function Ox(u,h,m,b,S,N){if(tu=N,An=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Fm.current=u===null||u.memoizedState===null?LV:MV,u=m(b,S),gd){N=0;do{if(gd=!1,yd=0,25<=N)throw Error(t(301));N+=1,yr=or=null,h.updateQueue=null,Fm.current=VV,u=m(b,S)}while(gd)}if(Fm.current=Vm,h=or!==null&&or.next!==null,tu=0,yr=or=An=null,Om=!1,h)throw Error(t(300));return u}function Lx(){var u=yd!==0;return yd=0,u}function po(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yr===null?An.memoizedState=yr=u:yr=yr.next=u,yr}function ii(){if(or===null){var u=An.alternate;u=u!==null?u.memoizedState:null}else u=or.next;var h=yr===null?An.memoizedState:yr.next;if(h!==null)yr=h,or=u;else{if(u===null)throw Error(t(310));or=u,u={memoizedState:or.memoizedState,baseState:or.baseState,baseQueue:or.baseQueue,queue:or.queue,next:null},yr===null?An.memoizedState=yr=u:yr=yr.next=u}return yr}function vd(u,h){return typeof h=="function"?h(u):h}function Mx(u){var h=ii(),m=h.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=u;var b=or,S=b.baseQueue,N=m.pending;if(N!==null){if(S!==null){var V=S.next;S.next=N.next,N.next=V}b.baseQueue=S=N,m.pending=null}if(S!==null){N=S.next,b=b.baseState;var W=V=null,K=null,me=N;do{var Re=me.lane;if((tu&Re)===Re)K!==null&&(K=K.next={lane:0,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),b=me.hasEagerState?me.eagerState:u(b,me.action);else{var $e={lane:Re,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null};K===null?(W=K=$e,V=b):K=K.next=$e,An.lanes|=Re,nu|=Re}me=me.next}while(me!==null&&me!==N);K===null?V=b:K.next=W,$i(b,h.memoizedState)||(Ss=!0),h.memoizedState=b,h.baseState=V,h.baseQueue=K,m.lastRenderedState=b}if(u=m.interleaved,u!==null){S=u;do N=S.lane,An.lanes|=N,nu|=N,S=S.next;while(S!==u)}else S===null&&(m.lanes=0);return[h.memoizedState,m.dispatch]}function Vx(u){var h=ii(),m=h.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=u;var b=m.dispatch,S=m.pending,N=h.memoizedState;if(S!==null){m.pending=null;var V=S=S.next;do N=u(N,V.action),V=V.next;while(V!==S);$i(N,h.memoizedState)||(Ss=!0),h.memoizedState=N,h.baseQueue===null&&(h.baseState=N),m.lastRenderedState=N}return[N,b]}function KE(){}function XE(u,h){var m=An,b=ii(),S=h(),N=!$i(b.memoizedState,S);if(N&&(b.memoizedState=S,Ss=!0),b=b.queue,zx(JE.bind(null,m,b,u),[u]),b.getSnapshot!==h||N||yr!==null&&yr.memoizedState.tag&1){if(m.flags|=2048,xd(9,QE.bind(null,m,b,S,h),void 0,null),vr===null)throw Error(t(349));tu&30||YE(m,h,S)}return S}function YE(u,h,m){u.flags|=16384,u={getSnapshot:h,value:m},h=An.updateQueue,h===null?(h={lastEffect:null,stores:null},An.updateQueue=h,h.stores=[u]):(m=h.stores,m===null?h.stores=[u]:m.push(u))}function QE(u,h,m,b){h.value=m,h.getSnapshot=b,ZE(h)&&ek(u)}function JE(u,h,m){return m(function(){ZE(h)&&ek(u)})}function ZE(u){var h=u.getSnapshot;u=u.value;try{var m=h();return!$i(u,m)}catch{return!0}}function ek(u){var h=ta(u,1);h!==null&&Li(h,u,1,-1)}function tk(u){var h=po();return typeof u=="function"&&(u=u()),h.memoizedState=h.baseState=u,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vd,lastRenderedState:u},h.queue=u,u=u.dispatch=OV.bind(null,An,u),[h.memoizedState,u]}function xd(u,h,m,b){return u={tag:u,create:h,destroy:m,deps:b,next:null},h=An.updateQueue,h===null?(h={lastEffect:null,stores:null},An.updateQueue=h,h.lastEffect=u.next=u):(m=h.lastEffect,m===null?h.lastEffect=u.next=u:(b=m.next,m.next=u,u.next=b,h.lastEffect=u)),u}function nk(){return ii().memoizedState}function Lm(u,h,m,b){var S=po();An.flags|=u,S.memoizedState=xd(1|h,m,void 0,b===void 0?null:b)}function Mm(u,h,m,b){var S=ii();b=b===void 0?null:b;var N=void 0;if(or!==null){var V=or.memoizedState;if(N=V.destroy,b!==null&&Fx(b,V.deps)){S.memoizedState=xd(h,m,N,b);return}}An.flags|=u,S.memoizedState=xd(1|h,m,N,b)}function rk(u,h){return Lm(8390656,8,u,h)}function zx(u,h){return Mm(2048,8,u,h)}function sk(u,h){return Mm(4,2,u,h)}function ik(u,h){return Mm(4,4,u,h)}function ok(u,h){if(typeof h=="function")return u=u(),h(u),function(){h(null)};if(h!=null)return u=u(),h.current=u,function(){h.current=null}}function ak(u,h,m){return m=m!=null?m.concat([u]):null,Mm(4,4,ok.bind(null,h,u),m)}function Bx(){}function lk(u,h){var m=ii();h=h===void 0?null:h;var b=m.memoizedState;return b!==null&&h!==null&&Fx(h,b[1])?b[0]:(m.memoizedState=[u,h],u)}function uk(u,h){var m=ii();h=h===void 0?null:h;var b=m.memoizedState;return b!==null&&h!==null&&Fx(h,b[1])?b[0]:(u=u(),m.memoizedState=[u,h],u)}function ck(u,h,m){return tu&21?($i(m,h)||(m=Gl(),An.lanes|=m,nu|=m,u.baseState=!0),h):(u.baseState&&(u.baseState=!1,Ss=!0),u.memoizedState=m)}function PV(u,h){var m=Pt;Pt=m!==0&&4>m?m:4,u(!0);var b=Px.transition;Px.transition={};try{u(!1),h()}finally{Pt=m,Px.transition=b}}function hk(){return ii().memoizedState}function FV(u,h,m){var b=Ka(u);if(m={lane:b,action:m,hasEagerState:!1,eagerState:null,next:null},dk(u))fk(h,m);else if(m=WE(u,h,m,b),m!==null){var S=us();Li(m,u,b,S),pk(m,h,b)}}function OV(u,h,m){var b=Ka(u),S={lane:b,action:m,hasEagerState:!1,eagerState:null,next:null};if(dk(u))fk(h,S);else{var N=u.alternate;if(u.lanes===0&&(N===null||N.lanes===0)&&(N=h.lastRenderedReducer,N!==null))try{var V=h.lastRenderedState,W=N(V,m);if(S.hasEagerState=!0,S.eagerState=W,$i(W,V)){var K=h.interleaved;K===null?(S.next=S,_x(h)):(S.next=K.next,K.next=S),h.interleaved=S;return}}catch{}finally{}m=WE(u,h,S,b),m!==null&&(S=us(),Li(m,u,b,S),pk(m,h,b))}}function dk(u){var h=u.alternate;return u===An||h!==null&&h===An}function fk(u,h){gd=Om=!0;var m=u.pending;m===null?h.next=h:(h.next=m.next,m.next=h),u.pending=h}function pk(u,h,m){if(m&4194240){var b=h.lanes;b&=u.pendingLanes,m|=b,h.lanes=m,Da(u,m)}}var Vm={readContext:si,useCallback:Hr,useContext:Hr,useEffect:Hr,useImperativeHandle:Hr,useInsertionEffect:Hr,useLayoutEffect:Hr,useMemo:Hr,useReducer:Hr,useRef:Hr,useState:Hr,useDebugValue:Hr,useDeferredValue:Hr,useTransition:Hr,useMutableSource:Hr,useSyncExternalStore:Hr,useId:Hr,unstable_isNewReconciler:!1},LV={readContext:si,useCallback:function(u,h){return po().memoizedState=[u,h===void 0?null:h],u},useContext:si,useEffect:rk,useImperativeHandle:function(u,h,m){return m=m!=null?m.concat([u]):null,Lm(4194308,4,ok.bind(null,h,u),m)},useLayoutEffect:function(u,h){return Lm(4194308,4,u,h)},useInsertionEffect:function(u,h){return Lm(4,2,u,h)},useMemo:function(u,h){var m=po();return h=h===void 0?null:h,u=u(),m.memoizedState=[u,h],u},useReducer:function(u,h,m){var b=po();return h=m!==void 0?m(h):h,b.memoizedState=b.baseState=h,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:h},b.queue=u,u=u.dispatch=FV.bind(null,An,u),[b.memoizedState,u]},useRef:function(u){var h=po();return u={current:u},h.memoizedState=u},useState:tk,useDebugValue:Bx,useDeferredValue:function(u){return po().memoizedState=u},useTransition:function(){var u=tk(!1),h=u[0];return u=PV.bind(null,u[1]),po().memoizedState=u,[h,u]},useMutableSource:function(){},useSyncExternalStore:function(u,h,m){var b=An,S=po();if(Tn){if(m===void 0)throw Error(t(407));m=m()}else{if(m=h(),vr===null)throw Error(t(349));tu&30||YE(b,h,m)}S.memoizedState=m;var N={value:m,getSnapshot:h};return S.queue=N,rk(JE.bind(null,b,N,u),[u]),b.flags|=2048,xd(9,QE.bind(null,b,N,m,h),void 0,null),m},useId:function(){var u=po(),h=vr.identifierPrefix;if(Tn){var m=ea,b=Zo;m=(b&~(1<<32-os(b)-1)).toString(32)+m,h=":"+h+"R"+m,m=yd++,0<m&&(h+="H"+m.toString(32)),h+=":"}else m=DV++,h=":"+h+"r"+m.toString(32)+":";return u.memoizedState=h},unstable_isNewReconciler:!1},MV={readContext:si,useCallback:lk,useContext:si,useEffect:zx,useImperativeHandle:ak,useInsertionEffect:sk,useLayoutEffect:ik,useMemo:uk,useReducer:Mx,useRef:nk,useState:function(){return Mx(vd)},useDebugValue:Bx,useDeferredValue:function(u){var h=ii();return ck(h,or.memoizedState,u)},useTransition:function(){var u=Mx(vd)[0],h=ii().memoizedState;return[u,h]},useMutableSource:KE,useSyncExternalStore:XE,useId:hk,unstable_isNewReconciler:!1},VV={readContext:si,useCallback:lk,useContext:si,useEffect:zx,useImperativeHandle:ak,useInsertionEffect:sk,useLayoutEffect:ik,useMemo:uk,useReducer:Vx,useRef:nk,useState:function(){return Vx(vd)},useDebugValue:Bx,useDeferredValue:function(u){var h=ii();return or===null?h.memoizedState=u:ck(h,or.memoizedState,u)},useTransition:function(){var u=Vx(vd)[0],h=ii().memoizedState;return[u,h]},useMutableSource:KE,useSyncExternalStore:XE,useId:hk,unstable_isNewReconciler:!1};function Pi(u,h){if(u&&u.defaultProps){h=ee({},h),u=u.defaultProps;for(var m in u)h[m]===void 0&&(h[m]=u[m]);return h}return h}function Ux(u,h,m,b){h=u.memoizedState,m=m(b,h),m=m==null?h:ee({},h,m),u.memoizedState=m,u.lanes===0&&(u.updateQueue.baseState=m)}var zm={isMounted:function(u){return(u=u._reactInternals)?Dt(u)===u:!1},enqueueSetState:function(u,h,m){u=u._reactInternals;var b=us(),S=Ka(u),N=na(b,S);N.payload=h,m!=null&&(N.callback=m),h=Ga(u,N,S),h!==null&&(Li(h,u,S,b),$m(h,u,S))},enqueueReplaceState:function(u,h,m){u=u._reactInternals;var b=us(),S=Ka(u),N=na(b,S);N.tag=1,N.payload=h,m!=null&&(N.callback=m),h=Ga(u,N,S),h!==null&&(Li(h,u,S,b),$m(h,u,S))},enqueueForceUpdate:function(u,h){u=u._reactInternals;var m=us(),b=Ka(u),S=na(m,b);S.tag=2,h!=null&&(S.callback=h),h=Ga(u,S,b),h!==null&&(Li(h,u,b,m),$m(h,u,b))}};function mk(u,h,m,b,S,N,V){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(b,N,V):h.prototype&&h.prototype.isPureReactComponent?!id(m,b)||!id(S,N):!0}function gk(u,h,m){var b=!1,S=Ba,N=h.contextType;return typeof N=="object"&&N!==null?N=si(N):(S=Cs(h)?Yl:jr.current,b=h.contextTypes,N=(b=b!=null)?Ec(u,S):Ba),h=new h(m,N),u.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=zm,u.stateNode=h,h._reactInternals=u,b&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=S,u.__reactInternalMemoizedMaskedChildContext=N),h}function yk(u,h,m,b){u=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(m,b),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(m,b),h.state!==u&&zm.enqueueReplaceState(h,h.state,null)}function Wx(u,h,m,b){var S=u.stateNode;S.props=m,S.state=u.memoizedState,S.refs={},Rx(u);var N=h.contextType;typeof N=="object"&&N!==null?S.context=si(N):(N=Cs(h)?Yl:jr.current,S.context=Ec(u,N)),S.state=u.memoizedState,N=h.getDerivedStateFromProps,typeof N=="function"&&(Ux(u,h,N,m),S.state=u.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(h=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),h!==S.state&&zm.enqueueReplaceState(S,S.state,null),Dm(u,m,S,b),S.state=u.memoizedState),typeof S.componentDidMount=="function"&&(u.flags|=4194308)}function Dc(u,h){try{var m="",b=h;do m+=be(b),b=b.return;while(b);var S=m}catch(N){S=`
Error generating stack: `+N.message+`
`+N.stack}return{value:u,source:h,stack:S,digest:null}}function Gx(u,h,m){return{value:u,source:null,stack:m??null,digest:h??null}}function jx(u,h){try{console.error(h.value)}catch(m){setTimeout(function(){throw m})}}var zV=typeof WeakMap=="function"?WeakMap:Map;function vk(u,h,m){m=na(-1,m),m.tag=3,m.payload={element:null};var b=h.value;return m.callback=function(){qm||(qm=!0,ow=b),jx(u,h)},m}function xk(u,h,m){m=na(-1,m),m.tag=3;var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var S=h.value;m.payload=function(){return b(S)},m.callback=function(){jx(u,h)}}var N=u.stateNode;return N!==null&&typeof N.componentDidCatch=="function"&&(m.callback=function(){jx(u,h),typeof b!="function"&&(Ha===null?Ha=new Set([this]):Ha.add(this));var V=h.stack;this.componentDidCatch(h.value,{componentStack:V!==null?V:""})}),m}function wk(u,h,m){var b=u.pingCache;if(b===null){b=u.pingCache=new zV;var S=new Set;b.set(h,S)}else S=b.get(h),S===void 0&&(S=new Set,b.set(h,S));S.has(m)||(S.add(m),u=e3.bind(null,u,h,m),h.then(u,u))}function bk(u){do{var h;if((h=u.tag===13)&&(h=u.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return u;u=u.return}while(u!==null);return null}function Ik(u,h,m,b,S){return u.mode&1?(u.flags|=65536,u.lanes=S,u):(u===h?u.flags|=65536:(u.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(h=na(-1,1),h.tag=2,Ga(m,h,1))),m.lanes|=1),u)}var BV=E.ReactCurrentOwner,Ss=!1;function ls(u,h,m,b){h.child=u===null?UE(h,null,m,b):Rc(h,u.child,m,b)}function Ck(u,h,m,b,S){m=m.render;var N=h.ref;return Ac(h,S),b=Ox(u,h,m,b,N,S),m=Lx(),u!==null&&!Ss?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~S,ra(u,h,S)):(Tn&&m&&xx(h),h.flags|=1,ls(u,h,b,S),h.child)}function Sk(u,h,m,b,S){if(u===null){var N=m.type;return typeof N=="function"&&!fw(N)&&N.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(h.tag=15,h.type=N,Ek(u,h,N,b,S)):(u=Zm(m.type,null,b,h,h.mode,S),u.ref=h.ref,u.return=h,h.child=u)}if(N=u.child,!(u.lanes&S)){var V=N.memoizedProps;if(m=m.compare,m=m!==null?m:id,m(V,b)&&u.ref===h.ref)return ra(u,h,S)}return h.flags|=1,u=Ya(N,b),u.ref=h.ref,u.return=h,h.child=u}function Ek(u,h,m,b,S){if(u!==null){var N=u.memoizedProps;if(id(N,b)&&u.ref===h.ref)if(Ss=!1,h.pendingProps=b=N,(u.lanes&S)!==0)u.flags&131072&&(Ss=!0);else return h.lanes=u.lanes,ra(u,h,S)}return Hx(u,h,m,b,S)}function kk(u,h,m){var b=h.pendingProps,S=b.children,N=u!==null?u.memoizedState:null;if(b.mode==="hidden")if(!(h.mode&1))h.memoizedState={baseLanes:0,cachePool:null,transitions:null},mn(Fc,Gs),Gs|=m;else{if(!(m&1073741824))return u=N!==null?N.baseLanes|m:m,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:u,cachePool:null,transitions:null},h.updateQueue=null,mn(Fc,Gs),Gs|=u,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=N!==null?N.baseLanes:m,mn(Fc,Gs),Gs|=b}else N!==null?(b=N.baseLanes|m,h.memoizedState=null):b=m,mn(Fc,Gs),Gs|=b;return ls(u,h,S,m),h.child}function Tk(u,h){var m=h.ref;(u===null&&m!==null||u!==null&&u.ref!==m)&&(h.flags|=512,h.flags|=2097152)}function Hx(u,h,m,b,S){var N=Cs(m)?Yl:jr.current;return N=Ec(h,N),Ac(h,S),m=Ox(u,h,m,b,N,S),b=Lx(),u!==null&&!Ss?(h.updateQueue=u.updateQueue,h.flags&=-2053,u.lanes&=~S,ra(u,h,S)):(Tn&&b&&xx(h),h.flags|=1,ls(u,h,m,S),h.child)}function _k(u,h,m,b,S){if(Cs(m)){var N=!0;Sm(h)}else N=!1;if(Ac(h,S),h.stateNode===null)Um(u,h),gk(h,m,b),Wx(h,m,b,S),b=!0;else if(u===null){var V=h.stateNode,W=h.memoizedProps;V.props=W;var K=V.context,me=m.contextType;typeof me=="object"&&me!==null?me=si(me):(me=Cs(m)?Yl:jr.current,me=Ec(h,me));var Re=m.getDerivedStateFromProps,$e=typeof Re=="function"||typeof V.getSnapshotBeforeUpdate=="function";$e||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(W!==b||K!==me)&&yk(h,V,b,me),Wa=!1;var _e=h.memoizedState;V.state=_e,Dm(h,b,V,S),K=h.memoizedState,W!==b||_e!==K||Is.current||Wa?(typeof Re=="function"&&(Ux(h,m,Re,b),K=h.memoizedState),(W=Wa||mk(h,m,W,b,_e,K,me))?($e||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(h.flags|=4194308)):(typeof V.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=b,h.memoizedState=K),V.props=b,V.state=K,V.context=me,b=W):(typeof V.componentDidMount=="function"&&(h.flags|=4194308),b=!1)}else{V=h.stateNode,GE(u,h),W=h.memoizedProps,me=h.type===h.elementType?W:Pi(h.type,W),V.props=me,$e=h.pendingProps,_e=V.context,K=m.contextType,typeof K=="object"&&K!==null?K=si(K):(K=Cs(m)?Yl:jr.current,K=Ec(h,K));var We=m.getDerivedStateFromProps;(Re=typeof We=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(W!==$e||_e!==K)&&yk(h,V,b,K),Wa=!1,_e=h.memoizedState,V.state=_e,Dm(h,b,V,S);var Qe=h.memoizedState;W!==$e||_e!==Qe||Is.current||Wa?(typeof We=="function"&&(Ux(h,m,We,b),Qe=h.memoizedState),(me=Wa||mk(h,m,me,b,_e,Qe,K)||!1)?(Re||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(b,Qe,K),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(b,Qe,K)),typeof V.componentDidUpdate=="function"&&(h.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof V.componentDidUpdate!="function"||W===u.memoizedProps&&_e===u.memoizedState||(h.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||W===u.memoizedProps&&_e===u.memoizedState||(h.flags|=1024),h.memoizedProps=b,h.memoizedState=Qe),V.props=b,V.state=Qe,V.context=K,b=me):(typeof V.componentDidUpdate!="function"||W===u.memoizedProps&&_e===u.memoizedState||(h.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||W===u.memoizedProps&&_e===u.memoizedState||(h.flags|=1024),b=!1)}return qx(u,h,m,b,N,S)}function qx(u,h,m,b,S,N){Tk(u,h);var V=(h.flags&128)!==0;if(!b&&!V)return S&&DE(h,m,!1),ra(u,h,N);b=h.stateNode,BV.current=h;var W=V&&typeof m.getDerivedStateFromError!="function"?null:b.render();return h.flags|=1,u!==null&&V?(h.child=Rc(h,u.child,null,N),h.child=Rc(h,null,W,N)):ls(u,h,W,N),h.memoizedState=b.state,S&&DE(h,m,!0),h.child}function Rk(u){var h=u.stateNode;h.pendingContext?AE(u,h.pendingContext,h.pendingContext!==h.context):h.context&&AE(u,h.context,!1),Nx(u,h.containerInfo)}function Nk(u,h,m,b,S){return _c(),Cx(S),h.flags|=256,ls(u,h,m,b),h.child}var Kx={dehydrated:null,treeContext:null,retryLane:0};function Xx(u){return{baseLanes:u,cachePool:null,transitions:null}}function Ak(u,h,m){var b=h.pendingProps,S=Nn.current,N=!1,V=(h.flags&128)!==0,W;if((W=V)||(W=u!==null&&u.memoizedState===null?!1:(S&2)!==0),W?(N=!0,h.flags&=-129):(u===null||u.memoizedState!==null)&&(S|=1),mn(Nn,S&1),u===null)return Ix(h),u=h.memoizedState,u!==null&&(u=u.dehydrated,u!==null)?(h.mode&1?u.data==="$!"?h.lanes=8:h.lanes=1073741824:h.lanes=1,null):(V=b.children,u=b.fallback,N?(b=h.mode,N=h.child,V={mode:"hidden",children:V},!(b&1)&&N!==null?(N.childLanes=0,N.pendingProps=V):N=eg(V,b,0,null),u=ou(u,b,m,null),N.return=h,u.return=h,N.sibling=u,h.child=N,h.child.memoizedState=Xx(m),h.memoizedState=Kx,u):Yx(h,V));if(S=u.memoizedState,S!==null&&(W=S.dehydrated,W!==null))return UV(u,h,V,b,W,S,m);if(N){N=b.fallback,V=h.mode,S=u.child,W=S.sibling;var K={mode:"hidden",children:b.children};return!(V&1)&&h.child!==S?(b=h.child,b.childLanes=0,b.pendingProps=K,h.deletions=null):(b=Ya(S,K),b.subtreeFlags=S.subtreeFlags&14680064),W!==null?N=Ya(W,N):(N=ou(N,V,m,null),N.flags|=2),N.return=h,b.return=h,b.sibling=N,h.child=b,b=N,N=h.child,V=u.child.memoizedState,V=V===null?Xx(m):{baseLanes:V.baseLanes|m,cachePool:null,transitions:V.transitions},N.memoizedState=V,N.childLanes=u.childLanes&~m,h.memoizedState=Kx,b}return N=u.child,u=N.sibling,b=Ya(N,{mode:"visible",children:b.children}),!(h.mode&1)&&(b.lanes=m),b.return=h,b.sibling=null,u!==null&&(m=h.deletions,m===null?(h.deletions=[u],h.flags|=16):m.push(u)),h.child=b,h.memoizedState=null,b}function Yx(u,h){return h=eg({mode:"visible",children:h},u.mode,0,null),h.return=u,u.child=h}function Bm(u,h,m,b){return b!==null&&Cx(b),Rc(h,u.child,null,m),u=Yx(h,h.pendingProps.children),u.flags|=2,h.memoizedState=null,u}function UV(u,h,m,b,S,N,V){if(m)return h.flags&256?(h.flags&=-257,b=Gx(Error(t(422))),Bm(u,h,V,b)):h.memoizedState!==null?(h.child=u.child,h.flags|=128,null):(N=b.fallback,S=h.mode,b=eg({mode:"visible",children:b.children},S,0,null),N=ou(N,S,V,null),N.flags|=2,b.return=h,N.return=h,b.sibling=N,h.child=b,h.mode&1&&Rc(h,u.child,null,V),h.child.memoizedState=Xx(V),h.memoizedState=Kx,N);if(!(h.mode&1))return Bm(u,h,V,null);if(S.data==="$!"){if(b=S.nextSibling&&S.nextSibling.dataset,b)var W=b.dgst;return b=W,N=Error(t(419)),b=Gx(N,b,void 0),Bm(u,h,V,b)}if(W=(V&u.childLanes)!==0,Ss||W){if(b=vr,b!==null){switch(V&-V){case 4:S=2;break;case 16:S=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:S=32;break;case 536870912:S=268435456;break;default:S=0}S=S&(b.suspendedLanes|V)?0:S,S!==0&&S!==N.retryLane&&(N.retryLane=S,ta(u,S),Li(b,u,S,-1))}return dw(),b=Gx(Error(t(421))),Bm(u,h,V,b)}return S.data==="$?"?(h.flags|=128,h.child=u.child,h=t3.bind(null,u),S._reactRetry=h,null):(u=N.treeContext,Ws=Va(S.nextSibling),Us=h,Tn=!0,Di=null,u!==null&&(ni[ri++]=Zo,ni[ri++]=ea,ni[ri++]=Ql,Zo=u.id,ea=u.overflow,Ql=h),h=Yx(h,b.children),h.flags|=4096,h)}function $k(u,h,m){u.lanes|=h;var b=u.alternate;b!==null&&(b.lanes|=h),Tx(u.return,h,m)}function Qx(u,h,m,b,S){var N=u.memoizedState;N===null?u.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:b,tail:m,tailMode:S}:(N.isBackwards=h,N.rendering=null,N.renderingStartTime=0,N.last=b,N.tail=m,N.tailMode=S)}function Dk(u,h,m){var b=h.pendingProps,S=b.revealOrder,N=b.tail;if(ls(u,h,b.children,m),b=Nn.current,b&2)b=b&1|2,h.flags|=128;else{if(u!==null&&u.flags&128)e:for(u=h.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&$k(u,m,h);else if(u.tag===19)$k(u,m,h);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===h)break e;for(;u.sibling===null;){if(u.return===null||u.return===h)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}b&=1}if(mn(Nn,b),!(h.mode&1))h.memoizedState=null;else switch(S){case"forwards":for(m=h.child,S=null;m!==null;)u=m.alternate,u!==null&&Pm(u)===null&&(S=m),m=m.sibling;m=S,m===null?(S=h.child,h.child=null):(S=m.sibling,m.sibling=null),Qx(h,!1,S,m,N);break;case"backwards":for(m=null,S=h.child,h.child=null;S!==null;){if(u=S.alternate,u!==null&&Pm(u)===null){h.child=S;break}u=S.sibling,S.sibling=m,m=S,S=u}Qx(h,!0,m,null,N);break;case"together":Qx(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Um(u,h){!(h.mode&1)&&u!==null&&(u.alternate=null,h.alternate=null,h.flags|=2)}function ra(u,h,m){if(u!==null&&(h.dependencies=u.dependencies),nu|=h.lanes,!(m&h.childLanes))return null;if(u!==null&&h.child!==u.child)throw Error(t(153));if(h.child!==null){for(u=h.child,m=Ya(u,u.pendingProps),h.child=m,m.return=h;u.sibling!==null;)u=u.sibling,m=m.sibling=Ya(u,u.pendingProps),m.return=h;m.sibling=null}return h.child}function WV(u,h,m){switch(h.tag){case 3:Rk(h),_c();break;case 5:qE(h);break;case 1:Cs(h.type)&&Sm(h);break;case 4:Nx(h,h.stateNode.containerInfo);break;case 10:var b=h.type._context,S=h.memoizedProps.value;mn(Nm,b._currentValue),b._currentValue=S;break;case 13:if(b=h.memoizedState,b!==null)return b.dehydrated!==null?(mn(Nn,Nn.current&1),h.flags|=128,null):m&h.child.childLanes?Ak(u,h,m):(mn(Nn,Nn.current&1),u=ra(u,h,m),u!==null?u.sibling:null);mn(Nn,Nn.current&1);break;case 19:if(b=(m&h.childLanes)!==0,u.flags&128){if(b)return Dk(u,h,m);h.flags|=128}if(S=h.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),mn(Nn,Nn.current),b)break;return null;case 22:case 23:return h.lanes=0,kk(u,h,m)}return ra(u,h,m)}var Pk,Jx,Fk,Ok;Pk=function(u,h){for(var m=h.child;m!==null;){if(m.tag===5||m.tag===6)u.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},Jx=function(){},Fk=function(u,h,m,b){var S=u.memoizedProps;if(S!==b){u=h.stateNode,eu(fo.current);var N=null;switch(m){case"input":S=Wt(u,S),b=Wt(u,b),N=[];break;case"select":S=ee({},S,{value:void 0}),b=ee({},b,{value:void 0}),N=[];break;case"textarea":S=yn(u,S),b=yn(u,b),N=[];break;default:typeof S.onClick!="function"&&typeof b.onClick=="function"&&(u.onclick=bm)}so(m,b);var V;m=null;for(me in S)if(!b.hasOwnProperty(me)&&S.hasOwnProperty(me)&&S[me]!=null)if(me==="style"){var W=S[me];for(V in W)W.hasOwnProperty(V)&&(m||(m={}),m[V]="")}else me!=="dangerouslySetInnerHTML"&&me!=="children"&&me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&me!=="autoFocus"&&(s.hasOwnProperty(me)?N||(N=[]):(N=N||[]).push(me,null));for(me in b){var K=b[me];if(W=S!=null?S[me]:void 0,b.hasOwnProperty(me)&&K!==W&&(K!=null||W!=null))if(me==="style")if(W){for(V in W)!W.hasOwnProperty(V)||K&&K.hasOwnProperty(V)||(m||(m={}),m[V]="");for(V in K)K.hasOwnProperty(V)&&W[V]!==K[V]&&(m||(m={}),m[V]=K[V])}else m||(N||(N=[]),N.push(me,m)),m=K;else me==="dangerouslySetInnerHTML"?(K=K?K.__html:void 0,W=W?W.__html:void 0,K!=null&&W!==K&&(N=N||[]).push(me,K)):me==="children"?typeof K!="string"&&typeof K!="number"||(N=N||[]).push(me,""+K):me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&(s.hasOwnProperty(me)?(K!=null&&me==="onScroll"&&wn("scroll",u),N||W===K||(N=[])):(N=N||[]).push(me,K))}m&&(N=N||[]).push("style",m);var me=N;(h.updateQueue=me)&&(h.flags|=4)}},Ok=function(u,h,m,b){m!==b&&(h.flags|=4)};function wd(u,h){if(!Tn)switch(u.tailMode){case"hidden":h=u.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?u.tail=null:m.sibling=null;break;case"collapsed":m=u.tail;for(var b=null;m!==null;)m.alternate!==null&&(b=m),m=m.sibling;b===null?h||u.tail===null?u.tail=null:u.tail.sibling=null:b.sibling=null}}function qr(u){var h=u.alternate!==null&&u.alternate.child===u.child,m=0,b=0;if(h)for(var S=u.child;S!==null;)m|=S.lanes|S.childLanes,b|=S.subtreeFlags&14680064,b|=S.flags&14680064,S.return=u,S=S.sibling;else for(S=u.child;S!==null;)m|=S.lanes|S.childLanes,b|=S.subtreeFlags,b|=S.flags,S.return=u,S=S.sibling;return u.subtreeFlags|=b,u.childLanes=m,h}function GV(u,h,m){var b=h.pendingProps;switch(wx(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qr(h),null;case 1:return Cs(h.type)&&Cm(),qr(h),null;case 3:return b=h.stateNode,$c(),bn(Is),bn(jr),Dx(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(u===null||u.child===null)&&(_m(h)?h.flags|=4:u===null||u.memoizedState.isDehydrated&&!(h.flags&256)||(h.flags|=1024,Di!==null&&(uw(Di),Di=null))),Jx(u,h),qr(h),null;case 5:Ax(h);var S=eu(md.current);if(m=h.type,u!==null&&h.stateNode!=null)Fk(u,h,m,b,S),u.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!b){if(h.stateNode===null)throw Error(t(166));return qr(h),null}if(u=eu(fo.current),_m(h)){b=h.stateNode,m=h.type;var N=h.memoizedProps;switch(b[ho]=h,b[cd]=N,u=(h.mode&1)!==0,m){case"dialog":wn("cancel",b),wn("close",b);break;case"iframe":case"object":case"embed":wn("load",b);break;case"video":case"audio":for(S=0;S<ad.length;S++)wn(ad[S],b);break;case"source":wn("error",b);break;case"img":case"image":case"link":wn("error",b),wn("load",b);break;case"details":wn("toggle",b);break;case"input":Rt(b,N),wn("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!N.multiple},wn("invalid",b);break;case"textarea":Tr(b,N),wn("invalid",b)}so(m,N),S=null;for(var V in N)if(N.hasOwnProperty(V)){var W=N[V];V==="children"?typeof W=="string"?b.textContent!==W&&(N.suppressHydrationWarning!==!0&&wm(b.textContent,W,u),S=["children",W]):typeof W=="number"&&b.textContent!==""+W&&(N.suppressHydrationWarning!==!0&&wm(b.textContent,W,u),S=["children",""+W]):s.hasOwnProperty(V)&&W!=null&&V==="onScroll"&&wn("scroll",b)}switch(m){case"input":st(b),qt(b,N,!0);break;case"textarea":st(b),En(b);break;case"select":case"option":break;default:typeof N.onClick=="function"&&(b.onclick=bm)}b=S,h.updateQueue=b,b!==null&&(h.flags|=4)}else{V=S.nodeType===9?S:S.ownerDocument,u==="http://www.w3.org/1999/xhtml"&&(u=Tt(m)),u==="http://www.w3.org/1999/xhtml"?m==="script"?(u=V.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild)):typeof b.is=="string"?u=V.createElement(m,{is:b.is}):(u=V.createElement(m),m==="select"&&(V=u,b.multiple?V.multiple=!0:b.size&&(V.size=b.size))):u=V.createElementNS(u,m),u[ho]=h,u[cd]=b,Pk(u,h,!1,!1),h.stateNode=u;e:{switch(V=_a(m,b),m){case"dialog":wn("cancel",u),wn("close",u),S=b;break;case"iframe":case"object":case"embed":wn("load",u),S=b;break;case"video":case"audio":for(S=0;S<ad.length;S++)wn(ad[S],u);S=b;break;case"source":wn("error",u),S=b;break;case"img":case"image":case"link":wn("error",u),wn("load",u),S=b;break;case"details":wn("toggle",u),S=b;break;case"input":Rt(u,b),S=Wt(u,b),wn("invalid",u);break;case"option":S=b;break;case"select":u._wrapperState={wasMultiple:!!b.multiple},S=ee({},b,{value:void 0}),wn("invalid",u);break;case"textarea":Tr(u,b),S=yn(u,b),wn("invalid",u);break;default:S=b}so(m,S),W=S;for(N in W)if(W.hasOwnProperty(N)){var K=W[N];N==="style"?Bo(u,K):N==="dangerouslySetInnerHTML"?(K=K?K.__html:void 0,K!=null&&Os(u,K)):N==="children"?typeof K=="string"?(m!=="textarea"||K!=="")&&Wn(u,K):typeof K=="number"&&Wn(u,""+K):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(s.hasOwnProperty(N)?K!=null&&N==="onScroll"&&wn("scroll",u):K!=null&&k(u,N,K,V))}switch(m){case"input":st(u),qt(u,b,!1);break;case"textarea":st(u),En(u);break;case"option":b.value!=null&&u.setAttribute("value",""+Fe(b.value));break;case"select":u.multiple=!!b.multiple,N=b.value,N!=null?pn(u,!!b.multiple,N,!1):b.defaultValue!=null&&pn(u,!!b.multiple,b.defaultValue,!0);break;default:typeof S.onClick=="function"&&(u.onclick=bm)}switch(m){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return qr(h),null;case 6:if(u&&h.stateNode!=null)Ok(u,h,u.memoizedProps,b);else{if(typeof b!="string"&&h.stateNode===null)throw Error(t(166));if(m=eu(md.current),eu(fo.current),_m(h)){if(b=h.stateNode,m=h.memoizedProps,b[ho]=h,(N=b.nodeValue!==m)&&(u=Us,u!==null))switch(u.tag){case 3:wm(b.nodeValue,m,(u.mode&1)!==0);break;case 5:u.memoizedProps.suppressHydrationWarning!==!0&&wm(b.nodeValue,m,(u.mode&1)!==0)}N&&(h.flags|=4)}else b=(m.nodeType===9?m:m.ownerDocument).createTextNode(b),b[ho]=h,h.stateNode=b}return qr(h),null;case 13:if(bn(Nn),b=h.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(Tn&&Ws!==null&&h.mode&1&&!(h.flags&128))VE(),_c(),h.flags|=98560,N=!1;else if(N=_m(h),b!==null&&b.dehydrated!==null){if(u===null){if(!N)throw Error(t(318));if(N=h.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(t(317));N[ho]=h}else _c(),!(h.flags&128)&&(h.memoizedState=null),h.flags|=4;qr(h),N=!1}else Di!==null&&(uw(Di),Di=null),N=!0;if(!N)return h.flags&65536?h:null}return h.flags&128?(h.lanes=m,h):(b=b!==null,b!==(u!==null&&u.memoizedState!==null)&&b&&(h.child.flags|=8192,h.mode&1&&(u===null||Nn.current&1?ar===0&&(ar=3):dw())),h.updateQueue!==null&&(h.flags|=4),qr(h),null);case 4:return $c(),Jx(u,h),u===null&&ld(h.stateNode.containerInfo),qr(h),null;case 10:return kx(h.type._context),qr(h),null;case 17:return Cs(h.type)&&Cm(),qr(h),null;case 19:if(bn(Nn),N=h.memoizedState,N===null)return qr(h),null;if(b=(h.flags&128)!==0,V=N.rendering,V===null)if(b)wd(N,!1);else{if(ar!==0||u!==null&&u.flags&128)for(u=h.child;u!==null;){if(V=Pm(u),V!==null){for(h.flags|=128,wd(N,!1),b=V.updateQueue,b!==null&&(h.updateQueue=b,h.flags|=4),h.subtreeFlags=0,b=m,m=h.child;m!==null;)N=m,u=b,N.flags&=14680066,V=N.alternate,V===null?(N.childLanes=0,N.lanes=u,N.child=null,N.subtreeFlags=0,N.memoizedProps=null,N.memoizedState=null,N.updateQueue=null,N.dependencies=null,N.stateNode=null):(N.childLanes=V.childLanes,N.lanes=V.lanes,N.child=V.child,N.subtreeFlags=0,N.deletions=null,N.memoizedProps=V.memoizedProps,N.memoizedState=V.memoizedState,N.updateQueue=V.updateQueue,N.type=V.type,u=V.dependencies,N.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),m=m.sibling;return mn(Nn,Nn.current&1|2),h.child}u=u.sibling}N.tail!==null&&tn()>Oc&&(h.flags|=128,b=!0,wd(N,!1),h.lanes=4194304)}else{if(!b)if(u=Pm(V),u!==null){if(h.flags|=128,b=!0,m=u.updateQueue,m!==null&&(h.updateQueue=m,h.flags|=4),wd(N,!0),N.tail===null&&N.tailMode==="hidden"&&!V.alternate&&!Tn)return qr(h),null}else 2*tn()-N.renderingStartTime>Oc&&m!==1073741824&&(h.flags|=128,b=!0,wd(N,!1),h.lanes=4194304);N.isBackwards?(V.sibling=h.child,h.child=V):(m=N.last,m!==null?m.sibling=V:h.child=V,N.last=V)}return N.tail!==null?(h=N.tail,N.rendering=h,N.tail=h.sibling,N.renderingStartTime=tn(),h.sibling=null,m=Nn.current,mn(Nn,b?m&1|2:m&1),h):(qr(h),null);case 22:case 23:return hw(),b=h.memoizedState!==null,u!==null&&u.memoizedState!==null!==b&&(h.flags|=8192),b&&h.mode&1?Gs&1073741824&&(qr(h),h.subtreeFlags&6&&(h.flags|=8192)):qr(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function jV(u,h){switch(wx(h),h.tag){case 1:return Cs(h.type)&&Cm(),u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 3:return $c(),bn(Is),bn(jr),Dx(),u=h.flags,u&65536&&!(u&128)?(h.flags=u&-65537|128,h):null;case 5:return Ax(h),null;case 13:if(bn(Nn),u=h.memoizedState,u!==null&&u.dehydrated!==null){if(h.alternate===null)throw Error(t(340));_c()}return u=h.flags,u&65536?(h.flags=u&-65537|128,h):null;case 19:return bn(Nn),null;case 4:return $c(),null;case 10:return kx(h.type._context),null;case 22:case 23:return hw(),null;case 24:return null;default:return null}}var Wm=!1,Kr=!1,HV=typeof WeakSet=="function"?WeakSet:Set,qe=null;function Pc(u,h){var m=u.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(b){On(u,h,b)}else m.current=null}function Zx(u,h,m){try{m()}catch(b){On(u,h,b)}}var Lk=!1;function qV(u,h){if(hx=Oa,u=mE(),rx(u)){if("selectionStart"in u)var m={start:u.selectionStart,end:u.selectionEnd};else e:{m=(m=u.ownerDocument)&&m.defaultView||window;var b=m.getSelection&&m.getSelection();if(b&&b.rangeCount!==0){m=b.anchorNode;var S=b.anchorOffset,N=b.focusNode;b=b.focusOffset;try{m.nodeType,N.nodeType}catch{m=null;break e}var V=0,W=-1,K=-1,me=0,Re=0,$e=u,_e=null;t:for(;;){for(var We;$e!==m||S!==0&&$e.nodeType!==3||(W=V+S),$e!==N||b!==0&&$e.nodeType!==3||(K=V+b),$e.nodeType===3&&(V+=$e.nodeValue.length),(We=$e.firstChild)!==null;)_e=$e,$e=We;for(;;){if($e===u)break t;if(_e===m&&++me===S&&(W=V),_e===N&&++Re===b&&(K=V),(We=$e.nextSibling)!==null)break;$e=_e,_e=$e.parentNode}$e=We}m=W===-1||K===-1?null:{start:W,end:K}}else m=null}m=m||{start:0,end:0}}else m=null;for(dx={focusedElem:u,selectionRange:m},Oa=!1,qe=h;qe!==null;)if(h=qe,u=h.child,(h.subtreeFlags&1028)!==0&&u!==null)u.return=h,qe=u;else for(;qe!==null;){h=qe;try{var Qe=h.alternate;if(h.flags&1024)switch(h.tag){case 0:case 11:case 15:break;case 1:if(Qe!==null){var Ze=Qe.memoizedProps,Gn=Qe.memoizedState,he=h.stateNode,ne=he.getSnapshotBeforeUpdate(h.elementType===h.type?Ze:Pi(h.type,Ze),Gn);he.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var fe=h.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Pe){On(h,h.return,Pe)}if(u=h.sibling,u!==null){u.return=h.return,qe=u;break}qe=h.return}return Qe=Lk,Lk=!1,Qe}function bd(u,h,m){var b=h.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var S=b=b.next;do{if((S.tag&u)===u){var N=S.destroy;S.destroy=void 0,N!==void 0&&Zx(h,m,N)}S=S.next}while(S!==b)}}function Gm(u,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var m=h=h.next;do{if((m.tag&u)===u){var b=m.create;m.destroy=b()}m=m.next}while(m!==h)}}function ew(u){var h=u.ref;if(h!==null){var m=u.stateNode;switch(u.tag){case 5:u=m;break;default:u=m}typeof h=="function"?h(u):h.current=u}}function Mk(u){var h=u.alternate;h!==null&&(u.alternate=null,Mk(h)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(h=u.stateNode,h!==null&&(delete h[ho],delete h[cd],delete h[gx],delete h[RV],delete h[NV])),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}function Vk(u){return u.tag===5||u.tag===3||u.tag===4}function zk(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||Vk(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function tw(u,h,m){var b=u.tag;if(b===5||b===6)u=u.stateNode,h?m.nodeType===8?m.parentNode.insertBefore(u,h):m.insertBefore(u,h):(m.nodeType===8?(h=m.parentNode,h.insertBefore(u,m)):(h=m,h.appendChild(u)),m=m._reactRootContainer,m!=null||h.onclick!==null||(h.onclick=bm));else if(b!==4&&(u=u.child,u!==null))for(tw(u,h,m),u=u.sibling;u!==null;)tw(u,h,m),u=u.sibling}function nw(u,h,m){var b=u.tag;if(b===5||b===6)u=u.stateNode,h?m.insertBefore(u,h):m.appendChild(u);else if(b!==4&&(u=u.child,u!==null))for(nw(u,h,m),u=u.sibling;u!==null;)nw(u,h,m),u=u.sibling}var $r=null,Fi=!1;function ja(u,h,m){for(m=m.child;m!==null;)Bk(u,h,m),m=m.sibling}function Bk(u,h,m){if(Gr&&typeof Gr.onCommitFiberUnmount=="function")try{Gr.onCommitFiberUnmount(xs,m)}catch{}switch(m.tag){case 5:Kr||Pc(m,h);case 6:var b=$r,S=Fi;$r=null,ja(u,h,m),$r=b,Fi=S,$r!==null&&(Fi?(u=$r,m=m.stateNode,u.nodeType===8?u.parentNode.removeChild(m):u.removeChild(m)):$r.removeChild(m.stateNode));break;case 18:$r!==null&&(Fi?(u=$r,m=m.stateNode,u.nodeType===8?mx(u.parentNode,m):u.nodeType===1&&mx(u,m),Ni(u)):mx($r,m.stateNode));break;case 4:b=$r,S=Fi,$r=m.stateNode.containerInfo,Fi=!0,ja(u,h,m),$r=b,Fi=S;break;case 0:case 11:case 14:case 15:if(!Kr&&(b=m.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){S=b=b.next;do{var N=S,V=N.destroy;N=N.tag,V!==void 0&&(N&2||N&4)&&Zx(m,h,V),S=S.next}while(S!==b)}ja(u,h,m);break;case 1:if(!Kr&&(Pc(m,h),b=m.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=m.memoizedProps,b.state=m.memoizedState,b.componentWillUnmount()}catch(W){On(m,h,W)}ja(u,h,m);break;case 21:ja(u,h,m);break;case 22:m.mode&1?(Kr=(b=Kr)||m.memoizedState!==null,ja(u,h,m),Kr=b):ja(u,h,m);break;default:ja(u,h,m)}}function Uk(u){var h=u.updateQueue;if(h!==null){u.updateQueue=null;var m=u.stateNode;m===null&&(m=u.stateNode=new HV),h.forEach(function(b){var S=n3.bind(null,u,b);m.has(b)||(m.add(b),b.then(S,S))})}}function Oi(u,h){var m=h.deletions;if(m!==null)for(var b=0;b<m.length;b++){var S=m[b];try{var N=u,V=h,W=V;e:for(;W!==null;){switch(W.tag){case 5:$r=W.stateNode,Fi=!1;break e;case 3:$r=W.stateNode.containerInfo,Fi=!0;break e;case 4:$r=W.stateNode.containerInfo,Fi=!0;break e}W=W.return}if($r===null)throw Error(t(160));Bk(N,V,S),$r=null,Fi=!1;var K=S.alternate;K!==null&&(K.return=null),S.return=null}catch(me){On(S,h,me)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)Wk(h,u),h=h.sibling}function Wk(u,h){var m=u.alternate,b=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:if(Oi(h,u),mo(u),b&4){try{bd(3,u,u.return),Gm(3,u)}catch(Ze){On(u,u.return,Ze)}try{bd(5,u,u.return)}catch(Ze){On(u,u.return,Ze)}}break;case 1:Oi(h,u),mo(u),b&512&&m!==null&&Pc(m,m.return);break;case 5:if(Oi(h,u),mo(u),b&512&&m!==null&&Pc(m,m.return),u.flags&32){var S=u.stateNode;try{Wn(S,"")}catch(Ze){On(u,u.return,Ze)}}if(b&4&&(S=u.stateNode,S!=null)){var N=u.memoizedProps,V=m!==null?m.memoizedProps:N,W=u.type,K=u.updateQueue;if(u.updateQueue=null,K!==null)try{W==="input"&&N.type==="radio"&&N.name!=null&&kt(S,N),_a(W,V);var me=_a(W,N);for(V=0;V<K.length;V+=2){var Re=K[V],$e=K[V+1];Re==="style"?Bo(S,$e):Re==="dangerouslySetInnerHTML"?Os(S,$e):Re==="children"?Wn(S,$e):k(S,Re,$e,me)}switch(W){case"input":Ht(S,N);break;case"textarea":Dn(S,N);break;case"select":var _e=S._wrapperState.wasMultiple;S._wrapperState.wasMultiple=!!N.multiple;var We=N.value;We!=null?pn(S,!!N.multiple,We,!1):_e!==!!N.multiple&&(N.defaultValue!=null?pn(S,!!N.multiple,N.defaultValue,!0):pn(S,!!N.multiple,N.multiple?[]:"",!1))}S[cd]=N}catch(Ze){On(u,u.return,Ze)}}break;case 6:if(Oi(h,u),mo(u),b&4){if(u.stateNode===null)throw Error(t(162));S=u.stateNode,N=u.memoizedProps;try{S.nodeValue=N}catch(Ze){On(u,u.return,Ze)}}break;case 3:if(Oi(h,u),mo(u),b&4&&m!==null&&m.memoizedState.isDehydrated)try{Ni(h.containerInfo)}catch(Ze){On(u,u.return,Ze)}break;case 4:Oi(h,u),mo(u);break;case 13:Oi(h,u),mo(u),S=u.child,S.flags&8192&&(N=S.memoizedState!==null,S.stateNode.isHidden=N,!N||S.alternate!==null&&S.alternate.memoizedState!==null||(iw=tn())),b&4&&Uk(u);break;case 22:if(Re=m!==null&&m.memoizedState!==null,u.mode&1?(Kr=(me=Kr)||Re,Oi(h,u),Kr=me):Oi(h,u),mo(u),b&8192){if(me=u.memoizedState!==null,(u.stateNode.isHidden=me)&&!Re&&u.mode&1)for(qe=u,Re=u.child;Re!==null;){for($e=qe=Re;qe!==null;){switch(_e=qe,We=_e.child,_e.tag){case 0:case 11:case 14:case 15:bd(4,_e,_e.return);break;case 1:Pc(_e,_e.return);var Qe=_e.stateNode;if(typeof Qe.componentWillUnmount=="function"){b=_e,m=_e.return;try{h=b,Qe.props=h.memoizedProps,Qe.state=h.memoizedState,Qe.componentWillUnmount()}catch(Ze){On(b,m,Ze)}}break;case 5:Pc(_e,_e.return);break;case 22:if(_e.memoizedState!==null){Hk($e);continue}}We!==null?(We.return=_e,qe=We):Hk($e)}Re=Re.sibling}e:for(Re=null,$e=u;;){if($e.tag===5){if(Re===null){Re=$e;try{S=$e.stateNode,me?(N=S.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none"):(W=$e.stateNode,K=$e.memoizedProps.style,V=K!=null&&K.hasOwnProperty("display")?K.display:null,W.style.display=Ls("display",V))}catch(Ze){On(u,u.return,Ze)}}}else if($e.tag===6){if(Re===null)try{$e.stateNode.nodeValue=me?"":$e.memoizedProps}catch(Ze){On(u,u.return,Ze)}}else if(($e.tag!==22&&$e.tag!==23||$e.memoizedState===null||$e===u)&&$e.child!==null){$e.child.return=$e,$e=$e.child;continue}if($e===u)break e;for(;$e.sibling===null;){if($e.return===null||$e.return===u)break e;Re===$e&&(Re=null),$e=$e.return}Re===$e&&(Re=null),$e.sibling.return=$e.return,$e=$e.sibling}}break;case 19:Oi(h,u),mo(u),b&4&&Uk(u);break;case 21:break;default:Oi(h,u),mo(u)}}function mo(u){var h=u.flags;if(h&2){try{e:{for(var m=u.return;m!==null;){if(Vk(m)){var b=m;break e}m=m.return}throw Error(t(160))}switch(b.tag){case 5:var S=b.stateNode;b.flags&32&&(Wn(S,""),b.flags&=-33);var N=zk(u);nw(u,N,S);break;case 3:case 4:var V=b.stateNode.containerInfo,W=zk(u);tw(u,W,V);break;default:throw Error(t(161))}}catch(K){On(u,u.return,K)}u.flags&=-3}h&4096&&(u.flags&=-4097)}function KV(u,h,m){qe=u,Gk(u)}function Gk(u,h,m){for(var b=(u.mode&1)!==0;qe!==null;){var S=qe,N=S.child;if(S.tag===22&&b){var V=S.memoizedState!==null||Wm;if(!V){var W=S.alternate,K=W!==null&&W.memoizedState!==null||Kr;W=Wm;var me=Kr;if(Wm=V,(Kr=K)&&!me)for(qe=S;qe!==null;)V=qe,K=V.child,V.tag===22&&V.memoizedState!==null?qk(S):K!==null?(K.return=V,qe=K):qk(S);for(;N!==null;)qe=N,Gk(N),N=N.sibling;qe=S,Wm=W,Kr=me}jk(u)}else S.subtreeFlags&8772&&N!==null?(N.return=S,qe=N):jk(u)}}function jk(u){for(;qe!==null;){var h=qe;if(h.flags&8772){var m=h.alternate;try{if(h.flags&8772)switch(h.tag){case 0:case 11:case 15:Kr||Gm(5,h);break;case 1:var b=h.stateNode;if(h.flags&4&&!Kr)if(m===null)b.componentDidMount();else{var S=h.elementType===h.type?m.memoizedProps:Pi(h.type,m.memoizedProps);b.componentDidUpdate(S,m.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var N=h.updateQueue;N!==null&&HE(h,N,b);break;case 3:var V=h.updateQueue;if(V!==null){if(m=null,h.child!==null)switch(h.child.tag){case 5:m=h.child.stateNode;break;case 1:m=h.child.stateNode}HE(h,V,m)}break;case 5:var W=h.stateNode;if(m===null&&h.flags&4){m=W;var K=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":K.autoFocus&&m.focus();break;case"img":K.src&&(m.src=K.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var me=h.alternate;if(me!==null){var Re=me.memoizedState;if(Re!==null){var $e=Re.dehydrated;$e!==null&&Ni($e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Kr||h.flags&512&&ew(h)}catch(_e){On(h,h.return,_e)}}if(h===u){qe=null;break}if(m=h.sibling,m!==null){m.return=h.return,qe=m;break}qe=h.return}}function Hk(u){for(;qe!==null;){var h=qe;if(h===u){qe=null;break}var m=h.sibling;if(m!==null){m.return=h.return,qe=m;break}qe=h.return}}function qk(u){for(;qe!==null;){var h=qe;try{switch(h.tag){case 0:case 11:case 15:var m=h.return;try{Gm(4,h)}catch(K){On(h,m,K)}break;case 1:var b=h.stateNode;if(typeof b.componentDidMount=="function"){var S=h.return;try{b.componentDidMount()}catch(K){On(h,S,K)}}var N=h.return;try{ew(h)}catch(K){On(h,N,K)}break;case 5:var V=h.return;try{ew(h)}catch(K){On(h,V,K)}}}catch(K){On(h,h.return,K)}if(h===u){qe=null;break}var W=h.sibling;if(W!==null){W.return=h.return,qe=W;break}qe=h.return}}var XV=Math.ceil,jm=E.ReactCurrentDispatcher,rw=E.ReactCurrentOwner,oi=E.ReactCurrentBatchConfig,jt=0,vr=null,Xn=null,Dr=0,Gs=0,Fc=za(0),ar=0,Id=null,nu=0,Hm=0,sw=0,Cd=null,Es=null,iw=0,Oc=1/0,sa=null,qm=!1,ow=null,Ha=null,Km=!1,qa=null,Xm=0,Sd=0,aw=null,Ym=-1,Qm=0;function us(){return jt&6?tn():Ym!==-1?Ym:Ym=tn()}function Ka(u){return u.mode&1?jt&2&&Dr!==0?Dr&-Dr:$V.transition!==null?(Qm===0&&(Qm=Gl()),Qm):(u=Pt,u!==0||(u=window.event,u=u===void 0?16:Jh(u.type)),u):1}function Li(u,h,m,b){if(50<Sd)throw Sd=0,aw=null,Error(t(185));$a(u,m,b),(!(jt&2)||u!==vr)&&(u===vr&&(!(jt&2)&&(Hm|=m),ar===4&&Xa(u,Dr)),ks(u,b),m===1&&jt===0&&!(h.mode&1)&&(Oc=tn()+500,Em&&Ua()))}function ks(u,h){var m=u.callbackNode;Ho(u,h);var b=Wl(u,u===vr?Dr:0);if(b===0)m!==null&&Go(m),u.callbackNode=null,u.callbackPriority=0;else if(h=b&-b,u.callbackPriority!==h){if(m!=null&&Go(m),h===1)u.tag===0?AV(Xk.bind(null,u)):PE(Xk.bind(null,u)),TV(function(){!(jt&6)&&Ua()}),m=null;else{switch(Pa(b)){case 1:m=Vt;break;case 4:m=vn;break;case 16:m=Rr;break;case 536870912:m=xn;break;default:m=Rr}m=rT(m,Kk.bind(null,u))}u.callbackPriority=h,u.callbackNode=m}}function Kk(u,h){if(Ym=-1,Qm=0,jt&6)throw Error(t(327));var m=u.callbackNode;if(Lc()&&u.callbackNode!==m)return null;var b=Wl(u,u===vr?Dr:0);if(b===0)return null;if(b&30||b&u.expiredLanes||h)h=Jm(u,b);else{h=b;var S=jt;jt|=2;var N=Qk();(vr!==u||Dr!==h)&&(sa=null,Oc=tn()+500,su(u,h));do try{JV();break}catch(W){Yk(u,W)}while(!0);Ex(),jm.current=N,jt=S,Xn!==null?h=0:(vr=null,Dr=0,h=ar)}if(h!==0){if(h===2&&(S=Vs(u),S!==0&&(b=S,h=lw(u,S))),h===1)throw m=Id,su(u,0),Xa(u,b),ks(u,tn()),m;if(h===6)Xa(u,b);else{if(S=u.current.alternate,!(b&30)&&!YV(S)&&(h=Jm(u,b),h===2&&(N=Vs(u),N!==0&&(b=N,h=lw(u,N))),h===1))throw m=Id,su(u,0),Xa(u,b),ks(u,tn()),m;switch(u.finishedWork=S,u.finishedLanes=b,h){case 0:case 1:throw Error(t(345));case 2:iu(u,Es,sa);break;case 3:if(Xa(u,b),(b&130023424)===b&&(h=iw+500-tn(),10<h)){if(Wl(u,0)!==0)break;if(S=u.suspendedLanes,(S&b)!==b){us(),u.pingedLanes|=u.suspendedLanes&S;break}u.timeoutHandle=px(iu.bind(null,u,Es,sa),h);break}iu(u,Es,sa);break;case 4:if(Xa(u,b),(b&4194240)===b)break;for(h=u.eventTimes,S=-1;0<b;){var V=31-os(b);N=1<<V,V=h[V],V>S&&(S=V),b&=~N}if(b=S,b=tn()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*XV(b/1960))-b,10<b){u.timeoutHandle=px(iu.bind(null,u,Es,sa),b);break}iu(u,Es,sa);break;case 5:iu(u,Es,sa);break;default:throw Error(t(329))}}}return ks(u,tn()),u.callbackNode===m?Kk.bind(null,u):null}function lw(u,h){var m=Cd;return u.current.memoizedState.isDehydrated&&(su(u,h).flags|=256),u=Jm(u,h),u!==2&&(h=Es,Es=m,h!==null&&uw(h)),u}function uw(u){Es===null?Es=u:Es.push.apply(Es,u)}function YV(u){for(var h=u;;){if(h.flags&16384){var m=h.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var b=0;b<m.length;b++){var S=m[b],N=S.getSnapshot;S=S.value;try{if(!$i(N(),S))return!1}catch{return!1}}}if(m=h.child,h.subtreeFlags&16384&&m!==null)m.return=h,h=m;else{if(h===u)break;for(;h.sibling===null;){if(h.return===null||h.return===u)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Xa(u,h){for(h&=~sw,h&=~Hm,u.suspendedLanes|=h,u.pingedLanes&=~h,u=u.expirationTimes;0<h;){var m=31-os(h),b=1<<m;u[m]=-1,h&=~b}}function Xk(u){if(jt&6)throw Error(t(327));Lc();var h=Wl(u,0);if(!(h&1))return ks(u,tn()),null;var m=Jm(u,h);if(u.tag!==0&&m===2){var b=Vs(u);b!==0&&(h=b,m=lw(u,b))}if(m===1)throw m=Id,su(u,0),Xa(u,h),ks(u,tn()),m;if(m===6)throw Error(t(345));return u.finishedWork=u.current.alternate,u.finishedLanes=h,iu(u,Es,sa),ks(u,tn()),null}function cw(u,h){var m=jt;jt|=1;try{return u(h)}finally{jt=m,jt===0&&(Oc=tn()+500,Em&&Ua())}}function ru(u){qa!==null&&qa.tag===0&&!(jt&6)&&Lc();var h=jt;jt|=1;var m=oi.transition,b=Pt;try{if(oi.transition=null,Pt=1,u)return u()}finally{Pt=b,oi.transition=m,jt=h,!(jt&6)&&Ua()}}function hw(){Gs=Fc.current,bn(Fc)}function su(u,h){u.finishedWork=null,u.finishedLanes=0;var m=u.timeoutHandle;if(m!==-1&&(u.timeoutHandle=-1,kV(m)),Xn!==null)for(m=Xn.return;m!==null;){var b=m;switch(wx(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&Cm();break;case 3:$c(),bn(Is),bn(jr),Dx();break;case 5:Ax(b);break;case 4:$c();break;case 13:bn(Nn);break;case 19:bn(Nn);break;case 10:kx(b.type._context);break;case 22:case 23:hw()}m=m.return}if(vr=u,Xn=u=Ya(u.current,null),Dr=Gs=h,ar=0,Id=null,sw=Hm=nu=0,Es=Cd=null,Zl!==null){for(h=0;h<Zl.length;h++)if(m=Zl[h],b=m.interleaved,b!==null){m.interleaved=null;var S=b.next,N=m.pending;if(N!==null){var V=N.next;N.next=S,b.next=V}m.pending=b}Zl=null}return u}function Yk(u,h){do{var m=Xn;try{if(Ex(),Fm.current=Vm,Om){for(var b=An.memoizedState;b!==null;){var S=b.queue;S!==null&&(S.pending=null),b=b.next}Om=!1}if(tu=0,yr=or=An=null,gd=!1,yd=0,rw.current=null,m===null||m.return===null){ar=1,Id=h,Xn=null;break}e:{var N=u,V=m.return,W=m,K=h;if(h=Dr,W.flags|=32768,K!==null&&typeof K=="object"&&typeof K.then=="function"){var me=K,Re=W,$e=Re.tag;if(!(Re.mode&1)&&($e===0||$e===11||$e===15)){var _e=Re.alternate;_e?(Re.updateQueue=_e.updateQueue,Re.memoizedState=_e.memoizedState,Re.lanes=_e.lanes):(Re.updateQueue=null,Re.memoizedState=null)}var We=bk(V);if(We!==null){We.flags&=-257,Ik(We,V,W,N,h),We.mode&1&&wk(N,me,h),h=We,K=me;var Qe=h.updateQueue;if(Qe===null){var Ze=new Set;Ze.add(K),h.updateQueue=Ze}else Qe.add(K);break e}else{if(!(h&1)){wk(N,me,h),dw();break e}K=Error(t(426))}}else if(Tn&&W.mode&1){var Gn=bk(V);if(Gn!==null){!(Gn.flags&65536)&&(Gn.flags|=256),Ik(Gn,V,W,N,h),Cx(Dc(K,W));break e}}N=K=Dc(K,W),ar!==4&&(ar=2),Cd===null?Cd=[N]:Cd.push(N),N=V;do{switch(N.tag){case 3:N.flags|=65536,h&=-h,N.lanes|=h;var he=vk(N,K,h);jE(N,he);break e;case 1:W=K;var ne=N.type,fe=N.stateNode;if(!(N.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(Ha===null||!Ha.has(fe)))){N.flags|=65536,h&=-h,N.lanes|=h;var Pe=xk(N,W,h);jE(N,Pe);break e}}N=N.return}while(N!==null)}Zk(m)}catch(et){h=et,Xn===m&&m!==null&&(Xn=m=m.return);continue}break}while(!0)}function Qk(){var u=jm.current;return jm.current=Vm,u===null?Vm:u}function dw(){(ar===0||ar===3||ar===2)&&(ar=4),vr===null||!(nu&268435455)&&!(Hm&268435455)||Xa(vr,Dr)}function Jm(u,h){var m=jt;jt|=2;var b=Qk();(vr!==u||Dr!==h)&&(sa=null,su(u,h));do try{QV();break}catch(S){Yk(u,S)}while(!0);if(Ex(),jt=m,jm.current=b,Xn!==null)throw Error(t(261));return vr=null,Dr=0,ar}function QV(){for(;Xn!==null;)Jk(Xn)}function JV(){for(;Xn!==null&&!io();)Jk(Xn)}function Jk(u){var h=nT(u.alternate,u,Gs);u.memoizedProps=u.pendingProps,h===null?Zk(u):Xn=h,rw.current=null}function Zk(u){var h=u;do{var m=h.alternate;if(u=h.return,h.flags&32768){if(m=jV(m,h),m!==null){m.flags&=32767,Xn=m;return}if(u!==null)u.flags|=32768,u.subtreeFlags=0,u.deletions=null;else{ar=6,Xn=null;return}}else if(m=GV(m,h,Gs),m!==null){Xn=m;return}if(h=h.sibling,h!==null){Xn=h;return}Xn=h=u}while(h!==null);ar===0&&(ar=5)}function iu(u,h,m){var b=Pt,S=oi.transition;try{oi.transition=null,Pt=1,ZV(u,h,m,b)}finally{oi.transition=S,Pt=b}return null}function ZV(u,h,m,b){do Lc();while(qa!==null);if(jt&6)throw Error(t(327));m=u.finishedWork;var S=u.finishedLanes;if(m===null)return null;if(u.finishedWork=null,u.finishedLanes=0,m===u.current)throw Error(t(177));u.callbackNode=null,u.callbackPriority=0;var N=m.lanes|m.childLanes;if(cn(u,N),u===vr&&(Xn=vr=null,Dr=0),!(m.subtreeFlags&2064)&&!(m.flags&2064)||Km||(Km=!0,rT(Rr,function(){return Lc(),null})),N=(m.flags&15990)!==0,m.subtreeFlags&15990||N){N=oi.transition,oi.transition=null;var V=Pt;Pt=1;var W=jt;jt|=4,rw.current=null,qV(u,m),Wk(m,u),xV(dx),Oa=!!hx,dx=hx=null,u.current=m,KV(m),Ei(),jt=W,Pt=V,oi.transition=N}else u.current=m;if(Km&&(Km=!1,qa=u,Xm=S),N=u.pendingLanes,N===0&&(Ha=null),sc(m.stateNode),ks(u,tn()),h!==null)for(b=u.onRecoverableError,m=0;m<h.length;m++)S=h[m],b(S.value,{componentStack:S.stack,digest:S.digest});if(qm)throw qm=!1,u=ow,ow=null,u;return Xm&1&&u.tag!==0&&Lc(),N=u.pendingLanes,N&1?u===aw?Sd++:(Sd=0,aw=u):Sd=0,Ua(),null}function Lc(){if(qa!==null){var u=Pa(Xm),h=oi.transition,m=Pt;try{if(oi.transition=null,Pt=16>u?16:u,qa===null)var b=!1;else{if(u=qa,qa=null,Xm=0,jt&6)throw Error(t(331));var S=jt;for(jt|=4,qe=u.current;qe!==null;){var N=qe,V=N.child;if(qe.flags&16){var W=N.deletions;if(W!==null){for(var K=0;K<W.length;K++){var me=W[K];for(qe=me;qe!==null;){var Re=qe;switch(Re.tag){case 0:case 11:case 15:bd(8,Re,N)}var $e=Re.child;if($e!==null)$e.return=Re,qe=$e;else for(;qe!==null;){Re=qe;var _e=Re.sibling,We=Re.return;if(Mk(Re),Re===me){qe=null;break}if(_e!==null){_e.return=We,qe=_e;break}qe=We}}}var Qe=N.alternate;if(Qe!==null){var Ze=Qe.child;if(Ze!==null){Qe.child=null;do{var Gn=Ze.sibling;Ze.sibling=null,Ze=Gn}while(Ze!==null)}}qe=N}}if(N.subtreeFlags&2064&&V!==null)V.return=N,qe=V;else e:for(;qe!==null;){if(N=qe,N.flags&2048)switch(N.tag){case 0:case 11:case 15:bd(9,N,N.return)}var he=N.sibling;if(he!==null){he.return=N.return,qe=he;break e}qe=N.return}}var ne=u.current;for(qe=ne;qe!==null;){V=qe;var fe=V.child;if(V.subtreeFlags&2064&&fe!==null)fe.return=V,qe=fe;else e:for(V=ne;qe!==null;){if(W=qe,W.flags&2048)try{switch(W.tag){case 0:case 11:case 15:Gm(9,W)}}catch(et){On(W,W.return,et)}if(W===V){qe=null;break e}var Pe=W.sibling;if(Pe!==null){Pe.return=W.return,qe=Pe;break e}qe=W.return}}if(jt=S,Ua(),Gr&&typeof Gr.onPostCommitFiberRoot=="function")try{Gr.onPostCommitFiberRoot(xs,u)}catch{}b=!0}return b}finally{Pt=m,oi.transition=h}}return!1}function eT(u,h,m){h=Dc(m,h),h=vk(u,h,1),u=Ga(u,h,1),h=us(),u!==null&&($a(u,1,h),ks(u,h))}function On(u,h,m){if(u.tag===3)eT(u,u,m);else for(;h!==null;){if(h.tag===3){eT(h,u,m);break}else if(h.tag===1){var b=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Ha===null||!Ha.has(b))){u=Dc(m,u),u=xk(h,u,1),h=Ga(h,u,1),u=us(),h!==null&&($a(h,1,u),ks(h,u));break}}h=h.return}}function e3(u,h,m){var b=u.pingCache;b!==null&&b.delete(h),h=us(),u.pingedLanes|=u.suspendedLanes&m,vr===u&&(Dr&m)===m&&(ar===4||ar===3&&(Dr&130023424)===Dr&&500>tn()-iw?su(u,0):sw|=m),ks(u,h)}function tT(u,h){h===0&&(u.mode&1?(h=oc,oc<<=1,!(oc&130023424)&&(oc=4194304)):h=1);var m=us();u=ta(u,h),u!==null&&($a(u,h,m),ks(u,m))}function t3(u){var h=u.memoizedState,m=0;h!==null&&(m=h.retryLane),tT(u,m)}function n3(u,h){var m=0;switch(u.tag){case 13:var b=u.stateNode,S=u.memoizedState;S!==null&&(m=S.retryLane);break;case 19:b=u.stateNode;break;default:throw Error(t(314))}b!==null&&b.delete(h),tT(u,m)}var nT;nT=function(u,h,m){if(u!==null)if(u.memoizedProps!==h.pendingProps||Is.current)Ss=!0;else{if(!(u.lanes&m)&&!(h.flags&128))return Ss=!1,WV(u,h,m);Ss=!!(u.flags&131072)}else Ss=!1,Tn&&h.flags&1048576&&FE(h,Tm,h.index);switch(h.lanes=0,h.tag){case 2:var b=h.type;Um(u,h),u=h.pendingProps;var S=Ec(h,jr.current);Ac(h,m),S=Ox(null,h,b,u,S,m);var N=Lx();return h.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Cs(b)?(N=!0,Sm(h)):N=!1,h.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,Rx(h),S.updater=zm,h.stateNode=S,S._reactInternals=h,Wx(h,b,u,m),h=qx(null,h,b,!0,N,m)):(h.tag=0,Tn&&N&&xx(h),ls(null,h,S,m),h=h.child),h;case 16:b=h.elementType;e:{switch(Um(u,h),u=h.pendingProps,S=b._init,b=S(b._payload),h.type=b,S=h.tag=s3(b),u=Pi(b,u),S){case 0:h=Hx(null,h,b,u,m);break e;case 1:h=_k(null,h,b,u,m);break e;case 11:h=Ck(null,h,b,u,m);break e;case 14:h=Sk(null,h,b,Pi(b.type,u),m);break e}throw Error(t(306,b,""))}return h;case 0:return b=h.type,S=h.pendingProps,S=h.elementType===b?S:Pi(b,S),Hx(u,h,b,S,m);case 1:return b=h.type,S=h.pendingProps,S=h.elementType===b?S:Pi(b,S),_k(u,h,b,S,m);case 3:e:{if(Rk(h),u===null)throw Error(t(387));b=h.pendingProps,N=h.memoizedState,S=N.element,GE(u,h),Dm(h,b,null,m);var V=h.memoizedState;if(b=V.element,N.isDehydrated)if(N={element:b,isDehydrated:!1,cache:V.cache,pendingSuspenseBoundaries:V.pendingSuspenseBoundaries,transitions:V.transitions},h.updateQueue.baseState=N,h.memoizedState=N,h.flags&256){S=Dc(Error(t(423)),h),h=Nk(u,h,b,m,S);break e}else if(b!==S){S=Dc(Error(t(424)),h),h=Nk(u,h,b,m,S);break e}else for(Ws=Va(h.stateNode.containerInfo.firstChild),Us=h,Tn=!0,Di=null,m=UE(h,null,b,m),h.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(_c(),b===S){h=ra(u,h,m);break e}ls(u,h,b,m)}h=h.child}return h;case 5:return qE(h),u===null&&Ix(h),b=h.type,S=h.pendingProps,N=u!==null?u.memoizedProps:null,V=S.children,fx(b,S)?V=null:N!==null&&fx(b,N)&&(h.flags|=32),Tk(u,h),ls(u,h,V,m),h.child;case 6:return u===null&&Ix(h),null;case 13:return Ak(u,h,m);case 4:return Nx(h,h.stateNode.containerInfo),b=h.pendingProps,u===null?h.child=Rc(h,null,b,m):ls(u,h,b,m),h.child;case 11:return b=h.type,S=h.pendingProps,S=h.elementType===b?S:Pi(b,S),Ck(u,h,b,S,m);case 7:return ls(u,h,h.pendingProps,m),h.child;case 8:return ls(u,h,h.pendingProps.children,m),h.child;case 12:return ls(u,h,h.pendingProps.children,m),h.child;case 10:e:{if(b=h.type._context,S=h.pendingProps,N=h.memoizedProps,V=S.value,mn(Nm,b._currentValue),b._currentValue=V,N!==null)if($i(N.value,V)){if(N.children===S.children&&!Is.current){h=ra(u,h,m);break e}}else for(N=h.child,N!==null&&(N.return=h);N!==null;){var W=N.dependencies;if(W!==null){V=N.child;for(var K=W.firstContext;K!==null;){if(K.context===b){if(N.tag===1){K=na(-1,m&-m),K.tag=2;var me=N.updateQueue;if(me!==null){me=me.shared;var Re=me.pending;Re===null?K.next=K:(K.next=Re.next,Re.next=K),me.pending=K}}N.lanes|=m,K=N.alternate,K!==null&&(K.lanes|=m),Tx(N.return,m,h),W.lanes|=m;break}K=K.next}}else if(N.tag===10)V=N.type===h.type?null:N.child;else if(N.tag===18){if(V=N.return,V===null)throw Error(t(341));V.lanes|=m,W=V.alternate,W!==null&&(W.lanes|=m),Tx(V,m,h),V=N.sibling}else V=N.child;if(V!==null)V.return=N;else for(V=N;V!==null;){if(V===h){V=null;break}if(N=V.sibling,N!==null){N.return=V.return,V=N;break}V=V.return}N=V}ls(u,h,S.children,m),h=h.child}return h;case 9:return S=h.type,b=h.pendingProps.children,Ac(h,m),S=si(S),b=b(S),h.flags|=1,ls(u,h,b,m),h.child;case 14:return b=h.type,S=Pi(b,h.pendingProps),S=Pi(b.type,S),Sk(u,h,b,S,m);case 15:return Ek(u,h,h.type,h.pendingProps,m);case 17:return b=h.type,S=h.pendingProps,S=h.elementType===b?S:Pi(b,S),Um(u,h),h.tag=1,Cs(b)?(u=!0,Sm(h)):u=!1,Ac(h,m),gk(h,b,S),Wx(h,b,S,m),qx(null,h,b,!0,u,m);case 19:return Dk(u,h,m);case 22:return kk(u,h,m)}throw Error(t(156,h.tag))};function rT(u,h){return _r(u,h)}function r3(u,h,m,b){this.tag=u,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(u,h,m,b){return new r3(u,h,m,b)}function fw(u){return u=u.prototype,!(!u||!u.isReactComponent)}function s3(u){if(typeof u=="function")return fw(u)?1:0;if(u!=null){if(u=u.$$typeof,u===M)return 11;if(u===q)return 14}return 2}function Ya(u,h){var m=u.alternate;return m===null?(m=ai(u.tag,h,u.key,u.mode),m.elementType=u.elementType,m.type=u.type,m.stateNode=u.stateNode,m.alternate=u,u.alternate=m):(m.pendingProps=h,m.type=u.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=u.flags&14680064,m.childLanes=u.childLanes,m.lanes=u.lanes,m.child=u.child,m.memoizedProps=u.memoizedProps,m.memoizedState=u.memoizedState,m.updateQueue=u.updateQueue,h=u.dependencies,m.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},m.sibling=u.sibling,m.index=u.index,m.ref=u.ref,m}function Zm(u,h,m,b,S,N){var V=2;if(b=u,typeof u=="function")fw(u)&&(V=1);else if(typeof u=="string")V=5;else e:switch(u){case P:return ou(m.children,S,N,h);case A:V=8,S|=8;break;case $:return u=ai(12,m,h,S|2),u.elementType=$,u.lanes=N,u;case O:return u=ai(13,m,h,S),u.elementType=O,u.lanes=N,u;case Z:return u=ai(19,m,h,S),u.elementType=Z,u.lanes=N,u;case le:return eg(m,S,N,h);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case D:V=10;break e;case R:V=9;break e;case M:V=11;break e;case q:V=14;break e;case se:V=16,b=null;break e}throw Error(t(130,u==null?u:typeof u,""))}return h=ai(V,m,h,S),h.elementType=u,h.type=b,h.lanes=N,h}function ou(u,h,m,b){return u=ai(7,u,b,h),u.lanes=m,u}function eg(u,h,m,b){return u=ai(22,u,b,h),u.elementType=le,u.lanes=m,u.stateNode={isHidden:!1},u}function pw(u,h,m){return u=ai(6,u,null,h),u.lanes=m,u}function mw(u,h,m){return h=ai(4,u.children!==null?u.children:[],u.key,h),h.lanes=m,h.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},h}function i3(u,h,m,b,S){this.tag=h,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Aa(0),this.expirationTimes=Aa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Aa(0),this.identifierPrefix=b,this.onRecoverableError=S,this.mutableSourceEagerHydrationData=null}function gw(u,h,m,b,S,N,V,W,K){return u=new i3(u,h,m,W,K),h===1?(h=1,N===!0&&(h|=8)):h=0,N=ai(3,null,null,h),u.current=N,N.stateNode=u,N.memoizedState={element:b,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rx(N),u}function o3(u,h,m){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:b==null?null:""+b,children:u,containerInfo:h,implementation:m}}function sT(u){if(!u)return Ba;u=u._reactInternals;e:{if(Dt(u)!==u||u.tag!==1)throw Error(t(170));var h=u;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Cs(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(u.tag===1){var m=u.type;if(Cs(m))return $E(u,m,h)}return h}function iT(u,h,m,b,S,N,V,W,K){return u=gw(m,b,!0,u,S,N,V,W,K),u.context=sT(null),m=u.current,b=us(),S=Ka(m),N=na(b,S),N.callback=h??null,Ga(m,N,S),u.current.lanes=S,$a(u,S,b),ks(u,b),u}function tg(u,h,m,b){var S=h.current,N=us(),V=Ka(S);return m=sT(m),h.context===null?h.context=m:h.pendingContext=m,h=na(N,V),h.payload={element:u},b=b===void 0?null:b,b!==null&&(h.callback=b),u=Ga(S,h,V),u!==null&&(Li(u,S,V,N),$m(u,S,V)),V}function ng(u){if(u=u.current,!u.child)return null;switch(u.child.tag){case 5:return u.child.stateNode;default:return u.child.stateNode}}function oT(u,h){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var m=u.retryLane;u.retryLane=m!==0&&m<h?m:h}}function yw(u,h){oT(u,h),(u=u.alternate)&&oT(u,h)}var aT=typeof reportError=="function"?reportError:function(u){console.error(u)};function vw(u){this._internalRoot=u}rg.prototype.render=vw.prototype.render=function(u){var h=this._internalRoot;if(h===null)throw Error(t(409));tg(u,h,null,null)},rg.prototype.unmount=vw.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var h=u.containerInfo;ru(function(){tg(null,u,null,null)}),h[Qo]=null}};function rg(u){this._internalRoot=u}rg.prototype.unstable_scheduleHydration=function(u){if(u){var h=rm();u={blockedOn:null,target:u,priority:h};for(var m=0;m<ao.length&&h!==0&&h<ao[m].priority;m++);ao.splice(m,0,u),m===0&&om(u)}};function xw(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function sg(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11&&(u.nodeType!==8||u.nodeValue!==" react-mount-point-unstable "))}function lT(){}function a3(u,h,m,b,S){if(S){if(typeof b=="function"){var N=b;b=function(){var me=ng(V);N.call(me)}}var V=iT(h,b,u,0,null,!1,!1,"",lT);return u._reactRootContainer=V,u[Qo]=V.current,ld(u.nodeType===8?u.parentNode:u),ru(),V}for(;S=u.lastChild;)u.removeChild(S);if(typeof b=="function"){var W=b;b=function(){var me=ng(K);W.call(me)}}var K=gw(u,0,!1,null,null,!1,!1,"",lT);return u._reactRootContainer=K,u[Qo]=K.current,ld(u.nodeType===8?u.parentNode:u),ru(function(){tg(h,K,m,b)}),K}function ig(u,h,m,b,S){var N=m._reactRootContainer;if(N){var V=N;if(typeof S=="function"){var W=S;S=function(){var K=ng(V);W.call(K)}}tg(h,V,u,S)}else V=a3(m,h,u,S,b);return ng(V)}tm=function(u){switch(u.tag){case 3:var h=u.stateNode;if(h.current.memoizedState.isDehydrated){var m=Na(h.pendingLanes);m!==0&&(Da(h,m|1),ks(h,tn()),!(jt&6)&&(Oc=tn()+500,Ua()))}break;case 13:ru(function(){var b=ta(u,1);if(b!==null){var S=us();Li(b,u,1,S)}}),yw(u,1)}},ac=function(u){if(u.tag===13){var h=ta(u,134217728);if(h!==null){var m=us();Li(h,u,134217728,m)}yw(u,134217728)}},nm=function(u){if(u.tag===13){var h=Ka(u),m=ta(u,h);if(m!==null){var b=us();Li(m,u,h,b)}yw(u,h)}},rm=function(){return Pt},sm=function(u,h){var m=Pt;try{return Pt=u,h()}finally{Pt=m}},Uo=function(u,h,m){switch(h){case"input":if(Ht(u,m),h=m.name,m.type==="radio"&&h!=null){for(m=u;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<m.length;h++){var b=m[h];if(b!==u&&b.form===u.form){var S=Im(b);if(!S)throw Error(t(90));Et(b),Ht(b,S)}}}break;case"textarea":Dn(u,m);break;case"select":h=m.value,h!=null&&pn(u,!!m.multiple,h,!1)}},Wo=cw,X=ru;var l3={usingClientEntryPoint:!1,Events:[hd,Cc,Im,is,Ul,cw]},Ed={findFiberByHostInstance:Xl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},u3={bundleType:Ed.bundleType,version:Ed.version,rendererPackageName:Ed.rendererPackageName,rendererConfig:Ed.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(u){return u=Si(u),u===null?null:u.stateNode},findFiberByHostInstance:Ed.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var og=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!og.isDisabled&&og.supportsFiber)try{xs=og.inject(u3),Gr=og}catch{}}return Ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=l3,Ts.createPortal=function(u,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xw(h))throw Error(t(200));return o3(u,h,null,m)},Ts.createRoot=function(u,h){if(!xw(u))throw Error(t(299));var m=!1,b="",S=aT;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),h=gw(u,1,!1,null,null,m,!1,b,S),u[Qo]=h.current,ld(u.nodeType===8?u.parentNode:u),new vw(h)},Ts.findDOMNode=function(u){if(u==null)return null;if(u.nodeType===1)return u;var h=u._reactInternals;if(h===void 0)throw typeof u.render=="function"?Error(t(188)):(u=Object.keys(u).join(","),Error(t(268,u)));return u=Si(h),u=u===null?null:u.stateNode,u},Ts.flushSync=function(u){return ru(u)},Ts.hydrate=function(u,h,m){if(!sg(h))throw Error(t(200));return ig(null,u,h,!0,m)},Ts.hydrateRoot=function(u,h,m){if(!xw(u))throw Error(t(405));var b=m!=null&&m.hydratedSources||null,S=!1,N="",V=aT;if(m!=null&&(m.unstable_strictMode===!0&&(S=!0),m.identifierPrefix!==void 0&&(N=m.identifierPrefix),m.onRecoverableError!==void 0&&(V=m.onRecoverableError)),h=iT(h,null,u,1,m??null,S,!1,N,V),u[Qo]=h.current,ld(u),b)for(u=0;u<b.length;u++)m=b[u],S=m._getVersion,S=S(m._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[m,S]:h.mutableSourceEagerHydrationData.push(m,S);return new rg(h)},Ts.render=function(u,h,m){if(!sg(h))throw Error(t(200));return ig(null,u,h,!1,m)},Ts.unmountComponentAtNode=function(u){if(!sg(u))throw Error(t(40));return u._reactRootContainer?(ru(function(){ig(null,null,u,!1,function(){u._reactRootContainer=null,u[Qo]=null})}),!0):!1},Ts.unstable_batchedUpdates=cw,Ts.unstable_renderSubtreeIntoContainer=function(u,h,m,b){if(!sg(m))throw Error(t(200));if(u==null||u._reactInternals===void 0)throw Error(t(38));return ig(u,h,m,!1,b)},Ts.version="18.3.1-next-f1338f8080-20240426",Ts}var gT;function WN(){if(gT)return Iw.exports;gT=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Iw.exports=x3(),Iw.exports}var yT;function w3(){if(yT)return ag;yT=1;var n=WN();return ag.createRoot=n.createRoot,ag.hydrateRoot=n.hydrateRoot,ag}var b3=w3(),vT={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},I3=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},jN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|c>>6,g=c&63;l||(g=64,o||(p=64)),r.push(t[d],t[f],t[p],t[g])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(GN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):I3(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new C3;const p=i<<2|a>>4;if(r.push(p),c!==64){const g=a<<4&240|c>>2;if(r.push(g),f!==64){const y=c<<6&192|f;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class C3 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const S3=function(n){const e=GN(n);return jN.encodeByteArray(e,!0)},Jg=function(n){return S3(n).replace(/\./g,"")},HN=function(n){try{return jN.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E3(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3=()=>E3().__FIREBASE_DEFAULTS__,T3=()=>{if(typeof process>"u"||typeof vT>"u")return;const n=vT.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},_3=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&HN(n[1]);return e&&JSON.parse(e)},Xy=()=>{try{return k3()||T3()||_3()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},qN=n=>{var e,t;return(t=(e=Xy())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},R3=n=>{const e=qN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},KN=()=>{var n;return(n=Xy())===null||n===void 0?void 0:n.config},XN=n=>{var e;return(e=Xy())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let N3=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A3(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Jg(JSON.stringify(t)),Jg(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $3(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ns())}function D3(){var n;const e=(n=Xy())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function P3(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function F3(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function O3(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function L3(){const n=ns();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function M3(){return!D3()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function V3(){try{return typeof indexedDB=="object"}catch{return!1}}function z3(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3="FirebaseError";class Ia extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=B3,Object.setPrototypeOf(this,Ia.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,If.prototype.create)}}class If{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?U3(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ia(s,a,r)}}function U3(n,e){return n.replace(W3,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const W3=/\{\$([^}]+)}/g;function G3(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zg(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(xT(i)&&xT(o)){if(!Zg(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function xT(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function j3(n,e){const t=new H3(n,e);return t.subscribe.bind(t)}class H3{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");q3(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ew),s.error===void 0&&(s.error=Ew),s.complete===void 0&&(s.complete=Ew);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function q3(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ew(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(n){return n&&n._delegate?n._delegate:n}class Eu{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new N3;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Y3(e))try{this.getOrInitializeService({instanceIdentifier:uu})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=uu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uu){return this.instances.has(e)}getOptions(e=uu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:X3(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=uu){return this.component?this.component.multipleInstances?e:uu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function X3(n){return n===uu?void 0:n}function Y3(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new K3(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Nt||(Nt={}));const J3={debug:Nt.DEBUG,verbose:Nt.VERBOSE,info:Nt.INFO,warn:Nt.WARN,error:Nt.ERROR,silent:Nt.SILENT},Z3=Nt.INFO,ez={[Nt.DEBUG]:"log",[Nt.VERBOSE]:"log",[Nt.INFO]:"info",[Nt.WARN]:"warn",[Nt.ERROR]:"error"},tz=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ez[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let yb=class{constructor(e){this.name=e,this._logLevel=Z3,this._logHandler=tz,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Nt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?J3[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Nt.DEBUG,...e),this._logHandler(this,Nt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Nt.VERBOSE,...e),this._logHandler(this,Nt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Nt.INFO,...e),this._logHandler(this,Nt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Nt.WARN,...e),this._logHandler(this,Nt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Nt.ERROR,...e),this._logHandler(this,Nt.ERROR,...e)}};const nz=(n,e)=>e.some(t=>n instanceof t);let wT,bT;function rz(){return wT||(wT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sz(){return bT||(bT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const YN=new WeakMap,a1=new WeakMap,QN=new WeakMap,kw=new WeakMap,vb=new WeakMap;function iz(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ul(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&YN.set(t,n)}).catch(()=>{}),vb.set(e,n),e}function oz(n){if(a1.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});a1.set(n,e)}let l1={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return a1.get(n);if(e==="objectStoreNames")return n.objectStoreNames||QN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ul(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function az(n){l1=n(l1)}function lz(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Tw(this),e,...t);return QN.set(r,e.sort?e.sort():[e]),ul(r)}:sz().includes(n)?function(...e){return n.apply(Tw(this),e),ul(YN.get(this))}:function(...e){return ul(n.apply(Tw(this),e))}}function uz(n){return typeof n=="function"?lz(n):(n instanceof IDBTransaction&&oz(n),nz(n,rz())?new Proxy(n,l1):n)}function ul(n){if(n instanceof IDBRequest)return iz(n);if(kw.has(n))return kw.get(n);const e=uz(n);return e!==n&&(kw.set(n,e),vb.set(e,n)),e}const Tw=n=>vb.get(n);function cz(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=ul(o);return r&&o.addEventListener("upgradeneeded",l=>{r(ul(o.result),l.oldVersion,l.newVersion,ul(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const hz=["get","getKey","getAll","getAllKeys","count"],dz=["put","add","delete","clear"],_w=new Map;function IT(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(_w.get(e))return _w.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=dz.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||hz.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return _w.set(e,i),i}az(n=>({...n,get:(e,t,r)=>IT(e,t)||n.get(e,t,r),has:(e,t)=>!!IT(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fz{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pz(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function pz(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const u1="@firebase/app",CT="0.10.17";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pa=new yb("@firebase/app"),mz="@firebase/app-compat",gz="@firebase/analytics-compat",yz="@firebase/analytics",vz="@firebase/app-check-compat",xz="@firebase/app-check",wz="@firebase/auth",bz="@firebase/auth-compat",Iz="@firebase/database",Cz="@firebase/data-connect",Sz="@firebase/database-compat",Ez="@firebase/functions",kz="@firebase/functions-compat",Tz="@firebase/installations",_z="@firebase/installations-compat",Rz="@firebase/messaging",Nz="@firebase/messaging-compat",Az="@firebase/performance",$z="@firebase/performance-compat",Dz="@firebase/remote-config",Pz="@firebase/remote-config-compat",Fz="@firebase/storage",Oz="@firebase/storage-compat",Lz="@firebase/firestore",Mz="@firebase/vertexai",Vz="@firebase/firestore-compat",zz="firebase",Bz="11.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1="[DEFAULT]",Uz={[u1]:"fire-core",[mz]:"fire-core-compat",[yz]:"fire-analytics",[gz]:"fire-analytics-compat",[xz]:"fire-app-check",[vz]:"fire-app-check-compat",[wz]:"fire-auth",[bz]:"fire-auth-compat",[Iz]:"fire-rtdb",[Cz]:"fire-data-connect",[Sz]:"fire-rtdb-compat",[Ez]:"fire-fn",[kz]:"fire-fn-compat",[Tz]:"fire-iid",[_z]:"fire-iid-compat",[Rz]:"fire-fcm",[Nz]:"fire-fcm-compat",[Az]:"fire-perf",[$z]:"fire-perf-compat",[Dz]:"fire-rc",[Pz]:"fire-rc-compat",[Fz]:"fire-gcs",[Oz]:"fire-gcs-compat",[Lz]:"fire-fst",[Vz]:"fire-fst-compat",[Mz]:"fire-vertex","fire-js":"fire-js",[zz]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ey=new Map,Wz=new Map,h1=new Map;function ST(n,e){try{n.container.addComponent(e)}catch(t){pa.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ih(n){const e=n.name;if(h1.has(e))return pa.debug(`There were multiple attempts to register component ${e}.`),!1;h1.set(e,n);for(const t of ey.values())ST(t,n);for(const t of Wz.values())ST(t,n);return!0}function xb(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function la(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gz={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},cl=new If("app","Firebase",Gz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jz{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Eu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw cl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eh=Bz;function JN(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:c1,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw cl.create("bad-app-name",{appName:String(s)});if(t||(t=KN()),!t)throw cl.create("no-options");const i=ey.get(s);if(i){if(Zg(t,i.options)&&Zg(r,i.config))return i;throw cl.create("duplicate-app",{appName:s})}const o=new Q3(s);for(const l of h1.values())o.addComponent(l);const a=new jz(t,r,o);return ey.set(s,a),a}function ZN(n=c1){const e=ey.get(n);if(!e&&n===c1&&KN())return JN();if(!e)throw cl.create("no-app",{appName:n});return e}function hl(n,e,t){var r;let s=(r=Uz[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),pa.warn(a.join(" "));return}ih(new Eu(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hz="firebase-heartbeat-database",qz=1,Zd="firebase-heartbeat-store";let Rw=null;function eA(){return Rw||(Rw=cz(Hz,qz,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Zd)}catch(t){console.warn(t)}}}}).catch(n=>{throw cl.create("idb-open",{originalErrorMessage:n.message})})),Rw}async function Kz(n){try{const t=(await eA()).transaction(Zd),r=await t.objectStore(Zd).get(tA(n));return await t.done,r}catch(e){if(e instanceof Ia)pa.warn(e.message);else{const t=cl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});pa.warn(t.message)}}}async function ET(n,e){try{const r=(await eA()).transaction(Zd,"readwrite");await r.objectStore(Zd).put(e,tA(n)),await r.done}catch(t){if(t instanceof Ia)pa.warn(t.message);else{const r=cl.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});pa.warn(r.message)}}}function tA(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xz=1024,Yz=30*24*60*60*1e3;class Qz{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Zz(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=kT();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=Yz}),this._storage.overwrite(this._heartbeatsCache))}catch(r){pa.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=kT(),{heartbeatsToSend:r,unsentEntries:s}=Jz(this._heartbeatsCache.heartbeats),i=Jg(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return pa.warn(t),""}}}function kT(){return new Date().toISOString().substring(0,10)}function Jz(n,e=Xz){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),TT(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),TT(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Zz{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return V3()?z3().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Kz(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ET(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ET(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function TT(n){return Jg(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eB(n){ih(new Eu("platform-logger",e=>new fz(e),"PRIVATE")),ih(new Eu("heartbeat",e=>new Qz(e),"PRIVATE")),hl(u1,CT,n),hl(u1,CT,"esm2017"),hl("fire-js","")}eB("");function wb(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function nA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tB=nA,rA=new If("auth","Firebase",nA());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ty=new yb("@firebase/auth");function nB(n,...e){ty.logLevel<=Nt.WARN&&ty.warn(`Auth (${Eh}): ${n}`,...e)}function Ng(n,...e){ty.logLevel<=Nt.ERROR&&ty.error(`Auth (${Eh}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(n,...e){throw Ib(n,...e)}function ji(n,...e){return Ib(n,...e)}function bb(n,e,t){const r=Object.assign(Object.assign({},tB()),{[e]:t});return new If("auth","Firebase",r).create(e,{appName:n.name})}function wu(n){return bb(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rB(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Do(n,"argument-error"),bb(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ib(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return rA.create(n,...e)}function pt(n,e,...t){if(!n)throw Ib(e,...t)}function ua(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ng(e),new Error(e)}function ma(n,e){n||ua(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function sB(){return _T()==="http:"||_T()==="https:"}function _T(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sB()||F3()||"connection"in navigator)?navigator.onLine:!0}function oB(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,t){this.shortDelay=e,this.longDelay=t,ma(t>e,"Short delay should be less than long delay!"),this.isMobile=$3()||O3()}get(){return iB()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n,e){ma(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ua("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ua("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ua("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aB={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lB=new Sf(3e4,6e4);function Sb(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function kh(n,e,t,r,s={}){return iA(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Cf(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return P3()||(c.referrerPolicy="no-referrer"),sA.fetch()(oA(n,n.config.apiHost,t,a),c)})}async function iA(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},aB),e);try{const s=new cB(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw lg(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw lg(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw lg(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw lg(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw bb(n,d,c);Do(n,d)}}catch(s){if(s instanceof Ia)throw s;Do(n,"network-request-failed",{message:String(s)})}}async function uB(n,e,t,r,s={}){const i=await kh(n,e,t,r,s);return"mfaPendingCredential"in i&&Do(n,"multi-factor-auth-required",{_serverResponse:i}),i}function oA(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Cb(n.config,s):`${n.config.apiScheme}://${s}`}class cB{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ji(this.auth,"network-request-failed")),lB.get())})}}function lg(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ji(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hB(n,e){return kh(n,"POST","/v1/accounts:delete",e)}async function aA(n,e){return kh(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function dB(n,e=!1){const t=Xs(n),r=await t.getIdToken(e),s=Eb(r);pt(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Hd(Nw(s.auth_time)),issuedAtTime:Hd(Nw(s.iat)),expirationTime:Hd(Nw(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Nw(n){return Number(n)*1e3}function Eb(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ng("JWT malformed, contained fewer than 3 sections"),null;try{const s=HN(t);return s?JSON.parse(s):(Ng("Failed to decode base64 JWT payload"),null)}catch(s){return Ng("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function RT(n){const e=Eb(n);return pt(e,"internal-error"),pt(typeof e.exp<"u","internal-error"),pt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ef(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ia&&fB(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function fB({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pB{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f1{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hd(this.lastLoginAt),this.creationTime=Hd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ny(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ef(n,aA(t,{idToken:r}));pt(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?lA(i.providerUserInfo):[],a=gB(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new f1(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function mB(n){const e=Xs(n);await ny(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function gB(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function lA(n){return n.map(e=>{var{providerId:t}=e,r=wb(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yB(n,e){const t=await iA(n,{},async()=>{const r=Cf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=oA(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",sA.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function vB(n,e){return kh(n,"POST","/v2/accounts:revokeToken",Sb(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pt(e.idToken,"internal-error"),pt(typeof e.idToken<"u","internal-error"),pt(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):RT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){pt(e.length!==0,"internal-error");const t=RT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(pt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await yB(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Xc;return r&&(pt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(pt(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(pt(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Xc,this.toJSON())}_performRefresh(){return ua("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(n,e){pt(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ca{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=wb(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pB(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new f1(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ef(this,this.stsTokenManager.getToken(this.auth,e));return pt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return dB(this,e)}reload(){return mB(this)}_assign(e){this!==e&&(pt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ca(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ny(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(la(this.auth.app))return Promise.reject(wu(this.auth));const e=await this.getIdToken();return await ef(this,hB(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,g=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,y=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,x=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,I=(c=t.createdAt)!==null&&c!==void 0?c:void 0,C=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:k,emailVerified:E,isAnonymous:_,providerData:L,stsTokenManager:P}=t;pt(k&&P,e,"internal-error");const A=Xc.fromJSON(this.name,P);pt(typeof k=="string",e,"internal-error"),Ja(f,e.name),Ja(p,e.name),pt(typeof E=="boolean",e,"internal-error"),pt(typeof _=="boolean",e,"internal-error"),Ja(g,e.name),Ja(y,e.name),Ja(w,e.name),Ja(x,e.name),Ja(I,e.name),Ja(C,e.name);const $=new ca({uid:k,auth:e,email:p,emailVerified:E,displayName:f,isAnonymous:_,photoURL:y,phoneNumber:g,tenantId:w,stsTokenManager:A,createdAt:I,lastLoginAt:C});return L&&Array.isArray(L)&&($.providerData=L.map(D=>Object.assign({},D))),x&&($._redirectEventId=x),$}static async _fromIdTokenResponse(e,t,r=!1){const s=new Xc;s.updateFromServerResponse(t);const i=new ca({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ny(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];pt(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?lA(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Xc;a.updateFromIdToken(r);const l=new ca({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new f1(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT=new Map;function ha(n){ma(n instanceof Function,"Expected a class definition");let e=NT.get(n);return e?(ma(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,NT.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uA{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}uA.type="NONE";const AT=uA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n,e,t){return`firebase:${n}:${e}:${t}`}class Yc{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ag(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ag("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ca._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Yc(ha(AT),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||ha(AT);const o=Ag(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=ca._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Yc(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Yc(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $T(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(cA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mA(e))return"Blackberry";if(gA(e))return"Webos";if(hA(e))return"Safari";if((e.includes("chrome/")||dA(e))&&!e.includes("edge/"))return"Chrome";if(pA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function cA(n=ns()){return/firefox\//i.test(n)}function hA(n=ns()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dA(n=ns()){return/crios\//i.test(n)}function fA(n=ns()){return/iemobile/i.test(n)}function pA(n=ns()){return/android/i.test(n)}function mA(n=ns()){return/blackberry/i.test(n)}function gA(n=ns()){return/webos/i.test(n)}function kb(n=ns()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function xB(n=ns()){var e;return kb(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function wB(){return L3()&&document.documentMode===10}function yA(n=ns()){return kb(n)||pA(n)||gA(n)||mA(n)||/windows phone/i.test(n)||fA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vA(n,e=[]){let t;switch(n){case"Browser":t=$T(ns());break;case"Worker":t=`${$T(ns())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Eh}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bB{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IB(n,e={}){return kh(n,"GET","/v2/passwordPolicy",Sb(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB=6;class SB{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:CB,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new DT(this),this.idTokenSubscription=new DT(this),this.beforeStateQueue=new bB(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rA,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ha(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Yc.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await aA(this,{idToken:e}),r=await ca._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(la(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return pt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ny(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=oB()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(la(this.app))return Promise.reject(wu(this));const t=e?Xs(e):null;return t&&pt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&pt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return la(this.app)?Promise.reject(wu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return la(this.app)?Promise.reject(wu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ha(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IB(this),t=new SB(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new If("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await vB(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ha(e)||this._popupRedirectResolver;pt(t,this,"argument-error"),this.redirectPersistenceManager=await Yc.create(this,[ha(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(pt(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&nB(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Yy(n){return Xs(n)}class DT{constructor(e){this.auth=e,this.observer=null,this.addObserver=j3(t=>this.observer=t)}get next(){return pt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function kB(n){Tb=n}function TB(n){return Tb.loadJS(n)}function _B(){return Tb.gapiScript}function RB(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NB(n,e){const t=xb(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Zg(i,e??{}))return s;Do(s,"already-initialized")}return t.initialize({options:e})}function AB(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ha);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function $B(n,e,t){const r=Yy(n);pt(r._canInitEmulator,r,"emulator-config-failed"),pt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=xA(e),{host:o,port:a}=DB(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),PB()}function xA(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function DB(n){const e=xA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:PT(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:PT(o)}}}function PT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function PB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ua("not implemented")}_getIdTokenResponse(e){return ua("not implemented")}_linkToIdToken(e,t){return ua("not implemented")}_getReauthenticationResolver(e){return ua("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qc(n,e){return uB(n,"POST","/v1/accounts:signInWithIdp",Sb(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB="http://localhost";class ku extends wA{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ku(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Do("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=wb(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ku(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Qc(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Qc(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qc(e,t)}buildRequest(){const e={requestUri:FB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Cf(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _b{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef extends _b{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl extends Ef{constructor(){super("facebook.com")}static credential(e){return ku._fromParams({providerId:tl.PROVIDER_ID,signInMethod:tl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tl.credentialFromTaggedObject(e)}static credentialFromError(e){return tl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tl.credential(e.oauthAccessToken)}catch{return null}}}tl.FACEBOOK_SIGN_IN_METHOD="facebook.com";tl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa extends Ef{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ku._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return oa.credential(t,r)}catch{return null}}}oa.GOOGLE_SIGN_IN_METHOD="google.com";oa.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl extends Ef{constructor(){super("github.com")}static credential(e){return ku._fromParams({providerId:nl.PROVIDER_ID,signInMethod:nl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nl.credentialFromTaggedObject(e)}static credentialFromError(e){return nl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nl.credential(e.oauthAccessToken)}catch{return null}}}nl.GITHUB_SIGN_IN_METHOD="github.com";nl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl extends Ef{constructor(){super("twitter.com")}static credential(e,t){return ku._fromParams({providerId:rl.PROVIDER_ID,signInMethod:rl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rl.credentialFromTaggedObject(e)}static credentialFromError(e){return rl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rl.credential(t,r)}catch{return null}}}rl.TWITTER_SIGN_IN_METHOD="twitter.com";rl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ca._fromIdTokenResponse(e,r,s),o=FT(r);return new oh({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=FT(r);return new oh({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function FT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry extends Ia{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ry.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ry(e,t,r,s)}}function bA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ry._fromErrorAndOperation(n,i,e,r):i})}async function OB(n,e,t=!1){const r=await ef(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return oh._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LB(n,e,t=!1){const{auth:r}=n;if(la(r.app))return Promise.reject(wu(r));const s="reauthenticate";try{const i=await ef(n,bA(r,s,e,n),t);pt(i.idToken,r,"internal-error");const o=Eb(i.idToken);pt(o,r,"internal-error");const{sub:a}=o;return pt(n.uid===a,r,"user-mismatch"),oh._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Do(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MB(n,e,t=!1){if(la(n.app))return Promise.reject(wu(n));const r="signIn",s=await bA(n,r,e),i=await oh._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function VB(n,e,t,r){return Xs(n).onIdTokenChanged(e,t,r)}function zB(n,e,t){return Xs(n).beforeAuthStateChanged(e,t)}function BB(n){return Xs(n).signOut()}const sy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(sy,"1"),this.storage.removeItem(sy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB=1e3,WB=10;class CA extends IA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);wB()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,WB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},UB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}CA.type="LOCAL";const GB=CA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA extends IA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}SA.type="SESSION";const EA=SA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Qy(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await jB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Rb("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===c)switch(p.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(){return window}function qB(n){Io().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kA(){return typeof Io().WorkerGlobalScope<"u"&&typeof Io().importScripts=="function"}async function KB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function XB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function YB(){return kA()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TA="firebaseLocalStorageDb",QB=1,iy="firebaseLocalStorage",_A="fbase_key";class kf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jy(n,e){return n.transaction([iy],e?"readwrite":"readonly").objectStore(iy)}function JB(){const n=indexedDB.deleteDatabase(TA);return new kf(n).toPromise()}function p1(){const n=indexedDB.open(TA,QB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(iy,{keyPath:_A})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(iy)?e(r):(r.close(),await JB(),e(await p1()))})})}async function OT(n,e,t){const r=Jy(n,!0).put({[_A]:e,value:t});return new kf(r).toPromise()}async function ZB(n,e){const t=Jy(n,!1).get(e),r=await new kf(t).toPromise();return r===void 0?null:r.value}function LT(n,e){const t=Jy(n,!0).delete(e);return new kf(t).toPromise()}const e4=800,t4=3;class RA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await p1(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>t4)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kA()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qy._getInstance(YB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await KB(),!this.activeServiceWorker)return;this.sender=new HB(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||XB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await p1();return await OT(e,sy,"1"),await LT(e,sy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>OT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>ZB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>LT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Jy(s,!1).getAll();return new kf(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),e4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}RA.type="LOCAL";const n4=RA;new Sf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NA(n,e){return e?ha(e):(pt(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb extends wA{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qc(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function r4(n){return MB(n.auth,new Nb(n),n.bypassAuthState)}function s4(n){const{auth:e,user:t}=n;return pt(t,e,"internal-error"),LB(t,new Nb(n),n.bypassAuthState)}async function i4(n){const{auth:e,user:t}=n;return pt(t,e,"internal-error"),OB(t,new Nb(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return r4;case"linkViaPopup":case"linkViaRedirect":return i4;case"reauthViaPopup":case"reauthViaRedirect":return s4;default:Do(this.auth,"internal-error")}}resolve(e){ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4=new Sf(2e3,1e4);async function a4(n,e,t){if(la(n.app))return Promise.reject(ji(n,"operation-not-supported-in-this-environment"));const r=Yy(n);rB(n,e,_b);const s=NA(r,t);return new mu(r,"signInViaPopup",e,s).executeNotNull()}class mu extends AA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,mu.currentPopupAction&&mu.currentPopupAction.cancel(),mu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pt(e,this.auth,"internal-error"),e}async onExecution(){ma(this.filter.length===1,"Popup operations only handle one event");const e=Rb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ji(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(ji(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ji(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,o4.get())};e()}}mu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4="pendingRedirect",$g=new Map;class u4 extends AA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=$g.get(this.auth._key());if(!e){try{const r=await c4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}$g.set(this.auth._key(),e)}return this.bypassAuthState||$g.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function c4(n,e){const t=f4(e),r=d4(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function h4(n,e){$g.set(n._key(),e)}function d4(n){return ha(n._redirectPersistence)}function f4(n){return Ag(l4,n.config.apiKey,n.name)}async function p4(n,e,t=!1){if(la(n.app))return Promise.reject(wu(n));const r=Yy(n),s=NA(r,e),o=await new u4(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4=10*60*1e3;class g4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!y4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!$A(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(ji(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=m4&&this.cachedEventUids.clear(),this.cachedEventUids.has(MT(e))}saveEventToCache(e){this.cachedEventUids.add(MT(e)),this.lastProcessedEventTime=Date.now()}}function MT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $A({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function y4(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $A(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v4(n,e={}){return kh(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,w4=/^https?/;async function b4(n){if(n.config.emulator)return;const{authorizedDomains:e}=await v4(n);for(const t of e)try{if(I4(t))return}catch{}Do(n,"unauthorized-domain")}function I4(n){const e=d1(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!w4.test(t))return!1;if(x4.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C4=new Sf(3e4,6e4);function VT(){const n=Io().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function S4(n){return new Promise((e,t)=>{var r,s,i;function o(){VT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{VT(),t(ji(n,"network-request-failed"))},timeout:C4.get()})}if(!((s=(r=Io().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Io().gapi)===null||i===void 0)&&i.load)o();else{const a=RB("iframefcb");return Io()[a]=()=>{gapi.load?o():t(ji(n,"network-request-failed"))},TB(`${_B()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Dg=null,e})}let Dg=null;function E4(n){return Dg=Dg||S4(n),Dg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4=new Sf(5e3,15e3),T4="__/auth/iframe",_4="emulator/auth/iframe",R4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},N4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function A4(n){const e=n.config;pt(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Cb(e,_4):`https://${n.config.authDomain}/${T4}`,r={apiKey:e.apiKey,appName:n.name,v:Eh},s=N4.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Cf(r).slice(1)}`}async function $4(n){const e=await E4(n),t=Io().gapi;return pt(t,n,"internal-error"),e.open({where:document.body,url:A4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:R4,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=ji(n,"network-request-failed"),a=Io().setTimeout(()=>{i(o)},k4.get());function l(){Io().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},P4=500,F4=600,O4="_blank",L4="http://localhost";class zT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function M4(n,e,t,r=P4,s=F4){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},D4),{width:r.toString(),height:s.toString(),top:i,left:o}),c=ns().toLowerCase();t&&(a=dA(c)?O4:t),cA(c)&&(e=e||L4,l.scrollbars="yes");const d=Object.entries(l).reduce((p,[g,y])=>`${p}${g}=${y},`,"");if(xB(c)&&a!=="_self")return V4(e||"",a),new zT(null);const f=window.open(e||"",a,d);pt(f,n,"popup-blocked");try{f.focus()}catch{}return new zT(f)}function V4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z4="__/auth/handler",B4="emulator/auth/handler",U4=encodeURIComponent("fac");async function BT(n,e,t,r,s,i){pt(n.config.authDomain,n,"auth-domain-config-required"),pt(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Eh,eventId:s};if(e instanceof _b){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",G3(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries({}))o[d]=f}if(e instanceof Ef){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${U4}=${encodeURIComponent(l)}`:"";return`${W4(n)}?${Cf(a).slice(1)}${c}`}function W4({config:n}){return n.emulator?Cb(n,B4):`https://${n.authDomain}/${z4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw="webStorageSupport";class G4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=EA,this._completeRedirectFn=p4,this._overrideRedirectResult=h4}async _openPopup(e,t,r,s){var i;ma((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await BT(e,t,r,d1(),s);return M4(e,o,Rb())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await BT(e,t,r,d1(),s);return qB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ma(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await $4(e),r=new g4(e);return t.register("authEvent",s=>(pt(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Aw,{type:Aw},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Aw];o!==void 0&&t(!!o),Do(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=b4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return yA()||hA()||kb()}}const j4=G4;var UT="@firebase/auth",WT="1.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q4(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function K4(n){ih(new Eu("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;pt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vA(n)},c=new EB(r,s,i,l);return AB(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ih(new Eu("auth-internal",e=>{const t=Yy(e.getProvider("auth").getImmediate());return(r=>new H4(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),hl(UT,WT,q4(n)),hl(UT,WT,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X4=5*60,Y4=XN("authIdTokenMaxAge")||X4;let GT=null;const Q4=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Y4)return;const s=t==null?void 0:t.token;GT!==s&&(GT=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function DA(n=ZN()){const e=xb(n,"auth");if(e.isInitialized())return e.getImmediate();const t=NB(n,{popupRedirectResolver:j4,persistence:[n4,GB,EA]}),r=XN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Q4(i.toString());zB(t,o,()=>o(t.currentUser)),VB(t,a=>o(a))}}const s=qN("auth");return s&&$B(t,`http://${s}`),t}function J4(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}kB({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ji("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",J4().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});K4("Browser");var Z4="firebase",eU="11.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */hl(Z4,eU,"app");var jT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bu,PA;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,A){function $(){}$.prototype=A.prototype,P.D=A.prototype,P.prototype=new $,P.prototype.constructor=P,P.C=function(D,R,M){for(var O=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)O[Z-2]=arguments[Z];return A.prototype[R].apply(D,O)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(P,A,$){$||($=0);var D=Array(16);if(typeof A=="string")for(var R=0;16>R;++R)D[R]=A.charCodeAt($++)|A.charCodeAt($++)<<8|A.charCodeAt($++)<<16|A.charCodeAt($++)<<24;else for(R=0;16>R;++R)D[R]=A[$++]|A[$++]<<8|A[$++]<<16|A[$++]<<24;A=P.g[0],$=P.g[1],R=P.g[2];var M=P.g[3],O=A+(M^$&(R^M))+D[0]+3614090360&4294967295;A=$+(O<<7&4294967295|O>>>25),O=M+(R^A&($^R))+D[1]+3905402710&4294967295,M=A+(O<<12&4294967295|O>>>20),O=R+($^M&(A^$))+D[2]+606105819&4294967295,R=M+(O<<17&4294967295|O>>>15),O=$+(A^R&(M^A))+D[3]+3250441966&4294967295,$=R+(O<<22&4294967295|O>>>10),O=A+(M^$&(R^M))+D[4]+4118548399&4294967295,A=$+(O<<7&4294967295|O>>>25),O=M+(R^A&($^R))+D[5]+1200080426&4294967295,M=A+(O<<12&4294967295|O>>>20),O=R+($^M&(A^$))+D[6]+2821735955&4294967295,R=M+(O<<17&4294967295|O>>>15),O=$+(A^R&(M^A))+D[7]+4249261313&4294967295,$=R+(O<<22&4294967295|O>>>10),O=A+(M^$&(R^M))+D[8]+1770035416&4294967295,A=$+(O<<7&4294967295|O>>>25),O=M+(R^A&($^R))+D[9]+2336552879&4294967295,M=A+(O<<12&4294967295|O>>>20),O=R+($^M&(A^$))+D[10]+4294925233&4294967295,R=M+(O<<17&4294967295|O>>>15),O=$+(A^R&(M^A))+D[11]+2304563134&4294967295,$=R+(O<<22&4294967295|O>>>10),O=A+(M^$&(R^M))+D[12]+1804603682&4294967295,A=$+(O<<7&4294967295|O>>>25),O=M+(R^A&($^R))+D[13]+4254626195&4294967295,M=A+(O<<12&4294967295|O>>>20),O=R+($^M&(A^$))+D[14]+2792965006&4294967295,R=M+(O<<17&4294967295|O>>>15),O=$+(A^R&(M^A))+D[15]+1236535329&4294967295,$=R+(O<<22&4294967295|O>>>10),O=A+(R^M&($^R))+D[1]+4129170786&4294967295,A=$+(O<<5&4294967295|O>>>27),O=M+($^R&(A^$))+D[6]+3225465664&4294967295,M=A+(O<<9&4294967295|O>>>23),O=R+(A^$&(M^A))+D[11]+643717713&4294967295,R=M+(O<<14&4294967295|O>>>18),O=$+(M^A&(R^M))+D[0]+3921069994&4294967295,$=R+(O<<20&4294967295|O>>>12),O=A+(R^M&($^R))+D[5]+3593408605&4294967295,A=$+(O<<5&4294967295|O>>>27),O=M+($^R&(A^$))+D[10]+38016083&4294967295,M=A+(O<<9&4294967295|O>>>23),O=R+(A^$&(M^A))+D[15]+3634488961&4294967295,R=M+(O<<14&4294967295|O>>>18),O=$+(M^A&(R^M))+D[4]+3889429448&4294967295,$=R+(O<<20&4294967295|O>>>12),O=A+(R^M&($^R))+D[9]+568446438&4294967295,A=$+(O<<5&4294967295|O>>>27),O=M+($^R&(A^$))+D[14]+3275163606&4294967295,M=A+(O<<9&4294967295|O>>>23),O=R+(A^$&(M^A))+D[3]+4107603335&4294967295,R=M+(O<<14&4294967295|O>>>18),O=$+(M^A&(R^M))+D[8]+1163531501&4294967295,$=R+(O<<20&4294967295|O>>>12),O=A+(R^M&($^R))+D[13]+2850285829&4294967295,A=$+(O<<5&4294967295|O>>>27),O=M+($^R&(A^$))+D[2]+4243563512&4294967295,M=A+(O<<9&4294967295|O>>>23),O=R+(A^$&(M^A))+D[7]+1735328473&4294967295,R=M+(O<<14&4294967295|O>>>18),O=$+(M^A&(R^M))+D[12]+2368359562&4294967295,$=R+(O<<20&4294967295|O>>>12),O=A+($^R^M)+D[5]+4294588738&4294967295,A=$+(O<<4&4294967295|O>>>28),O=M+(A^$^R)+D[8]+2272392833&4294967295,M=A+(O<<11&4294967295|O>>>21),O=R+(M^A^$)+D[11]+1839030562&4294967295,R=M+(O<<16&4294967295|O>>>16),O=$+(R^M^A)+D[14]+4259657740&4294967295,$=R+(O<<23&4294967295|O>>>9),O=A+($^R^M)+D[1]+2763975236&4294967295,A=$+(O<<4&4294967295|O>>>28),O=M+(A^$^R)+D[4]+1272893353&4294967295,M=A+(O<<11&4294967295|O>>>21),O=R+(M^A^$)+D[7]+4139469664&4294967295,R=M+(O<<16&4294967295|O>>>16),O=$+(R^M^A)+D[10]+3200236656&4294967295,$=R+(O<<23&4294967295|O>>>9),O=A+($^R^M)+D[13]+681279174&4294967295,A=$+(O<<4&4294967295|O>>>28),O=M+(A^$^R)+D[0]+3936430074&4294967295,M=A+(O<<11&4294967295|O>>>21),O=R+(M^A^$)+D[3]+3572445317&4294967295,R=M+(O<<16&4294967295|O>>>16),O=$+(R^M^A)+D[6]+76029189&4294967295,$=R+(O<<23&4294967295|O>>>9),O=A+($^R^M)+D[9]+3654602809&4294967295,A=$+(O<<4&4294967295|O>>>28),O=M+(A^$^R)+D[12]+3873151461&4294967295,M=A+(O<<11&4294967295|O>>>21),O=R+(M^A^$)+D[15]+530742520&4294967295,R=M+(O<<16&4294967295|O>>>16),O=$+(R^M^A)+D[2]+3299628645&4294967295,$=R+(O<<23&4294967295|O>>>9),O=A+(R^($|~M))+D[0]+4096336452&4294967295,A=$+(O<<6&4294967295|O>>>26),O=M+($^(A|~R))+D[7]+1126891415&4294967295,M=A+(O<<10&4294967295|O>>>22),O=R+(A^(M|~$))+D[14]+2878612391&4294967295,R=M+(O<<15&4294967295|O>>>17),O=$+(M^(R|~A))+D[5]+4237533241&4294967295,$=R+(O<<21&4294967295|O>>>11),O=A+(R^($|~M))+D[12]+1700485571&4294967295,A=$+(O<<6&4294967295|O>>>26),O=M+($^(A|~R))+D[3]+2399980690&4294967295,M=A+(O<<10&4294967295|O>>>22),O=R+(A^(M|~$))+D[10]+4293915773&4294967295,R=M+(O<<15&4294967295|O>>>17),O=$+(M^(R|~A))+D[1]+2240044497&4294967295,$=R+(O<<21&4294967295|O>>>11),O=A+(R^($|~M))+D[8]+1873313359&4294967295,A=$+(O<<6&4294967295|O>>>26),O=M+($^(A|~R))+D[15]+4264355552&4294967295,M=A+(O<<10&4294967295|O>>>22),O=R+(A^(M|~$))+D[6]+2734768916&4294967295,R=M+(O<<15&4294967295|O>>>17),O=$+(M^(R|~A))+D[13]+1309151649&4294967295,$=R+(O<<21&4294967295|O>>>11),O=A+(R^($|~M))+D[4]+4149444226&4294967295,A=$+(O<<6&4294967295|O>>>26),O=M+($^(A|~R))+D[11]+3174756917&4294967295,M=A+(O<<10&4294967295|O>>>22),O=R+(A^(M|~$))+D[2]+718787259&4294967295,R=M+(O<<15&4294967295|O>>>17),O=$+(M^(R|~A))+D[9]+3951481745&4294967295,P.g[0]=P.g[0]+A&4294967295,P.g[1]=P.g[1]+(R+(O<<21&4294967295|O>>>11))&4294967295,P.g[2]=P.g[2]+R&4294967295,P.g[3]=P.g[3]+M&4294967295}r.prototype.u=function(P,A){A===void 0&&(A=P.length);for(var $=A-this.blockSize,D=this.B,R=this.h,M=0;M<A;){if(R==0)for(;M<=$;)s(this,P,M),M+=this.blockSize;if(typeof P=="string"){for(;M<A;)if(D[R++]=P.charCodeAt(M++),R==this.blockSize){s(this,D),R=0;break}}else for(;M<A;)if(D[R++]=P[M++],R==this.blockSize){s(this,D),R=0;break}}this.h=R,this.o+=A},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var A=1;A<P.length-8;++A)P[A]=0;var $=8*this.o;for(A=P.length-8;A<P.length;++A)P[A]=$&255,$/=256;for(this.u(P),P=Array(16),A=$=0;4>A;++A)for(var D=0;32>D;D+=8)P[$++]=this.g[A]>>>D&255;return P};function i(P,A){var $=a;return Object.prototype.hasOwnProperty.call($,P)?$[P]:$[P]=A(P)}function o(P,A){this.h=A;for(var $=[],D=!0,R=P.length-1;0<=R;R--){var M=P[R]|0;D&&M==A||($[R]=M,D=!1)}this.g=$}var a={};function l(P){return-128<=P&&128>P?i(P,function(A){return new o([A|0],0>A?-1:0)}):new o([P|0],0>P?-1:0)}function c(P){if(isNaN(P)||!isFinite(P))return f;if(0>P)return x(c(-P));for(var A=[],$=1,D=0;P>=$;D++)A[D]=P/$|0,$*=4294967296;return new o(A,0)}function d(P,A){if(P.length==0)throw Error("number format error: empty string");if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(P.charAt(0)=="-")return x(d(P.substring(1),A));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var $=c(Math.pow(A,8)),D=f,R=0;R<P.length;R+=8){var M=Math.min(8,P.length-R),O=parseInt(P.substring(R,R+M),A);8>M?(M=c(Math.pow(A,M)),D=D.j(M).add(c(O))):(D=D.j($),D=D.add(c(O)))}return D}var f=l(0),p=l(1),g=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-x(this).m();for(var P=0,A=1,$=0;$<this.g.length;$++){var D=this.i($);P+=(0<=D?D:4294967296+D)*A,A*=4294967296}return P},n.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(y(this))return"0";if(w(this))return"-"+x(this).toString(P);for(var A=c(Math.pow(P,6)),$=this,D="";;){var R=E($,A).g;$=I($,R.j(A));var M=((0<$.g.length?$.g[0]:$.h)>>>0).toString(P);if($=R,y($))return M+D;for(;6>M.length;)M="0"+M;D=M+D}},n.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function y(P){if(P.h!=0)return!1;for(var A=0;A<P.g.length;A++)if(P.g[A]!=0)return!1;return!0}function w(P){return P.h==-1}n.l=function(P){return P=I(this,P),w(P)?-1:y(P)?0:1};function x(P){for(var A=P.g.length,$=[],D=0;D<A;D++)$[D]=~P.g[D];return new o($,~P.h).add(p)}n.abs=function(){return w(this)?x(this):this},n.add=function(P){for(var A=Math.max(this.g.length,P.g.length),$=[],D=0,R=0;R<=A;R++){var M=D+(this.i(R)&65535)+(P.i(R)&65535),O=(M>>>16)+(this.i(R)>>>16)+(P.i(R)>>>16);D=O>>>16,M&=65535,O&=65535,$[R]=O<<16|M}return new o($,$[$.length-1]&-2147483648?-1:0)};function I(P,A){return P.add(x(A))}n.j=function(P){if(y(this)||y(P))return f;if(w(this))return w(P)?x(this).j(x(P)):x(x(this).j(P));if(w(P))return x(this.j(x(P)));if(0>this.l(g)&&0>P.l(g))return c(this.m()*P.m());for(var A=this.g.length+P.g.length,$=[],D=0;D<2*A;D++)$[D]=0;for(D=0;D<this.g.length;D++)for(var R=0;R<P.g.length;R++){var M=this.i(D)>>>16,O=this.i(D)&65535,Z=P.i(R)>>>16,q=P.i(R)&65535;$[2*D+2*R]+=O*q,C($,2*D+2*R),$[2*D+2*R+1]+=M*q,C($,2*D+2*R+1),$[2*D+2*R+1]+=O*Z,C($,2*D+2*R+1),$[2*D+2*R+2]+=M*Z,C($,2*D+2*R+2)}for(D=0;D<A;D++)$[D]=$[2*D+1]<<16|$[2*D];for(D=A;D<2*A;D++)$[D]=0;return new o($,0)};function C(P,A){for(;(P[A]&65535)!=P[A];)P[A+1]+=P[A]>>>16,P[A]&=65535,A++}function k(P,A){this.g=P,this.h=A}function E(P,A){if(y(A))throw Error("division by zero");if(y(P))return new k(f,f);if(w(P))return A=E(x(P),A),new k(x(A.g),x(A.h));if(w(A))return A=E(P,x(A)),new k(x(A.g),A.h);if(30<P.g.length){if(w(P)||w(A))throw Error("slowDivide_ only works with positive integers.");for(var $=p,D=A;0>=D.l(P);)$=_($),D=_(D);var R=L($,1),M=L(D,1);for(D=L(D,2),$=L($,2);!y(D);){var O=M.add(D);0>=O.l(P)&&(R=R.add($),M=O),D=L(D,1),$=L($,1)}return A=I(P,R.j(A)),new k(R,A)}for(R=f;0<=P.l(A);){for($=Math.max(1,Math.floor(P.m()/A.m())),D=Math.ceil(Math.log($)/Math.LN2),D=48>=D?1:Math.pow(2,D-48),M=c($),O=M.j(A);w(O)||0<O.l(P);)$-=D,M=c($),O=M.j(A);y(M)&&(M=p),R=R.add(M),P=I(P,O)}return new k(R,P)}n.A=function(P){return E(this,P).h},n.and=function(P){for(var A=Math.max(this.g.length,P.g.length),$=[],D=0;D<A;D++)$[D]=this.i(D)&P.i(D);return new o($,this.h&P.h)},n.or=function(P){for(var A=Math.max(this.g.length,P.g.length),$=[],D=0;D<A;D++)$[D]=this.i(D)|P.i(D);return new o($,this.h|P.h)},n.xor=function(P){for(var A=Math.max(this.g.length,P.g.length),$=[],D=0;D<A;D++)$[D]=this.i(D)^P.i(D);return new o($,this.h^P.h)};function _(P){for(var A=P.g.length+1,$=[],D=0;D<A;D++)$[D]=P.i(D)<<1|P.i(D-1)>>>31;return new o($,P.h)}function L(P,A){var $=A>>5;A%=32;for(var D=P.g.length-$,R=[],M=0;M<D;M++)R[M]=0<A?P.i(M+$)>>>A|P.i(M+$+1)<<32-A:P.i(M+$);return new o(R,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,PA=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,bu=o}).apply(typeof jT<"u"?jT:typeof self<"u"?self:typeof window<"u"?window:{});var ug=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var FA,Fd,OA,Pg,m1,LA,MA,VA;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,T,F){return v==Array.prototype||v==Object.prototype||(v[T]=F.value),v};function t(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof ug=="object"&&ug];for(var T=0;T<v.length;++T){var F=v[T];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=t(this);function s(v,T){if(T)e:{var F=r;v=v.split(".");for(var B=0;B<v.length-1;B++){var ce=v[B];if(!(ce in F))break e;F=F[ce]}v=v[v.length-1],B=F[v],T=T(B),T!=B&&T!=null&&e(F,v,{configurable:!0,writable:!0,value:T})}}function i(v,T){v instanceof String&&(v+="");var F=0,B=!1,ce={next:function(){if(!B&&F<v.length){var we=F++;return{value:T(we,v[we]),done:!1}}return B=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}s("Array.prototype.values",function(v){return v||function(){return i(this,function(T,F){return F})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(v){var T=typeof v;return T=T!="object"?T:v?Array.isArray(v)?"array":T:"null",T=="array"||T=="object"&&typeof v.length=="number"}function c(v){var T=typeof v;return T=="object"&&v!=null||T=="function"}function d(v,T,F){return v.call.apply(v.bind,arguments)}function f(v,T,F){if(!v)throw Error();if(2<arguments.length){var B=Array.prototype.slice.call(arguments,2);return function(){var ce=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ce,B),v.apply(T,ce)}}return function(){return v.apply(T,arguments)}}function p(v,T,F){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,p.apply(null,arguments)}function g(v,T){var F=Array.prototype.slice.call(arguments,1);return function(){var B=F.slice();return B.push.apply(B,arguments),v.apply(this,B)}}function y(v,T){function F(){}F.prototype=T.prototype,v.aa=T.prototype,v.prototype=new F,v.prototype.constructor=v,v.Qb=function(B,ce,we){for(var Le=Array(arguments.length-2),an=2;an<arguments.length;an++)Le[an-2]=arguments[an];return T.prototype[ce].apply(B,Le)}}function w(v){const T=v.length;if(0<T){const F=Array(T);for(let B=0;B<T;B++)F[B]=v[B];return F}return[]}function x(v,T){for(let F=1;F<arguments.length;F++){const B=arguments[F];if(l(B)){const ce=v.length||0,we=B.length||0;v.length=ce+we;for(let Le=0;Le<we;Le++)v[ce+Le]=B[Le]}else v.push(B)}}class I{constructor(T,F){this.i=T,this.j=F,this.h=0,this.g=null}get(){let T;return 0<this.h?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function C(v){return/^[\s\xa0]*$/.test(v)}function k(){var v=a.navigator;return v&&(v=v.userAgent)?v:""}function E(v){return E[" "](v),v}E[" "]=function(){};var _=k().indexOf("Gecko")!=-1&&!(k().toLowerCase().indexOf("webkit")!=-1&&k().indexOf("Edge")==-1)&&!(k().indexOf("Trident")!=-1||k().indexOf("MSIE")!=-1)&&k().indexOf("Edge")==-1;function L(v,T,F){for(const B in v)T.call(F,v[B],B,v)}function P(v,T){for(const F in v)T.call(void 0,v[F],F,v)}function A(v){const T={};for(const F in v)T[F]=v[F];return T}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function D(v,T){let F,B;for(let ce=1;ce<arguments.length;ce++){B=arguments[ce];for(F in B)v[F]=B[F];for(let we=0;we<$.length;we++)F=$[we],Object.prototype.hasOwnProperty.call(B,F)&&(v[F]=B[F])}}function R(v){var T=1;v=v.split(":");const F=[];for(;0<T&&v.length;)F.push(v.shift()),T--;return v.length&&F.push(v.join(":")),F}function M(v){a.setTimeout(()=>{throw v},0)}function O(){var v=Q;let T=null;return v.g&&(T=v.g,v.g=v.g.next,v.g||(v.h=null),T.next=null),T}class Z{constructor(){this.h=this.g=null}add(T,F){const B=q.get();B.set(T,F),this.h?this.h.next=B:this.g=B,this.h=B}}var q=new I(()=>new se,v=>v.reset());class se{constructor(){this.next=this.g=this.h=null}set(T,F){this.h=T,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let le,j=!1,Q=new Z,ee=()=>{const v=a.Promise.resolve(void 0);le=()=>{v.then(U)}};var U=()=>{for(var v;v=O();){try{v.h.call(v.g)}catch(F){M(F)}var T=q;T.j(v),100>T.h&&(T.h++,v.next=T.g,T.g=v)}j=!1};function H(){this.s=this.s,this.C=this.C}H.prototype.s=!1,H.prototype.ma=function(){this.s||(this.s=!0,this.N())},H.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(v,T){this.type=v,this.g=this.target=T,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var Ie=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var v=!1,T=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const F=()=>{};a.addEventListener("test",F,T),a.removeEventListener("test",F,T)}catch{}return v}();function be(v,T){if(ue.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v){var F=this.type=v.type,B=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;if(this.target=v.target||v.srcElement,this.g=T,T=v.relatedTarget){if(_){e:{try{E(T.nodeName);var ce=!0;break e}catch{}ce=!1}ce||(T=null)}}else F=="mouseover"?T=v.fromElement:F=="mouseout"&&(T=v.toElement);this.relatedTarget=T,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=typeof v.pointerType=="string"?v.pointerType:ke[v.pointerType]||"",this.state=v.state,this.i=v,v.defaultPrevented&&be.aa.h.call(this)}}y(be,ue);var ke={2:"touch",3:"pen",4:"mouse"};be.prototype.h=function(){be.aa.h.call(this);var v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var De="closure_listenable_"+(1e6*Math.random()|0),Fe=0;function Ae(v,T,F,B,ce){this.listener=v,this.proxy=null,this.src=T,this.type=F,this.capture=!!B,this.ha=ce,this.key=++Fe,this.da=this.fa=!1}function Ge(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function st(v){this.src=v,this.g={},this.h=0}st.prototype.add=function(v,T,F,B,ce){var we=v.toString();v=this.g[we],v||(v=this.g[we]=[],this.h++);var Le=gt(v,T,B,ce);return-1<Le?(T=v[Le],F||(T.fa=!1)):(T=new Ae(T,this.src,we,!!B,ce),T.fa=F,v.push(T)),T};function Et(v,T){var F=T.type;if(F in v.g){var B=v.g[F],ce=Array.prototype.indexOf.call(B,T,void 0),we;(we=0<=ce)&&Array.prototype.splice.call(B,ce,1),we&&(Ge(T),v.g[F].length==0&&(delete v.g[F],v.h--))}}function gt(v,T,F,B){for(var ce=0;ce<v.length;++ce){var we=v[ce];if(!we.da&&we.listener==T&&we.capture==!!F&&we.ha==B)return ce}return-1}var Wt="closure_lm_"+(1e6*Math.random()|0),Rt={};function kt(v,T,F,B,ce){if(Array.isArray(T)){for(var we=0;we<T.length;we++)kt(v,T[we],F,B,ce);return null}return F=En(F),v&&v[De]?v.K(T,F,c(B)?!!B.capture:!!B,ce):Ht(v,T,F,!1,B,ce)}function Ht(v,T,F,B,ce,we){if(!T)throw Error("Invalid event type");var Le=c(ce)?!!ce.capture:!!ce,an=Tr(v);if(an||(v[Wt]=an=new st(v)),F=an.add(T,F,B,Le,we),F.proxy)return F;if(B=qt(),F.proxy=B,B.src=v,B.listener=F,v.addEventListener)Ie||(ce=Le),ce===void 0&&(ce=!1),v.addEventListener(T.toString(),B,ce);else if(v.attachEvent)v.attachEvent(pn(T.toString()),B);else if(v.addListener&&v.removeListener)v.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return F}function qt(){function v(F){return T.call(v.src,v.listener,F)}const T=yn;return v}function mr(v,T,F,B,ce){if(Array.isArray(T))for(var we=0;we<T.length;we++)mr(v,T[we],F,B,ce);else B=c(B)?!!B.capture:!!B,F=En(F),v&&v[De]?(v=v.i,T=String(T).toString(),T in v.g&&(we=v.g[T],F=gt(we,F,B,ce),-1<F&&(Ge(we[F]),Array.prototype.splice.call(we,F,1),we.length==0&&(delete v.g[T],v.h--)))):v&&(v=Tr(v))&&(T=v.g[T.toString()],v=-1,T&&(v=gt(T,F,B,ce)),(F=-1<v?T[v]:null)&&nn(F))}function nn(v){if(typeof v!="number"&&v&&!v.da){var T=v.src;if(T&&T[De])Et(T.i,v);else{var F=v.type,B=v.proxy;T.removeEventListener?T.removeEventListener(F,B,v.capture):T.detachEvent?T.detachEvent(pn(F),B):T.addListener&&T.removeListener&&T.removeListener(B),(F=Tr(T))?(Et(F,v),F.h==0&&(F.src=null,T[Wt]=null)):Ge(v)}}}function pn(v){return v in Rt?Rt[v]:Rt[v]="on"+v}function yn(v,T){if(v.da)v=!0;else{T=new be(T,this);var F=v.listener,B=v.ha||v.src;v.fa&&nn(v),v=F.call(B,T)}return v}function Tr(v){return v=v[Wt],v instanceof st?v:null}var Dn="__closure_events_fn_"+(1e9*Math.random()>>>0);function En(v){return typeof v=="function"?v:(v[Dn]||(v[Dn]=function(T){return v.handleEvent(T)}),v[Dn])}function Tt(){H.call(this),this.i=new st(this),this.M=this,this.F=null}y(Tt,H),Tt.prototype[De]=!0,Tt.prototype.removeEventListener=function(v,T,F,B){mr(this,v,T,F,B)};function Jt(v,T){var F,B=v.F;if(B)for(F=[];B;B=B.F)F.push(B);if(v=v.M,B=T.type||T,typeof T=="string")T=new ue(T,v);else if(T instanceof ue)T.target=T.target||v;else{var ce=T;T=new ue(B,v),D(T,ce)}if(ce=!0,F)for(var we=F.length-1;0<=we;we--){var Le=T.g=F[we];ce=Pn(Le,B,!0,T)&&ce}if(Le=T.g=v,ce=Pn(Le,B,!0,T)&&ce,ce=Pn(Le,B,!1,T)&&ce,F)for(we=0;we<F.length;we++)Le=T.g=F[we],ce=Pn(Le,B,!1,T)&&ce}Tt.prototype.N=function(){if(Tt.aa.N.call(this),this.i){var v=this.i,T;for(T in v.g){for(var F=v.g[T],B=0;B<F.length;B++)Ge(F[B]);delete v.g[T],v.h--}}this.F=null},Tt.prototype.K=function(v,T,F,B){return this.i.add(String(v),T,!1,F,B)},Tt.prototype.L=function(v,T,F,B){return this.i.add(String(v),T,!0,F,B)};function Pn(v,T,F,B){if(T=v.i.g[String(T)],!T)return!0;T=T.concat();for(var ce=!0,we=0;we<T.length;++we){var Le=T[we];if(Le&&!Le.da&&Le.capture==F){var an=Le.listener,ir=Le.ha||Le.src;Le.fa&&Et(v.i,Le),ce=an.call(ir,B)!==!1&&ce}}return ce&&!B.defaultPrevented}function Os(v,T,F){if(typeof v=="function")F&&(v=p(v,F));else if(v&&typeof v.handleEvent=="function")v=p(v.handleEvent,v);else throw Error("Invalid listener argument");return 2147483647<Number(T)?-1:a.setTimeout(v,T||0)}function Wn(v){v.g=Os(()=>{v.g=null,v.i&&(v.i=!1,Wn(v))},v.l);const T=v.h;v.h=null,v.m.apply(null,T)}class ys extends H{constructor(T,F){super(),this.m=T,this.l=F,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:Wn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zs(v){H.call(this),this.h=v,this.g={}}y(Zs,H);var Ls=[];function Bo(v){L(v.g,function(T,F){this.g.hasOwnProperty(F)&&nn(T)},v),v.g={}}Zs.prototype.N=function(){Zs.aa.N.call(this),Bo(this)},Zs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ro=a.JSON.stringify,so=a.JSON.parse,_a=class{stringify(v){return a.JSON.stringify(v,void 0)}parse(v){return a.JSON.parse(v,void 0)}};function bi(){}bi.prototype.h=null;function Ra(v){return v.h||(v.h=v.i())}function Uo(){}var vs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ms(){ue.call(this,"d")}y(Ms,ue);function Ii(){ue.call(this,"c")}y(Ii,ue);var is={},Ul=null;function Wo(){return Ul=Ul||new Tt}is.La="serverreachability";function X(v){ue.call(this,is.La,v)}y(X,ue);function ae(v){const T=Wo();Jt(T,new X(T))}is.STAT_EVENT="statevent";function ye(v,T){ue.call(this,is.STAT_EVENT,v),this.stat=T}y(ye,ue);function Ce(v){const T=Wo();Jt(T,new ye(T,v))}is.Ma="timingevent";function Be(v,T){ue.call(this,is.Ma,v),this.size=T}y(Be,ue);function He(v,T){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){v()},T)}function ot(){this.g=!0}ot.prototype.xa=function(){this.g=!1};function Ue(v,T,F,B,ce,we){v.info(function(){if(v.g)if(we)for(var Le="",an=we.split("&"),ir=0;ir<an.length;ir++){var zt=an[ir].split("=");if(1<zt.length){var gr=zt[0];zt=zt[1];var Kn=gr.split("_");Le=2<=Kn.length&&Kn[1]=="type"?Le+(gr+"="+zt+"&"):Le+(gr+"=redacted&")}}else Le=null;else Le=we;return"XMLHTTP REQ ("+B+") [attempt "+ce+"]: "+T+`
`+F+`
`+Le})}function Ke(v,T,F,B,ce,we,Le){v.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+ce+"]: "+T+`
`+F+`
`+we+" "+Le})}function Oe(v,T,F,B){v.info(function(){return"XMLHTTP TEXT ("+T+"): "+xt(v,F)+(B?" "+B:"")})}function ht(v,T){v.info(function(){return"TIMEOUT: "+T})}ot.prototype.info=function(){};function xt(v,T){if(!v.g)return T;if(!T)return null;try{var F=JSON.parse(T);if(F){for(v=0;v<F.length;v++)if(Array.isArray(F[v])){var B=F[v];if(!(2>B.length)){var ce=B[1];if(Array.isArray(ce)&&!(1>ce.length)){var we=ce[0];if(we!="noop"&&we!="stop"&&we!="close")for(var Le=1;Le<ce.length;Le++)ce[Le]=""}}}}return ro(F)}catch{return T}}var Zt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Fn={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Dt;function Gt(){}y(Gt,bi),Gt.prototype.g=function(){return new XMLHttpRequest},Gt.prototype.i=function(){return{}},Dt=new Gt;function en(v,T,F,B){this.j=v,this.i=T,this.l=F,this.R=B||1,this.U=new Zs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ci}function Ci(){this.i=null,this.g="",this.h=!1}var Si={},Wr={};function _r(v,T,F){v.L=1,v.v=Da(Vs(T)),v.m=F,v.P=!0,Go(v,null)}function Go(v,T){v.F=Date.now(),tn(v),v.A=Vs(v.v);var F=v.A,B=v.R;Array.isArray(B)||(B=[String(B)]),Fa(F.i,"t",B),v.C=0,F=v.j.J,v.h=new Ci,v.g=dm(v.j,F?T:null,!v.m),0<v.O&&(v.M=new ys(p(v.Y,v,v.g),v.O)),T=v.U,F=v.g,B=v.ca;var ce="readystatechange";Array.isArray(ce)||(ce&&(Ls[0]=ce.toString()),ce=Ls);for(var we=0;we<ce.length;we++){var Le=kt(F,ce[we],B||T.handleEvent,!1,T.h||T);if(!Le)break;T.g[Le.key]=Le}T=v.H?A(v.H):{},v.m?(v.u||(v.u="POST"),T["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.A,v.u,v.m,T)):(v.u="GET",v.g.ea(v.A,v.u,null,T)),ae(),Ue(v.i,v.u,v.A,v.l,v.R,v.m)}en.prototype.ca=function(v){v=v.target;const T=this.M;T&&bs(v)==3?T.j():this.Y(v)},en.prototype.Y=function(v){try{if(v==this.g)e:{const Kn=bs(this.g);var T=this.g.Ba();const ti=this.g.Z();if(!(3>Kn)&&(Kn!=3||this.g&&(this.h.h||this.g.oa()||Zh(this.g)))){this.J||Kn!=4||T==7||(T==8||0>=ti?ae(3):ae(2)),Vt(this);var F=this.g.Z();this.X=F;t:if(io(this)){var B=Zh(this.g);v="";var ce=B.length,we=bs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Rr(this),vn(this);var Le="";break t}this.h.i=new a.TextDecoder}for(T=0;T<ce;T++)this.h.h=!0,v+=this.h.i.decode(B[T],{stream:!(we&&T==ce-1)});B.length=0,this.h.g+=v,this.C=0,Le=this.h.g}else Le=this.g.oa();if(this.o=F==200,Ke(this.i,this.u,this.A,this.l,this.R,Kn,F),this.o){if(this.T&&!this.K){t:{if(this.g){var an,ir=this.g;if((an=ir.g?ir.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(an)){var zt=an;break t}}zt=null}if(F=zt)Oe(this.i,this.l,F,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ki(this,F);else{this.o=!1,this.s=3,Ce(12),Rr(this),vn(this);break e}}if(this.P){F=!0;let Bs;for(;!this.J&&this.C<Le.length;)if(Bs=Ei(this,Le),Bs==Wr){Kn==4&&(this.s=4,Ce(14),F=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}else if(Bs==Si){this.s=4,Ce(15),Oe(this.i,this.l,Le,"[Invalid Chunk]"),F=!1;break}else Oe(this.i,this.l,Bs,null),ki(this,Bs);if(io(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kn!=4||Le.length!=0||this.h.h||(this.s=1,Ce(16),F=!1),this.o=this.o&&F,!F)Oe(this.i,this.l,Le,"[Invalid Chunked Response]"),Rr(this),vn(this);else if(0<Le.length&&!this.W){this.W=!0;var gr=this.j;gr.g==this&&gr.ba&&!gr.M&&(gr.j.info("Great, no buffering proxy detected. Bytes received: "+Le.length),td(gr),gr.M=!0,Ce(11))}}else Oe(this.i,this.l,Le,null),ki(this,Le);Kn==4&&Rr(this),this.o&&!this.J&&(Kn==4?mc(this.j,this):(this.o=!1,tn(this)))}else cc(this.g),F==400&&0<Le.indexOf("Unknown SID")?(this.s=3,Ce(12)):(this.s=0,Ce(13)),Rr(this),vn(this)}}}catch{}finally{}};function io(v){return v.g?v.u=="GET"&&v.L!=2&&v.j.Ca:!1}function Ei(v,T){var F=v.C,B=T.indexOf(`
`,F);return B==-1?Wr:(F=Number(T.substring(F,B)),isNaN(F)?Si:(B+=1,B+F>T.length?Wr:(T=T.slice(B,B+F),v.C=B+F,T)))}en.prototype.cancel=function(){this.J=!0,Rr(this)};function tn(v){v.S=Date.now()+v.I,jo(v,v.I)}function jo(v,T){if(v.B!=null)throw Error("WatchDog timer not null");v.B=He(p(v.ba,v),T)}function Vt(v){v.B&&(a.clearTimeout(v.B),v.B=null)}en.prototype.ba=function(){this.B=null;const v=Date.now();0<=v-this.S?(ht(this.i,this.A),this.L!=2&&(ae(),Ce(17)),Rr(this),this.s=2,vn(this)):jo(this,this.S-v)};function vn(v){v.j.G==0||v.J||mc(v.j,v)}function Rr(v){Vt(v);var T=v.M;T&&typeof T.ma=="function"&&T.ma(),v.M=null,Bo(v.U),v.g&&(T=v.g,v.g=null,T.abort(),T.ma())}function ki(v,T){try{var F=v.j;if(F.G!=0&&(F.g==v||os(F.h,v))){if(!v.K&&os(F.h,v)&&F.G==3){try{var B=F.Da.g.parse(T)}catch{B=null}if(Array.isArray(B)&&B.length==3){var ce=B;if(ce[0]==0){e:if(!F.u){if(F.g)if(F.g.F+3e3<v.F)pc(F),Ai(F);else break e;fc(F),Ce(18)}}else F.za=ce[1],0<F.za-F.T&&37500>ce[2]&&F.F&&F.v==0&&!F.C&&(F.C=He(p(F.Za,F),6e3));if(1>=sc(F.h)&&F.ca){try{F.ca()}catch{}F.ca=void 0}}else Yo(F,11)}else if((v.K||F.g==v)&&pc(F),!C(T))for(ce=F.Da.g.parse(T),T=0;T<ce.length;T++){let zt=ce[T];if(F.T=zt[0],zt=zt[1],F.G==2)if(zt[0]=="c"){F.K=zt[1],F.ia=zt[2];const gr=zt[3];gr!=null&&(F.la=gr,F.j.info("VER="+F.la));const Kn=zt[4];Kn!=null&&(F.Aa=Kn,F.j.info("SVER="+F.Aa));const ti=zt[5];ti!=null&&typeof ti=="number"&&0<ti&&(B=1.5*ti,F.L=B,F.j.info("backChannelRequestTimeoutMs_="+B)),B=F;const Bs=v.g;if(Bs){const Kl=Bs.g?Bs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Kl){var we=B.h;we.g||Kl.indexOf("spdy")==-1&&Kl.indexOf("quic")==-1&&Kl.indexOf("h2")==-1||(we.j=we.l,we.g=new Set,we.h&&(Xh(we,we.h),we.h=null))}if(B.D){const yc=Bs.g?Bs.g.getResponseHeader("X-HTTP-Session-Id"):null;yc&&(B.ya=yc,cn(B.I,B.D,yc))}}F.G=3,F.l&&F.l.ua(),F.ba&&(F.R=Date.now()-v.F,F.j.info("Handshake RTT: "+F.R+"ms")),B=F;var Le=v;if(B.qa=hm(B,B.J?B.ia:null,B.W),Le.K){Zp(B.h,Le);var an=Le,ir=B.L;ir&&(an.I=ir),an.B&&(Vt(an),tn(an)),B.g=Le}else ql(B);0<F.i.length&&uo(F)}else zt[0]!="stop"&&zt[0]!="close"||Yo(F,7);else F.G==3&&(zt[0]=="stop"||zt[0]=="close"?zt[0]=="stop"?Yo(F,7):Ar(F):zt[0]!="noop"&&F.l&&F.l.ta(zt),F.v=0)}}ae(4)}catch{}}var xn=class{constructor(v,T){this.g=v,this.map=T}};function xs(v){this.l=v||10,a.PerformanceNavigationTiming?(v=a.performance.getEntriesByType("navigation"),v=0<v.length&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Gr(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function sc(v){return v.h?1:v.g?v.g.size:0}function os(v,T){return v.h?v.h==T:v.g?v.g.has(T):!1}function Xh(v,T){v.g?v.g.add(T):v.h=T}function Zp(v,T){v.h&&v.h==T?v.h=null:v.g&&v.g.has(T)&&v.g.delete(T)}xs.prototype.cancel=function(){if(this.i=em(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function em(v){if(v.h!=null)return v.i.concat(v.h.D);if(v.g!=null&&v.g.size!==0){let T=v.i;for(const F of v.g.values())T=T.concat(F.D);return T}return w(v.i)}function ic(v){if(v.V&&typeof v.V=="function")return v.V();if(typeof Map<"u"&&v instanceof Map||typeof Set<"u"&&v instanceof Set)return Array.from(v.values());if(typeof v=="string")return v.split("");if(l(v)){for(var T=[],F=v.length,B=0;B<F;B++)T.push(v[B]);return T}T=[],F=0;for(B in v)T[F++]=v[B];return T}function oc(v){if(v.na&&typeof v.na=="function")return v.na();if(!v.V||typeof v.V!="function"){if(typeof Map<"u"&&v instanceof Map)return Array.from(v.keys());if(!(typeof Set<"u"&&v instanceof Set)){if(l(v)||typeof v=="string"){var T=[];v=v.length;for(var F=0;F<v;F++)T.push(F);return T}T=[],F=0;for(const B in v)T[F++]=B;return T}}}function Na(v,T){if(v.forEach&&typeof v.forEach=="function")v.forEach(T,void 0);else if(l(v)||typeof v=="string")Array.prototype.forEach.call(v,T,void 0);else for(var F=oc(v),B=ic(v),ce=B.length,we=0;we<ce;we++)T.call(void 0,B[we],F&&F[we],v)}var Wl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yv(v,T){if(v){v=v.split("&");for(var F=0;F<v.length;F++){var B=v[F].indexOf("="),ce=null;if(0<=B){var we=v[F].substring(0,B);ce=v[F].substring(B+1)}else we=v[F];T(we,ce?decodeURIComponent(ce.replace(/\+/g," ")):"")}}}function Ho(v){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,v instanceof Ho){this.h=v.h,Gl(this,v.j),this.o=v.o,this.g=v.g,Aa(this,v.s),this.l=v.l;var T=v.i,F=new oo;F.i=T.i,T.g&&(F.g=new Map(T.g),F.h=T.h),$a(this,F),this.m=v.m}else v&&(T=String(v).match(Wl))?(this.h=!1,Gl(this,T[1]||"",!0),this.o=Pt(T[2]||""),this.g=Pt(T[3]||"",!0),Aa(this,T[4]),this.l=Pt(T[5]||"",!0),$a(this,T[6]||"",!0),this.m=Pt(T[7]||"")):(this.h=!1,this.i=new oo(null,this.h))}Ho.prototype.toString=function(){var v=[],T=this.j;T&&v.push(Pa(T,ac,!0),":");var F=this.g;return(F||T=="file")&&(v.push("//"),(T=this.o)&&v.push(Pa(T,ac,!0),"@"),v.push(encodeURIComponent(String(F)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.s,F!=null&&v.push(":",String(F))),(F=this.l)&&(this.g&&F.charAt(0)!="/"&&v.push("/"),v.push(Pa(F,F.charAt(0)=="/"?rm:nm,!0))),(F=this.i.toString())&&v.push("?",F),(F=this.m)&&v.push("#",Pa(F,Yh)),v.join("")};function Vs(v){return new Ho(v)}function Gl(v,T,F){v.j=F?Pt(T,!0):T,v.j&&(v.j=v.j.replace(/:$/,""))}function Aa(v,T){if(T){if(T=Number(T),isNaN(T)||0>T)throw Error("Bad port number "+T);v.s=T}else v.s=null}function $a(v,T,F){T instanceof oo?(v.i=T,ao(v.i,v.h)):(F||(T=Pa(T,sm)),v.i=new oo(T,v.h))}function cn(v,T,F){v.i.set(T,F)}function Da(v){return cn(v,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),v}function Pt(v,T){return v?T?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function Pa(v,T,F){return typeof v=="string"?(v=encodeURI(v).replace(T,tm),F&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function tm(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var ac=/[#\/\?@]/g,nm=/[#\?:]/g,rm=/[#\?]/g,sm=/[#\?@]/g,Yh=/#/g;function oo(v,T){this.h=this.g=null,this.i=v||null,this.j=!!T}function Nr(v){v.g||(v.g=new Map,v.h=0,v.i&&Yv(v.i,function(T,F){v.add(decodeURIComponent(T.replace(/\+/g," ")),F)}))}n=oo.prototype,n.add=function(v,T){Nr(this),this.i=null,v=ei(this,v);var F=this.g.get(v);return F||this.g.set(v,F=[]),F.push(T),this.h+=1,this};function Ti(v,T){Nr(v),T=ei(v,T),v.g.has(T)&&(v.i=null,v.h-=v.g.get(T).length,v.g.delete(T))}function _i(v,T){return Nr(v),T=ei(v,T),v.g.has(T)}n.forEach=function(v,T){Nr(this),this.g.forEach(function(F,B){F.forEach(function(ce){v.call(T,ce,B,this)},this)},this)},n.na=function(){Nr(this);const v=Array.from(this.g.values()),T=Array.from(this.g.keys()),F=[];for(let B=0;B<T.length;B++){const ce=v[B];for(let we=0;we<ce.length;we++)F.push(T[B])}return F},n.V=function(v){Nr(this);let T=[];if(typeof v=="string")_i(this,v)&&(T=T.concat(this.g.get(ei(this,v))));else{v=Array.from(this.g.values());for(let F=0;F<v.length;F++)T=T.concat(v[F])}return T},n.set=function(v,T){return Nr(this),this.i=null,v=ei(this,v),_i(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[T]),this.h+=1,this},n.get=function(v,T){return v?(v=this.V(v),0<v.length?String(v[0]):T):T};function Fa(v,T,F){Ti(v,T),0<F.length&&(v.i=null,v.g.set(ei(v,T),w(F)),v.h+=F.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],T=Array.from(this.g.keys());for(var F=0;F<T.length;F++){var B=T[F];const we=encodeURIComponent(String(B)),Le=this.V(B);for(B=0;B<Le.length;B++){var ce=we;Le[B]!==""&&(ce+="="+encodeURIComponent(String(Le[B]))),v.push(ce)}}return this.i=v.join("&")};function ei(v,T){return T=String(T),v.j&&(T=T.toLowerCase()),T}function ao(v,T){T&&!v.j&&(Nr(v),v.i=null,v.g.forEach(function(F,B){var ce=B.toLowerCase();B!=ce&&(Ti(this,B),Fa(this,ce,F))},v)),v.j=T}function Qv(v,T){const F=new ot;if(a.Image){const B=new Image;B.onload=g(ws,F,"TestLoadImage: loaded",!0,T,B),B.onerror=g(ws,F,"TestLoadImage: error",!1,T,B),B.onabort=g(ws,F,"TestLoadImage: abort",!1,T,B),B.ontimeout=g(ws,F,"TestLoadImage: timeout",!1,T,B),a.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=v}else T(!1)}function im(v,T){const F=new ot,B=new AbortController,ce=setTimeout(()=>{B.abort(),ws(F,"TestPingServer: timeout",!1,T)},1e4);fetch(v,{signal:B.signal}).then(we=>{clearTimeout(ce),we.ok?ws(F,"TestPingServer: ok",!0,T):ws(F,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(ce),ws(F,"TestPingServer: error",!1,T)})}function ws(v,T,F,B,ce){try{ce&&(ce.onload=null,ce.onerror=null,ce.onabort=null,ce.ontimeout=null),B(F)}catch{}}function Jv(){this.g=new _a}function om(v,T,F){const B=F||"";try{Na(v,function(ce,we){let Le=ce;c(ce)&&(Le=ro(ce)),T.push(B+we+"="+encodeURIComponent(Le))})}catch(ce){throw T.push(B+"type="+encodeURIComponent("_badmap")),ce}}function qo(v){this.l=v.Ub||null,this.j=v.eb||!1}y(qo,bi),qo.prototype.g=function(){return new jl(this.l,this.j)},qo.prototype.i=function(v){return function(){return v}}({});function jl(v,T){Tt.call(this),this.D=v,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(jl,Tt),n=jl.prototype,n.open=function(v,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=v,this.A=T,this.readyState=1,Ni(this)},n.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const T={headers:this.u,method:this.B,credentials:this.m,cache:void 0};v&&(T.body=v),(this.D||a).fetch(new Request(this.A,T)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ri(this)),this.readyState=0},n.Sa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,Ni(this)),this.g&&(this.readyState=3,Ni(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;am(this)}else v.text().then(this.Ra.bind(this),this.ga.bind(this))};function am(v){v.j.read().then(v.Pa.bind(v)).catch(v.ga.bind(v))}n.Pa=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var T=v.value?v.value:new Uint8Array(0);(T=this.v.decode(T,{stream:!v.done}))&&(this.response=this.responseText+=T)}v.done?Ri(this):Ni(this),this.readyState==3&&am(this)}},n.Ra=function(v){this.g&&(this.response=this.responseText=v,Ri(this))},n.Qa=function(v){this.g&&(this.response=v,Ri(this))},n.ga=function(){this.g&&Ri(this)};function Ri(v){v.readyState=4,v.l=null,v.j=null,v.v=null,Ni(v)}n.setRequestHeader=function(v,T){this.u.append(v,T)},n.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],T=this.h.entries();for(var F=T.next();!F.done;)F=F.value,v.push(F[0]+": "+F[1]),F=T.next();return v.join(`\r
`)};function Ni(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(jl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function Ko(v){let T="";return L(v,function(F,B){T+=B,T+=":",T+=F,T+=`\r
`}),T}function Oa(v,T,F){e:{for(B in F){var B=!1;break e}B=!0}B||(F=Ko(F),typeof v=="string"?F!=null&&encodeURIComponent(String(F)):cn(v,T,F))}function kn(v){Tt.call(this),this.headers=new Map,this.o=v||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(kn,Tt);var Zv=/^https?$/i,Qh=["POST","PUT"];n=kn.prototype,n.Ha=function(v){this.J=v},n.ea=function(v,T,F,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);T=T?T.toUpperCase():"GET",this.D=v,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Dt.g(),this.v=this.o?Ra(this.o):Ra(Dt),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(T,String(v),!0),this.B=!1}catch(we){Hl(this,we);return}if(v=F||"",F=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var ce in B)F.set(ce,B[ce]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const we of B.keys())F.set(we,B.get(we));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(F.keys()).find(we=>we.toLowerCase()=="content-type"),ce=a.FormData&&v instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Qh,T,void 0))||B||ce||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[we,Le]of F)this.g.setRequestHeader(we,Le);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uc(this),this.u=!0,this.g.send(v),this.u=!1}catch(we){Hl(this,we)}};function Hl(v,T){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=T,v.m=5,lc(v),zs(v)}function lc(v){v.A||(v.A=!0,Jt(v,"complete"),Jt(v,"error"))}n.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=v||7,Jt(this,"complete"),Jt(this,"abort"),zs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zs(this,!0)),kn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Jh(this):this.bb())},n.bb=function(){Jh(this)};function Jh(v){if(v.h&&typeof o<"u"&&(!v.v[1]||bs(v)!=4||v.Z()!=2)){if(v.u&&bs(v)==4)Os(v.Ea,0,v);else if(Jt(v,"readystatechange"),bs(v)==4){v.h=!1;try{const Le=v.Z();e:switch(Le){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var F;if(!(F=T)){var B;if(B=Le===0){var ce=String(v.D).match(Wl)[1]||null;!ce&&a.self&&a.self.location&&(ce=a.self.location.protocol.slice(0,-1)),B=!Zv.test(ce?ce.toLowerCase():"")}F=B}if(F)Jt(v,"complete"),Jt(v,"success");else{v.m=6;try{var we=2<bs(v)?v.g.statusText:""}catch{we=""}v.l=we+" ["+v.Z()+"]",lc(v)}}finally{zs(v)}}}}function zs(v,T){if(v.g){uc(v);const F=v.g,B=v.v[0]?()=>{}:null;v.g=null,v.v=null,T||Jt(v,"ready");try{F.onreadystatechange=B}catch{}}}function uc(v){v.I&&(a.clearTimeout(v.I),v.I=null)}n.isActive=function(){return!!this.g};function bs(v){return v.g?v.g.readyState:0}n.Z=function(){try{return 2<bs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(v){if(this.g){var T=this.g.responseText;return v&&T.indexOf(v)==0&&(T=T.substring(v.length)),so(T)}};function Zh(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.H){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function cc(v){const T={};v=(v.g&&2<=bs(v)&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<v.length;B++){if(C(v[B]))continue;var F=R(v[B]);const ce=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const we=T[ce]||[];T[ce]=we,we.push(F)}P(T,function(B){return B.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function lo(v,T,F){return F&&F.internalChannelParams&&F.internalChannelParams[v]||T}function ed(v){this.Aa=0,this.i=[],this.j=new ot,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=lo("failFast",!1,v),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=lo("baseRetryDelayMs",5e3,v),this.cb=lo("retryDelaySeedMs",1e4,v),this.Wa=lo("forwardChannelMaxRetries",2,v),this.wa=lo("forwardChannelRequestTimeoutMs",2e4,v),this.pa=v&&v.xmlHttpFactory||void 0,this.Xa=v&&v.Tb||void 0,this.Ca=v&&v.useFetchStreams||!1,this.L=void 0,this.J=v&&v.supportsCrossDomainXhr||!1,this.K="",this.h=new xs(v&&v.concurrentRequestLimit),this.Da=new Jv,this.P=v&&v.fastHandshake||!1,this.O=v&&v.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=v&&v.Rb||!1,v&&v.xa&&this.j.xa(),v&&v.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&v&&v.detectBufferingProxy||!1,this.ja=void 0,v&&v.longPollingTimeout&&0<v.longPollingTimeout&&(this.ja=v.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ed.prototype,n.la=8,n.G=1,n.connect=function(v,T,F,B){Ce(0),this.W=v,this.H=T||{},F&&B!==void 0&&(this.H.OSID=F,this.H.OAID=B),this.F=this.X,this.I=hm(this,null,this.W),uo(this)};function Ar(v){if(hc(v),v.G==3){var T=v.U++,F=Vs(v.I);if(cn(F,"SID",v.K),cn(F,"RID",T),cn(F,"TYPE","terminate"),Xo(v,F),T=new en(v,v.j,T),T.L=2,T.v=Da(Vs(F)),F=!1,a.navigator&&a.navigator.sendBeacon)try{F=a.navigator.sendBeacon(T.v.toString(),"")}catch{}!F&&a.Image&&(new Image().src=T.v,F=!0),F||(T.g=dm(T.j,null),T.g.ea(T.v)),T.F=Date.now(),tn(T)}cm(v)}function Ai(v){v.g&&(td(v),v.g.cancel(),v.g=null)}function hc(v){Ai(v),v.u&&(a.clearTimeout(v.u),v.u=null),pc(v),v.h.cancel(),v.s&&(typeof v.s=="number"&&a.clearTimeout(v.s),v.s=null)}function uo(v){if(!Gr(v.h)&&!v.s){v.s=!0;var T=v.Ga;le||ee(),j||(le(),j=!0),Q.add(T,v),v.B=0}}function ex(v,T){return sc(v.h)>=v.h.j-(v.s?1:0)?!1:v.s?(v.i=T.D.concat(v.i),!0):v.G==1||v.G==2||v.B>=(v.Va?0:v.Wa)?!1:(v.s=He(p(v.Ga,v,T),um(v,v.B)),v.B++,!0)}n.Ga=function(v){if(this.s)if(this.s=null,this.G==1){if(!v){this.U=Math.floor(1e5*Math.random()),v=this.U++;const ce=new en(this,this.j,v);let we=this.o;if(this.S&&(we?(we=A(we),D(we,this.S)):we=this.S),this.m!==null||this.O||(ce.H=we,we=null),this.P)e:{for(var T=0,F=0;F<this.i.length;F++){t:{var B=this.i[F];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(T+=B,4096<T){T=F;break e}if(T===4096||F===this.i.length-1){T=F+1;break e}}T=1e3}else T=1e3;T=La(this,ce,T),F=Vs(this.I),cn(F,"RID",v),cn(F,"CVER",22),this.D&&cn(F,"X-HTTP-Session-Id",this.D),Xo(this,F),we&&(this.O?T="headers="+encodeURIComponent(String(Ko(we)))+"&"+T:this.m&&Oa(F,this.m,we)),Xh(this.h,ce),this.Ua&&cn(F,"TYPE","init"),this.P?(cn(F,"$req",T),cn(F,"SID","null"),ce.T=!0,_r(ce,F,null)):_r(ce,F,T),this.G=2}}else this.G==3&&(v?dc(this,v):this.i.length==0||Gr(this.h)||dc(this))};function dc(v,T){var F;T?F=T.l:F=v.U++;const B=Vs(v.I);cn(B,"SID",v.K),cn(B,"RID",F),cn(B,"AID",v.T),Xo(v,B),v.m&&v.o&&Oa(B,v.m,v.o),F=new en(v,v.j,F,v.B+1),v.m===null&&(F.H=v.o),T&&(v.i=T.D.concat(v.i)),T=La(v,F,1e3),F.I=Math.round(.5*v.wa)+Math.round(.5*v.wa*Math.random()),Xh(v.h,F),_r(F,B,T)}function Xo(v,T){v.H&&L(v.H,function(F,B){cn(T,B,F)}),v.l&&Na({},function(F,B){cn(T,B,F)})}function La(v,T,F){F=Math.min(v.i.length,F);var B=v.l?p(v.l.Na,v.l,v):null;e:{var ce=v.i;let we=-1;for(;;){const Le=["count="+F];we==-1?0<F?(we=ce[0].g,Le.push("ofs="+we)):we=0:Le.push("ofs="+we);let an=!0;for(let ir=0;ir<F;ir++){let zt=ce[ir].g;const gr=ce[ir].map;if(zt-=we,0>zt)we=Math.max(0,ce[ir].g-100),an=!1;else try{om(gr,Le,"req"+zt+"_")}catch{B&&B(gr)}}if(an){B=Le.join("&");break e}}}return v=v.i.splice(0,F),T.D=v,B}function ql(v){if(!v.g&&!v.u){v.Y=1;var T=v.Fa;le||ee(),j||(le(),j=!0),Q.add(T,v),v.v=0}}function fc(v){return v.g||v.u||3<=v.v?!1:(v.Y++,v.u=He(p(v.Fa,v),um(v,v.v)),v.v++,!0)}n.Fa=function(){if(this.u=null,lm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var v=2*this.R;this.j.info("BP detection timer enabled: "+v),this.A=He(p(this.ab,this),v)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ce(10),Ai(this),lm(this))};function td(v){v.A!=null&&(a.clearTimeout(v.A),v.A=null)}function lm(v){v.g=new en(v,v.j,"rpc",v.Y),v.m===null&&(v.g.H=v.o),v.g.O=0;var T=Vs(v.qa);cn(T,"RID","rpc"),cn(T,"SID",v.K),cn(T,"AID",v.T),cn(T,"CI",v.F?"0":"1"),!v.F&&v.ja&&cn(T,"TO",v.ja),cn(T,"TYPE","xmlhttp"),Xo(v,T),v.m&&v.o&&Oa(T,v.m,v.o),v.L&&(v.g.I=v.L);var F=v.g;v=v.ia,F.L=1,F.v=Da(Vs(T)),F.m=null,F.P=!0,Go(F,v)}n.Za=function(){this.C!=null&&(this.C=null,Ai(this),fc(this),Ce(19))};function pc(v){v.C!=null&&(a.clearTimeout(v.C),v.C=null)}function mc(v,T){var F=null;if(v.g==T){pc(v),td(v),v.g=null;var B=2}else if(os(v.h,T))F=T.D,Zp(v.h,T),B=1;else return;if(v.G!=0){if(T.o)if(B==1){F=T.m?T.m.length:0,T=Date.now()-T.F;var ce=v.B;B=Wo(),Jt(B,new Be(B,F)),uo(v)}else ql(v);else if(ce=T.s,ce==3||ce==0&&0<T.X||!(B==1&&ex(v,T)||B==2&&fc(v)))switch(F&&0<F.length&&(T=v.h,T.i=T.i.concat(F)),ce){case 1:Yo(v,5);break;case 4:Yo(v,10);break;case 3:Yo(v,6);break;default:Yo(v,2)}}}function um(v,T){let F=v.Ta+Math.floor(Math.random()*v.cb);return v.isActive()||(F*=2),F*T}function Yo(v,T){if(v.j.info("Error code "+T),T==2){var F=p(v.fb,v),B=v.Xa;const ce=!B;B=new Ho(B||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Gl(B,"https"),Da(B),ce?Qv(B.toString(),F):im(B.toString(),F)}else Ce(2);v.G=0,v.l&&v.l.sa(T),cm(v),hc(v)}n.fb=function(v){v?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function cm(v){if(v.G=0,v.ka=[],v.l){const T=em(v.h);(T.length!=0||v.i.length!=0)&&(x(v.ka,T),x(v.ka,v.i),v.h.i.length=0,w(v.i),v.i.length=0),v.l.ra()}}function hm(v,T,F){var B=F instanceof Ho?Vs(F):new Ho(F);if(B.g!="")T&&(B.g=T+"."+B.g),Aa(B,B.s);else{var ce=a.location;B=ce.protocol,T=T?T+"."+ce.hostname:ce.hostname,ce=+ce.port;var we=new Ho(null);B&&Gl(we,B),T&&(we.g=T),ce&&Aa(we,ce),F&&(we.l=F),B=we}return F=v.D,T=v.ya,F&&T&&cn(B,F,T),cn(B,"VER",v.la),Xo(v,B),B}function dm(v,T,F){if(T&&!v.J)throw Error("Can't create secondary domain capable XhrIo object.");return T=v.Ca&&!v.pa?new kn(new qo({eb:F})):new kn(v.pa),T.Ha(v.J),T}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function nd(){}n=nd.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function gc(){}gc.prototype.g=function(v,T){return new as(v,T)};function as(v,T){Tt.call(this),this.g=new ed(T),this.l=v,this.h=T&&T.messageUrlParams||null,v=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(v?v["X-WebChannel-Content-Type"]=T.messageContentType:v={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.va&&(v?v["X-WebChannel-Client-Profile"]=T.va:v={"X-WebChannel-Client-Profile":T.va}),this.g.S=v,(v=T&&T.Sb)&&!C(v)&&(this.g.m=v),this.v=T&&T.supportsCrossDomainXhr||!1,this.u=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!C(T)&&(this.g.D=T,v=this.h,v!==null&&T in v&&(v=this.h,T in v&&delete v[T])),this.j=new co(this)}y(as,Tt),as.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},as.prototype.close=function(){Ar(this.g)},as.prototype.o=function(v){var T=this.g;if(typeof v=="string"){var F={};F.__data__=v,v=F}else this.u&&(F={},F.__data__=ro(v),v=F);T.i.push(new xn(T.Ya++,v)),T.G==3&&uo(T)},as.prototype.N=function(){this.g.l=null,delete this.j,Ar(this.g),delete this.g,as.aa.N.call(this)};function fm(v){Ms.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var T=v.__sm__;if(T){e:{for(const F in T){v=F;break e}v=void 0}(this.i=v)&&(v=this.i,T=T!==null&&v in T?T[v]:void 0),this.data=T}else this.data=v}y(fm,Ms);function pm(){Ii.call(this),this.status=1}y(pm,Ii);function co(v){this.g=v}y(co,nd),co.prototype.ua=function(){Jt(this.g,"a")},co.prototype.ta=function(v){Jt(this.g,new fm(v))},co.prototype.sa=function(v){Jt(this.g,new pm)},co.prototype.ra=function(){Jt(this.g,"b")},gc.prototype.createWebChannel=gc.prototype.g,as.prototype.send=as.prototype.o,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,VA=function(){return new gc},MA=function(){return Wo()},LA=is,m1={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Zt.NO_ERROR=0,Zt.TIMEOUT=8,Zt.HTTP_ERROR=6,Pg=Zt,Fn.COMPLETE="complete",OA=Fn,Uo.EventType=vs,vs.OPEN="a",vs.CLOSE="b",vs.ERROR="c",vs.MESSAGE="d",Tt.prototype.listen=Tt.prototype.K,Fd=Uo,kn.prototype.listenOnce=kn.prototype.L,kn.prototype.getLastError=kn.prototype.Ka,kn.prototype.getLastErrorCode=kn.prototype.Ba,kn.prototype.getStatus=kn.prototype.Z,kn.prototype.getResponseJson=kn.prototype.Oa,kn.prototype.getResponseText=kn.prototype.oa,kn.prototype.send=kn.prototype.ea,kn.prototype.setWithCredentials=kn.prototype.Ha,FA=kn}).apply(typeof ug<"u"?ug:typeof self<"u"?self:typeof window<"u"?window:{});const HT="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yr.UNAUTHENTICATED=new Yr(null),Yr.GOOGLE_CREDENTIALS=new Yr("google-credentials-uid"),Yr.FIRST_PARTY=new Yr("first-party-uid"),Yr.MOCK_USER=new Yr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Th="11.0.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=new yb("@firebase/firestore");function Uc(){return Tu.logLevel}function je(n,...e){if(Tu.logLevel<=Nt.DEBUG){const t=e.map(Ab);Tu.debug(`Firestore (${Th}): ${n}`,...t)}}function ga(n,...e){if(Tu.logLevel<=Nt.ERROR){const t=e.map(Ab);Tu.error(`Firestore (${Th}): ${n}`,...t)}}function ah(n,...e){if(Tu.logLevel<=Nt.WARN){const t=e.map(Ab);Tu.warn(`Firestore (${Th}): ${n}`,...t)}}function Ab(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ft(n="Unexpected state"){const e=`FIRESTORE (${Th}) INTERNAL ASSERTION FAILED: `+n;throw ga(e),new Error(e)}function sn(n,e){n||ft()}function vt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xe extends Ia{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Yr.UNAUTHENTICATED))}shutdown(){}}class nU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rU{constructor(e){this.t=e,this.currentUser=Yr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){sn(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new fa;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new fa,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{je("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(je("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new fa)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(je("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(sn(typeof r.accessToken=="string"),new zA(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return sn(e===null||typeof e=="string"),new Yr(e)}}class sU{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Yr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class iU{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new sU(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Yr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aU{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){sn(this.o===void 0);const r=i=>{i.error!=null&&je("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,je("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{je("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):je("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(sn(typeof t.token=="string"),this.R=t.token,new oU(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lU(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=lU(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ft(n,e){return n<e?-1:n>e?1:0}function lh(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{static now(){return dr.fromMillis(Date.now())}static fromDate(e){return dr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new dr(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Xe(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Xe(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Xe(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xe(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ft(this.nanoseconds,e.nanoseconds):Ft(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{static fromTimestamp(e){return new mt(e)}static min(){return new mt(new dr(0,0))}static max(){return new mt(new dr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e,t,r){t===void 0?t=0:t>e.length&&ft(),r===void 0?r=e.length-t:r>e.length-t&&ft(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return tf.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof tf?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class In extends tf{construct(e,t,r){return new In(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Xe(Ee.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new In(t)}static emptyPath(){return new In([])}}const uU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fr extends tf{construct(e,t,r){return new Fr(e,t,r)}static isValidIdentifier(e){return uU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Fr(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Xe(Ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Xe(Ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Xe(Ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Xe(Ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fr(t)}static emptyPath(){return new Fr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.path=e}static fromPath(e){return new it(In.fromString(e))}static fromName(e){return new it(In.fromString(e).popFirst(5))}static empty(){return new it(In.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&In.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return In.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new it(new In(e.slice()))}}function cU(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=mt.fromTimestamp(r===1e9?new dr(t+1,0):new dr(t,r));return new yl(s,it.empty(),e)}function hU(n){return new yl(n.readTime,n.key,-1)}class yl{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new yl(mt.min(),it.empty(),-1)}static max(){return new yl(mt.max(),it.empty(),-1)}}function dU(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=it.comparator(n.documentKey,e.documentKey),t!==0?t:Ft(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pU{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _h(n){if(n.code!==Ee.FAILED_PRECONDITION||n.message!==fU)throw n;je("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ft(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Se((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Se?t:Se.resolve(t)}catch(t){return Se.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Se.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Se.reject(t)}static resolve(e){return new Se((t,r)=>{t(e)})}static reject(e){return new Se((t,r)=>{r(e)})}static waitFor(e){return new Se((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=Se.resolve(!1);for(const r of e)t=t.next(s=>s?Se.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new Se((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new Se((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function mU(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Rh(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Zy.oe=-1;function e0(n){return n==null}function oy(n){return n===0&&1/n==-1/0}function gU(n){return typeof n=="number"&&Number.isInteger(n)&&!oy(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yU(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=qT(e)),e=vU(n.get(t),e);return qT(e)}function vU(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function qT(n){return n+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Wu(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function UA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e,t){this.comparator=e,this.root=t||Pr.EMPTY}insert(e,t){return new $n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pr.BLACK,null,null))}remove(e){return new $n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cg(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cg(this.root,e,this.comparator,!1)}getReverseIterator(){return new cg(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cg(this.root,e,this.comparator,!0)}}class cg{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pr{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Pr.RED,this.left=s??Pr.EMPTY,this.right=i??Pr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Pr(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Pr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Pr.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ft();const e=this.left.check();if(e!==this.right.check())throw ft();return e+(this.isRed()?0:1)}}Pr.EMPTY=null,Pr.RED=!0,Pr.BLACK=!1;Pr.EMPTY=new class{constructor(){this.size=0}get key(){throw ft()}get value(){throw ft()}get color(){throw ft()}get left(){throw ft()}get right(){throw ft()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Pr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e){this.comparator=e,this.data=new $n(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new XT(this.data.getIterator())}getIteratorFrom(e){return new XT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof fr)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new fr(this.comparator);return t.data=e,t}}class XT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this.fields=e,e.sort(Fr.comparator)}static empty(){return new Wi([])}unionWith(e){let t=new fr(Fr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Wi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new WA("Invalid base64 string: "+i):i}}(e);return new Or(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Or(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ft(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Or.EMPTY_BYTE_STRING=new Or("");const xU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vl(n){if(sn(!!n),typeof n=="string"){let e=0;const t=xU.exec(n);if(sn(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:jn(n.seconds),nanos:jn(n.nanos)}}function jn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xl(n){return typeof n=="string"?Or.fromBase64String(n):Or.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $b(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function t0(n){const e=n.mapValue.fields.__previous_value__;return $b(e)?t0(e):e}function nf(n){const e=vl(n.mapValue.fields.__local_write_time__.timestampValue);return new dr(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wU{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class rf{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new rf("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof rf&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function wl(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$b(n)?4:IU(n)?9007199254740991:bU(n)?10:11:ft()}function Po(n,e){if(n===e)return!0;const t=wl(n);if(t!==wl(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return nf(n).isEqual(nf(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=vl(s.timestampValue),a=vl(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return xl(s.bytesValue).isEqual(xl(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return jn(s.geoPointValue.latitude)===jn(i.geoPointValue.latitude)&&jn(s.geoPointValue.longitude)===jn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return jn(s.integerValue)===jn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=jn(s.doubleValue),a=jn(i.doubleValue);return o===a?oy(o)===oy(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return lh(n.arrayValue.values||[],e.arrayValue.values||[],Po);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(KT(o)!==KT(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Po(o[l],a[l])))return!1;return!0}(n,e);default:return ft()}}function sf(n,e){return(n.values||[]).find(t=>Po(t,e))!==void 0}function uh(n,e){if(n===e)return 0;const t=wl(n),r=wl(e);if(t!==r)return Ft(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ft(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=jn(i.integerValue||i.doubleValue),l=jn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return YT(n.timestampValue,e.timestampValue);case 4:return YT(nf(n),nf(e));case 5:return Ft(n.stringValue,e.stringValue);case 6:return function(i,o){const a=xl(i),l=xl(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Ft(a[c],l[c]);if(d!==0)return d}return Ft(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ft(jn(i.latitude),jn(o.latitude));return a!==0?a:Ft(jn(i.longitude),jn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return QT(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},p=o.fields||{},g=(a=f.value)===null||a===void 0?void 0:a.arrayValue,y=(l=p.value)===null||l===void 0?void 0:l.arrayValue,w=Ft(((c=g==null?void 0:g.values)===null||c===void 0?void 0:c.length)||0,((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0);return w!==0?w:QT(g,y)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===hg.mapValue&&o===hg.mapValue)return 0;if(i===hg.mapValue)return 1;if(o===hg.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const p=Ft(l[f],d[f]);if(p!==0)return p;const g=uh(a[l[f]],c[d[f]]);if(g!==0)return g}return Ft(l.length,d.length)}(n.mapValue,e.mapValue);default:throw ft()}}function YT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ft(n,e);const t=vl(n),r=vl(e),s=Ft(t.seconds,r.seconds);return s!==0?s:Ft(t.nanos,r.nanos)}function QT(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=uh(t[s],r[s]);if(i)return i}return Ft(t.length,r.length)}function ch(n){return g1(n)}function g1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=vl(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return xl(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return it.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=g1(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${g1(t.fields[o])}`;return s+"}"}(n.mapValue):ft()}function Fg(n){switch(wl(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=t0(n);return e?16+Fg(e):16;case 5:return 2*n.stringValue.length;case 6:return xl(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Fg(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Wu(r.fields,(i,o)=>{s+=i.length+Fg(o)}),s}(n.mapValue);default:throw ft()}}function JT(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function y1(n){return!!n&&"integerValue"in n}function Db(n){return!!n&&"arrayValue"in n}function ZT(n){return!!n&&"nullValue"in n}function e_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Og(n){return!!n&&"mapValue"in n}function bU(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function qd(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Wu(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qd(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qd(n.arrayValue.values[t]);return e}return Object.assign({},n)}function IU(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e){this.value=e}static empty(){return new di({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Og(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qd(t)}setAll(e){let t=Fr.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=qd(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Og(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Po(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Og(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Wu(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new di(qd(this.value))}}function GA(n){const e=[];return Wu(n.fields,(t,r)=>{const s=new Fr([t]);if(Og(r)){const i=GA(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Wi(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Jr(e,0,mt.min(),mt.min(),mt.min(),di.empty(),0)}static newFoundDocument(e,t,r,s){return new Jr(e,1,t,mt.min(),r,s,0)}static newNoDocument(e,t){return new Jr(e,2,t,mt.min(),mt.min(),di.empty(),0)}static newUnknownDocument(e,t){return new Jr(e,3,t,mt.min(),mt.min(),di.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(mt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=di.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=di.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=mt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e,t){this.position=e,this.inclusive=t}}function t_(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=it.comparator(it.fromName(o.referenceValue),t.key):r=uh(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function n_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Po(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e,t="asc"){this.field=e,this.dir=t}}function CU(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{}class Jn extends jA{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new EU(e,t,r):t==="array-contains"?new _U(e,r):t==="in"?new RU(e,r):t==="not-in"?new NU(e,r):t==="array-contains-any"?new AU(e,r):new Jn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new kU(e,r):new TU(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(uh(t,this.value)):t!==null&&wl(this.value)===wl(t)&&this.matchesComparison(uh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ft()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xi extends jA{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Xi(e,t)}matches(e){return HA(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function HA(n){return n.op==="and"}function qA(n){return SU(n)&&HA(n)}function SU(n){for(const e of n.filters)if(e instanceof Xi)return!1;return!0}function v1(n){if(n instanceof Jn)return n.field.canonicalString()+n.op.toString()+ch(n.value);if(qA(n))return n.filters.map(e=>v1(e)).join(",");{const e=n.filters.map(t=>v1(t)).join(",");return`${n.op}(${e})`}}function KA(n,e){return n instanceof Jn?function(r,s){return s instanceof Jn&&r.op===s.op&&r.field.isEqual(s.field)&&Po(r.value,s.value)}(n,e):n instanceof Xi?function(r,s){return s instanceof Xi&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&KA(o,s.filters[a]),!0):!1}(n,e):void ft()}function XA(n){return n instanceof Jn?function(t){return`${t.field.canonicalString()} ${t.op} ${ch(t.value)}`}(n):n instanceof Xi?function(t){return t.op.toString()+" {"+t.getFilters().map(XA).join(" ,")+"}"}(n):"Filter"}class EU extends Jn{constructor(e,t,r){super(e,t,r),this.key=it.fromName(r.referenceValue)}matches(e){const t=it.comparator(e.key,this.key);return this.matchesComparison(t)}}class kU extends Jn{constructor(e,t){super(e,"in",t),this.keys=YA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class TU extends Jn{constructor(e,t){super(e,"not-in",t),this.keys=YA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function YA(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>it.fromName(r.referenceValue))}class _U extends Jn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Db(t)&&sf(t.arrayValue,this.value)}}class RU extends Jn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&sf(this.value.arrayValue,t)}}class NU extends Jn{constructor(e,t){super(e,"not-in",t)}matches(e){if(sf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!sf(this.value.arrayValue,t)}}class AU extends Jn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Db(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>sf(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function r_(n,e=null,t=[],r=[],s=null,i=null,o=null){return new $U(n,e,t,r,s,i,o)}function Pb(n){const e=vt(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>v1(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),e0(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ch(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ch(r)).join(",")),e.ue=t}return e.ue}function Fb(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!CU(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!KA(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!n_(n.startAt,e.startAt)&&n_(n.endAt,e.endAt)}function x1(n){return it.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function DU(n,e,t,r,s,i,o,a){return new Tf(n,e,t,r,s,i,o,a)}function Ob(n){return new Tf(n)}function s_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function QA(n){return n.collectionGroup!==null}function Kd(n){const e=vt(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fr(Fr.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ly(i,r))}),t.has(Fr.keyField().canonicalString())||e.ce.push(new ly(Fr.keyField(),r))}return e.ce}function Co(n){const e=vt(n);return e.le||(e.le=PU(e,Kd(n))),e.le}function PU(n,e){if(n.limitType==="F")return r_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ly(s.field,i)});const t=n.endAt?new ay(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ay(n.startAt.position,n.startAt.inclusive):null;return r_(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function w1(n,e){const t=n.filters.concat([e]);return new Tf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function b1(n,e,t){return new Tf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function n0(n,e){return Fb(Co(n),Co(e))&&n.limitType===e.limitType}function JA(n){return`${Pb(Co(n))}|lt:${n.limitType}`}function Wc(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>XA(s)).join(", ")}]`),e0(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>ch(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>ch(s)).join(",")),`Target(${r})`}(Co(n))}; limitType=${n.limitType})`}function r0(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):it.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Kd(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=t_(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Kd(r),s)||r.endAt&&!function(o,a,l){const c=t_(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Kd(r),s))}(n,e)}function FU(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ZA(n){return(e,t)=>{let r=!1;for(const s of Kd(n)){const i=OU(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function OU(n,e,t){const r=n.field.isKeyField()?it.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?uh(l,c):ft()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ft()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Wu(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return UA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LU=new $n(it.comparator);function ya(){return LU}const e2=new $n(it.comparator);function Od(...n){let e=e2;for(const t of n)e=e.insert(t.key,t);return e}function t2(n){let e=e2;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function gu(){return Xd()}function n2(){return Xd()}function Xd(){return new Gu(n=>n.toString(),(n,e)=>n.isEqual(e))}const MU=new $n(it.comparator),VU=new fr(it.comparator);function $t(...n){let e=VU;for(const t of n)e=e.add(t);return e}const zU=new fr(Ft);function BU(){return zU}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lb(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oy(e)?"-0":e}}function r2(n){return{integerValue:""+n}}function UU(n,e){return gU(e)?r2(e):Lb(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(){this._=void 0}}function WU(n,e,t){return n instanceof uy?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&$b(i)&&(i=t0(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof of?i2(n,e):n instanceof af?o2(n,e):function(s,i){const o=s2(s,i),a=i_(o)+i_(s.Pe);return y1(o)&&y1(s.Pe)?r2(a):Lb(s.serializer,a)}(n,e)}function GU(n,e,t){return n instanceof of?i2(n,e):n instanceof af?o2(n,e):t}function s2(n,e){return n instanceof cy?function(r){return y1(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class uy extends s0{}class of extends s0{constructor(e){super(),this.elements=e}}function i2(n,e){const t=a2(e);for(const r of n.elements)t.some(s=>Po(s,r))||t.push(r);return{arrayValue:{values:t}}}class af extends s0{constructor(e){super(),this.elements=e}}function o2(n,e){let t=a2(e);for(const r of n.elements)t=t.filter(s=>!Po(s,r));return{arrayValue:{values:t}}}class cy extends s0{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function i_(n){return jn(n.integerValue||n.doubleValue)}function a2(n){return Db(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function jU(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof of&&s instanceof of||r instanceof af&&s instanceof af?lh(r.elements,s.elements,Po):r instanceof cy&&s instanceof cy?Po(r.Pe,s.Pe):r instanceof uy&&s instanceof uy}(n.transform,e.transform)}class HU{constructor(e,t){this.version=e,this.transformResults=t}}class So{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new So}static exists(e){return new So(void 0,e)}static updateTime(e){return new So(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lg(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class i0{}function l2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new c2(n.key,So.none()):new _f(n.key,n.data,So.none());{const t=n.data,r=di.empty();let s=new fr(Fr.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new ju(n.key,r,new Wi(s.toArray()),So.none())}}function qU(n,e,t){n instanceof _f?function(s,i,o){const a=s.value.clone(),l=a_(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ju?function(s,i,o){if(!Lg(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=a_(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(u2(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Yd(n,e,t,r){return n instanceof _f?function(i,o,a,l){if(!Lg(i.precondition,o))return a;const c=i.value.clone(),d=l_(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof ju?function(i,o,a,l){if(!Lg(i.precondition,o))return a;const c=l_(i.fieldTransforms,l,o),d=o.data;return d.setAll(u2(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Lg(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function KU(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=s2(r.transform,s||null);i!=null&&(t===null&&(t=di.empty()),t.set(r.field,i))}return t||null}function o_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&lh(r,s,(i,o)=>jU(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _f extends i0{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ju extends i0{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function u2(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function a_(n,e,t){const r=new Map;sn(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,GU(o,a,t[s]))}return r}function l_(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,WU(i,o,e))}return r}class c2 extends i0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class XU extends i0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&qU(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yd(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=n2();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=l2(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(mt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$t())}isEqual(e){return this.batchId===e.batchId&&lh(this.mutations,e.mutations,(t,r)=>o_(t,r))&&lh(this.baseMutations,e.baseMutations,(t,r)=>o_(t,r))}}class Mb{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){sn(e.mutations.length===r.length);let s=function(){return MU}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Mb(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yn,Bt;function ZU(n){switch(n){default:return ft();case Ee.CANCELLED:case Ee.UNKNOWN:case Ee.DEADLINE_EXCEEDED:case Ee.RESOURCE_EXHAUSTED:case Ee.INTERNAL:case Ee.UNAVAILABLE:case Ee.UNAUTHENTICATED:return!1;case Ee.INVALID_ARGUMENT:case Ee.NOT_FOUND:case Ee.ALREADY_EXISTS:case Ee.PERMISSION_DENIED:case Ee.FAILED_PRECONDITION:case Ee.ABORTED:case Ee.OUT_OF_RANGE:case Ee.UNIMPLEMENTED:case Ee.DATA_LOSS:return!0}}function h2(n){if(n===void 0)return ga("GRPC error has no .code"),Ee.UNKNOWN;switch(n){case Yn.OK:return Ee.OK;case Yn.CANCELLED:return Ee.CANCELLED;case Yn.UNKNOWN:return Ee.UNKNOWN;case Yn.DEADLINE_EXCEEDED:return Ee.DEADLINE_EXCEEDED;case Yn.RESOURCE_EXHAUSTED:return Ee.RESOURCE_EXHAUSTED;case Yn.INTERNAL:return Ee.INTERNAL;case Yn.UNAVAILABLE:return Ee.UNAVAILABLE;case Yn.UNAUTHENTICATED:return Ee.UNAUTHENTICATED;case Yn.INVALID_ARGUMENT:return Ee.INVALID_ARGUMENT;case Yn.NOT_FOUND:return Ee.NOT_FOUND;case Yn.ALREADY_EXISTS:return Ee.ALREADY_EXISTS;case Yn.PERMISSION_DENIED:return Ee.PERMISSION_DENIED;case Yn.FAILED_PRECONDITION:return Ee.FAILED_PRECONDITION;case Yn.ABORTED:return Ee.ABORTED;case Yn.OUT_OF_RANGE:return Ee.OUT_OF_RANGE;case Yn.UNIMPLEMENTED:return Ee.UNIMPLEMENTED;case Yn.DATA_LOSS:return Ee.DATA_LOSS;default:return ft()}}(Bt=Yn||(Yn={}))[Bt.OK=0]="OK",Bt[Bt.CANCELLED=1]="CANCELLED",Bt[Bt.UNKNOWN=2]="UNKNOWN",Bt[Bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bt[Bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bt[Bt.NOT_FOUND=5]="NOT_FOUND",Bt[Bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bt[Bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bt[Bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bt[Bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bt[Bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bt[Bt.ABORTED=10]="ABORTED",Bt[Bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bt[Bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bt[Bt.INTERNAL=13]="INTERNAL",Bt[Bt.UNAVAILABLE=14]="UNAVAILABLE",Bt[Bt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eW(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tW=new bu([4294967295,4294967295],0);function u_(n){const e=eW().encode(n),t=new PA;return t.update(e),new Uint8Array(t.digest())}function c_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new bu([t,r],0),new bu([s,i],0)]}class Vb{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ld(`Invalid padding: ${t}`);if(r<0)throw new Ld(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ld(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ld(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=bu.fromNumber(this.Te)}Ee(e,t,r){let s=e.add(t.multiply(bu.fromNumber(r)));return s.compare(tW)===1&&(s=new bu([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ie).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=u_(e),[r,s]=c_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vb(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const t=u_(e),[r,s]=c_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ld extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Rf.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new o0(mt.min(),s,new $n(Ft),ya(),$t())}}class Rf{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Rf(r,t,$t(),$t(),$t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class d2{constructor(e,t){this.targetId=e,this.me=t}}class f2{constructor(e,t,r=Or.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class h_{constructor(){this.fe=0,this.ge=d_(),this.pe=Or.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=$t(),t=$t(),r=$t();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ft()}}),new Rf(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=d_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,sn(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class nW{constructor(e){this.Le=e,this.Be=new Map,this.ke=ya(),this.qe=dg(),this.Qe=dg(),this.Ke=new $n(Ft)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.je(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.De(e.resumeToken));break;default:ft()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.je(s)&&t(s)})}Je(e){const t=e.targetId,r=e.me.count,s=this.Ye(t);if(s){const i=s.target;if(x1(i))if(r===0){const o=new it(i.path);this.We(t,o,Jr.newNoDocument(o,mt.min()))}else sn(r===1);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),l=a?this.et(a,e,o):1;if(l!==0){this.He(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=xl(r).toUint8Array()}catch(l){if(l instanceof WA)return ah("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vb(o,s,i)}catch(l){return ah(l instanceof Ld?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Te===0?null:a}et(e,t,r){return t.me.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.We(t,i,null),s++)}),s}it(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Ye(o);if(a){if(i.current&&x1(a.target)){const l=new it(a.target.path);this.st(l).has(o)||this.ot(o,l)||this.We(o,l,Jr.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=$t();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Ye(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new o0(e,t,this.Ke,this.ke,r);return this.ke=ya(),this.qe=dg(),this.Qe=dg(),this.Ke=new $n(Ft),s}Ue(e,t){if(!this.je(e))return;const r=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const s=this.ze(e);this.ot(e,t)?s.Fe(t,1):s.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Be.get(e);return t||(t=new h_,this.Be.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new fr(Ft),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new fr(Ft),this.qe=this.qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||je("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new h_),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function dg(){return new $n(it.comparator)}function d_(){return new $n(it.comparator)}const rW={asc:"ASCENDING",desc:"DESCENDING"},sW={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iW={and:"AND",or:"OR"};class oW{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function I1(n,e){return n.useProto3Json||e0(e)?e:{value:e}}function hy(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function p2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function aW(n,e){return hy(n,e.toTimestamp())}function Eo(n){return sn(!!n),mt.fromTimestamp(function(t){const r=vl(t);return new dr(r.seconds,r.nanos)}(n))}function zb(n,e){return C1(n,e).canonicalString()}function C1(n,e){const t=function(s){return new In(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function m2(n){const e=In.fromString(n);return sn(w2(e)),e}function S1(n,e){return zb(n.databaseId,e.path)}function $w(n,e){const t=m2(e);if(t.get(1)!==n.databaseId.projectId)throw new Xe(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Xe(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new it(y2(t))}function g2(n,e){return zb(n.databaseId,e)}function lW(n){const e=m2(n);return e.length===4?In.emptyPath():y2(e)}function E1(n){return new In(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function y2(n){return sn(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function f_(n,e,t){return{name:S1(n,e),fields:t.value.mapValue.fields}}function uW(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ft()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(sn(d===void 0||typeof d=="string"),Or.fromBase64String(d||"")):(sn(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Or.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?Ee.UNKNOWN:h2(c.code);return new Xe(d,c.message||"")}(o);t=new f2(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=$w(n,r.document.name),i=Eo(r.document.updateTime),o=r.document.createTime?Eo(r.document.createTime):mt.min(),a=new di({mapValue:{fields:r.document.fields}}),l=Jr.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Mg(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=$w(n,r.document),i=r.readTime?Eo(r.readTime):mt.min(),o=Jr.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Mg([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=$w(n,r.document),i=r.removedTargetIds||[];t=new Mg([],i,s,null)}else{if(!("filter"in e))return ft();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new JU(s,i),a=r.targetId;t=new d2(a,o)}}return t}function cW(n,e){let t;if(e instanceof _f)t={update:f_(n,e.key,e.value)};else if(e instanceof c2)t={delete:S1(n,e.key)};else if(e instanceof ju)t={update:f_(n,e.key,e.data),updateMask:xW(e.fieldMask)};else{if(!(e instanceof XU))return ft();t={verify:S1(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof uy)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof of)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof af)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof cy)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ft()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:aW(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ft()}(n,e.precondition)),t}function hW(n,e){return n&&n.length>0?(sn(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Eo(s.updateTime):Eo(i);return o.isEqual(mt.min())&&(o=Eo(i)),new HU(o,s.transformResults||[])}(t,e))):[]}function dW(n,e){return{documents:[g2(n,e.path)]}}function fW(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=g2(n,s);const i=function(c){if(c.length!==0)return x2(Xi.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(p){return{field:Gc(p.field),direction:gW(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=I1(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ct:t,parent:s}}function pW(n){let e=lW(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){sn(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const p=v2(f);return p instanceof Xi&&qA(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(y){return new ly(jc(y.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,e0(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,g=f.values||[];return new ay(g,p)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const p=!f.before,g=f.values||[];return new ay(g,p)}(t.endAt)),DU(e,s,o,i,a,"F",l,c)}function mW(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ft()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function v2(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=jc(t.unaryFilter.field);return Jn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=jc(t.unaryFilter.field);return Jn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=jc(t.unaryFilter.field);return Jn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=jc(t.unaryFilter.field);return Jn.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ft()}}(n):n.fieldFilter!==void 0?function(t){return Jn.create(jc(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ft()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Xi.create(t.compositeFilter.filters.map(r=>v2(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ft()}}(t.compositeFilter.op))}(n):ft()}function gW(n){return rW[n]}function yW(n){return sW[n]}function vW(n){return iW[n]}function Gc(n){return{fieldPath:n.canonicalString()}}function jc(n){return Fr.fromServerFormat(n.fieldPath)}function x2(n){return n instanceof Jn?function(t){if(t.op==="=="){if(e_(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NAN"}};if(ZT(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(e_(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NAN"}};if(ZT(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gc(t.field),op:yW(t.op),value:t.value}}}(n):n instanceof Xi?function(t){const r=t.getFilters().map(s=>x2(s));return r.length===1?r[0]:{compositeFilter:{op:vW(t.op),filters:r}}}(n):ft()}function xW(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function w2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,t,r,s,i=mt.min(),o=mt.min(),a=Or.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new il(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wW{constructor(e){this.ht=e}}function bW(n){const e=pW({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?b1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IW{constructor(){this.ln=new CW}addToCollectionParentIndex(e,t){return this.ln.add(t),Se.resolve()}getCollectionParents(e,t){return Se.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return Se.resolve()}deleteFieldIndex(e,t){return Se.resolve()}deleteAllFieldIndexes(e){return Se.resolve()}createTargetIndexes(e,t){return Se.resolve()}getDocumentsMatchingTarget(e,t){return Se.resolve(null)}getIndexType(e,t){return Se.resolve(0)}getFieldIndexes(e,t){return Se.resolve([])}getNextCollectionGroupToUpdate(e){return Se.resolve(null)}getMinOffset(e,t){return Se.resolve(yl.min())}getMinOffsetFromCollectionGroup(e,t){return Se.resolve(yl.min())}updateCollectionGroup(e,t,r){return Se.resolve()}updateIndexEntries(e,t){return Se.resolve()}}class CW{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new fr(In.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new fr(In.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Rs{static withCacheSize(e){return new Rs(e,Rs.DEFAULT_COLLECTION_PERCENTILE,Rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rs.DEFAULT_COLLECTION_PERCENTILE=10,Rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rs.DEFAULT=new Rs(41943040,Rs.DEFAULT_COLLECTION_PERCENTILE,Rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rs.DISABLED=new Rs(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new hh(0)}static Qn(){return new hh(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m_([n,e],[t,r]){const s=Ft(n,t);return s===0?Ft(e,r):s}class SW{constructor(e){this.Gn=e,this.buffer=new fr(m_),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();m_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class EW{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){je("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Rh(t)?je("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await _h(t)}await this.Yn(3e5)})}}class kW{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return Se.resolve(Zy.oe);const r=new SW(t);return this.Zn.forEachTarget(e,s=>r.Hn(s.sequenceNumber)).next(()=>this.Zn.er(e,s=>r.Hn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(je("LruGarbageCollector","Garbage collection skipped; disabled"),Se.resolve(p_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(je("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),p_):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(je("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Uc()<=Nt.DEBUG&&je("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),Se.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function TW(n,e){return new kW(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _W{constructor(){this.changes=new Gu(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?Se.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RW{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NW{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Yd(r.mutation,s,Wi.empty(),dr.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,$t()).next(()=>r))}getLocalViewOfDocuments(e,t,r=$t()){const s=gu();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Od();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=gu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,$t()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=ya();const o=Xd(),a=function(){return Xd()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof ju)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Yd(d.mutation,c,d.mutation.getFieldMask(),dr.now())):o.set(c.key,Wi.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new RW(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Xd();let s=new $n((o,a)=>o-a),i=$t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||Wi.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||$t()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=n2();d.forEach(p=>{if(!i.has(p)){const g=l2(t.get(p),r.get(p));g!==null&&f.set(p,g),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return Se.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return it.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):QA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):Se.resolve(gu());let a=-1,l=i;return o.next(c=>Se.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?Se.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{l=l.insert(d,p)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,$t())).next(d=>({batchId:a,changes:t2(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new it(t)).next(r=>{let s=Od();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Od();return this.indexManager.getCollectionParents(e,i).next(a=>Se.forEach(a,l=>{const c=function(f,p){return new Tf(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Jr.newInvalidDocument(d)))});let a=Od();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Yd(d.mutation,c,Wi.empty(),dr.now()),r0(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AW{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return Se.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Eo(s.createTime)}}(t)),Se.resolve()}getNamedQuery(e,t){return Se.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(s){return{name:s.name,query:bW(s.bundledQuery),readTime:Eo(s.readTime)}}(t)),Se.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $W{constructor(){this.overlays=new $n(it.comparator),this.Er=new Map}getOverlay(e,t){return Se.resolve(this.overlays.get(t))}getOverlays(e,t){const r=gu();return Se.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.Tt(e,t,i)}),Se.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Er.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Er.delete(r)),Se.resolve()}getOverlaysForCollection(e,t,r){const s=gu(),i=t.length+1,o=new it(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return Se.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new $n((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=gu(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=gu(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return Se.resolve(a)}Tt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Er.get(s.largestBatchId).delete(r.key);this.Er.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new QU(t,r));let i=this.Er.get(t);i===void 0&&(i=$t(),this.Er.set(t,i)),this.Er.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DW{constructor(){this.sessionToken=Or.EMPTY_BYTE_STRING}getSessionToken(e){return Se.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Se.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(){this.dr=new fr(wr.Ar),this.Rr=new fr(wr.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,t){const r=new wr(e,t);this.dr=this.dr.add(r),this.Rr=this.Rr.add(r)}mr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.gr(new wr(e,t))}pr(e,t){e.forEach(r=>this.removeReference(r,t))}yr(e){const t=new it(new In([])),r=new wr(t,e),s=new wr(t,e+1),i=[];return this.Rr.forEachInRange([r,s],o=>{this.gr(o),i.push(o.key)}),i}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new it(new In([])),r=new wr(t,e),s=new wr(t,e+1);let i=$t();return this.Rr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new wr(e,0),r=this.dr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class wr{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return it.comparator(e.key,t.key)||Ft(e.br,t.br)}static Vr(e,t){return Ft(e.br,t.br)||it.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PW{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new fr(wr.Ar)}checkEmpty(e){return Se.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new YU(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.vr=this.vr.add(new wr(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Se.resolve(o)}lookupMutationBatch(e,t){return Se.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Fr(r),i=s<0?0:s;return Se.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Se.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return Se.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new wr(t,0),s=new wr(t,Number.POSITIVE_INFINITY),i=[];return this.vr.forEachInRange([r,s],o=>{const a=this.Cr(o.br);i.push(a)}),Se.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fr(Ft);return t.forEach(s=>{const i=new wr(s,0),o=new wr(s,Number.POSITIVE_INFINITY);this.vr.forEachInRange([i,o],a=>{r=r.add(a.br)})}),Se.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;it.isDocumentKey(i)||(i=i.child(""));const o=new wr(new it(i),0);let a=new fr(Ft);return this.vr.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.br)),!0)},o),Se.resolve(this.Mr(a))}Mr(e){const t=[];return e.forEach(r=>{const s=this.Cr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){sn(this.Or(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return Se.forEach(t.mutations,s=>{const i=new wr(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.vr=r})}Ln(e){}containsKey(e,t){const r=new wr(t,0),s=this.vr.firstAfterOrEqual(r);return Se.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Se.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FW{constructor(e){this.Nr=e,this.docs=function(){return new $n(it.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Nr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return Se.resolve(r?r.document.mutableCopy():Jr.newInvalidDocument(t))}getEntries(e,t){let r=ya();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Jr.newInvalidDocument(s))}),Se.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ya();const o=t.path,a=new it(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||dU(hU(d),r)<=0||(s.has(d.key)||r0(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return Se.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ft()}Lr(e,t){return Se.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new OW(this)}getSize(e){return Se.resolve(this.size)}}class OW extends _W{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.hr.addEntry(e,s)):this.hr.removeEntry(r)}),Se.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LW{constructor(e){this.persistence=e,this.Br=new Gu(t=>Pb(t),Fb),this.lastRemoteSnapshotVersion=mt.min(),this.highestTargetId=0,this.kr=0,this.qr=new Bb,this.targetCount=0,this.Qr=hh.qn()}forEachTarget(e,t){return this.Br.forEach((r,s)=>t(s)),Se.resolve()}getLastRemoteSnapshotVersion(e){return Se.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Se.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),Se.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.kr&&(this.kr=t),Se.resolve()}Un(e){this.Br.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new hh(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,Se.resolve()}updateTargetData(e,t){return this.Un(t),Se.resolve()}removeTargetData(e,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,Se.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Br.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Br.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),Se.waitFor(i).next(()=>s)}getTargetCount(e){return Se.resolve(this.targetCount)}getTargetData(e,t){const r=this.Br.get(t)||null;return Se.resolve(r)}addMatchingKeys(e,t,r){return this.qr.mr(t,r),Se.resolve()}removeMatchingKeys(e,t,r){this.qr.pr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),Se.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),Se.resolve()}getMatchingKeysForTargetId(e,t){const r=this.qr.Sr(t);return Se.resolve(r)}containsKey(e,t){return Se.resolve(this.qr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2{constructor(e,t){this.Kr={},this.overlays={},this.$r=new Zy(0),this.Ur=!1,this.Ur=!0,this.Wr=new DW,this.referenceDelegate=e(this),this.Gr=new LW(this),this.indexManager=new IW,this.remoteDocumentCache=function(s){return new FW(s)}(r=>this.referenceDelegate.zr(r)),this.serializer=new wW(t),this.jr=new AW(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $W,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Kr[e.toKey()];return r||(r=new PW(t,this.referenceDelegate),this.Kr[e.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,r){je("MemoryPersistence","Starting transaction:",e);const s=new MW(this.$r.next());return this.referenceDelegate.Hr(),r(s).next(i=>this.referenceDelegate.Jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Yr(e,t){return Se.or(Object.values(this.Kr).map(r=>()=>r.containsKey(e,t)))}}class MW extends pU{constructor(e){super(),this.currentSequenceNumber=e}}class Ub{constructor(e){this.persistence=e,this.Zr=new Bb,this.Xr=null}static ei(e){return new Ub(e)}get ti(){if(this.Xr)return this.Xr;throw ft()}addReference(e,t,r){return this.Zr.addReference(r,t),this.ti.delete(r.toString()),Se.resolve()}removeReference(e,t,r){return this.Zr.removeReference(r,t),this.ti.add(r.toString()),Se.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),Se.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(s=>this.ti.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.ti.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Se.forEach(this.ti,r=>{const s=it.fromPath(r);return this.ni(e,s).next(i=>{i||t.removeEntry(s,mt.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(r=>{r?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return Se.or([()=>Se.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class dy{constructor(e,t){this.persistence=e,this.ri=new Gu(r=>yU(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=TW(this,t)}static ei(e,t){return new dy(e,t)}Hr(){}Jr(e){return Se.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}nr(e){let t=0;return this.er(e,r=>{t++}).next(()=>t)}er(e,t){return Se.forEach(this.ri,(r,s)=>this.ir(e,r,s).next(i=>i?Se.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Lr(e,o=>this.ir(e,o,t).next(a=>{a||(r++,i.removeEntry(o,mt.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),Se.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),Se.resolve()}removeReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),Se.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),Se.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Fg(e.data.value)),t}ir(e,t,r){return Se.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ri.get(t);return Se.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Wi=r,this.Gi=s}static zi(e,t){let r=$t(),s=$t();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Wb(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zW{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return M3()?8:mU(ns())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Xi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.es(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new VW;return this.ts(e,t,o).next(a=>{if(i.result=a,this.Hi)return this.ns(e,t,o,a.size)})}).next(()=>i.result)}ns(e,t,r,s){return r.documentReadCount<this.Ji?(Uc()<=Nt.DEBUG&&je("QueryEngine","SDK will not create cache indexes for query:",Wc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),Se.resolve()):(Uc()<=Nt.DEBUG&&je("QueryEngine","Query:",Wc(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Yi*s?(Uc()<=Nt.DEBUG&&je("QueryEngine","The SDK decides to create cache indexes for query:",Wc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Co(t))):Se.resolve())}Xi(e,t){if(s_(t))return Se.resolve(null);let r=Co(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=b1(t,null,"F"),r=Co(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=$t(...i);return this.Zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.rs(t,a);return this.ss(t,c,o,l.readTime)?this.Xi(e,b1(t,null,"F")):this.os(e,c,t,l)}))})))}es(e,t,r,s){return s_(t)||s.isEqual(mt.min())?Se.resolve(null):this.Zi.getDocuments(e,r).next(i=>{const o=this.rs(t,i);return this.ss(t,o,r,s)?Se.resolve(null):(Uc()<=Nt.DEBUG&&je("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wc(t)),this.os(e,o,t,cU(s,-1)).next(a=>a))})}rs(e,t){let r=new fr(ZA(e));return t.forEach((s,i)=>{r0(e,i)&&(r=r.add(i))}),r}ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ts(e,t,r){return Uc()<=Nt.DEBUG&&je("QueryEngine","Using full collection scan to execute query:",Wc(t)),this.Zi.getDocumentsMatchingQuery(e,t,yl.min(),r)}os(e,t,r,s){return this.Zi.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BW{constructor(e,t,r,s){this.persistence=e,this._s=t,this.serializer=s,this.us=new $n(Ft),this.cs=new Gu(i=>Pb(i),Fb),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(r)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new NW(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function UW(n,e,t,r){return new BW(n,e,t,r)}async function I2(n,e){const t=vt(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Ps(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=$t();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({Ts:c,removedBatchIds:o,addedBatchIds:a}))})})}function WW(n,e){const t=vt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.hs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,p=f.keys();let g=Se.resolve();return p.forEach(y=>{g=g.next(()=>d.getEntry(l,y)).next(w=>{const x=c.docVersions.get(y);sn(x!==null),w.version.compareTo(x)<0&&(f.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),d.addEntry(w)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=$t();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function C2(n){const e=vt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function GW(n,e){const t=vt(n),r=e.snapshotVersion;let s=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.hs.newChangeBuffer({trackRemovals:!0});s=t.us;const a=[];e.targetChanges.forEach((d,f)=>{const p=s.get(f);if(!p)return;a.push(t.Gr.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Gr.addMatchingKeys(i,d.addedDocuments,f)));let g=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(Or.EMPTY_BYTE_STRING,mt.min()).withLastLimboFreeSnapshotVersion(mt.min()):d.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(d.resumeToken,r)),s=s.insert(f,g),function(w,x,I){return w.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(p,g,d)&&a.push(t.Gr.updateTargetData(i,g))});let l=ya(),c=$t();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(jW(i,o,e.documentUpdates).next(d=>{l=d.Is,c=d.Es})),!r.isEqual(mt.min())){const d=t.Gr.getLastRemoteSnapshotVersion(i).next(f=>t.Gr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return Se.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.us=s,i))}function jW(n,e,t){let r=$t(),s=$t();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=ya();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(mt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):je("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Is:o,Es:s}})}function HW(n,e){const t=vt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function qW(n,e){const t=vt(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Gr.getTargetData(r,e).next(i=>i?(s=i,Se.resolve(s)):t.Gr.allocateTargetId(r).next(o=>(s=new il(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Gr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.us.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.us=t.us.insert(r.targetId,r),t.cs.set(e,r.targetId)),r})}async function k1(n,e,t){const r=vt(n),s=r.us.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Rh(o))throw o;je("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.us=r.us.remove(e),r.cs.delete(s.target)}function g_(n,e,t){const r=vt(n);let s=mt.min(),i=$t();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=vt(l),p=f.cs.get(d);return p!==void 0?Se.resolve(f.us.get(p)):f.Gr.getTargetData(c,d)}(r,o,Co(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r._s.getDocumentsMatchingQuery(o,e,t?s:mt.min(),t?i:$t())).next(a=>(KW(r,FU(e),a),{documents:a,ds:i})))}function KW(n,e,t){let r=n.ls.get(e)||mt.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.ls.set(e,r)}class y_{constructor(){this.activeTargetIds=BU()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class XW{constructor(){this._o=new y_,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,r){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new y_,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YW{uo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){je("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){je("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fg=null;function Dw(){return fg===null?fg=function(){return 268435456+Math.round(2147483648*Math.random())}():fg++,"0x"+fg.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QW={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JW{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xr="WebChannelConnection";class ZW extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+t.host,this.Mo=`projects/${s}/databases/${i}`,this.xo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Oo(t,r,s,i,o){const a=Dw(),l=this.No(t,r.toUriEncodedString());je("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(c,i,o),this.Bo(t,l,c,s).then(d=>(je("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw ah("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}ko(t,r,s,i,o,a){return this.Oo(t,r,s,i,o)}Lo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Th}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}No(t,r){const s=QW[t];return`${this.Fo}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,t,r,s){const i=Dw();return new Promise((o,a)=>{const l=new FA;l.setWithCredentials(!0),l.listenOnce(OA.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Pg.NO_ERROR:const d=l.getResponseJson();je(Xr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Pg.TIMEOUT:je(Xr,`RPC '${e}' ${i} timed out`),a(new Xe(Ee.DEADLINE_EXCEEDED,"Request time out"));break;case Pg.HTTP_ERROR:const f=l.getStatus();if(je(Xr,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let p=l.getResponseJson();Array.isArray(p)&&(p=p[0]);const g=p==null?void 0:p.error;if(g&&g.status&&g.message){const y=function(x){const I=x.toLowerCase().replace(/_/g,"-");return Object.values(Ee).indexOf(I)>=0?I:Ee.UNKNOWN}(g.status);a(new Xe(y,g.message))}else a(new Xe(Ee.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Xe(Ee.UNAVAILABLE,"Connection failed."));break;default:ft()}}finally{je(Xr,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);je(Xr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}qo(e,t,r){const s=Dw(),i=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=VA(),a=MA(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Lo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");je(Xr,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let p=!1,g=!1;const y=new JW({Eo:x=>{g?je(Xr,`Not sending because RPC '${e}' stream ${s} is closed:`,x):(p||(je(Xr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),je(Xr,`RPC '${e}' stream ${s} sending:`,x),f.send(x))},Ao:()=>f.close()}),w=(x,I,C)=>{x.listen(I,k=>{try{C(k)}catch(E){setTimeout(()=>{throw E},0)}})};return w(f,Fd.EventType.OPEN,()=>{g||(je(Xr,`RPC '${e}' stream ${s} transport opened.`),y.So())}),w(f,Fd.EventType.CLOSE,()=>{g||(g=!0,je(Xr,`RPC '${e}' stream ${s} transport closed`),y.Do())}),w(f,Fd.EventType.ERROR,x=>{g||(g=!0,ah(Xr,`RPC '${e}' stream ${s} transport errored:`,x),y.Do(new Xe(Ee.UNAVAILABLE,"The operation could not be completed")))}),w(f,Fd.EventType.MESSAGE,x=>{var I;if(!g){const C=x.data[0];sn(!!C);const k=C,E=(k==null?void 0:k.error)||((I=k[0])===null||I===void 0?void 0:I.error);if(E){je(Xr,`RPC '${e}' stream ${s} received error:`,E);const _=E.status;let L=function($){const D=Yn[$];if(D!==void 0)return h2(D)}(_),P=E.message;L===void 0&&(L=Ee.INTERNAL,P="Unknown error status: "+_+" with message "+E.message),g=!0,y.Do(new Xe(L,P)),f.close()}else je(Xr,`RPC '${e}' stream ${s} received:`,C),y.vo(C)}}),w(a,LA.STAT_EVENT,x=>{x.stat===m1.PROXY?je(Xr,`RPC '${e}' stream ${s} detected buffering proxy`):x.stat===m1.NOPROXY&&je(Xr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.bo()},0),y}}function Pw(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a0(n){return new oW(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S2{constructor(e,t,r=1e3,s=1.5,i=6e4){this.li=e,this.timerId=t,this.Qo=r,this.Ko=s,this.$o=i,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),s=Math.max(0,t-r);s>0&&je("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,s,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,t,r,s,i,o,a,l){this.li=e,this.Yo=r,this.Zo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new S2(e,t)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,t){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():t&&t.code===Ee.RESOURCE_EXHAUSTED?(ga(t.toString()),ga("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===Ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(t)}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Xo===t&&this.I_(r,s)},r=>{e(()=>{const s=new Xe(Ee.UNKNOWN,"Fetching auth token failed: "+r.message);return this.E_(s)})})}I_(e,t){const r=this.T_(this.Xo);this.stream=this.d_(e,t),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(s=>{r(()=>this.E_(s))}),this.stream.onMessage(s=>{r(()=>++this.n_==1?this.A_(s):this.onNext(s))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}E_(e){return je("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(je("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class eG extends E2{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}d_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=uW(this.serializer,e),r=function(i){if(!("targetChange"in i))return mt.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?mt.min():o.readTime?Eo(o.readTime):mt.min()}(e);return this.listener.R_(t,r)}V_(e){const t={};t.database=E1(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=x1(l)?{documents:dW(i,l)}:{query:fW(i,l).ct},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=p2(i,o.resumeToken);const c=I1(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(mt.min())>0){a.readTime=hy(i,o.snapshotVersion.toTimestamp());const c=I1(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=mW(this.serializer,e);r&&(t.labels=r),this.c_(t)}m_(e){const t={};t.database=E1(this.serializer),t.removeTarget=e,this.c_(t)}}class tG extends E2{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,t){return this.connection.qo("Write",e,t)}A_(e){return sn(!!e.streamToken),this.lastStreamToken=e.streamToken,sn(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){sn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=hW(e.writeResults,e.commitTime),r=Eo(e.commitTime);return this.listener.y_(r,t)}w_(){const e={};e.database=E1(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>cW(this.serializer,r))};this.c_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nG extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.S_=!1}b_(){if(this.S_)throw new Xe(Ee.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,r,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Oo(e,C1(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Xe(Ee.UNKNOWN,i.toString())})}ko(e,t,r,s,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.ko(e,C1(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Xe(Ee.UNKNOWN,o.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class rG{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(ga(t),this.C_=!1):je("OnlineStateTracker",t)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sG{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=i,this.Q_.uo(o=>{r.enqueueAndForget(async()=>{Hu(this)&&(je("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=vt(l);c.k_.add(4),await Nf(c),c.K_.set("Unknown"),c.k_.delete(4),await l0(c)}(this))})}),this.K_=new rG(r,s)}}async function l0(n){if(Hu(n))for(const e of n.q_)await e(!0)}async function Nf(n){for(const e of n.q_)await e(!1)}function k2(n,e){const t=vt(n);t.B_.has(e.targetId)||(t.B_.set(e.targetId,e),qb(t)?Hb(t):Nh(t).s_()&&jb(t,e))}function Gb(n,e){const t=vt(n),r=Nh(t);t.B_.delete(e),r.s_()&&T2(t,e),t.B_.size===0&&(r.s_()?r.a_():Hu(t)&&t.K_.set("Unknown"))}function jb(n,e){if(n.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(mt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Nh(n).V_(e)}function T2(n,e){n.U_.xe(e),Nh(n).m_(e)}function Hb(n){n.U_=new nW({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.B_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Nh(n).start(),n.K_.F_()}function qb(n){return Hu(n)&&!Nh(n).i_()&&n.B_.size>0}function Hu(n){return vt(n).k_.size===0}function _2(n){n.U_=void 0}async function iG(n){n.K_.set("Online")}async function oG(n){n.B_.forEach((e,t)=>{jb(n,e)})}async function aG(n,e){_2(n),qb(n)?(n.K_.O_(e),Hb(n)):n.K_.set("Unknown")}async function lG(n,e,t){if(n.K_.set("Online"),e instanceof f2&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.B_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.B_.delete(a),s.U_.removeTarget(a))}(n,e)}catch(r){je("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await fy(n,r)}else if(e instanceof Mg?n.U_.$e(e):e instanceof d2?n.U_.Je(e):n.U_.Ge(e),!t.isEqual(mt.min()))try{const r=await C2(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.U_.it(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.B_.get(c);d&&i.B_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.B_.get(l);if(!d)return;i.B_.set(l,d.withResumeToken(Or.EMPTY_BYTE_STRING,d.snapshotVersion)),T2(i,l);const f=new il(d.target,l,c,d.sequenceNumber);jb(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){je("RemoteStore","Failed to raise snapshot:",r),await fy(n,r)}}async function fy(n,e,t){if(!Rh(e))throw e;n.k_.add(1),await Nf(n),n.K_.set("Offline"),t||(t=()=>C2(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{je("RemoteStore","Retrying IndexedDB access"),await t(),n.k_.delete(1),await l0(n)})}function R2(n,e){return e().catch(t=>fy(n,t,e))}async function u0(n){const e=vt(n),t=bl(e);let r=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;uG(e);)try{const s=await HW(e.localStore,r);if(s===null){e.L_.length===0&&t.a_();break}r=s.batchId,cG(e,s)}catch(s){await fy(e,s)}N2(e)&&A2(e)}function uG(n){return Hu(n)&&n.L_.length<10}function cG(n,e){n.L_.push(e);const t=bl(n);t.s_()&&t.f_&&t.g_(e.mutations)}function N2(n){return Hu(n)&&!bl(n).i_()&&n.L_.length>0}function A2(n){bl(n).start()}async function hG(n){bl(n).w_()}async function dG(n){const e=bl(n);for(const t of n.L_)e.g_(t.mutations)}async function fG(n,e,t){const r=n.L_.shift(),s=Mb.from(r,e,t);await R2(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await u0(n)}async function pG(n,e){e&&bl(n).f_&&await async function(r,s){if(function(o){return ZU(o)&&o!==Ee.ABORTED}(s.code)){const i=r.L_.shift();bl(r).__(),await R2(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await u0(r)}}(n,e),N2(n)&&A2(n)}async function x_(n,e){const t=vt(n);t.asyncQueue.verifyOperationInProgress(),je("RemoteStore","RemoteStore received new credentials");const r=Hu(t);t.k_.add(3),await Nf(t),r&&t.K_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),await l0(t)}async function mG(n,e){const t=vt(n);e?(t.k_.delete(2),await l0(t)):e||(t.k_.add(2),await Nf(t),t.K_.set("Unknown"))}function Nh(n){return n.W_||(n.W_=function(t,r,s){const i=vt(t);return i.b_(),new eG(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Ro:iG.bind(null,n),mo:oG.bind(null,n),po:aG.bind(null,n),R_:lG.bind(null,n)}),n.q_.push(async e=>{e?(n.W_.__(),qb(n)?Hb(n):n.K_.set("Unknown")):(await n.W_.stop(),_2(n))})),n.W_}function bl(n){return n.G_||(n.G_=function(t,r,s){const i=vt(t);return i.b_(),new tG(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:hG.bind(null,n),po:pG.bind(null,n),p_:dG.bind(null,n),y_:fG.bind(null,n)}),n.q_.push(async e=>{e?(n.G_.__(),await u0(n)):(await n.G_.stop(),n.L_.length>0&&(je("RemoteStore",`Stopping write stream with ${n.L_.length} pending writes`),n.L_=[]))})),n.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new fa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Kb(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xe(Ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xb(n,e){if(ga("AsyncQueue",`${e}: ${n}`),Rh(n))return new Xe(Ee.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{static emptySet(e){return new Jc(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||it.comparator(t.key,r.key):(t,r)=>it.comparator(t.key,r.key),this.keyedMap=Od(),this.sortedSet=new $n(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Jc;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(){this.z_=new $n(it.comparator)}track(e){const t=e.doc.key,r=this.z_.get(t);r?e.type!==0&&r.type===3?this.z_=this.z_.insert(t,e):e.type===3&&r.type!==1?this.z_=this.z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.z_=this.z_.remove(t):e.type===1&&r.type===2?this.z_=this.z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):ft():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class dh{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new dh(e,t,Jc.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&n0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gG{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class yG{constructor(){this.queries=b_(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(t,r){const s=vt(t),i=s.queries;s.queries=b_(),i.forEach((o,a)=>{for(const l of a.J_)l.onError(r)})})(this,new Xe(Ee.ABORTED,"Firestore shutting down"))}}function b_(){return new Gu(n=>JA(n),n0)}async function $2(n,e){const t=vt(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Y_()&&e.Z_()&&(r=2):(i=new gG,r=e.Z_()?0:1);try{switch(r){case 0:i.H_=await t.onListen(s,!0);break;case 1:i.H_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Xb(o,`Initialization of query '${Wc(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.J_.push(e),e.ea(t.onlineState),i.H_&&e.ta(i.H_)&&Yb(t)}async function D2(n,e){const t=vt(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.J_.indexOf(e);o>=0&&(i.J_.splice(o,1),i.J_.length===0?s=e.Z_()?0:1:!i.Y_()&&e.Z_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function vG(n,e){const t=vt(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.J_)a.ta(s)&&(r=!0);o.H_=s}}r&&Yb(t)}function xG(n,e,t){const r=vt(n),s=r.queries.get(e);if(s)for(const i of s.J_)i.onError(t);r.queries.delete(e)}function Yb(n){n.X_.forEach(e=>{e.next()})}var T1,I_;(I_=T1||(T1={})).na="default",I_.Cache="cache";class P2{constructor(e,t,r){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new dh(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){if(!e.fromCache||!this.Z_())return!0;const r=t!=="Offline";return(!this.options.ua||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}oa(e){if(e.docChanges.length>0)return!0;const t=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}aa(e){e=dh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==T1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(e){this.key=e}}class O2{constructor(e){this.key=e}}class wG{constructor(e,t){this.query=e,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=$t(),this.mutatedKeys=$t(),this.Va=ZA(e),this.ma=new Jc(this.Va)}get fa(){return this.da}ga(e,t){const r=t?t.pa:new w_,s=t?t.ma:this.ma;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const p=s.get(d),g=r0(this.query,f)?f:null,y=!!p&&this.mutatedKeys.has(p.key),w=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let x=!1;p&&g?p.data.isEqual(g.data)?y!==w&&(r.track({type:3,doc:g}),x=!0):this.ya(p,g)||(r.track({type:2,doc:g}),x=!0,(l&&this.Va(g,l)>0||c&&this.Va(g,c)<0)&&(a=!0)):!p&&g?(r.track({type:0,doc:g}),x=!0):p&&!g&&(r.track({type:1,doc:p}),x=!0,(l||c)&&(a=!0)),x&&(g?(o=o.add(g),i=w?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{ma:o,pa:r,ss:a,mutatedKeys:i}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const o=e.pa.j_();o.sort((d,f)=>function(g,y){const w=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ft()}};return w(g)-w(y)}(d.type,f.type)||this.Va(d.doc,f.doc)),this.wa(r),s=s!=null&&s;const a=t&&!s?this.Sa():[],l=this.Ra.size===0&&this.current&&!s?1:0,c=l!==this.Aa;return this.Aa=l,o.length!==0||c?{snapshot:new dh(this.query,e.ma,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new w_,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.da=this.da.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.da=this.da.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=$t(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});const t=[];return e.forEach(r=>{this.Ra.has(r)||t.push(new O2(r))}),this.Ra.forEach(r=>{e.has(r)||t.push(new F2(r))}),t}va(e){this.da=e.ds,this.Ra=$t();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return dh.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class bG{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class IG{constructor(e){this.key=e,this.Fa=!1}}class CG{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ma={},this.xa=new Gu(a=>JA(a),n0),this.Oa=new Map,this.Na=new Set,this.La=new $n(it.comparator),this.Ba=new Map,this.ka=new Bb,this.qa={},this.Qa=new Map,this.Ka=hh.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function SG(n,e,t=!0){const r=U2(n);let s;const i=r.xa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Ca()):s=await L2(r,e,t,!0),s}async function EG(n,e){const t=U2(n);await L2(t,e,!0,!1)}async function L2(n,e,t,r){const s=await qW(n.localStore,Co(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await kG(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&k2(n.remoteStore,s),a}async function kG(n,e,t,r,s){n.Ua=(f,p,g)=>async function(w,x,I,C){let k=x.view.ga(I);k.ss&&(k=await g_(w.localStore,x.query,!1).then(({documents:P})=>x.view.ga(P,k)));const E=C&&C.targetChanges.get(x.targetId),_=C&&C.targetMismatches.get(x.targetId)!=null,L=x.view.applyChanges(k,w.isPrimaryClient,E,_);return S_(w,x.targetId,L.ba),L.snapshot}(n,f,p,g);const i=await g_(n.localStore,e,!0),o=new wG(e,i.ds),a=o.ga(i.documents),l=Rf.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);S_(n,t,c.ba);const d=new bG(e,t,o);return n.xa.set(e,d),n.Oa.has(t)?n.Oa.get(t).push(e):n.Oa.set(t,[e]),c.snapshot}async function TG(n,e,t){const r=vt(n),s=r.xa.get(e),i=r.Oa.get(s.targetId);if(i.length>1)return r.Oa.set(s.targetId,i.filter(o=>!n0(o,e))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await k1(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Gb(r.remoteStore,s.targetId),_1(r,s.targetId)}).catch(_h)):(_1(r,s.targetId),await k1(r.localStore,s.targetId,!0))}async function _G(n,e){const t=vt(n),r=t.xa.get(e),s=t.Oa.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Gb(t.remoteStore,r.targetId))}async function RG(n,e,t){const r=OG(n);try{const s=await function(o,a){const l=vt(o),c=dr.now(),d=a.reduce((g,y)=>g.add(y.key),$t());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",g=>{let y=ya(),w=$t();return l.hs.getEntries(g,d).next(x=>{y=x,y.forEach((I,C)=>{C.isValidDocument()||(w=w.add(I))})}).next(()=>l.localDocuments.getOverlayedDocuments(g,y)).next(x=>{f=x;const I=[];for(const C of a){const k=KU(C,f.get(C.key).overlayedDocument);k!=null&&I.push(new ju(C.key,k,GA(k.value.mapValue),So.exists(!0)))}return l.mutationQueue.addMutationBatch(g,c,I,a)}).next(x=>{p=x;const I=x.applyToLocalDocumentSet(f,w);return l.documentOverlayCache.saveOverlays(g,x.batchId,I)})}).then(()=>({batchId:p.batchId,changes:t2(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.qa[o.currentUser.toKey()];c||(c=new $n(Ft)),c=c.insert(a,l),o.qa[o.currentUser.toKey()]=c}(r,s.batchId,t),await Af(r,s.changes),await u0(r.remoteStore)}catch(s){const i=Xb(s,"Failed to persist write");t.reject(i)}}async function M2(n,e){const t=vt(n);try{const r=await GW(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Ba.get(i);o&&(sn(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Fa=!0:s.modifiedDocuments.size>0?sn(o.Fa):s.removedDocuments.size>0&&(sn(o.Fa),o.Fa=!1))}),await Af(t,r,e)}catch(r){await _h(r)}}function C_(n,e,t){const r=vt(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.xa.forEach((i,o)=>{const a=o.view.ea(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=vt(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const p of f.J_)p.ea(a)&&(c=!0)}),c&&Yb(l)}(r.eventManager,e),s.length&&r.Ma.R_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function NG(n,e,t){const r=vt(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Ba.get(e),i=s&&s.key;if(i){let o=new $n(it.comparator);o=o.insert(i,Jr.newNoDocument(i,mt.min()));const a=$t().add(i),l=new o0(mt.min(),new Map,new $n(Ft),o,a);await M2(r,l),r.La=r.La.remove(i),r.Ba.delete(e),Qb(r)}else await k1(r.localStore,e,!1).then(()=>_1(r,e,t)).catch(_h)}async function AG(n,e){const t=vt(n),r=e.batch.batchId;try{const s=await WW(t.localStore,e);z2(t,r,null),V2(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Af(t,s)}catch(s){await _h(s)}}async function $G(n,e,t){const r=vt(n);try{const s=await function(o,a){const l=vt(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(sn(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);z2(r,e,t),V2(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Af(r,s)}catch(s){await _h(s)}}function V2(n,e){(n.Qa.get(e)||[]).forEach(t=>{t.resolve()}),n.Qa.delete(e)}function z2(n,e,t){const r=vt(n);let s=r.qa[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.qa[r.currentUser.toKey()]=s}}function _1(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Oa.get(e))n.xa.delete(r),t&&n.Ma.Wa(r,t);n.Oa.delete(e),n.isPrimaryClient&&n.ka.yr(e).forEach(r=>{n.ka.containsKey(r)||B2(n,r)})}function B2(n,e){n.Na.delete(e.path.canonicalString());const t=n.La.get(e);t!==null&&(Gb(n.remoteStore,t),n.La=n.La.remove(e),n.Ba.delete(t),Qb(n))}function S_(n,e,t){for(const r of t)r instanceof F2?(n.ka.addReference(r.key,e),DG(n,r)):r instanceof O2?(je("SyncEngine","Document no longer in limbo: "+r.key),n.ka.removeReference(r.key,e),n.ka.containsKey(r.key)||B2(n,r.key)):ft()}function DG(n,e){const t=e.key,r=t.path.canonicalString();n.La.get(t)||n.Na.has(r)||(je("SyncEngine","New document in limbo: "+t),n.Na.add(r),Qb(n))}function Qb(n){for(;n.Na.size>0&&n.La.size<n.maxConcurrentLimboResolutions;){const e=n.Na.values().next().value;n.Na.delete(e);const t=new it(In.fromString(e)),r=n.Ka.next();n.Ba.set(r,new IG(t)),n.La=n.La.insert(t,r),k2(n.remoteStore,new il(Co(Ob(t.path)),r,"TargetPurposeLimboResolution",Zy.oe))}}async function Af(n,e,t){const r=vt(n),s=[],i=[],o=[];r.xa.isEmpty()||(r.xa.forEach((a,l)=>{o.push(r.Ua(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Wb.zi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ma.R_(s),await async function(l,c){const d=vt(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>Se.forEach(c,p=>Se.forEach(p.Wi,g=>d.persistence.referenceDelegate.addReference(f,p.targetId,g)).next(()=>Se.forEach(p.Gi,g=>d.persistence.referenceDelegate.removeReference(f,p.targetId,g)))))}catch(f){if(!Rh(f))throw f;je("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const p=f.targetId;if(!f.fromCache){const g=d.us.get(p),y=g.snapshotVersion,w=g.withLastLimboFreeSnapshotVersion(y);d.us=d.us.insert(p,w)}}}(r.localStore,i))}async function PG(n,e){const t=vt(n);if(!t.currentUser.isEqual(e)){je("SyncEngine","User change. New user:",e.toKey());const r=await I2(t.localStore,e);t.currentUser=e,function(i,o){i.Qa.forEach(a=>{a.forEach(l=>{l.reject(new Xe(Ee.CANCELLED,o))})}),i.Qa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Af(t,r.Ts)}}function FG(n,e){const t=vt(n),r=t.Ba.get(e);if(r&&r.Fa)return $t().add(r.key);{let s=$t();const i=t.Oa.get(e);if(!i)return s;for(const o of i){const a=t.xa.get(o);s=s.unionWith(a.view.fa)}return s}}function U2(n){const e=vt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=M2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=FG.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NG.bind(null,e),e.Ma.R_=vG.bind(null,e.eventManager),e.Ma.Wa=xG.bind(null,e.eventManager),e}function OG(n){const e=vt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=AG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$G.bind(null,e),e}class py{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=a0(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,t){return null}Ya(e,t){return null}Ha(e){return UW(this.persistence,new zW,e.initialUser,this.serializer)}ja(e){return new b2(Ub.ei,this.serializer)}za(e){return new XW}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}py.provider={build:()=>new py};class LG extends py{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){sn(this.persistence.referenceDelegate instanceof dy);const r=this.persistence.referenceDelegate.garbageCollector;return new EW(r,e.asyncQueue,t)}ja(e){const t=this.cacheSizeBytes!==void 0?Rs.withCacheSize(this.cacheSizeBytes):Rs.DEFAULT;return new b2(r=>dy.ei(r,t),this.serializer)}}class R1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>C_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=PG.bind(null,this.syncEngine),await mG(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new yG}()}createDatastore(e){const t=a0(e.databaseInfo.databaseId),r=function(i){return new ZW(i)}(e.databaseInfo);return function(i,o,a,l){return new nG(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new sG(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>C_(this.syncEngine,t,0),function(){return v_.p()?new v_:new YW}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new CG(s,i,o,a,l,c);return d&&(f.$a=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=vt(s);je("RemoteStore","RemoteStore shutting down."),i.k_.add(5),await Nf(i),i.Q_.shutdown(),i.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}R1.provider={build:()=>new R1};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):ga("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MG{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Yr.UNAUTHENTICATED,this.clientId=BA.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{je("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(je("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Xb(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Fw(n,e){n.asyncQueue.verifyOperationInProgress(),je("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await I2(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function E_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await VG(n);je("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>x_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>x_(e.remoteStore,s)),n._onlineComponents=e}async function VG(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){je("FirestoreClient","Using user provided OfflineComponentProvider");try{await Fw(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Ee.FAILED_PRECONDITION||s.code===Ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;ah("Error using user provided cache. Falling back to memory cache: "+t),await Fw(n,new py)}}else je("FirestoreClient","Using default OfflineComponentProvider"),await Fw(n,new LG(void 0));return n._offlineComponents}async function G2(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(je("FirestoreClient","Using user provided OnlineComponentProvider"),await E_(n,n._uninitializedComponentsProvider._online)):(je("FirestoreClient","Using default OnlineComponentProvider"),await E_(n,new R1))),n._onlineComponents}function zG(n){return G2(n).then(e=>e.syncEngine)}async function j2(n){const e=await G2(n),t=e.eventManager;return t.onListen=SG.bind(null,e.syncEngine),t.onUnlisten=TG.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=EG.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=_G.bind(null,e.syncEngine),t}function BG(n,e,t={}){const r=new fa;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new W2({next:p=>{d.eu(),o.enqueueAndForget(()=>D2(i,f));const g=p.docs.has(a);!g&&p.fromCache?c.reject(new Xe(Ee.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&p.fromCache&&l&&l.source==="server"?c.reject(new Xe(Ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new P2(Ob(a.path),d,{includeMetadataChanges:!0,ua:!0});return $2(i,f)}(await j2(n),n.asyncQueue,e,t,r)),r.promise}function UG(n,e,t={}){const r=new fa;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new W2({next:p=>{d.eu(),o.enqueueAndForget(()=>D2(i,f)),p.fromCache&&l.source==="server"?c.reject(new Xe(Ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new P2(a,d,{includeMetadataChanges:!0,ua:!0});return $2(i,f)}(await j2(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H2(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q2(n,e,t){if(!t)throw new Xe(Ee.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function WG(n,e,t,r){if(e===!0&&r===!0)throw new Xe(Ee.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function T_(n){if(!it.isDocumentKey(n))throw new Xe(Ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function __(n){if(it.isDocumentKey(n))throw new Xe(Ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function c0(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ft()}function Il(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Xe(Ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=c0(n);throw new Xe(Ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Xe(Ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Xe(Ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WG("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=H2((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Xe(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Xe(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Xe(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class h0{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new R_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xe(Ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xe(Ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new R_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new tU;switch(r.type){case"firstParty":return new iU(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Xe(Ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=k_.get(t);r&&(je("ComponentProvider","Removing Datastore"),k_.delete(t),r.terminate())}(this),Promise.resolve()}}function GG(n,e,t,r={}){var s;const i=(n=Il(n,h0))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&ah("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Yr.MOCK_USER;else{a=A3(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new Xe(Ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Yr(c)}n._authCredentials=new nU(new zA(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ah(this.firestore,e,this._query)}}class $s{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $s(this.firestore,e,this._key)}}class dl extends Ah{constructor(e,t,r){super(e,t,Ob(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $s(this.firestore,null,new it(e))}withConverter(e){return new dl(this.firestore,e,this._path)}}function K2(n,e,...t){if(n=Xs(n),q2("collection","path",e),n instanceof h0){const r=In.fromString(e,...t);return __(r),new dl(n,null,r)}{if(!(n instanceof $s||n instanceof dl))throw new Xe(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(In.fromString(e,...t));return __(r),new dl(n.firestore,null,r)}}function Jb(n,e,...t){if(n=Xs(n),arguments.length===1&&(e=BA.newId()),q2("doc","path",e),n instanceof h0){const r=In.fromString(e,...t);return T_(r),new $s(n,null,new it(r))}{if(!(n instanceof $s||n instanceof dl))throw new Xe(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(In.fromString(e,...t));return T_(r),new $s(n.firestore,n instanceof dl?n.converter:null,new it(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new S2(this,"async_queue_retry"),this.fu=()=>{const r=Pw();r&&je("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=e;const t=Pw();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const t=Pw();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const t=new fa;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!Rh(e))throw e;je("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(r=>{this.Au=r,this.Ru=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ga("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.Ru=!1,r))));return this.gu=t,t}enqueueAfterDelay(e,t,r){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const s=Kb.createAndSchedule(this,e,t,r,i=>this.Su(i));return this.du.push(s),s}pu(){this.Au&&ft()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.du)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}class $f extends h0{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new N_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new N_(e),this._firestoreClient=void 0,await e}}}function jG(n,e){const t=typeof n=="object"?n:ZN(),r=typeof n=="string"?n:"(default)",s=xb(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=R3("firestore");i&&GG(s,...i)}return s}function Zb(n){if(n._terminated)throw new Xe(Ee.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||HG(n),n._firestoreClient}function HG(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new wU(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,H2(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new MG(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fh(Or.fromBase64String(e))}catch(t){throw new Xe(Ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new fh(Or.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Xe(Ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Xe(Ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Xe(Ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ft(this._lat,e._lat)||Ft(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qG=/^__.*__$/;class KG{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ju(e,this.data,this.fieldMask,t,this.fieldTransforms):new _f(e,this.data,t,this.fieldTransforms)}}function Y2(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ft()}}class rI{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Fu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new rI(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.xu({path:r,Nu:!1});return s.Lu(e),s}Bu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.xu({path:r,Nu:!1});return s.Fu(),s}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return my(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(Y2(this.Mu)&&qG.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class XG{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||a0(e)}$u(e,t,r,s=!1){return new rI({Mu:e,methodName:t,Ku:r,path:Fr.emptyPath(),Nu:!1,Qu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sI(n){const e=n._freezeSettings(),t=a0(n._databaseId);return new XG(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Q2(n,e,t,r,s,i={}){const o=n.$u(i.merge||i.mergeFields?2:0,e,t,s);e$("Data must be an object, but it was:",o,r);const a=J2(r,o);let l,c;if(i.merge)l=new Wi(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const p=QG(e,f,t);if(!o.contains(p))throw new Xe(Ee.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);ZG(d,p)||d.push(p)}l=new Wi(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new KG(new di(a),l,c)}function YG(n,e,t,r=!1){return iI(t,n.$u(r?4:3,e))}function iI(n,e){if(Z2(n=Xs(n)))return e$("Unsupported field value:",e,n),J2(n,e);if(n instanceof X2)return function(r,s){if(!Y2(s.Mu))throw s.qu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.qu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=iI(a,s.ku(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Xs(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return UU(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=dr.fromDate(r);return{timestampValue:hy(s.serializer,i)}}if(r instanceof dr){const i=new dr(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:hy(s.serializer,i)}}if(r instanceof tI)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof fh)return{bytesValue:p2(s.serializer,r._byteString)};if(r instanceof $s){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.qu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:zb(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof nI)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.qu("VectorValues must only contain numeric values.");return Lb(a.serializer,l)})}}}}}}(r,s);throw s.qu(`Unsupported field value: ${c0(r)}`)}(n,e)}function J2(n,e){const t={};return UA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wu(n,(r,s)=>{const i=iI(s,e.Ou(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Z2(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof dr||n instanceof tI||n instanceof fh||n instanceof $s||n instanceof X2||n instanceof nI)}function e$(n,e,t){if(!Z2(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=c0(t);throw r==="an object"?e.qu(n+" a custom object"):e.qu(n+" "+r)}}function QG(n,e,t){if((e=Xs(e))instanceof eI)return e._internalPath;if(typeof e=="string")return t$(n,e);throw my("Field path arguments must be of type string or ",n,!1,void 0,t)}const JG=new RegExp("[~\\*/\\[\\]]");function t$(n,e,t){if(e.search(JG)>=0)throw my(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new eI(...e.split("."))._internalPath}catch{throw my(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function my(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Xe(Ee.INVALID_ARGUMENT,a+n+l)}function ZG(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n${constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $s(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ej(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(oI("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ej extends n${data(){return super.data()}}function oI(n,e){return typeof e=="string"?t$(n,e):e instanceof eI?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tj(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Xe(Ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class aI{}class nj extends aI{}function rj(n,e,...t){let r=[];e instanceof aI&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof lI).length,a=i.filter(l=>l instanceof d0).length;if(o>1||o>0&&a>0)throw new Xe(Ee.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class d0 extends nj{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new d0(e,t,r)}_apply(e){const t=this._parse(e);return r$(e._query,t),new Ah(e.firestore,e.converter,w1(e._query,t))}_parse(e){const t=sI(e.firestore);return function(i,o,a,l,c,d,f){let p;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Xe(Ee.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){$_(f,d);const g=[];for(const y of f)g.push(A_(l,i,y));p={arrayValue:{values:g}}}else p=A_(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||$_(f,d),p=YG(a,o,f,d==="in"||d==="not-in");return Jn.create(c,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function sj(n,e,t){const r=e,s=oI("where",n);return d0._create(s,r,t)}class lI extends aI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new lI(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Xi.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)r$(o,l),o=w1(o,l)}(e._query,t),new Ah(e.firestore,e.converter,w1(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function A_(n,e,t){if(typeof(t=Xs(t))=="string"){if(t==="")throw new Xe(Ee.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!QA(e)&&t.indexOf("/")!==-1)throw new Xe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(In.fromString(t));if(!it.isDocumentKey(r))throw new Xe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return JT(n,new it(r))}if(t instanceof $s)return JT(n,t._key);throw new Xe(Ee.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${c0(t)}.`)}function $_(n,e){if(!Array.isArray(n)||n.length===0)throw new Xe(Ee.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function r$(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Xe(Ee.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Xe(Ee.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class ij{convertValue(e,t="none"){switch(wl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ft()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Wu(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>jn(o.doubleValue));return new nI(i)}convertGeoPoint(e){return new tI(jn(e.latitude),jn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=t0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(nf(e));default:return null}}convertTimestamp(e){const t=vl(e);return new dr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=In.fromString(e);sn(w2(r));const s=new rf(r.get(1),r.get(3)),i=new it(r.popFirst(5));return s.isEqual(t)||ga(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s$(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class i$ extends n${constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Vg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(oI("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Vg extends i${data(e={}){return super.data(e)}}class oj{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Md(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Vg(this._firestore,this._userDataWriter,r.key,r,new Md(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Xe(Ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Vg(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Md(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Vg(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Md(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:aj(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function aj(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ft()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lj(n){n=Il(n,$s);const e=Il(n.firestore,$f);return BG(Zb(e),n._key).then(t=>dj(e,n,t))}class o$ extends ij{constructor(e){super(),this.firestore=e}convertBytes(e){return new fh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $s(this.firestore,null,t)}}function uj(n){n=Il(n,Ah);const e=Il(n.firestore,$f),t=Zb(e),r=new o$(e);return tj(n._query),UG(t,n._query).then(s=>new oj(e,r,n,s))}function cj(n,e,t){n=Il(n,$s);const r=Il(n.firestore,$f),s=s$(n.converter,e);return a$(r,[Q2(sI(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,So.none())])}function hj(n,e){const t=Il(n.firestore,$f),r=Jb(n),s=s$(n.converter,e);return a$(t,[Q2(sI(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,So.exists(!1))]).then(()=>r)}function a$(n,e){return function(r,s){const i=new fa;return r.asyncQueue.enqueueAndForget(async()=>RG(await zG(r),s,i)),i.promise}(Zb(n),e)}function dj(n,e,t){const r=t.docs.get(e._key),s=new o$(n);return new i$(n,s,e._key,r,new Md(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){Th=s})(Eh),ih(new Eu("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new $f(new rU(r.getProvider("auth-internal")),new aU(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Xe(Ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rf(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),hl(HT,"4.7.5",e),hl(HT,"4.7.5","esm2017")})();const fj={apiKey:"AIzaSyA1vrpL6qLdexEUyxA7E5vh24gsJoe2JCE",authDomain:"brain-tumor-classifier-w-ed810.firebaseapp.com",projectId:"brain-tumor-classifier-w-ed810",storageBucket:"brain-tumor-classifier-w-ed810.firebasestorage.app",messagingSenderId:"962998518202",appId:"1:962998518202:web:39f15bf4197b9fa0579d83"},l$=JN(fj),uI=DA(l$),pj=new oa,f0=jG(l$);function p0(){const[n,e]=ge.useState(!1),[t,r]=ge.useState(null),s=()=>{e(!n)},i=a=>{a.target.closest(".nav-menu")||e(!1)};ge.useEffect(()=>{const a=uI.onAuthStateChanged(l=>{r(l)});return window.addEventListener("click",i),()=>{a(),window.removeEventListener("click",i)}},[]);const o=async()=>{const a=DA();try{await BB(a),r(null)}catch(l){console.error("Error signing out:",l.message)}};return te.jsx(te.Fragment,{children:te.jsxs("nav",{children:[te.jsx("div",{className:"logo",children:te.jsxs("h2",{children:["BrainTumorClassifier",te.jsx("span",{children:"AI"})]})}),te.jsxs("div",{className:"nav-menu",children:[te.jsx("a",{className:"btn",href:location.pathname==="/"||location.pathname==="/my/mri"?"/interpret":"/",children:location.pathname==="/"||location.pathname==="/my/mri"?"Interpret":"Home"}),t?te.jsx("div",{className:"profile-icon",onClick:s,children:te.jsx("img",{src:t.photoURL||"./assets/img/user.png",className:"profile-image"})}):te.jsx("a",{href:"/auth/signin",children:"Sign In"}),n&&te.jsxs("div",{className:"dropdown-menu",children:[te.jsx("a",{href:location.pathname==="/my/mri"?"/":"/my/mri",children:location.pathname==="/my/mri"?"Home":"My MRI"}),te.jsx("a",{href:"#",onClick:o,children:"Sign Out"})]})]})]})})}const pg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABVVJREFUWIWll2tsFGUUhp8zu22lF7qzLRIbbdEIVkkkQSKRKPFvExMUvAAFhERJ5G63tRBQR8XY0i2FgBqIAQkFmyKKJMQ/JBoQo2hQwJiC3EMUStndtpvS287xx07rdtlpF3n/7Mx7Lu/5LnO+/YQ7RP5qNaWfSYbwEDb5tqCG0GHbnCPGqcgmiYyUo/AtLbJtykI9NEo6onkBLcwQFgBzFCYDhourjXBcbJrtGDtTFXPvSh3bn8FRhfECrw1bwNhKzelV1iEsA3ITTB2qtIjBNVV6BYqA8cCYBJ9OtXkmslFODhC+VeoTL98Dk4AeO8ZjXjdxf6U+1avsRRjnUOcFGkVpulkvLaliCgJaagszEBajlBgG2QO2Ikuzb0U56IgDbGxvkAspZ8AMaDnCDiATaEN5N5zHdizpdyt4CCw18rvJb6+RsPOeaUY5AJQBqHDd6GZCaIt03FaAWalzgd3E1/nHjD5mtm6W62kJp8JL6jFL2Au8PECpsjBSL7sAhiyBv0KnKewADIX9kR7K2SI9/1scFbOETxPFgRORPHYPvAzu5jFLNFcNGoEs4Jgvl3l3Jw5mJbXA64kVoazEEvu2AvpHsQZ4EAj1wcxLlnTfjbgvoOuAqiR6T7hefkgkDIC8NVqAsMqp8e1oUFrvRtys0jdE+CCJ7sLD2mRfL0BGP4sUsoGL4StsS3TwV2ml2hTjJRiulSsjige0HGVrMq9QE3HifQF9HvgtUi+XDQBb45tEYRf7JDYkUKlAWE6MFjOgH5nVmj/MyJ9D2Elyp1Qu5cYIOuLTRfhahEYAI3+1mgJTALw2X6TI+57zOwphNTHOm5VazXLNSnTyV+g0lCYgIzmBQNXVBrkFIDZhh55aZGm2QS+T4z50tG3kr+TgcFC2AXsTqAKgxpfFKX+VvgQqvgqdpAaHgJwUAzgWqmf/YL6r/AlEgYyuTqYYYlDs2P4A0RQJwMMShAtJo5qgSrNZyRExOAz4UkTGVFg2JG98iU8DiHC/YSh+x3QjpTgQrpV2W3gF6E1hfhoodAn9LFInvyeTInQBqFBgALYzIjvZMRHtG+RXgTXD+SShwytYqQyqzkAUj6HQGn+mYKSMoSANwDfpqIti3aiTay4FxLWEiGF7OOPwj6aT1vayCLg8guO5UB4fp7RYaogwMa7PeSMzSgvx6R8z+k19eKQS2mskjDAfcD+alRVYkmq/4O+klPjXEtM+Ths3PpEocATA42HWSAUAhOvkqML7LuZD4Xr51rU2Ya7zeDyySSIGgCh7HHJFcoNxQySXDxUOJ9F9HoOAa5ClXmA+gEITOC3TjvElEAGKzCwWplMAltiZfcwDBjeawpa2DXLGLcTXyVKgGOiwY04rBohskojo4JSuN6u12CXHELRulusqzAb+AY4YPYNt+zYUrtL7ROJ2gYaOBgk5zwMj0kwzykmgFPg5nMt0t410pyiyNLurk+9EeBI4lxPj8YGz4b9Ty5Je8fAi0AFM9UdpKrI0O3XK9DHO0ntuRWlyxLttZfaAOCTOgAMzoGUIBwGvKsczDGa4NZSRYFZrscT4SuEJICbCnFCd7Ev0cftbXobQBIwGwgLrQ7lsTXtJlmuWP4ulCmsBP9At8GooKM3Jrq43I3+1TtT411HqUBcRths2B9wuJvlVOtkDL6iygPhuR+GsR5l3s15+SRUz/N1wsWb4RrNU4B3ATLC0AWeBmwiKUgKUMPRI7lQlmJ1H8G9Lutwk0rqcmtWaLzazUMoVnmW4yyn8pEqzePk8XCvtI+VOq4BEjK3UnG7hEUMpBR4QIWbHT9TLXuFE2wbpvJN8/wIbXgI5RGV+EQAAAABJRU5ErkJggg==",mj="/BrainTumorClassifierAI/assets/mri-scanner-eCiI2QgO.png",gj="/BrainTumorClassifierAI/assets/doctor-Berk0h_a.png",yj="/BrainTumorClassifierAI/assets/patients-CH1BV_bX.png",vj="/BrainTumorClassifierAI/assets/cloud-computing-CHyP3_MF.png",xj="/BrainTumorClassifierAI/assets/medical-checkup-C84tW2a4.png",wj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACxgAAAsYBJG9eggAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAA3/SURBVHic7Z15kF1FFYe/92bJZDGRJBARDLsEgqwaJEYSCCCryGIUEEWRRf5SynKhrIJSC4VoUYiISIqCgEixhRD2nbCEAsEQEAKBEAJEQiYLmZkkM5nM84/zXs3U8N68/vXte+97mftVnXo1U327T9/u27fv6T6nc6RLE7AbsCswpihji7/bAHlgVPF3JNBQ5rcapet9KADrHNN+AvQAa4u/nwDdQBvQBXQAa4BWYHVRVgKLgfWe+kUml2BZzcAkYCpwELA31vBNCepQq6wA3gD+CzwNzAc+TlWjQIwGzgEeBjZgT1Qm1aUH6wyXAwfKdz1lcsDRwDxs6Ev7Zm4N8hZwEfZ6rFmagfOwoSztG7a1ygbgWuCLjm2SGEcAr5H+DRos0oV1hNRHhB2AB0j/hgxW+Rg4vWorxcRRwEdVFMwkGZkNjBi4ucKRB2ZiM9W0K55JrywmgblBI3B9yhXNpLKsBg6p2HoRGQrcVwOVzGRgWQ9Mr9CGn8LVEtgI3AGc6JpxIDYBG8v89v+fL22YuXY49hnrS8ncXPr9LHZv+/8mRQdwJLCgWkIXpXLALOBHEZXqzybgVeD1oiwBVmHDWGtRCoHLTJMW7LNtLLAdsD2wV1G+BOwSuLw1wKGYRTESvyHc8LQU+CM2RA2NqthWxheAHwC3YyNbiPu9nIi2ginA5ohKdAG3FvNKchisZ0YC52MjY9ROMA/P+z4aeC9i4bcBO/sUngFYw80AlhGtHX7qU/h1EQpcgU1CMsIwFLgSf9vLRsQ5xoHAFs/CnsQmORnhORFox69d7nAtJIdtSPAp5G5stpsRH1/FvpR82meaSwFHemZ+D2YvyIif/bCtZz6jc1Xu9ch4PtmTnzTT8ftCO2CgTPdAf/evBsaHrFmGMz42mhsHyvByjwxPDlunQcVU4CrgKWAh8ChwKbCv4/V54Fm09tqEmaY/RQ79e/Mx56pm9GU88DiV72sPcDNmEKrGAeij9lnlMvqamEmBOtyxWgNMwH0jzauYQa4a/3LMryQPlMtkppjJfKHSGcYwbIevcp8fdMj3YDHPLsqMLi+KmZwmVT0D4Ffoo2wB+KZD3mr7HdP34lHYurjrxe3YGnqGhvr0l+Qeh7x/Jub5h74XHytefJtc9Yzx+DV+Adu4Uo2dxDwXQK/T5IDGgTJks3+dHSJcOwIbpQfiPeBtIc99gXypA+wpKvS4mD4j2ta1AtDpkE5pl2HA+JLtfi/hwna0npY2OcwTeSLW0Sdgq5UjsXlMC+YC3k5v3RZj7+sXcRt+XXgX+153cWnvzwe4daCFYr57NmI3SBkBSrtUapnRwCmYy9o0/Jenu4F/Y0/WXOCFCDqtA57BrH8q8xzTqfv/JoCZBZXJw/ViIUmRB44H7sSeFt8J10DyBualO85Tx2M8yuwCdnfMf6yY90ywCB3KRRd7VT0+8sAJwEvE0+jlpBNzx3JtmL7MFsv6pZh/m5D3DaBbkS4QFYqT6aTrjt4JXIZmE2nBdue45H8Z+obOdwX97wU4Tqz0DFGhOBiHbv+OU5YD3xL0z2GRUz6okN9rWLv48IKg9/MAZwoXFIDDPRULxTRs02najV5OZmOfV640YItwF2Bzi3NwXwquhOK+9zbY/nOlkmmtAOaw+Ydisk5D/oMFv0qLmyvoVU5W5NE9dDYEU9WdBiwixiX4fUcnyf7Ac+jW1VAoBqchPh1go5g+Ki3AXdjwWC+MA57A75s/Kkr7DMmjb+Z0MUmGogG4Cbfl0FpjFHA/MfrrV0AZAVoa0SYtkOwr4G/AqYHz7MFm7R9ibtSbsM+4bbF3d8hQK8MwX4kpmPdzEigdoKER/RUQZVFD4ULg3EB5LcBmx08ALzNwHXbC3KqnY5921VbhqrEd9r39ZcKtKwyE3D5KyJfuYGoOzMFEDzLZDlxBtLg5Q4EzsEWWqF8Ht0TQQ+FCUS/JoNKeQAVGolmz+ssW4BpsSA9FDltcWhZBrwJwdkCdKnGBqBNzhMSrEqjAlWIF+srb2OgRF8OBv0bQbw3xO87+UNSJeULiD2NWfn/8DT1zif6+duVUbALpo+eAnjkBOEPURzIdfhCz8k+KypdkFskbiCbj56Xbg4XNj4vTRX24X0j8foyKHyoqXpKbSC/0zFfQll9L4rLL15fvirpIsX7fi1HxB0XFC8BDpO+Sfiy6a1YP5uIdB98RdZFu/LKYlJ4oKl3AXkchZ/pR+D26/nHNBWYoeuTRhs9CUFV7OdPjmnNJ5qvEhUuAV8RrTiYe5xqpjWqhAzQA3xOvmYPNXWqFbnq/v10ZQTyu9XXXASajOU30YIERao3nKG6xEvh2DHr0KInzaEeqxdEB1B1Gc7Gt6bXIpWL6qYSfxNbdCKB2gOti0CEUzwOLhPQjsSP0QlJXHaAJzXS7EngksA6h+aeY/uuBy6+rDrArMERI/yjJrUj68pCYXnHLc6GuOoDqlPpk4PLjYBEW6t4V9R5Uo646wB5i+lcDlx8HBWxfvyuhz/mRvwLS7AAuAZD68mbg8uNC0XM0Ydcy6moE+IyQdjPuJ3mnjWKhbCBslNW66gDKBswk9tOFQtVVeRCqIXeANMlOEDFSfQUoF4RuMOVJSexkzACoT3TI0U16qOupAzRTIcZtDaIsU28hrLeV1EZpd4C1YvqaOza9Asq3/RrCzq3qqgO8JaaP6jqdBDlgHyF9aI+huuoA6nf91MDlx8G+aGf1LQ5cfl3NAZaiOZseSe27h39DTB+6A9TVCLAZLfTaOGr/OLozxPRPBy6/rjoA6FFHfxyDDqGYhDZPWY/FIQzJVt8BTiL8EmooLhLTzyf88nbddYBnsaBPruSB38WgR1QOQQ9kcXsMetTVJBDMEKLuojkFODoGXXxpAK5Guz8dWOib0NTdCAAWXk3lOiIejR6Qi9GDQt1FPO72chspnkFxuoY9LOhRkgdI3zXsaPxcw+KKIia7him+gctjUhrMyKN2gAI2eqS1qngQNpNXdXaN/u2D7ByqeAfH7R7ue2j130neQHQwtvFD1bWHeINYnCbqI50VHHeAiAPwDxAxB7eDFkNwMv7HuPvMdxTk+AB3C4mTcMb8i1iBvrIE89mPi2FYCJseT/3W4n/WgCtniTpxq5A4iW1Zo7DJpm8n6MY+yUJ+IeSwkHHvRtCrQDLRTn8i6sQNQuKknDIOIXqYuDbsRIxdIugxBPO3D3EYxa0R9FCQw8RdI17QlFBFfi7qVUl6sAWXX2DBGpurlLs9NpOeRe9mjajyFsnNT36t6NaIHlmyBVvFi5s/Y4caRY2tl8NCtU4p/t2NDeXvYxO5Tmyr2Shsx1HobWet2JE26wPnWwkl8utmnw4wlGTmAgXgPKxBTgmYbyPmkaR6JfmwAVsfSNKhRfEx2JTHbwRIii1Y+JhaigbiShv25C9IuFxlBNiYR9+RqgaXjspG7CmalXC5UVgJHEY6J6zKI0CtdwCwkeBc4LeIzo8psAg7B+illMpXOkBnHj3+f1p78wvYqtsRwP9S0qEaN2GfsO+kqIPSPh15LNypQtpLsE9gB1fFsZnClw+x+MHfJ50zlfqiBKNuzaMFM4DaCM74EWagOQrdtyAkm+n9XL0zRT36orTPqnocAfryCLY/cAZ2gmhSdGHD/d6YwSqJcxRcUTpAa+kCxar1j4DKhiSPbRidS3QzciVZgs1DPp9QnVTUg8AvBrtxG4SLnkmqNhHYFlsUuRO/kO4l6QZeBC7HAlrWujv7ZLT6nV2q0Cu472dfB2wTTufYyWN1m4i9q/fEJkojsCcmhz0A7VjdlmLeOm9ija86sKbJOWgjdMk8Li0JF7CTtTJqj6vQ2nFMaQ+56p82LYCyGeFRoq6uAlaXOsBCsaDpYvqM+PkcmsfUQuj1IpmPZmI9nurr6hnJchLaJPWp/v9YhPb+OCGavhmBUXdUT+mfgboZU42NnxEf+6G1XQdlYjQfJmayhfqJ2bO1Mxut7cquo+SxRY3IGWUkis9hmxVPZPc5tvWw8HXKcCSHTeaU9mrD/BvKMhHd6WE5etDnjDD47Jy+ulqmPl66c0g/7OxgYzK2ozn4vO0YMdOSXBOqZhlV2R34GL2NnAJS5LCdrD6d4Apqf8Ws3tkH89JW26YbmzA6MQl/B8gbSXbr+GBiOv7eSteqhd3gWVABszNP8KlhRlkascBYvq7za/HYyrcN0bx0u7DPylFydTP6cji6mb6/+JzNDNiyr2+vK0krdqLmjr5KDELymDOM+o1f6ZUciUsCKFHAOtJjmL/fblGV2gppwZ72K9AtspVkMVUO2nCZseewXuQ9jFRgGbbl6vWivIN92rQS9gCFWmNsUbbH1u8nYjP7SYSdPK/EbAVLB0rk+snWhIWSOTaiUq50YB2hEzNdbsHcq3uAT/r89qWb5A6WauTTx8I0A8P7/DZhT1/pdzjW8EkEs2rDXt8vh8x0GH5WwkySlXXEeK5CM3BLDVQyk/KyAsHY40se+BP+hqJM4pGFwM6Vmy08R2E+emlXPBPbEFJxiTdOdkQLNZtJWHkfPUR9LByBnZid9g0ZLNKJWVlDHjkbmWbgfMz4kPYN2lqlHfP+2cmxTVIhDxwH3Ed8XrqDTZZg8f/qbufVGMxh8WHMuJP2jawneR3zSj5IvusCSW7eaMYCOU/FInbuha0JJBV5tJZZiQW4eA2LavpU8X+xk/bunSZg16KModdOPgZbjs5jIVYbsAlPI73m1WGUcW4oQx7/JelNuK9LrMOe3JKpej1mwm7DzNQd2Lp8K71rHh9hbuipuaD/H/3U9lEFCWzWAAAAAElFTkSuQmCC";function bj(){return te.jsxs(te.Fragment,{children:[te.jsx(p0,{}),te.jsxs("div",{className:"container-hero",children:[te.jsxs("section",{className:"msg-cta",children:[te.jsx("h1",{children:"Enhance Diagnostic Accuracy with AI-Powered Brain Tumor Detection"}),te.jsx("p",{children:"Save time and improve efficiency with cutting-edge AI tools tailored for healthcare professionals. Make faster, more accurate diagnoses to support better outcomes in brain tumor detection and treatment planning."}),te.jsx("a",{href:"/interpret",className:"btn",children:"Start scanning!"})]}),te.jsx("section",{className:"benefits",children:te.jsxs("ul",{children:[te.jsxs("li",{children:[te.jsx("img",{src:pg}),te.jsxs("span",{children:[te.jsx("strong",{children:"Accurate tumor detection:"})," Leverage AI to achieve higher precision in diagnosing brain tumors."]})]}),te.jsxs("li",{children:[te.jsx("img",{src:pg}),te.jsxs("span",{children:[te.jsx("strong",{children:"Save valuable time:"})," Minimize waiting times with instant, AI-powered diagnoses."]})]}),te.jsxs("li",{children:[te.jsx("img",{src:pg}),te.jsxs("span",{children:[te.jsx("strong",{children:"Streamline your workflow:"})," Reduce manual effort and improve diagnostic efficiency."]})]}),te.jsxs("li",{children:[te.jsx("img",{src:pg}),te.jsxs("span",{children:[te.jsx("strong",{children:"Accessible and reliable:"})," Ensure consistent and dependable results for every scan."]})]})]})})]}),te.jsx("div",{className:"container-feature-highlight",children:te.jsxs("section",{className:"feature-highlight",children:[te.jsxs("div",{children:[te.jsx("h2",{children:"Comprehensive Care for Brain Health"}),te.jsx("p",{children:"Empowering healthcare professionals with advanced AI to revolutionize brain tumor detection and treatment, ensuring accurate, timely care for every patient."})]}),te.jsxs("div",{className:"features",children:[te.jsxs("div",{className:"feature",children:[te.jsx("img",{src:mj,alt:""}),te.jsx("h3",{children:"Confidence in Every Diagnosis"}),te.jsx("p",{children:"Achieve unmatched precision with AI-powered tools designed for brain tumor detection. Support accurate and reliable diagnoses to ensure the best possible care."})]}),te.jsxs("div",{className:"feature",children:[te.jsx("img",{src:gj,alt:""}),te.jsx("h3",{children:"Empowering Medical Professionals"}),te.jsx("p",{children:"Enhance your expertise with state-of-the-art AI insights for brain tumor detection and treatment planning. Save time while making informed decisions with advanced technology."})]}),te.jsxs("div",{className:"feature",children:[te.jsx("img",{src:yj,alt:""}),te.jsx("h3",{children:"Healthcare for Your Patients"}),te.jsx("p",{children:"Deliver fast, accurate diagnoses tailored for brain tumor cases. Improve outcomes and provide personalized care for every patients unique needs."})]})]})]})}),te.jsx("div",{className:"container-how-it-works",children:te.jsxs("section",{className:"how-it-works",children:[te.jsxs("div",{children:[te.jsx("h2",{children:"Simple & Straightforward"}),te.jsx("p",{children:"Quickly gain access to AI-driven insights, including tumor type predictions and expert guidance. Simplify your workflow and enhance diagnostic accuracy with minimal effort."})]}),te.jsxs("div",{className:"steps",children:[te.jsxs("div",{className:"step",children:[te.jsx("img",{src:vj,alt:""}),te.jsx("h3",{children:"1. Upload your brain MRI image"}),te.jsx("p",{children:"Easily and securely upload brain MRI scans to our platform. Leverage AI-powered precision for accurate analysis and reliable diagnostic support."})]}),te.jsxs("div",{className:"step",children:[te.jsx("img",{src:xj,alt:""}),te.jsx("h3",{children:"2. Get easy-to-understand report"}),te.jsx("p",{children:"Receive a report with predictions about the tumor type and actionable tips for healthcare professionals. Make informed decisions and optimize treatment planning with advanced AI insights."})]})]}),te.jsx("a",{href:"/interpret",className:"btn",children:"Upload your first image now!"})]})}),te.jsxs("footer",{children:[te.jsx("div",{className:"copyright",children:te.jsxs("div",{className:"logo",children:[te.jsxs("h2",{children:["BrainTumorClassifier",te.jsx("span",{children:"AI"})]}),te.jsxs("span",{children:["Copyright ",""," 2024 - BrainTumorClassifierAI"]})]})}),te.jsxs("div",{className:"social-media",children:[te.jsx("h3",{children:"Follow us on social media:"}),te.jsx("a",{href:"https://www.instagram.com/braintumorclassifier.ai",children:te.jsx("img",{src:wj,alt:""})})]})]})]})}var Td={},D_;function Ij(){if(D_)return Td;D_=1,Object.defineProperty(Td,"__esModule",{value:!0}),Td.parse=o,Td.serialize=c;const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,i=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function o(p,g){const y=new i,w=p.length;if(w<2)return y;const x=(g==null?void 0:g.decode)||d;let I=0;do{const C=p.indexOf("=",I);if(C===-1)break;const k=p.indexOf(";",I),E=k===-1?w:k;if(C>E){I=p.lastIndexOf(";",C-1)+1;continue}const _=a(p,I,C),L=l(p,C,_),P=p.slice(_,L);if(y[P]===void 0){let A=a(p,C+1,E),$=l(p,E,A);const D=x(p.slice(A,$));y[P]=D}I=E+1}while(I<w);return y}function a(p,g,y){do{const w=p.charCodeAt(g);if(w!==32&&w!==9)return g}while(++g<y);return y}function l(p,g,y){for(;g>y;){const w=p.charCodeAt(--g);if(w!==32&&w!==9)return g+1}return y}function c(p,g,y){const w=(y==null?void 0:y.encode)||encodeURIComponent;if(!n.test(p))throw new TypeError(`argument name is invalid: ${p}`);const x=w(g);if(!e.test(x))throw new TypeError(`argument val is invalid: ${g}`);let I=p+"="+x;if(!y)return I;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);I+="; Max-Age="+y.maxAge}if(y.domain){if(!t.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);I+="; Domain="+y.domain}if(y.path){if(!r.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);I+="; Path="+y.path}if(y.expires){if(!f(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);I+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(I+="; HttpOnly"),y.secure&&(I+="; Secure"),y.partitioned&&(I+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":I+="; Priority=Low";break;case"medium":I+="; Priority=Medium";break;case"high":I+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":I+="; SameSite=Strict";break;case"lax":I+="; SameSite=Lax";break;case"none":I+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return I}function d(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function f(p){return s.call(p)==="[object Date]"}return Td}Ij();/**
 * react-router v7.1.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var P_="popstate";function Cj(n={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return lf("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Cl(s)}return Ej(e,t,null,n)}function At(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Ir(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Sj(){return Math.random().toString(36).substring(2,10)}function F_(n,e){return{usr:n.state,key:n.key,idx:e}}function lf(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Nl(e):e,state:t,key:e&&e.key||r||Sj()}}function Cl({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Nl(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function Ej(n,e,t,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,c=d();c==null&&(c=0,o.replaceState({...o.state,idx:c},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let x=d(),I=x==null?null:x-c;c=x,l&&l({action:a,location:w.location,delta:I})}function p(x,I){a="PUSH";let C=lf(w.location,x,I);c=d()+1;let k=F_(C,c),E=w.createHref(C);try{o.pushState(k,"",E)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;s.location.assign(E)}i&&l&&l({action:a,location:w.location,delta:1})}function g(x,I){a="REPLACE";let C=lf(w.location,x,I);c=d();let k=F_(C,c),E=w.createHref(C);o.replaceState(k,"",E),i&&l&&l({action:a,location:w.location,delta:0})}function y(x){let I=s.location.origin!=="null"?s.location.origin:s.location.href,C=typeof x=="string"?x:Cl(x);return C=C.replace(/ $/,"%20"),At(I,`No window.location.(origin|href) available to create URL for href: ${C}`),new URL(C,I)}let w={get action(){return a},get location(){return n(s,o)},listen(x){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(P_,f),l=x,()=>{s.removeEventListener(P_,f),l=null}},createHref(x){return e(s,x)},createURL:y,encodeLocation(x){let I=y(x);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:p,replace:g,go(x){return o.go(x)}};return w}var kj=new Set(["lazy","caseSensitive","path","id","index","children"]);function Tj(n){return n.index===!0}function gy(n,e,t=[],r={}){return n.map((s,i)=>{let o=[...t,String(i)],a=typeof s.id=="string"?s.id:o.join("-");if(At(s.index!==!0||!s.children,"Cannot specify children on an index route"),At(!r[a],`Found a route id collision on id "${a}".  Route id's must be globally unique within Data Router usages`),Tj(s)){let l={...s,...e(s),id:a};return r[a]=l,l}else{let l={...s,...e(s),id:a,children:void 0};return r[a]=l,s.children&&(l.children=gy(s.children,e,o,r)),l}})}function sl(n,e,t="/"){return zg(n,e,t,!1)}function zg(n,e,t,r){let s=typeof e=="string"?Nl(e):e,i=Yi(s.pathname||"/",t);if(i==null)return null;let o=u$(n);Rj(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=zj(i);a=Mj(o[l],c,r)}return a}function _j(n,e){let{route:t,pathname:r,params:s}=n;return{id:t.id,pathname:r,params:s,data:e[t.id],handle:t.handle}}function u$(n,e=[],t=[],r=""){let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(At(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let c=ko([r,l.relativePath]),d=t.concat(l);i.children&&i.children.length>0&&(At(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),u$(i.children,e,d,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:Oj(c,i.index),routesMeta:d})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of c$(i.path))s(i,o,l)}),e}function c$(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=c$(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function Rj(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Lj(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var Nj=/^:[\w-]+$/,Aj=3,$j=2,Dj=1,Pj=10,Fj=-2,O_=n=>n==="*";function Oj(n,e){let t=n.split("/"),r=t.length;return t.some(O_)&&(r+=Fj),e&&(r+=$j),t.filter(s=>!O_(s)).reduce((s,i)=>s+(Nj.test(i)?Aj:i===""?Dj:Pj),r)}function Lj(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function Mj(n,e,t=!1){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=yy({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),p=l.route;if(!f&&c&&t&&!r[r.length-1].route.index&&(f=yy({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:ko([i,f.pathname]),pathnameBase:Wj(ko([i,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(i=ko([i,f.pathnameBase]))}return o}function yy(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=Vj(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,{paramName:d,isOptional:f},p)=>{if(d==="*"){let y=a[p]||"";o=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[p];return f&&!g?c[d]=void 0:c[d]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:n}}function Vj(n,e=!1,t=!0){Ir(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function zj(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ir(!1,`The URL path "${n}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Yi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function Bj(n,e="/"){let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Nl(n):n;return{pathname:t?t.startsWith("/")?t:Uj(t,e):e,search:Gj(r),hash:jj(s)}}function Uj(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Ow(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function h$(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function m0(n){let e=h$(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function g0(n,e,t,r=!1){let s;typeof n=="string"?s=Nl(n):(s={...n},At(!s.pathname||!s.pathname.includes("?"),Ow("?","pathname","search",s)),At(!s.pathname||!s.pathname.includes("#"),Ow("#","pathname","hash",s)),At(!s.search||!s.search.includes("#"),Ow("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let f=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;s.pathname=p.join("/")}a=f>=0?e[f]:"/"}let l=Bj(s,a),c=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}var ko=n=>n.join("/").replace(/\/\/+/g,"/"),Wj=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Gj=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,jj=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,vy=class{constructor(n,e,t,r=!1){this.status=n,this.statusText=e||"",this.internal=r,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function y0(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var d$=["POST","PUT","PATCH","DELETE"],Hj=new Set(d$),qj=["GET",...d$],Kj=new Set(qj),Xj=new Set([301,302,303,307,308]),Yj=new Set([307,308]),Lw={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Qj={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},_d={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},cI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Jj=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),f$="remix-router-transitions",p$=Symbol("ResetLoaderData");function Zj(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";At(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let r=n.mapRouteProperties||Jj,s={},i=gy(n.routes,r,void 0,s),o,a=n.basename||"/",l=n.dataStrategy||sH,c=n.patchRoutesOnNavigation,d={...n.future},f=null,p=new Set,g=null,y=null,w=null,x=n.hydrationData!=null,I=sl(i,n.history.location,a),C=null;if(I==null&&!c){let X=hi(404,{pathname:n.history.location.pathname}),{matches:ae,route:ye}=q_(i);I=ae,C={[ye.id]:X}}I&&!n.hydrationData&&Ii(I,i,n.history.location.pathname).active&&(I=null);let k;if(I)if(I.some(X=>X.route.lazy))k=!1;else if(!I.some(X=>X.route.loader))k=!0;else{let X=n.hydrationData?n.hydrationData.loaderData:null,ae=n.hydrationData?n.hydrationData.errors:null;if(ae){let ye=I.findIndex(Ce=>ae[Ce.route.id]!==void 0);k=I.slice(0,ye+1).every(Ce=>!A1(Ce.route,X,ae))}else k=I.every(ye=>!A1(ye.route,X,ae))}else{k=!1,I=[];let X=Ii(null,i,n.history.location.pathname);X.active&&X.matches&&(I=X.matches)}let E,_={historyAction:n.history.action,location:n.history.location,matches:I,initialized:k,navigation:Lw,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||C,fetchers:new Map,blockers:new Map},L="POP",P=!1,A,$=!1,D=new Map,R=null,M=!1,O=!1,Z=new Set,q=new Map,se=0,le=-1,j=new Map,Q=new Set,ee=new Map,U=new Map,H=new Set,ue=new Map,Ie,be=null;function ke(){if(f=n.history.listen(({action:X,location:ae,delta:ye})=>{if(Ie){Ie(),Ie=void 0;return}Ir(ue.size===0||ye!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ce=_a({currentLocation:_.location,nextLocation:ae,historyAction:X});if(Ce&&ye!=null){let Be=new Promise(He=>{Ie=He});n.history.go(ye*-1),so(Ce,{state:"blocked",location:ae,proceed(){so(Ce,{state:"proceeding",proceed:void 0,reset:void 0,location:ae}),Be.then(()=>n.history.go(ye))},reset(){let He=new Map(_.blockers);He.set(Ce,_d),Ae({blockers:He})}});return}return gt(X,ae)}),t){mH(e,D);let X=()=>gH(e,D);e.addEventListener("pagehide",X),R=()=>e.removeEventListener("pagehide",X)}return _.initialized||gt("POP",_.location,{initialHydration:!0}),E}function De(){f&&f(),R&&R(),p.clear(),A&&A.abort(),_.fetchers.forEach((X,ae)=>Pn(ae)),_.blockers.forEach((X,ae)=>ro(ae))}function Fe(X){return p.add(X),()=>p.delete(X)}function Ae(X,ae={}){_={..._,...X};let ye=[],Ce=[];_.fetchers.forEach((Be,He)=>{Be.state==="idle"&&(H.has(He)?ye.push(He):Ce.push(He))}),[...p].forEach(Be=>Be(_,{deletedFetchers:ye,viewTransitionOpts:ae.viewTransitionOpts,flushSync:ae.flushSync===!0})),ye.forEach(Be=>Pn(Be)),Ce.forEach(Be=>_.fetchers.delete(Be))}function Ge(X,ae,{flushSync:ye}={}){var Oe,ht;let Ce=_.actionData!=null&&_.navigation.formMethod!=null&&zi(_.navigation.formMethod)&&_.navigation.state==="loading"&&((Oe=X.state)==null?void 0:Oe._isRedirect)!==!0,Be;ae.actionData?Object.keys(ae.actionData).length>0?Be=ae.actionData:Be=null:Ce?Be=_.actionData:Be=null;let He=ae.loaderData?j_(_.loaderData,ae.loaderData,ae.matches||[],ae.errors):_.loaderData,ot=_.blockers;ot.size>0&&(ot=new Map(ot),ot.forEach((xt,Zt)=>ot.set(Zt,_d)));let Ue=P===!0||_.navigation.formMethod!=null&&zi(_.navigation.formMethod)&&((ht=X.state)==null?void 0:ht._isRedirect)!==!0;o&&(i=o,o=void 0),M||L==="POP"||(L==="PUSH"?n.history.push(X,X.state):L==="REPLACE"&&n.history.replace(X,X.state));let Ke;if(L==="POP"){let xt=D.get(_.location.pathname);xt&&xt.has(X.pathname)?Ke={currentLocation:_.location,nextLocation:X}:D.has(X.pathname)&&(Ke={currentLocation:X,nextLocation:_.location})}else if($){let xt=D.get(_.location.pathname);xt?xt.add(X.pathname):(xt=new Set([X.pathname]),D.set(_.location.pathname,xt)),Ke={currentLocation:_.location,nextLocation:X}}Ae({...ae,actionData:Be,loaderData:He,historyAction:L,location:X,initialized:!0,navigation:Lw,revalidation:"idle",restoreScrollPosition:Ms(X,ae.matches||_.matches),preventScrollReset:Ue,blockers:ot},{viewTransitionOpts:Ke,flushSync:ye===!0}),L="POP",P=!1,$=!1,M=!1,O=!1,be==null||be.resolve(),be=null}async function st(X,ae){if(typeof X=="number"){n.history.go(X);return}let ye=N1(_.location,_.matches,a,X,ae==null?void 0:ae.fromRouteId,ae==null?void 0:ae.relative),{path:Ce,submission:Be,error:He}=L_(!1,ye,ae),ot=_.location,Ue=lf(_.location,Ce,ae&&ae.state);Ue={...Ue,...n.history.encodeLocation(Ue)};let Ke=ae&&ae.replace!=null?ae.replace:void 0,Oe="PUSH";Ke===!0?Oe="REPLACE":Ke===!1||Be!=null&&zi(Be.formMethod)&&Be.formAction===_.location.pathname+_.location.search&&(Oe="REPLACE");let ht=ae&&"preventScrollReset"in ae?ae.preventScrollReset===!0:void 0,xt=(ae&&ae.flushSync)===!0,Zt=_a({currentLocation:ot,nextLocation:Ue,historyAction:Oe});if(Zt){so(Zt,{state:"blocked",location:Ue,proceed(){so(Zt,{state:"proceeding",proceed:void 0,reset:void 0,location:Ue}),st(X,ae)},reset(){let Fn=new Map(_.blockers);Fn.set(Zt,_d),Ae({blockers:Fn})}});return}await gt(Oe,Ue,{submission:Be,pendingError:He,preventScrollReset:ht,replace:ae&&ae.replace,enableViewTransition:ae&&ae.viewTransition,flushSync:xt})}function Et(){be||(be=yH()),Dn(),Ae({revalidation:"loading"});let X=be.promise;return _.navigation.state==="submitting"?X:_.navigation.state==="idle"?(gt(_.historyAction,_.location,{startUninterruptedRevalidation:!0}),X):(gt(L||_.historyAction,_.navigation.location,{overrideNavigation:_.navigation,enableViewTransition:$===!0}),X)}async function gt(X,ae,ye){A&&A.abort(),A=null,L=X,M=(ye&&ye.startUninterruptedRevalidation)===!0,vs(_.location,_.matches),P=(ye&&ye.preventScrollReset)===!0,$=(ye&&ye.enableViewTransition)===!0;let Ce=o||i,Be=ye&&ye.overrideNavigation,He=sl(Ce,ae,a),ot=(ye&&ye.flushSync)===!0,Ue=Ii(He,Ce,ae.pathname);if(Ue.active&&Ue.matches&&(He=Ue.matches),!He){let{error:Dt,notFoundMatches:Gt,route:en}=bi(ae.pathname);Ge(ae,{matches:Gt,loaderData:{},errors:{[en.id]:Dt}},{flushSync:ot});return}if(_.initialized&&!O&&cH(_.location,ae)&&!(ye&&ye.submission&&zi(ye.submission.formMethod))){Ge(ae,{matches:He},{flushSync:ot});return}A=new AbortController;let Ke=Mc(n.history,ae,A.signal,ye&&ye.submission),Oe;if(ye&&ye.pendingError)Oe=[hu(He).route.id,{type:"error",error:ye.pendingError}];else if(ye&&ye.submission&&zi(ye.submission.formMethod)){let Dt=await Wt(Ke,ae,ye.submission,He,Ue.active,{replace:ye.replace,flushSync:ot});if(Dt.shortCircuited)return;if(Dt.pendingActionResult){let[Gt,en]=Dt.pendingActionResult;if(js(en)&&y0(en.error)&&en.error.status===404){A=null,Ge(ae,{matches:Dt.matches,loaderData:{},errors:{[Gt]:en.error}});return}}He=Dt.matches||He,Oe=Dt.pendingActionResult,Be=Mw(ae,ye.submission),ot=!1,Ue.active=!1,Ke=Mc(n.history,Ke.url,Ke.signal)}let{shortCircuited:ht,matches:xt,loaderData:Zt,errors:Fn}=await Rt(Ke,ae,He,Ue.active,Be,ye&&ye.submission,ye&&ye.fetcherSubmission,ye&&ye.replace,ye&&ye.initialHydration===!0,ot,Oe);ht||(A=null,Ge(ae,{matches:xt||He,...H_(Oe),loaderData:Zt,errors:Fn}))}async function Wt(X,ae,ye,Ce,Be,He={}){Dn();let ot=fH(ae,ye);if(Ae({navigation:ot},{flushSync:He.flushSync===!0}),Be){let Oe=await is(Ce,ae.pathname,X.signal);if(Oe.type==="aborted")return{shortCircuited:!0};if(Oe.type==="error"){let ht=hu(Oe.partialMatches).route.id;return{matches:Oe.partialMatches,pendingActionResult:[ht,{type:"error",error:Oe.error}]}}else if(Oe.matches)Ce=Oe.matches;else{let{notFoundMatches:ht,error:xt,route:Zt}=bi(ae.pathname);return{matches:ht,pendingActionResult:[Zt.id,{type:"error",error:xt}]}}}let Ue,Ke=Vd(Ce,ae);if(!Ke.route.action&&!Ke.route.lazy)Ue={type:"error",error:hi(405,{method:X.method,pathname:ae.pathname,routeId:Ke.route.id})};else if(Ue=(await yn("action",_,X,[Ke],Ce,null))[Ke.route.id],X.signal.aborted)return{shortCircuited:!0};if(yu(Ue)){let Oe;return He&&He.replace!=null?Oe=He.replace:Oe=U_(Ue.response.headers.get("Location"),new URL(X.url),a)===_.location.pathname+_.location.search,await pn(X,Ue,!0,{submission:ye,replace:Oe}),{shortCircuited:!0}}if(js(Ue)){let Oe=hu(Ce,Ke.route.id);return(He&&He.replace)!==!0&&(L="PUSH"),{matches:Ce,pendingActionResult:[Oe.route.id,Ue]}}return{matches:Ce,pendingActionResult:[Ke.route.id,Ue]}}async function Rt(X,ae,ye,Ce,Be,He,ot,Ue,Ke,Oe,ht){let xt=Be||Mw(ae,He),Zt=He||ot||X_(xt),Fn=!M&&!Ke;if(Ce){if(Fn){let vn=kt(ht);Ae({navigation:xt,...vn!==void 0?{actionData:vn}:{}},{flushSync:Oe})}let Vt=await is(ye,ae.pathname,X.signal);if(Vt.type==="aborted")return{shortCircuited:!0};if(Vt.type==="error"){let vn=hu(Vt.partialMatches).route.id;return{matches:Vt.partialMatches,loaderData:{},errors:{[vn]:Vt.error}}}else if(Vt.matches)ye=Vt.matches;else{let{error:vn,notFoundMatches:Rr,route:ki}=bi(ae.pathname);return{matches:Rr,loaderData:{},errors:{[ki.id]:vn}}}}let Dt=o||i,[Gt,en]=V_(n.history,_,ye,Zt,ae,Ke===!0,O,Z,H,ee,Q,Dt,a,ht);if(le=++se,Gt.length===0&&en.length===0){let Vt=Zs();return Ge(ae,{matches:ye,loaderData:{},errors:ht&&js(ht[1])?{[ht[0]]:ht[1].error}:null,...H_(ht),...Vt?{fetchers:new Map(_.fetchers)}:{}},{flushSync:Oe}),{shortCircuited:!0}}if(Fn){let Vt={};if(!Ce){Vt.navigation=xt;let vn=kt(ht);vn!==void 0&&(Vt.actionData=vn)}en.length>0&&(Vt.fetchers=Ht(en)),Ae(Vt,{flushSync:Oe})}en.forEach(Vt=>{Wn(Vt.key),Vt.controller&&q.set(Vt.key,Vt.controller)});let Ci=()=>en.forEach(Vt=>Wn(Vt.key));A&&A.signal.addEventListener("abort",Ci);let{loaderResults:Si,fetcherResults:Wr}=await Tr(_,ye,Gt,en,X);if(X.signal.aborted)return{shortCircuited:!0};A&&A.signal.removeEventListener("abort",Ci),en.forEach(Vt=>q.delete(Vt.key));let _r=mg(Si);if(_r)return await pn(X,_r.result,!0,{replace:Ue}),{shortCircuited:!0};if(_r=mg(Wr),_r)return Q.add(_r.key),await pn(X,_r.result,!0,{replace:Ue}),{shortCircuited:!0};let{loaderData:Go,errors:io}=G_(_,ye,Si,ht,en,Wr);Ke&&_.errors&&(io={..._.errors,...io});let Ei=Zs(),tn=Ls(le),jo=Ei||tn||en.length>0;return{matches:ye,loaderData:Go,errors:io,...jo?{fetchers:new Map(_.fetchers)}:{}}}function kt(X){if(X&&!js(X[1]))return{[X[0]]:X[1].data};if(_.actionData)return Object.keys(_.actionData).length===0?null:_.actionData}function Ht(X){return X.forEach(ae=>{let ye=_.fetchers.get(ae.key),Ce=Rd(void 0,ye?ye.data:void 0);_.fetchers.set(ae.key,Ce)}),new Map(_.fetchers)}async function qt(X,ae,ye,Ce){Wn(X);let Be=(Ce&&Ce.flushSync)===!0,He=o||i,ot=N1(_.location,_.matches,a,ye,ae,Ce==null?void 0:Ce.relative),Ue=sl(He,ot,a),Ke=Ii(Ue,He,ot);if(Ke.active&&Ke.matches&&(Ue=Ke.matches),!Ue){Tt(X,ae,hi(404,{pathname:ot}),{flushSync:Be});return}let{path:Oe,submission:ht,error:xt}=L_(!0,ot,Ce);if(xt){Tt(X,ae,xt,{flushSync:Be});return}let Zt=Vd(Ue,Oe),Fn=(Ce&&Ce.preventScrollReset)===!0;if(ht&&zi(ht.formMethod)){await mr(X,ae,Oe,Zt,Ue,Ke.active,Be,Fn,ht);return}ee.set(X,{routeId:ae,path:Oe}),await nn(X,ae,Oe,Zt,Ue,Ke.active,Be,Fn,ht)}async function mr(X,ae,ye,Ce,Be,He,ot,Ue,Ke){Dn(),ee.delete(X);function Oe(xn){if(!xn.route.action&&!xn.route.lazy){let xs=hi(405,{method:Ke.formMethod,pathname:ye,routeId:ae});return Tt(X,ae,xs,{flushSync:ot}),!0}return!1}if(!He&&Oe(Ce))return;let ht=_.fetchers.get(X);En(X,pH(Ke,ht),{flushSync:ot});let xt=new AbortController,Zt=Mc(n.history,ye,xt.signal,Ke);if(He){let xn=await is(Be,ye,Zt.signal);if(xn.type==="aborted")return;if(xn.type==="error"){Tt(X,ae,xn.error,{flushSync:ot});return}else if(xn.matches){if(Be=xn.matches,Ce=Vd(Be,ye),Oe(Ce))return}else{Tt(X,ae,hi(404,{pathname:ye}),{flushSync:ot});return}}q.set(X,xt);let Fn=se,Gt=(await yn("action",_,Zt,[Ce],Be,X))[Ce.route.id];if(Zt.signal.aborted){q.get(X)===xt&&q.delete(X);return}if(H.has(X)){if(yu(Gt)||js(Gt)){En(X,Za(void 0));return}}else{if(yu(Gt))if(q.delete(X),le>Fn){En(X,Za(void 0));return}else return Q.add(X),En(X,Rd(Ke)),pn(Zt,Gt,!1,{fetcherSubmission:Ke,preventScrollReset:Ue});if(js(Gt)){Tt(X,ae,Gt.error);return}}let en=_.navigation.location||_.location,Ci=Mc(n.history,en,xt.signal),Si=o||i,Wr=_.navigation.state!=="idle"?sl(Si,_.navigation.location,a):_.matches;At(Wr,"Didn't find any matches after fetcher action");let _r=++se;j.set(X,_r);let Go=Rd(Ke,Gt.data);_.fetchers.set(X,Go);let[io,Ei]=V_(n.history,_,Wr,Ke,en,!1,O,Z,H,ee,Q,Si,a,[Ce.route.id,Gt]);Ei.filter(xn=>xn.key!==X).forEach(xn=>{let xs=xn.key,Gr=_.fetchers.get(xs),sc=Rd(void 0,Gr?Gr.data:void 0);_.fetchers.set(xs,sc),Wn(xs),xn.controller&&q.set(xs,xn.controller)}),Ae({fetchers:new Map(_.fetchers)});let tn=()=>Ei.forEach(xn=>Wn(xn.key));xt.signal.addEventListener("abort",tn);let{loaderResults:jo,fetcherResults:Vt}=await Tr(_,Wr,io,Ei,Ci);if(xt.signal.aborted)return;xt.signal.removeEventListener("abort",tn),j.delete(X),q.delete(X),Ei.forEach(xn=>q.delete(xn.key));let vn=mg(jo);if(vn)return pn(Ci,vn.result,!1,{preventScrollReset:Ue});if(vn=mg(Vt),vn)return Q.add(vn.key),pn(Ci,vn.result,!1,{preventScrollReset:Ue});let{loaderData:Rr,errors:ki}=G_(_,Wr,jo,void 0,Ei,Vt);if(_.fetchers.has(X)){let xn=Za(Gt.data);_.fetchers.set(X,xn)}Ls(_r),_.navigation.state==="loading"&&_r>le?(At(L,"Expected pending action"),A&&A.abort(),Ge(_.navigation.location,{matches:Wr,loaderData:Rr,errors:ki,fetchers:new Map(_.fetchers)})):(Ae({errors:ki,loaderData:j_(_.loaderData,Rr,Wr,ki),fetchers:new Map(_.fetchers)}),O=!1)}async function nn(X,ae,ye,Ce,Be,He,ot,Ue,Ke){let Oe=_.fetchers.get(X);En(X,Rd(Ke,Oe?Oe.data:void 0),{flushSync:ot});let ht=new AbortController,xt=Mc(n.history,ye,ht.signal);if(He){let Gt=await is(Be,ye,xt.signal);if(Gt.type==="aborted")return;if(Gt.type==="error"){Tt(X,ae,Gt.error,{flushSync:ot});return}else if(Gt.matches)Be=Gt.matches,Ce=Vd(Be,ye);else{Tt(X,ae,hi(404,{pathname:ye}),{flushSync:ot});return}}q.set(X,ht);let Zt=se,Dt=(await yn("loader",_,xt,[Ce],Be,X))[Ce.route.id];if(q.get(X)===ht&&q.delete(X),!xt.signal.aborted){if(H.has(X)){En(X,Za(void 0));return}if(yu(Dt))if(le>Zt){En(X,Za(void 0));return}else{Q.add(X),await pn(xt,Dt,!1,{preventScrollReset:Ue});return}if(js(Dt)){Tt(X,ae,Dt.error);return}En(X,Za(Dt.data))}}async function pn(X,ae,ye,{submission:Ce,fetcherSubmission:Be,preventScrollReset:He,replace:ot}={}){ae.response.headers.has("X-Remix-Revalidate")&&(O=!0);let Ue=ae.response.headers.get("Location");At(Ue,"Expected a Location header on the redirect Response"),Ue=U_(Ue,new URL(X.url),a);let Ke=lf(_.location,Ue,{_isRedirect:!0});if(t){let Dt=!1;if(ae.response.headers.has("X-Remix-Reload-Document"))Dt=!0;else if(cI.test(Ue)){const Gt=n.history.createURL(Ue);Dt=Gt.origin!==e.location.origin||Yi(Gt.pathname,a)==null}if(Dt){ot?e.location.replace(Ue):e.location.assign(Ue);return}}A=null;let Oe=ot===!0||ae.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:ht,formAction:xt,formEncType:Zt}=_.navigation;!Ce&&!Be&&ht&&xt&&Zt&&(Ce=X_(_.navigation));let Fn=Ce||Be;if(Yj.has(ae.response.status)&&Fn&&zi(Fn.formMethod))await gt(Oe,Ke,{submission:{...Fn,formAction:Ue},preventScrollReset:He||P,enableViewTransition:ye?$:void 0});else{let Dt=Mw(Ke,Ce);await gt(Oe,Ke,{overrideNavigation:Dt,fetcherSubmission:Be,preventScrollReset:He||P,enableViewTransition:ye?$:void 0})}}async function yn(X,ae,ye,Ce,Be,He){let ot,Ue={};try{ot=await iH(l,X,ae,ye,Ce,Be,He,s,r)}catch(Ke){return Ce.forEach(Oe=>{Ue[Oe.route.id]={type:"error",error:Ke}}),Ue}for(let[Ke,Oe]of Object.entries(ot))if(hH(Oe)){let ht=Oe.result;Ue[Ke]={type:"redirect",response:lH(ht,ye,Ke,Be,a)}}else Ue[Ke]=await aH(Oe);return Ue}async function Tr(X,ae,ye,Ce,Be){let He=yn("loader",X,Be,ye,ae,null),ot=Promise.all(Ce.map(async Oe=>{if(Oe.matches&&Oe.match&&Oe.controller){let xt=(await yn("loader",X,Mc(n.history,Oe.path,Oe.controller.signal),[Oe.match],Oe.matches,Oe.key))[Oe.match.route.id];return{[Oe.key]:xt}}else return Promise.resolve({[Oe.key]:{type:"error",error:hi(404,{pathname:Oe.path})}})})),Ue=await He,Ke=(await ot).reduce((Oe,ht)=>Object.assign(Oe,ht),{});return{loaderResults:Ue,fetcherResults:Ke}}function Dn(){O=!0,ee.forEach((X,ae)=>{q.has(ae)&&Z.add(ae),Wn(ae)})}function En(X,ae,ye={}){_.fetchers.set(X,ae),Ae({fetchers:new Map(_.fetchers)},{flushSync:(ye&&ye.flushSync)===!0})}function Tt(X,ae,ye,Ce={}){let Be=hu(_.matches,ae);Pn(X),Ae({errors:{[Be.route.id]:ye},fetchers:new Map(_.fetchers)},{flushSync:(Ce&&Ce.flushSync)===!0})}function Jt(X){return U.set(X,(U.get(X)||0)+1),H.has(X)&&H.delete(X),_.fetchers.get(X)||Qj}function Pn(X){let ae=_.fetchers.get(X);q.has(X)&&!(ae&&ae.state==="loading"&&j.has(X))&&Wn(X),ee.delete(X),j.delete(X),Q.delete(X),H.delete(X),Z.delete(X),_.fetchers.delete(X)}function Os(X){let ae=(U.get(X)||0)-1;ae<=0?(U.delete(X),H.add(X)):U.set(X,ae),Ae({fetchers:new Map(_.fetchers)})}function Wn(X){let ae=q.get(X);ae&&(ae.abort(),q.delete(X))}function ys(X){for(let ae of X){let ye=Jt(ae),Ce=Za(ye.data);_.fetchers.set(ae,Ce)}}function Zs(){let X=[],ae=!1;for(let ye of Q){let Ce=_.fetchers.get(ye);At(Ce,`Expected fetcher: ${ye}`),Ce.state==="loading"&&(Q.delete(ye),X.push(ye),ae=!0)}return ys(X),ae}function Ls(X){let ae=[];for(let[ye,Ce]of j)if(Ce<X){let Be=_.fetchers.get(ye);At(Be,`Expected fetcher: ${ye}`),Be.state==="loading"&&(Wn(ye),j.delete(ye),ae.push(ye))}return ys(ae),ae.length>0}function Bo(X,ae){let ye=_.blockers.get(X)||_d;return ue.get(X)!==ae&&ue.set(X,ae),ye}function ro(X){_.blockers.delete(X),ue.delete(X)}function so(X,ae){let ye=_.blockers.get(X)||_d;At(ye.state==="unblocked"&&ae.state==="blocked"||ye.state==="blocked"&&ae.state==="blocked"||ye.state==="blocked"&&ae.state==="proceeding"||ye.state==="blocked"&&ae.state==="unblocked"||ye.state==="proceeding"&&ae.state==="unblocked",`Invalid blocker state transition: ${ye.state} -> ${ae.state}`);let Ce=new Map(_.blockers);Ce.set(X,ae),Ae({blockers:Ce})}function _a({currentLocation:X,nextLocation:ae,historyAction:ye}){if(ue.size===0)return;ue.size>1&&Ir(!1,"A router only supports one blocker at a time");let Ce=Array.from(ue.entries()),[Be,He]=Ce[Ce.length-1],ot=_.blockers.get(Be);if(!(ot&&ot.state==="proceeding")&&He({currentLocation:X,nextLocation:ae,historyAction:ye}))return Be}function bi(X){let ae=hi(404,{pathname:X}),ye=o||i,{matches:Ce,route:Be}=q_(ye);return{notFoundMatches:Ce,route:Be,error:ae}}function Ra(X,ae,ye){if(g=X,w=ae,y=ye||null,!x&&_.navigation===Lw){x=!0;let Ce=Ms(_.location,_.matches);Ce!=null&&Ae({restoreScrollPosition:Ce})}return()=>{g=null,w=null,y=null}}function Uo(X,ae){return y&&y(X,ae.map(Ce=>_j(Ce,_.loaderData)))||X.key}function vs(X,ae){if(g&&w){let ye=Uo(X,ae);g[ye]=w()}}function Ms(X,ae){if(g){let ye=Uo(X,ae),Ce=g[ye];if(typeof Ce=="number")return Ce}return null}function Ii(X,ae,ye){if(c)if(X){if(Object.keys(X[0].params).length>0)return{active:!0,matches:zg(ae,ye,a,!0)}}else return{active:!0,matches:zg(ae,ye,a,!0)||[]};return{active:!1,matches:null}}async function is(X,ae,ye){if(!c)return{type:"success",matches:X};let Ce=X;for(;;){let Be=o==null,He=o||i,ot=s;try{await c({path:ae,matches:Ce,patch:(Oe,ht)=>{ye.aborted||B_(Oe,ht,He,ot,r)}})}catch(Oe){return{type:"error",error:Oe,partialMatches:Ce}}finally{Be&&!ye.aborted&&(i=[...i])}if(ye.aborted)return{type:"aborted"};let Ue=sl(He,ae,a);if(Ue)return{type:"success",matches:Ue};let Ke=zg(He,ae,a,!0);if(!Ke||Ce.length===Ke.length&&Ce.every((Oe,ht)=>Oe.route.id===Ke[ht].route.id))return{type:"success",matches:null};Ce=Ke}}function Ul(X){s={},o=gy(X,r,void 0,s)}function Wo(X,ae){let ye=o==null;B_(X,ae,o||i,s,r),ye&&(i=[...i],Ae({}))}return E={get basename(){return a},get future(){return d},get state(){return _},get routes(){return i},get window(){return e},initialize:ke,subscribe:Fe,enableScrollRestoration:Ra,navigate:st,fetch:qt,revalidate:Et,createHref:X=>n.history.createHref(X),encodeLocation:X=>n.history.encodeLocation(X),getFetcher:Jt,deleteFetcher:Os,dispose:De,getBlocker:Bo,deleteBlocker:ro,patchRoutes:Wo,_internalFetchControllers:q,_internalSetRoutes:Ul},E}function eH(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function N1(n,e,t,r,s,i){let o,a;if(s){o=[];for(let c of e)if(o.push(c),c.route.id===s){a=c;break}}else o=e,a=e[e.length-1];let l=g0(r||".",m0(o),Yi(n.pathname,t)||n.pathname,i==="path");if(r==null&&(l.search=n.search,l.hash=n.hash),(r==null||r===""||r===".")&&a){let c=hI(l.search);if(a.route.index&&!c)l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index";else if(!a.route.index&&c){let d=new URLSearchParams(l.search),f=d.getAll("index");d.delete("index"),f.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();l.search=p?`?${p}`:""}}return t!=="/"&&(l.pathname=l.pathname==="/"?t:ko([t,l.pathname])),Cl(l)}function L_(n,e,t){if(!t||!eH(t))return{path:e};if(t.formMethod&&!dH(t.formMethod))return{path:e,error:hi(405,{method:t.formMethod})};let r=()=>({path:e,error:hi(400,{type:"invalid-body"})}),i=(t.formMethod||"get").toUpperCase(),o=g$(e);if(t.body!==void 0){if(t.formEncType==="text/plain"){if(!zi(i))return r();let f=typeof t.body=="string"?t.body:t.body instanceof FormData||t.body instanceof URLSearchParams?Array.from(t.body.entries()).reduce((p,[g,y])=>`${p}${g}=${y}
`,""):String(t.body);return{path:e,submission:{formMethod:i,formAction:o,formEncType:t.formEncType,formData:void 0,json:void 0,text:f}}}else if(t.formEncType==="application/json"){if(!zi(i))return r();try{let f=typeof t.body=="string"?JSON.parse(t.body):t.body;return{path:e,submission:{formMethod:i,formAction:o,formEncType:t.formEncType,formData:void 0,json:f,text:void 0}}}catch{return r()}}}At(typeof FormData=="function","FormData is not available in this environment");let a,l;if(t.formData)a=$1(t.formData),l=t.formData;else if(t.body instanceof FormData)a=$1(t.body),l=t.body;else if(t.body instanceof URLSearchParams)a=t.body,l=W_(a);else if(t.body==null)a=new URLSearchParams,l=new FormData;else try{a=new URLSearchParams(t.body),l=W_(a)}catch{return r()}let c={formMethod:i,formAction:o,formEncType:t&&t.formEncType||"application/x-www-form-urlencoded",formData:l,json:void 0,text:void 0};if(zi(c.formMethod))return{path:e,submission:c};let d=Nl(e);return n&&d.search&&hI(d.search)&&a.append("index",""),d.search=`?${a}`,{path:Cl(d),submission:c}}function M_(n,e,t=!1){let r=n.findIndex(s=>s.route.id===e);return r>=0?n.slice(0,t?r+1:r):n}function V_(n,e,t,r,s,i,o,a,l,c,d,f,p,g){let y=g?js(g[1])?g[1].error:g[1].data:void 0,w=n.createURL(e.location),x=n.createURL(s),I=t;i&&e.errors?I=M_(t,Object.keys(e.errors)[0],!0):g&&js(g[1])&&(I=M_(t,g[0]));let C=g?g[1].statusCode:void 0,k=C&&C>=400,E=I.filter((L,P)=>{let{route:A}=L;if(A.lazy)return!0;if(A.loader==null)return!1;if(i)return A1(A,e.loaderData,e.errors);if(tH(e.loaderData,e.matches[P],L))return!0;let $=e.matches[P],D=L;return z_(L,{currentUrl:w,currentParams:$.params,nextUrl:x,nextParams:D.params,...r,actionResult:y,actionStatus:C,defaultShouldRevalidate:k?!1:o||w.pathname+w.search===x.pathname+x.search||w.search!==x.search||nH($,D)})}),_=[];return c.forEach((L,P)=>{if(i||!t.some(M=>M.route.id===L.routeId)||l.has(P))return;let A=sl(f,L.path,p);if(!A){_.push({key:P,routeId:L.routeId,path:L.path,matches:null,match:null,controller:null});return}let $=e.fetchers.get(P),D=Vd(A,L.path),R=!1;d.has(P)?R=!1:a.has(P)?(a.delete(P),R=!0):$&&$.state!=="idle"&&$.data===void 0?R=o:R=z_(D,{currentUrl:w,currentParams:e.matches[e.matches.length-1].params,nextUrl:x,nextParams:t[t.length-1].params,...r,actionResult:y,actionStatus:C,defaultShouldRevalidate:k?!1:o}),R&&_.push({key:P,routeId:L.routeId,path:L.path,matches:A,match:D,controller:new AbortController})}),[E,_]}function A1(n,e,t){if(n.lazy)return!0;if(!n.loader)return!1;let r=e!=null&&e[n.id]!==void 0,s=t!=null&&t[n.id]!==void 0;return!r&&s?!1:typeof n.loader=="function"&&n.loader.hydrate===!0?!0:!r&&!s}function tH(n,e,t){let r=!e||t.route.id!==e.route.id,s=!n.hasOwnProperty(t.route.id);return r||s}function nH(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function z_(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}function B_(n,e,t,r,s){let i;if(n){let l=r[n];At(l,`No route found to patch children into: routeId = ${n}`),l.children||(l.children=[]),i=l.children}else i=t;let o=e.filter(l=>!i.some(c=>m$(l,c))),a=gy(o,s,[n||"_","patch",String((i==null?void 0:i.length)||"0")],r);i.push(...a)}function m$(n,e){return"id"in n&&"id"in e&&n.id===e.id?!0:n.index===e.index&&n.path===e.path&&n.caseSensitive===e.caseSensitive?(!n.children||n.children.length===0)&&(!e.children||e.children.length===0)?!0:n.children.every((t,r)=>{var s;return(s=e.children)==null?void 0:s.some(i=>m$(t,i))}):!1}async function rH(n,e,t){if(!n.lazy)return;let r=await n.lazy();if(!n.lazy)return;let s=t[n.id];At(s,"No route found in manifest");let i={};for(let o in r){let l=s[o]!==void 0&&o!=="hasErrorBoundary";Ir(!l,`Route "${s.id}" has a static property "${o}" defined but its lazy function is also returning a value for this property. The lazy route property "${o}" will be ignored.`),!l&&!kj.has(o)&&(i[o]=r[o])}Object.assign(s,i),Object.assign(s,{...e(s),lazy:void 0})}async function sH({matches:n}){let e=n.filter(r=>r.shouldLoad);return(await Promise.all(e.map(r=>r.resolve()))).reduce((r,s,i)=>Object.assign(r,{[e[i].route.id]:s}),{})}async function iH(n,e,t,r,s,i,o,a,l,c){let d=i.map(g=>g.route.lazy?rH(g.route,l,a):void 0),f=i.map((g,y)=>{let w=d[y],x=s.some(C=>C.route.id===g.route.id);return{...g,shouldLoad:x,resolve:async C=>(C&&r.method==="GET"&&(g.route.lazy||g.route.loader)&&(x=!0),x?oH(e,r,g,w,C,c):Promise.resolve({type:"data",result:void 0}))}}),p=await n({matches:f,request:r,params:i[0].params,fetcherKey:o,context:c});try{await Promise.all(d)}catch{}return p}async function oH(n,e,t,r,s,i){let o,a,l=c=>{let d,f=new Promise((y,w)=>d=w);a=()=>d(),e.signal.addEventListener("abort",a);let p=y=>typeof c!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${n}" [routeId: ${t.route.id}]`)):c({request:e,params:t.params,context:i},...y!==void 0?[y]:[]),g=(async()=>{try{return{type:"data",result:await(s?s(w=>p(w)):p())}}catch(y){return{type:"error",result:y}}})();return Promise.race([g,f])};try{let c=t.route[n];if(r)if(c){let d,[f]=await Promise.all([l(c).catch(p=>{d=p}),r]);if(d!==void 0)throw d;o=f}else if(await r,c=t.route[n],c)o=await l(c);else if(n==="action"){let d=new URL(e.url),f=d.pathname+d.search;throw hi(405,{method:e.method,pathname:f,routeId:t.route.id})}else return{type:"data",result:void 0};else if(c)o=await l(c);else{let d=new URL(e.url),f=d.pathname+d.search;throw hi(404,{pathname:f})}}catch(c){return{type:"error",result:c}}finally{a&&e.signal.removeEventListener("abort",a)}return o}async function aH(n){var r,s,i,o;let{result:e,type:t}=n;if(y$(e)){let a;try{let l=e.headers.get("Content-Type");l&&/\bapplication\/json\b/.test(l)?e.body==null?a=null:a=await e.json():a=await e.text()}catch(l){return{type:"error",error:l}}return t==="error"?{type:"error",error:new vy(e.status,e.statusText,a),statusCode:e.status,headers:e.headers}:{type:"data",data:a,statusCode:e.status,headers:e.headers}}if(t==="error"){if(K_(e)){if(e.data instanceof Error)return{type:"error",error:e.data,statusCode:(r=e.init)==null?void 0:r.status};e=new vy(((s=e.init)==null?void 0:s.status)||500,void 0,e.data)}return{type:"error",error:e,statusCode:y0(e)?e.status:void 0}}return K_(e)?{type:"data",data:e.data,statusCode:(i=e.init)==null?void 0:i.status,headers:(o=e.init)!=null&&o.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function lH(n,e,t,r,s){let i=n.headers.get("Location");if(At(i,"Redirects returned/thrown from loaders/actions must have a Location header"),!cI.test(i)){let o=r.slice(0,r.findIndex(a=>a.route.id===t)+1);i=N1(new URL(e.url),o,s,i),n.headers.set("Location",i)}return n}function U_(n,e,t){if(cI.test(n)){let r=n,s=r.startsWith("//")?new URL(e.protocol+r):new URL(r),i=Yi(s.pathname,t)!=null;if(s.origin===e.origin&&i)return s.pathname+s.search+s.hash}return n}function Mc(n,e,t,r){let s=n.createURL(g$(e)).toString(),i={signal:t};if(r&&zi(r.formMethod)){let{formMethod:o,formEncType:a}=r;i.method=o.toUpperCase(),a==="application/json"?(i.headers=new Headers({"Content-Type":a}),i.body=JSON.stringify(r.json)):a==="text/plain"?i.body=r.text:a==="application/x-www-form-urlencoded"&&r.formData?i.body=$1(r.formData):i.body=r.formData}return new Request(s,i)}function $1(n){let e=new URLSearchParams;for(let[t,r]of n.entries())e.append(t,typeof r=="string"?r:r.name);return e}function W_(n){let e=new FormData;for(let[t,r]of n.entries())e.append(t,r);return e}function uH(n,e,t,r=!1,s=!1){let i={},o=null,a,l=!1,c={},d=t&&js(t[1])?t[1].error:void 0;return n.forEach(f=>{if(!(f.route.id in e))return;let p=f.route.id,g=e[p];if(At(!yu(g),"Cannot handle redirect results in processLoaderData"),js(g)){let y=g.error;if(d!==void 0&&(y=d,d=void 0),o=o||{},s)o[p]=y;else{let w=hu(n,p);o[w.route.id]==null&&(o[w.route.id]=y)}r||(i[p]=p$),l||(l=!0,a=y0(g.error)?g.error.status:500),g.headers&&(c[p]=g.headers)}else i[p]=g.data,g.statusCode&&g.statusCode!==200&&!l&&(a=g.statusCode),g.headers&&(c[p]=g.headers)}),d!==void 0&&t&&(o={[t[0]]:d},i[t[0]]=void 0),{loaderData:i,errors:o,statusCode:a||200,loaderHeaders:c}}function G_(n,e,t,r,s,i){let{loaderData:o,errors:a}=uH(e,t,r);return s.forEach(l=>{let{key:c,match:d,controller:f}=l,p=i[c];if(At(p,"Did not find corresponding fetcher result"),!(f&&f.signal.aborted))if(js(p)){let g=hu(n.matches,d==null?void 0:d.route.id);a&&a[g.route.id]||(a={...a,[g.route.id]:p.error}),n.fetchers.delete(c)}else if(yu(p))At(!1,"Unhandled fetcher revalidation redirect");else{let g=Za(p.data);n.fetchers.set(c,g)}}),{loaderData:o,errors:a}}function j_(n,e,t,r){let s=Object.entries(e).filter(([,i])=>i!==p$).reduce((i,[o,a])=>(i[o]=a,i),{});for(let i of t){let o=i.route.id;if(!e.hasOwnProperty(o)&&n.hasOwnProperty(o)&&i.route.loader&&(s[o]=n[o]),r&&r.hasOwnProperty(o))break}return s}function H_(n){return n?js(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function hu(n,e){return(e?n.slice(0,n.findIndex(r=>r.route.id===e)+1):[...n]).reverse().find(r=>r.route.hasErrorBoundary===!0)||n[0]}function q_(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function hi(n,{pathname:e,routeId:t,method:r,type:s,message:i}={}){let o="Unknown Server Error",a="Unknown @remix-run/router error";return n===400?(o="Bad Request",r&&e&&t?a=`You made a ${r} request to "${e}" but did not provide a \`loader\` for route "${t}", so there is no way to handle the request.`:s==="invalid-body"&&(a="Unable to encode submission body")):n===403?(o="Forbidden",a=`Route "${t}" does not match URL "${e}"`):n===404?(o="Not Found",a=`No route matches URL "${e}"`):n===405&&(o="Method Not Allowed",r&&e&&t?a=`You made a ${r.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${t}", so there is no way to handle the request.`:r&&(a=`Invalid request method "${r.toUpperCase()}"`)),new vy(n||500,o,new Error(a),!0)}function mg(n){let e=Object.entries(n);for(let t=e.length-1;t>=0;t--){let[r,s]=e[t];if(yu(s))return{key:r,result:s}}}function g$(n){let e=typeof n=="string"?Nl(n):n;return Cl({...e,hash:""})}function cH(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function hH(n){return y$(n.result)&&Xj.has(n.result.status)}function js(n){return n.type==="error"}function yu(n){return(n&&n.type)==="redirect"}function K_(n){return typeof n=="object"&&n!=null&&"type"in n&&"data"in n&&"init"in n&&n.type==="DataWithResponseInit"}function y$(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function dH(n){return Kj.has(n.toUpperCase())}function zi(n){return Hj.has(n.toUpperCase())}function hI(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function Vd(n,e){let t=typeof e=="string"?Nl(e).search:e.search;if(n[n.length-1].route.index&&hI(t||""))return n[n.length-1];let r=h$(n);return r[r.length-1]}function X_(n){let{formMethod:e,formAction:t,formEncType:r,text:s,formData:i,json:o}=n;if(!(!e||!t||!r)){if(s!=null)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:void 0,text:s};if(i!=null)return{formMethod:e,formAction:t,formEncType:r,formData:i,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:o,text:void 0}}}function Mw(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function fH(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Rd(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function pH(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function Za(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function mH(n,e){try{let t=n.sessionStorage.getItem(f$);if(t){let r=JSON.parse(t);for(let[s,i]of Object.entries(r||{}))i&&Array.isArray(i)&&e.set(s,new Set(i||[]))}}catch{}}function gH(n,e){if(e.size>0){let t={};for(let[r,s]of e)t[r]=[...s];try{n.sessionStorage.setItem(f$,JSON.stringify(t))}catch(r){Ir(!1,`Failed to save applied view transitions in sessionStorage (${r}).`)}}}function yH(){let n,e,t=new Promise((r,s)=>{n=async i=>{r(i);try{await t}catch{}},e=async i=>{s(i);try{await t}catch{}}});return{promise:t,resolve:n,reject:e}}var qu=ge.createContext(null);qu.displayName="DataRouter";var Df=ge.createContext(null);Df.displayName="DataRouterState";var dI=ge.createContext({isTransitioning:!1});dI.displayName="ViewTransition";var v$=ge.createContext(new Map);v$.displayName="Fetchers";var vH=ge.createContext(null);vH.displayName="Await";var eo=ge.createContext(null);eo.displayName="Navigation";var v0=ge.createContext(null);v0.displayName="Location";var to=ge.createContext({outlet:null,matches:[],isDataRoute:!1});to.displayName="Route";var fI=ge.createContext(null);fI.displayName="RouteError";function xH(n,{relative:e}={}){At($h(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=ge.useContext(eo),{hash:s,pathname:i,search:o}=Pf(n,{relative:e}),a=i;return t!=="/"&&(a=i==="/"?t:ko([t,i])),r.createHref({pathname:a,search:o,hash:s})}function $h(){return ge.useContext(v0)!=null}function Ca(){return At($h(),"useLocation() may be used only in the context of a <Router> component."),ge.useContext(v0).location}var x$="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function w$(n){ge.useContext(eo).static||ge.useLayoutEffect(n)}function pI(){let{isDataRoute:n}=ge.useContext(to);return n?DH():wH()}function wH(){At($h(),"useNavigate() may be used only in the context of a <Router> component.");let n=ge.useContext(qu),{basename:e,navigator:t}=ge.useContext(eo),{matches:r}=ge.useContext(to),{pathname:s}=Ca(),i=JSON.stringify(m0(r)),o=ge.useRef(!1);return w$(()=>{o.current=!0}),ge.useCallback((l,c={})=>{if(Ir(o.current,x$),!o.current)return;if(typeof l=="number"){t.go(l);return}let d=g0(l,JSON.parse(i),s,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:ko([e,d.pathname])),(c.replace?t.replace:t.push)(d,c.state,c)},[e,t,i,s,n])}ge.createContext(null);function bH(){let{matches:n}=ge.useContext(to),e=n[n.length-1];return e?e.params:{}}function Pf(n,{relative:e}={}){let{matches:t}=ge.useContext(to),{pathname:r}=Ca(),s=JSON.stringify(m0(t));return ge.useMemo(()=>g0(n,JSON.parse(s),r,e==="path"),[n,s,r,e])}function IH(n,e,t,r){At($h(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=ge.useContext(eo),{matches:i}=ge.useContext(to),o=i[i.length-1],a=o?o.params:{},l=o?o.pathname:"/",c=o?o.pathnameBase:"/",d=o&&o.route;{let I=d&&d.path||"";b$(l,!d||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let f=Ca(),p;p=f;let g=p.pathname||"/",y=g;if(c!=="/"){let I=c.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(I.length).join("/")}let w=sl(n,{pathname:y});return Ir(d||w!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ir(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),TH(w&&w.map(I=>Object.assign({},I,{params:Object.assign({},a,I.params),pathname:ko([c,s.encodeLocation?s.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?c:ko([c,s.encodeLocation?s.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),i,t,r)}function CH(){let n=$H(),e=y0(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=ge.createElement(ge.Fragment,null,ge.createElement("p",null," Hey developer "),ge.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ge.createElement("code",{style:i},"ErrorBoundary")," or"," ",ge.createElement("code",{style:i},"errorElement")," prop on your route.")),ge.createElement(ge.Fragment,null,ge.createElement("h2",null,"Unexpected Application Error!"),ge.createElement("h3",{style:{fontStyle:"italic"}},e),t?ge.createElement("pre",{style:s},t):null,o)}var SH=ge.createElement(CH,null),EH=class extends ge.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?ge.createElement(to.Provider,{value:this.props.routeContext},ge.createElement(fI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kH({routeContext:n,match:e,children:t}){let r=ge.useContext(qu);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),ge.createElement(to.Provider,{value:n},t)}function TH(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let s=n,i=t==null?void 0:t.errors;if(i!=null){let l=s.findIndex(c=>c.route.id&&(i==null?void 0:i[c.route.id])!==void 0);At(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),s=s.slice(0,Math.min(s.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<s.length;l++){let c=s[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(a=l),c.route.id){let{loaderData:d,errors:f}=t,p=c.route.loader&&!d.hasOwnProperty(c.route.id)&&(!f||f[c.route.id]===void 0);if(c.route.lazy||p){o=!0,a>=0?s=s.slice(0,a+1):s=[s[0]];break}}}return s.reduceRight((l,c,d)=>{let f,p=!1,g=null,y=null;t&&(f=i&&c.route.id?i[c.route.id]:void 0,g=c.route.errorElement||SH,o&&(a<0&&d===0?(b$("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,y=null):a===d&&(p=!0,y=c.route.hydrateFallbackElement||null)));let w=e.concat(s.slice(0,d+1)),x=()=>{let I;return f?I=g:p?I=y:c.route.Component?I=ge.createElement(c.route.Component,null):c.route.element?I=c.route.element:I=l,ge.createElement(kH,{match:c,routeContext:{outlet:l,matches:w,isDataRoute:t!=null},children:I})};return t&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?ge.createElement(EH,{location:t.location,revalidation:t.revalidation,component:g,error:f,children:x(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):x()},null)}function mI(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _H(n){let e=ge.useContext(qu);return At(e,mI(n)),e}function RH(n){let e=ge.useContext(Df);return At(e,mI(n)),e}function NH(n){let e=ge.useContext(to);return At(e,mI(n)),e}function gI(n){let e=NH(n),t=e.matches[e.matches.length-1];return At(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function AH(){return gI("useRouteId")}function $H(){var r;let n=ge.useContext(fI),e=RH("useRouteError"),t=gI("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function DH(){let{router:n}=_H("useNavigate"),e=gI("useNavigate"),t=ge.useRef(!1);return w$(()=>{t.current=!0}),ge.useCallback(async(s,i={})=>{Ir(t.current,x$),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...i}))},[n,e])}var Y_={};function b$(n,e,t){!e&&!Y_[n]&&(Y_[n]=!0,Ir(!1,t))}var Q_={};function J_(n,e){!n&&!Q_[e]&&(Q_[e]=!0,console.warn(e))}function PH(n){let e={hasErrorBoundary:n.hasErrorBoundary||n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&(n.element&&Ir(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:ge.createElement(n.Component),Component:void 0})),n.HydrateFallback&&(n.hydrateFallbackElement&&Ir(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:ge.createElement(n.HydrateFallback),HydrateFallback:void 0})),n.ErrorBoundary&&(n.errorElement&&Ir(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:ge.createElement(n.ErrorBoundary),ErrorBoundary:void 0})),e}var FH=class{constructor(){this.status="pending",this.promise=new Promise((n,e)=>{this.resolve=t=>{this.status==="pending"&&(this.status="resolved",n(t))},this.reject=t=>{this.status==="pending"&&(this.status="rejected",e(t))}})}};function OH({router:n,flushSync:e}){let[t,r]=ge.useState(n.state),[s,i]=ge.useState(),[o,a]=ge.useState({isTransitioning:!1}),[l,c]=ge.useState(),[d,f]=ge.useState(),[p,g]=ge.useState(),y=ge.useRef(new Map),w=ge.useCallback((k,{deletedFetchers:E,flushSync:_,viewTransitionOpts:L})=>{E.forEach(A=>y.current.delete(A)),k.fetchers.forEach((A,$)=>{A.data!==void 0&&y.current.set($,A.data)}),J_(_===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let P=n.window!=null&&n.window.document!=null&&typeof n.window.document.startViewTransition=="function";if(J_(L==null||P,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!L||!P){e&&_?e(()=>r(k)):ge.startTransition(()=>r(k));return}if(e&&_){e(()=>{d&&(l&&l.resolve(),d.skipTransition()),a({isTransitioning:!0,flushSync:!0,currentLocation:L.currentLocation,nextLocation:L.nextLocation})});let A=n.window.document.startViewTransition(()=>{e(()=>r(k))});A.finished.finally(()=>{e(()=>{c(void 0),f(void 0),i(void 0),a({isTransitioning:!1})})}),e(()=>f(A));return}d?(l&&l.resolve(),d.skipTransition(),g({state:k,currentLocation:L.currentLocation,nextLocation:L.nextLocation})):(i(k),a({isTransitioning:!0,flushSync:!1,currentLocation:L.currentLocation,nextLocation:L.nextLocation}))},[n.window,e,d,l]);ge.useLayoutEffect(()=>n.subscribe(w),[n,w]),ge.useEffect(()=>{o.isTransitioning&&!o.flushSync&&c(new FH)},[o]),ge.useEffect(()=>{if(l&&s&&n.window){let k=s,E=l.promise,_=n.window.document.startViewTransition(async()=>{ge.startTransition(()=>r(k)),await E});_.finished.finally(()=>{c(void 0),f(void 0),i(void 0),a({isTransitioning:!1})}),f(_)}},[s,l,n.window]),ge.useEffect(()=>{l&&s&&t.location.key===s.location.key&&l.resolve()},[l,d,t.location,s]),ge.useEffect(()=>{!o.isTransitioning&&p&&(i(p.state),a({isTransitioning:!0,flushSync:!1,currentLocation:p.currentLocation,nextLocation:p.nextLocation}),g(void 0))},[o.isTransitioning,p]);let x=ge.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:k=>n.navigate(k),push:(k,E,_)=>n.navigate(k,{state:E,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(k,E,_)=>n.navigate(k,{replace:!0,state:E,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[n]),I=n.basename||"/",C=ge.useMemo(()=>({router:n,navigator:x,static:!1,basename:I}),[n,x,I]);return ge.createElement(ge.Fragment,null,ge.createElement(qu.Provider,{value:C},ge.createElement(Df.Provider,{value:t},ge.createElement(v$.Provider,{value:y.current},ge.createElement(dI.Provider,{value:o},ge.createElement(zH,{basename:I,location:t.location,navigationType:t.historyAction,navigator:x},ge.createElement(LH,{routes:n.routes,future:n.future,state:t})))))),null)}var LH=ge.memo(MH);function MH({routes:n,future:e,state:t}){return IH(n,void 0,t,e)}function VH({to:n,replace:e,state:t,relative:r}){At($h(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=ge.useContext(eo);Ir(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=ge.useContext(to),{pathname:o}=Ca(),a=pI(),l=g0(n,m0(i),o,r==="path"),c=JSON.stringify(l);return ge.useEffect(()=>{a(JSON.parse(c),{replace:e,state:t,relative:r})},[a,c,r,e,t]),null}function zH({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:s,static:i=!1}){At(!$h(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=ge.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof t=="string"&&(t=Nl(t));let{pathname:l="/",search:c="",hash:d="",state:f=null,key:p="default"}=t,g=ge.useMemo(()=>{let y=Yi(l,o);return y==null?null:{location:{pathname:y,search:c,hash:d,state:f,key:p},navigationType:r}},[o,l,c,d,f,p,r]);return Ir(g!=null,`<Router basename="${o}"> is not able to match the URL "${l}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:ge.createElement(eo.Provider,{value:a},ge.createElement(v0.Provider,{children:e,value:g}))}var Bg="get",Ug="application/x-www-form-urlencoded";function x0(n){return n!=null&&typeof n.tagName=="string"}function BH(n){return x0(n)&&n.tagName.toLowerCase()==="button"}function UH(n){return x0(n)&&n.tagName.toLowerCase()==="form"}function WH(n){return x0(n)&&n.tagName.toLowerCase()==="input"}function GH(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function jH(n,e){return n.button===0&&(!e||e==="_self")&&!GH(n)}var gg=null;function HH(){if(gg===null)try{new FormData(document.createElement("form"),0),gg=!1}catch{gg=!0}return gg}var qH=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Vw(n){return n!=null&&!qH.has(n)?(Ir(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ug}"`),null):n}function KH(n,e){let t,r,s,i,o;if(UH(n)){let a=n.getAttribute("action");r=a?Yi(a,e):null,t=n.getAttribute("method")||Bg,s=Vw(n.getAttribute("enctype"))||Ug,i=new FormData(n)}else if(BH(n)||WH(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(r=l?Yi(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Bg,s=Vw(n.getAttribute("formenctype"))||Vw(a.getAttribute("enctype"))||Ug,i=new FormData(a,n),!HH()){let{name:c,type:d,value:f}=n;if(d==="image"){let p=c?`${c}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else c&&i.append(c,f)}}else{if(x0(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Bg,r=null,s=Ug,o=n}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:t.toLowerCase(),encType:s,formData:i,body:o}}function yI(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}async function XH(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function YH(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function QH(n,e,t){let r=await Promise.all(n.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await XH(i,t);return o.links?o.links():[]}return[]}));return t6(r.flat(1).filter(YH).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Z_(n,e,t,r,s,i){let o=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,a=(l,c)=>{var d;return t[c].pathname!==l.pathname||((d=t[c].route.path)==null?void 0:d.endsWith("*"))&&t[c].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,c)=>o(l,c)||a(l,c)):i==="data"?e.filter((l,c)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=t[0])==null?void 0:f.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function JH(n,e){return ZH(n.map(t=>{let r=e.routes[t.route.id];if(!r)return[];let s=[r.module];return r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function ZH(n){return[...new Set(n)]}function e6(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function t6(n,e){let t=new Set;return new Set(e),n.reduce((r,s)=>{let i=JSON.stringify(e6(s));return t.has(i)||(t.add(i),r.push({key:i,link:s})),r},[])}function n6(n){let e=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function r6(){let n=ge.useContext(qu);return yI(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function s6(){let n=ge.useContext(Df);return yI(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var vI=ge.createContext(void 0);vI.displayName="FrameworkContext";function I$(){let n=ge.useContext(vI);return yI(n,"You must render this element inside a <HydratedRouter> element"),n}function i6(n,e){let t=ge.useContext(vI),[r,s]=ge.useState(!1),[i,o]=ge.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:d,onTouchStart:f}=e,p=ge.useRef(null);ge.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let w=I=>{I.forEach(C=>{o(C.isIntersecting)})},x=new IntersectionObserver(w,{threshold:.5});return p.current&&x.observe(p.current),()=>{x.disconnect()}}},[n]),ge.useEffect(()=>{if(r){let w=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(w)}}},[r]);let g=()=>{s(!0)},y=()=>{s(!1),o(!1)};return t?n!=="intent"?[i,p,{}]:[i,p,{onFocus:Nd(a,g),onBlur:Nd(l,y),onMouseEnter:Nd(c,g),onMouseLeave:Nd(d,y),onTouchStart:Nd(f,g)}]:[!1,p,{}]}function Nd(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function o6({page:n,...e}){let{router:t}=r6(),r=ge.useMemo(()=>sl(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?ge.createElement(l6,{page:n,matches:r,...e}):null}function a6(n){let{manifest:e,routeModules:t}=I$(),[r,s]=ge.useState([]);return ge.useEffect(()=>{let i=!1;return QH(n,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[n,e,t]),r}function l6({page:n,matches:e,...t}){let r=Ca(),{manifest:s,routeModules:i}=I$(),{loaderData:o,matches:a}=s6(),l=ge.useMemo(()=>Z_(n,e,a,s,r,"data"),[n,e,a,s,r]),c=ge.useMemo(()=>Z_(n,e,a,s,r,"assets"),[n,e,a,s,r]),d=ge.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let g=new Set,y=!1;if(e.forEach(x=>{var C;let I=s.routes[x.route.id];!I||!I.hasLoader||(!l.some(k=>k.route.id===x.route.id)&&x.route.id in o&&((C=i[x.route.id])!=null&&C.shouldRevalidate)||I.hasClientLoader?y=!0:g.add(x.route.id))}),g.size===0)return[];let w=n6(n);return y&&g.size>0&&w.searchParams.set("_routes",e.filter(x=>g.has(x.route.id)).map(x=>x.route.id).join(",")),[w.pathname+w.search]},[o,r,s,l,e,n,i]),f=ge.useMemo(()=>JH(c,s),[c,s]),p=a6(c);return ge.createElement(ge.Fragment,null,d.map(g=>ge.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...t})),f.map(g=>ge.createElement("link",{key:g,rel:"modulepreload",href:g,...t})),p.map(({key:g,link:y})=>ge.createElement("link",{key:g,...y})))}function u6(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var C$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{C$&&(window.__reactRouterVersion="7.1.1")}catch{}function c6(n,e){return Zj({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:Cj({window:e==null?void 0:e.window}),hydrationData:h6(),routes:n,mapRouteProperties:PH,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function h6(){let n=window==null?void 0:window.__staticRouterHydrationData;return n&&n.errors&&(n={...n,errors:d6(n.errors)}),n}function d6(n){if(!n)return null;let e=Object.entries(n),t={};for(let[r,s]of e)if(s&&s.__type==="RouteErrorResponse")t[r]=new vy(s.status,s.statusText,s.data,s.internal===!0);else if(s&&s.__type==="Error"){if(s.__subType){let i=window[s.__subType];if(typeof i=="function")try{let o=new i(s.message);o.stack="",t[r]=o}catch{}}if(t[r]==null){let i=new Error(s.message);i.stack="",t[r]=i}}else t[r]=s;return t}var S$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,E$=ge.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:d,viewTransition:f,...p},g){let{basename:y}=ge.useContext(eo),w=typeof c=="string"&&S$.test(c),x,I=!1;if(typeof c=="string"&&w&&(x=c,C$))try{let $=new URL(window.location.href),D=c.startsWith("//")?new URL($.protocol+c):new URL(c),R=Yi(D.pathname,y);D.origin===$.origin&&R!=null?c=R+D.search+D.hash:I=!0}catch{Ir(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=xH(c,{relative:s}),[k,E,_]=i6(r,p),L=g6(c,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f});function P($){e&&e($),$.defaultPrevented||L($)}let A=ge.createElement("a",{...p,..._,href:x||C,onClick:I||i?e:P,ref:u6(g,E),target:l,"data-discover":!w&&t==="render"?"true":void 0});return k&&!w?ge.createElement(ge.Fragment,null,A,ge.createElement(o6,{page:C})):A});E$.displayName="Link";var f6=ge.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...c},d){let f=Pf(o,{relative:c.relative}),p=Ca(),g=ge.useContext(Df),{navigator:y,basename:w}=ge.useContext(eo),x=g!=null&&b6(f)&&a===!0,I=y.encodeLocation?y.encodeLocation(f).pathname:f.pathname,C=p.pathname,k=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(C=C.toLowerCase(),k=k?k.toLowerCase():null,I=I.toLowerCase()),k&&w&&(k=Yi(k,w)||k);const E=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let _=C===I||!s&&C.startsWith(I)&&C.charAt(E)==="/",L=k!=null&&(k===I||!s&&k.startsWith(I)&&k.charAt(I.length)==="/"),P={isActive:_,isPending:L,isTransitioning:x},A=_?e:void 0,$;typeof r=="function"?$=r(P):$=[r,_?"active":null,L?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let D=typeof i=="function"?i(P):i;return ge.createElement(E$,{...c,"aria-current":A,className:$,ref:d,style:D,to:o,viewTransition:a},typeof l=="function"?l(P):l)});f6.displayName="NavLink";var p6=ge.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:s,state:i,method:o=Bg,action:a,onSubmit:l,relative:c,preventScrollReset:d,viewTransition:f,...p},g)=>{let y=x6(),w=w6(a,{relative:c}),x=o.toLowerCase()==="get"?"get":"post",I=typeof a=="string"&&S$.test(a),C=k=>{if(l&&l(k),k.defaultPrevented)return;k.preventDefault();let E=k.nativeEvent.submitter,_=(E==null?void 0:E.getAttribute("formmethod"))||o;y(E||k.currentTarget,{fetcherKey:e,method:_,navigate:t,replace:s,state:i,relative:c,preventScrollReset:d,viewTransition:f})};return ge.createElement("form",{ref:g,method:x,action:w,onSubmit:r?l:C,...p,"data-discover":!I&&n==="render"?"true":void 0})});p6.displayName="Form";function m6(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function k$(n){let e=ge.useContext(qu);return At(e,m6(n)),e}function g6(n,{target:e,replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let a=pI(),l=Ca(),c=Pf(n,{relative:i});return ge.useCallback(d=>{if(jH(d,e)){d.preventDefault();let f=t!==void 0?t:Cl(l)===Cl(c);a(n,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[l,a,c,t,r,e,n,s,i,o])}var y6=0,v6=()=>`__${String(++y6)}__`;function x6(){let{router:n}=k$("useSubmit"),{basename:e}=ge.useContext(eo),t=AH();return ge.useCallback(async(r,s={})=>{let{action:i,method:o,encType:a,formData:l,body:c}=KH(r,e);if(s.navigate===!1){let d=s.fetcherKey||v6();await n.fetch(d,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:c,formMethod:s.method||o,formEncType:s.encType||a,flushSync:s.flushSync})}else await n.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:c,formMethod:s.method||o,formEncType:s.encType||a,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function w6(n,{relative:e}={}){let{basename:t}=ge.useContext(eo),r=ge.useContext(to);At(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Pf(n||".",{relative:e})},o=Ca();if(n==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!n||n===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:ko([t,i.pathname])),Cl(i)}function b6(n,e={}){let t=ge.useContext(dI);At(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=k$("useViewTransitionState"),s=Pf(n,{relative:e.relative});if(!t.isTransitioning)return!1;let i=Yi(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Yi(t.nextLocation.pathname,r)||t.nextLocation.pathname;return yy(s.pathname,o)!=null||yy(s.pathname,i)!=null}new TextEncoder;var I6=WN();/**
 * react-router v7.1.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function C6(n){return ge.createElement(OH,{flushSync:I6.flushSync,...n})}function S6(){const n=pI(),e=Ca(),t=async()=>{var r;try{const i=(await a4(uI,pj)).user;await cj(Jb(f0,"users",i.uid),{name:i.displayName,email:i.email,photoURL:i.photoURL,lastSignIn:i.metadata.lastSignInTime,createdAt:new Date});const o=((r=e.state)==null?void 0:r.from)||"/";n(o)}catch(s){console.error("Error during sign-in:",s.message)}};return te.jsx("div",{className:"signin-container",children:te.jsxs("div",{className:"signin",children:[te.jsx("h2",{children:"Sign in with Google"}),te.jsx("button",{onClick:t,children:"Sign In with Google"})]})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E6=1e-7,k6=1e-4;class T${constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class xI{refCount(e){return _s("refCount")}incRef(e){return _s("incRef")}timerAvailable(){return!0}time(e){return _s("time")}read(e){return _s("read")}readSync(e){return _s("readSync")}readToGPU(e,t){return _s("readToGPU")}numDataIds(){return _s("numDataIds")}disposeData(e,t){return _s("disposeData")}write(e,t,r){return _s("write")}move(e,t,r,s,i){return _s("move")}createTensorFromGPUData(e,t,r){return _s("createTensorFromGPUData")}memory(){return _s("memory")}floatPrecision(){return _s("floatPrecision")}epsilon(){return this.floatPrecision()===32?E6:k6}dispose(){return _s("dispose")}}function _s(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Hc(n,e,t)}function _u(n,e,t){return Math.max(n,Math.min(e,t))}function wI(n){return n%2===0?n:n+1}function Hc(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function _6(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function z(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function bI(n,e,t=""){z(Qt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function _$(n){z(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function xe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Qt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ph(n){return n%1===0}function D1(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Zc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function eR(n,e=s=>0,t,r){return new Promise((s,i)=>{let o=0;const a=()=>{if(n()){s();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function R$(n,e){let t=1,r=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function Ct(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),z(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),z(n.every(r=>ph(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function Al(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:Ct(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Lr(n,e){return Ln(n,e)}function Ln(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function R6(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function N6(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function N$(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function xy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function A6(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Ff(n){return typeof n=="string"||n instanceof String}function $6(n){return typeof n=="boolean"}function P1(n){return typeof n=="number"}function Dh(n){return Array.isArray(n)?Dh(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":P1(n)?"float32":Ff(n)?"string":$6(n)?"bool":"float32"}function F1(n){return!!(n&&n.constructor&&n.call&&n.apply)}function O1(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function tt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function A$(n,e,t,r=!1){const s=new Array;if(e.length===1){const i=e[0]*(r?2:1);for(let o=0;o<i;o++)s[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)s[l]=A$(n+l*a,o,t,r)}return s}function Hi(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,i)=>s*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return A$(0,n,e,t)}function D6(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function II(n,e){const t=Mr(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function Mr(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function $$(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return Hi(n,new Float32Array(t));if(e==="int32")return Hi(n,new Int32Array(t));if(e==="bool")return Hi(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Sa(n){n.forEach(e=>{z(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function To(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function Ph(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function CI(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tR="tfjsflags";class P6{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=F6,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(CI(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);tR in e&&e[tR].split(",").forEach(r=>{const[s,i]=r.split(":");this.urlFlags[s]=L6(s,i)})}}function F6(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(O6(e,r[0],r[1]),r.join("="))),e}function O6(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function L6(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function pe(){return D$}let D$=null;function M6(n){D$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let zw;function P$(){if(zw==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");zw=n}return zw}function V6(){const n=P$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function SI(n,e){const t=V6();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const w0="Abs",Of="Acos",Lf="Acosh",Fh="Add",EI="AddN",kI="All",TI="Any",b0="ArgMax",I0="ArgMin",Mf="Asin",Vf="Asinh",zf="Atan",Bf="Atanh",Uf="Atan2",C0="AvgPool",_I="AvgPoolGrad",S0="AvgPool3D",RI="AvgPool3DGrad",E0="BatchMatMul",k0="BatchToSpaceND",NI="Bincount",AI="BitwiseAnd",z6="BroadcastTo",F$="BroadcastArgs",Wf="Cast",Gf="Ceil",jf="ClipByValue",$I="Complex",T0="ComplexAbs",_0="Concat",R0="Conv2D",DI="Conv2DBackpropFilter",N0="Conv2DBackpropInput",A0="Conv3D",PI="Conv3DBackpropFilterV2",FI="Conv3DBackpropInputV2",Hf="Cos",qf="Cosh",OI="Cumprod",$0="Cumsum",LI="CropAndResize",MI="DenseBincount",VI="DepthToSpace",D0="DepthwiseConv2dNative",zI="DepthwiseConv2dNativeBackpropFilter",BI="DepthwiseConv2dNativeBackpropInput",O$="Diag",P0="Dilation2D",L1="Dilation2DBackpropInput",M1="Dilation2DBackpropFilter",B6="Draw",Kf="RealDiv",UI="Einsum",Xf="Elu",WI="EluGrad",Yf="Erf",F0="Equal",Qf="Exp",O0="ExpandDims",Jf="Expm1",GI="FFT",jI="Fill",HI="FlipLeftRight",Zf="Floor",ep="FloorDiv",L0="FusedBatchNorm",M0="GatherV2",L$="GatherNd",V0="Greater",tp="GreaterEqual",np="Identity",qI="IFFT",KI="Imag",rp="IsFinite",sp="IsInf",ip="IsNan",z0="LeakyRelu",B0="Less",U0="LessEqual",M$="LinSpace",op="Log",ap="Log1p",W0="LogicalAnd",G0="LogicalNot",j0="LogicalOr",U6="LogSoftmax",H0="LRN",XI="LRNGrad",q0="Max",lp="Maximum",K0="MaxPool",YI="MaxPoolGrad",X0="MaxPool3D",QI="MaxPool3DGrad",V$="MaxPoolWithArgmax",Y0="Mean",Q0="Min",up="Minimum",J0="MirrorPad",cp="Mod",z$="Multinomial",hp="Multiply",Z0="Neg",ev="NotEqual",JI="NonMaxSuppressionV3",ZI="NonMaxSuppressionV4",eC="NonMaxSuppressionV5",tv="OnesLike",nv="OneHot",rv="Pack",sv="PadV2",dp="Pow",iv="Prelu",ov="Prod",B$="RaggedGather",U$="RaggedRange",W$="RaggedTensorToTensor",tC="Range",nC="Real",fp="Reciprocal",pp="Relu",av="Reshape",lv="ResizeNearestNeighbor",rC="ResizeNearestNeighborGrad",uv="ResizeBilinear",sC="ResizeBilinearGrad",mp="Relu6",cv="Reverse",gp="Round",yp="Rsqrt",G$="ScatterNd",j$="TensorScatterUpdate",H$="SearchSorted",hv="Select",vp="Selu",dv="Slice",xp="Sin",wp="Sinh",bp="Sign",Ip="Sigmoid",Cp="Softplus",Sp="Sqrt",fv="Sum",pv="SpaceToBatchND",mv="SplitV",gv="Softmax",q$="SparseFillEmptyRows",K$="SparseReshape",X$="SparseSegmentMean",Y$="SparseSegmentSum",Q$="SparseToDense",Ep="SquaredDifference",iC="Square",oC="StaticRegexReplace",aC="StridedSlice",J$="StringNGrams",Z$="StringSplit",eD="StringToHashBucketFast",kp="Sub",Tp="Tan",_p="Tanh",Rp="Tile",lC="TopK",uC="Transform",eh="Transpose",cC="Unique",yv="Unpack",vv="UnsortedSegmentSum",xv="ZerosLike",Np="Step",W6="FromPixels",hC="RotateWithOffset",wy="_FusedMatMul",by="FusedConv2D",tD="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(...n)}function G6(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iy=SI("kernelRegistry",()=>new Map),V1=SI("gradRegistry",()=>new Map);function nR(n,e){const t=rD(n,e);return Iy.get(t)}function rR(n){return V1.get(n)}function sR(n){const e=Iy.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[i,o]=s,[a]=i.split("_");a===n&&t.push(o)}return t}function nD(n){const{kernelName:e,backendName:t}=n,r=rD(e,t);Iy.has(r)&&Hs(`The kernel '${e}' for backend '${t}' is already registered`),Iy.set(r,n)}function j6(n){const{kernelName:e}=n;V1.has(e)&&pe().getBool("DEBUG")&&Hs(`Overriding the gradient for '${e}'`),V1.set(e,n)}function rD(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Bw,iR;function H6(){if(iR)return Bw;iR=1,Bw=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,R,M){this.low=D|0,this.high=R|0,this.unsigned=!!M}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var r={},s={};function i(D,R){var M,O,Z;return R?(D>>>=0,(Z=0<=D&&D<256)&&(O=s[D],O)?O:(M=a(D,(D|0)<0?-1:0,!0),Z&&(s[D]=M),M)):(D|=0,(Z=-128<=D&&D<128)&&(O=r[D],O)?O:(M=a(D,D<0?-1:0,!1),Z&&(r[D]=M),M))}e.fromInt=i;function o(D,R){if(isNaN(D))return R?C:I;if(R){if(D<0)return C;if(D>=y)return P}else{if(D<=-w)return A;if(D+1>=w)return L}return D<0?o(-D,R).neg():a(D%g|0,D/g|0,R)}e.fromNumber=o;function a(D,R,M){return new e(D,R,M)}e.fromBits=a;var l=Math.pow;function c(D,R,M){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return I;if(typeof R=="number"?(M=R,R=!1):R=!!R,M=M||10,M<2||36<M)throw RangeError("radix");var O;if((O=D.indexOf("-"))>0)throw Error("interior hyphen");if(O===0)return c(D.substring(1),R,M).neg();for(var Z=o(l(M,8)),q=I,se=0;se<D.length;se+=8){var le=Math.min(8,D.length-se),j=parseInt(D.substring(se,se+le),M);if(le<8){var Q=o(l(M,le));q=q.mul(Q).add(o(j))}else q=q.mul(Z),q=q.add(o(j))}return q.unsigned=R,q}e.fromString=c;function d(D,R){return typeof D=="number"?o(D,R):typeof D=="string"?c(D,R):a(D.low,D.high,typeof R=="boolean"?R:D.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,y=g*g,w=y/2,x=i(p),I=i(0);e.ZERO=I;var C=i(0,!0);e.UZERO=C;var k=i(1);e.ONE=k;var E=i(1,!0);e.UONE=E;var _=i(-1);e.NEG_ONE=_;var L=a(-1,2147483647,!1);e.MAX_VALUE=L;var P=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=P;var A=a(0,-2147483648,!1);e.MIN_VALUE=A;var $=e.prototype;return $.toInt=function(){return this.unsigned?this.low>>>0:this.low},$.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},$.toString=function(R){if(R=R||10,R<2||36<R)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(A)){var M=o(R),O=this.div(M),Z=O.mul(M).sub(this);return O.toString(R)+Z.toInt().toString(R)}else return"-"+this.neg().toString(R);for(var q=o(l(R,6),this.unsigned),se=this,le="";;){var j=se.div(q),Q=se.sub(j.mul(q)).toInt()>>>0,ee=Q.toString(R);if(se=j,se.isZero())return ee+le;for(;ee.length<6;)ee="0"+ee;le=""+ee+le}},$.getHighBits=function(){return this.high},$.getHighBitsUnsigned=function(){return this.high>>>0},$.getLowBits=function(){return this.low},$.getLowBitsUnsigned=function(){return this.low>>>0},$.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var R=this.high!=0?this.high:this.low,M=31;M>0&&!(R&1<<M);M--);return this.high!=0?M+33:M+1},$.isZero=function(){return this.high===0&&this.low===0},$.eqz=$.isZero,$.isNegative=function(){return!this.unsigned&&this.high<0},$.isPositive=function(){return this.unsigned||this.high>=0},$.isOdd=function(){return(this.low&1)===1},$.isEven=function(){return(this.low&1)===0},$.equals=function(R){return t(R)||(R=d(R)),this.unsigned!==R.unsigned&&this.high>>>31===1&&R.high>>>31===1?!1:this.high===R.high&&this.low===R.low},$.eq=$.equals,$.notEquals=function(R){return!this.eq(R)},$.neq=$.notEquals,$.ne=$.notEquals,$.lessThan=function(R){return this.comp(R)<0},$.lt=$.lessThan,$.lessThanOrEqual=function(R){return this.comp(R)<=0},$.lte=$.lessThanOrEqual,$.le=$.lessThanOrEqual,$.greaterThan=function(R){return this.comp(R)>0},$.gt=$.greaterThan,$.greaterThanOrEqual=function(R){return this.comp(R)>=0},$.gte=$.greaterThanOrEqual,$.ge=$.greaterThanOrEqual,$.compare=function(R){if(t(R)||(R=d(R)),this.eq(R))return 0;var M=this.isNegative(),O=R.isNegative();return M&&!O?-1:!M&&O?1:this.unsigned?R.high>>>0>this.high>>>0||R.high===this.high&&R.low>>>0>this.low>>>0?-1:1:this.sub(R).isNegative()?-1:1},$.comp=$.compare,$.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(k)},$.neg=$.negate,$.add=function(R){t(R)||(R=d(R));var M=this.high>>>16,O=this.high&65535,Z=this.low>>>16,q=this.low&65535,se=R.high>>>16,le=R.high&65535,j=R.low>>>16,Q=R.low&65535,ee=0,U=0,H=0,ue=0;return ue+=q+Q,H+=ue>>>16,ue&=65535,H+=Z+j,U+=H>>>16,H&=65535,U+=O+le,ee+=U>>>16,U&=65535,ee+=M+se,ee&=65535,a(H<<16|ue,ee<<16|U,this.unsigned)},$.subtract=function(R){return t(R)||(R=d(R)),this.add(R.neg())},$.sub=$.subtract,$.multiply=function(R){if(this.isZero())return I;if(t(R)||(R=d(R)),n){var M=n.mul(this.low,this.high,R.low,R.high);return a(M,n.get_high(),this.unsigned)}if(R.isZero())return I;if(this.eq(A))return R.isOdd()?A:I;if(R.eq(A))return this.isOdd()?A:I;if(this.isNegative())return R.isNegative()?this.neg().mul(R.neg()):this.neg().mul(R).neg();if(R.isNegative())return this.mul(R.neg()).neg();if(this.lt(x)&&R.lt(x))return o(this.toNumber()*R.toNumber(),this.unsigned);var O=this.high>>>16,Z=this.high&65535,q=this.low>>>16,se=this.low&65535,le=R.high>>>16,j=R.high&65535,Q=R.low>>>16,ee=R.low&65535,U=0,H=0,ue=0,Ie=0;return Ie+=se*ee,ue+=Ie>>>16,Ie&=65535,ue+=q*ee,H+=ue>>>16,ue&=65535,ue+=se*Q,H+=ue>>>16,ue&=65535,H+=Z*ee,U+=H>>>16,H&=65535,H+=q*Q,U+=H>>>16,H&=65535,H+=se*j,U+=H>>>16,H&=65535,U+=O*ee+Z*Q+q*j+se*le,U&=65535,a(ue<<16|Ie,U<<16|H,this.unsigned)},$.mul=$.multiply,$.divide=function(R){if(t(R)||(R=d(R)),R.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&R.low===-1&&R.high===-1)return this;var M=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,R.low,R.high);return a(M,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:I;var O,Z,q;if(this.unsigned){if(R.unsigned||(R=R.toUnsigned()),R.gt(this))return C;if(R.gt(this.shru(1)))return E;q=C}else{if(this.eq(A)){if(R.eq(k)||R.eq(_))return A;if(R.eq(A))return k;var se=this.shr(1);return O=se.div(R).shl(1),O.eq(I)?R.isNegative()?k:_:(Z=this.sub(R.mul(O)),q=O.add(Z.div(R)),q)}else if(R.eq(A))return this.unsigned?C:I;if(this.isNegative())return R.isNegative()?this.neg().div(R.neg()):this.neg().div(R).neg();if(R.isNegative())return this.div(R.neg()).neg();q=I}for(Z=this;Z.gte(R);){O=Math.max(1,Math.floor(Z.toNumber()/R.toNumber()));for(var le=Math.ceil(Math.log(O)/Math.LN2),j=le<=48?1:l(2,le-48),Q=o(O),ee=Q.mul(R);ee.isNegative()||ee.gt(Z);)O-=j,Q=o(O,this.unsigned),ee=Q.mul(R);Q.isZero()&&(Q=k),q=q.add(Q),Z=Z.sub(ee)}return q},$.div=$.divide,$.modulo=function(R){if(t(R)||(R=d(R)),n){var M=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,R.low,R.high);return a(M,n.get_high(),this.unsigned)}return this.sub(this.div(R).mul(R))},$.mod=$.modulo,$.rem=$.modulo,$.not=function(){return a(~this.low,~this.high,this.unsigned)},$.and=function(R){return t(R)||(R=d(R)),a(this.low&R.low,this.high&R.high,this.unsigned)},$.or=function(R){return t(R)||(R=d(R)),a(this.low|R.low,this.high|R.high,this.unsigned)},$.xor=function(R){return t(R)||(R=d(R)),a(this.low^R.low,this.high^R.high,this.unsigned)},$.shiftLeft=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low<<R,this.high<<R|this.low>>>32-R,this.unsigned):a(0,this.low<<R-32,this.unsigned)},$.shl=$.shiftLeft,$.shiftRight=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low>>>R|this.high<<32-R,this.high>>R,this.unsigned):a(this.high>>R-32,this.high>=0?0:-1,this.unsigned)},$.shr=$.shiftRight,$.shiftRightUnsigned=function(R){if(t(R)&&(R=R.toInt()),R&=63,R===0)return this;var M=this.high;if(R<32){var O=this.low;return a(O>>>R|M<<32-R,M>>>R,this.unsigned)}else return R===32?a(M,0,this.unsigned):a(M>>>R-32,0,this.unsigned)},$.shru=$.shiftRightUnsigned,$.shr_u=$.shiftRightUnsigned,$.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},$.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},$.toBytes=function(R){return R?this.toBytesLE():this.toBytesBE()},$.toBytesLE=function(){var R=this.high,M=this.low;return[M&255,M>>>8&255,M>>>16&255,M>>>24,R&255,R>>>8&255,R>>>16&255,R>>>24]},$.toBytesBE=function(){var R=this.high,M=this.low;return[R>>>24,R>>>16&255,R>>>8&255,R&255,M>>>24,M>>>16&255,M>>>8&255,M&255]},e.fromBytes=function(R,M,O){return O?e.fromBytesLE(R,M):e.fromBytesBE(R,M)},e.fromBytesLE=function(R,M){return new e(R[0]|R[1]<<8|R[2]<<16|R[3]<<24,R[4]|R[5]<<8|R[6]<<16|R[7]<<24,M)},e.fromBytesBE=function(R,M){return new e(R[4]<<24|R[5]<<16|R[6]<<8|R[7],R[0]<<24|R[1]<<16|R[2]<<8|R[3],M)},Bw}var iD=H6();const oD=d3(iD),q6=h3({__proto__:null,default:oD},[iD]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const du=oD||q6;function wv(n){return du.fromString(n,!0,16)}const aD=wv("c3a5c85c97cb3127"),cu=wv("b492b66fbe98f273"),Zr=wv("9ae16a3b2f90404f");function z1(n){return n.xor(n.shru(47))}function lD(n,e,t){const r=n.slice(e,e+t);return du.fromBytes(Array.from(r),!0,!0)}function hn(n,e){return lD(n,e,8)}function oR(n,e){return lD(n,e,4)}function ur(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function fl(n,e,t=wv("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function K6(n,e,t,r,s,i){s=s.add(n),i=ur(i.add(s).add(r),21);const o=s;return s=s.add(e),s=s.add(t),i=i.add(ur(s,44)),[s.add(r),i.add(o)]}function yg(n,e,t,r){return K6(hn(n,e),hn(n,e+8),hn(n,e+16),hn(n,e+24),t,r)}function X6(n,e=n.length){if(e>=8){const t=Zr.add(e*2),r=hn(n,0).add(Zr),s=hn(n,e-8),i=ur(s,37).mul(t).add(r),o=ur(r,25).add(s).mul(t);return fl(i,o,t)}if(e>=4){const t=Zr.add(e*2),r=oR(n,0);return fl(r.shl(3).add(e),oR(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],i=t+(r<<8),o=e+(s<<2);return z1(Zr.mul(i).xor(aD.mul(o))).mul(Zr)}return Zr}function Y6(n,e=n.length){const t=Zr.add(e*2),r=hn(n,0).mul(cu),s=hn(n,8),i=hn(n,e-8).mul(t),o=hn(n,e-16).mul(Zr);return fl(ur(r.add(s),43).add(ur(i,30)).add(o),r.add(ur(s.add(Zr),18)).add(i),t)}function Q6(n,e=n.length){const t=Zr.add(e*2),r=hn(n,0).mul(Zr),s=hn(n,8),i=hn(n,e-8).mul(t),o=hn(n,e-16).mul(Zr),a=ur(r.add(s),43).add(ur(i,30)).add(o),l=fl(a,r.add(ur(s.add(Zr),18)).add(i),t),c=hn(n,16).mul(t),d=hn(n,24),f=a.add(hn(n,e-32)).mul(t),p=l.add(hn(n,e-24)).mul(t);return fl(ur(c.add(d),43).add(ur(f,30)).add(p),c.add(ur(d.add(r),18)).add(f),t)}function J6(n,e=n.length){const t=du.fromNumber(81,!0);if(e<=32)return e<=16?X6(n,e):Y6(n,e);if(e<=64)return Q6(n,e);let r=t,s=t.mul(cu).add(113),i=z1(s.mul(Zr).add(113)).mul(Zr),o=[du.UZERO,du.UZERO],a=[du.UZERO,du.UZERO];r=r.mul(Zr).add(hn(n,0));let l=0;const c=(e-1>>6)*64,d=c+(e-1&63)-63;do r=ur(r.add(s).add(o[0]).add(hn(n,l+8)),37).mul(cu),s=ur(s.add(o[1]).add(hn(n,l+48)),42).mul(cu),r=r.xor(a[1]),s=s.add(o[0]).add(hn(n,l+40)),i=ur(i.add(a[0]),33).mul(cu),o=yg(n,l,o[1].mul(cu),r.add(a[0])),a=yg(n,l+32,i.add(a[1]),s.add(hn(n,l+16))),[i,r]=[r,i],l+=64;while(l!==c);const f=cu.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=ur(r.add(s).add(o[0]).add(hn(n,l+8)),37).mul(f),s=ur(s.add(o[1]).add(hn(n,l+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(o[0].mul(9).add(hn(n,l+40))),i=ur(i.add(a[0]),33).mul(f),o=yg(n,l,o[1].mul(f),r.add(a[0])),a=yg(n,l+32,i.add(a[1]),s.add(hn(n,l+16))),[i,r]=[r,i],fl(fl(o[0],a[0],f).add(z1(s).mul(aD)).add(i),fl(o[1],a[1],f).add(r),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(n,e){return e==="string"?pl(n):Ku([n],e)}function Z6(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ku(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ru(n)),pe().getBool("DEBUG")&&R6(n,e),Z6(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function cs(){return pe().platform.now()}function pl(n,e="utf-8"){return e=e||"utf-8",pe().platform.encode(n,e)}function Sl(n,e="utf-8"){return e=e||"utf-8",pe().platform.decode(n,e)}function gi(n){return pe().platform.isTypedArray!=null?pe().platform.isTypedArray(n):sD(n)}function Ru(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||CI(n)||n==null||gi(n)&&t)e.push(n);else if(Array.isArray(n)||gi(n))for(let r=0;r<n.length;++r)Ru(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Ru(n[s],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e5{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new n5)}profileKernel(e,t,r){let s;const i=()=>{s=r()};let o;const a=cs();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const c of s)c.dataSync();o=Promise.resolve({kernelMs:cs()-a})}if(pe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<s.length;c++){const d=s[c];d.data().then(f=>{t5(f,d.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:i,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),s,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function t5(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class n5{logKernelProfile(e,t,r,s,i,o){const a=typeof s=="number"?Zc(`${s}ms`,9):s.error,l=Zc(e,25),c=t.rank,d=t.size,f=Zc(t.shape.toString(),14);let p="";for(const g in i){const y=i[g];if(y!=null){const w=y.shape||t.shape,x=w.length;p+=`${g}: ${x}D ${x>0?w:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${f}	%c${d}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n,e,t){const r={},s={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],d=c.inputs;for(const f in d){const p=d[f];let g=!1;for(let y=0;y<e.length;y++)if(r[p.id]){c.outputs.forEach(w=>r[w.id]=!0),g=!0,s[c.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const c=n[l],d=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(const p in d)i[d[p].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const c=n[l];if(s[c.id]&&o[c.id]){const d={};for(const p in c.inputs){const g=c.inputs[p];r[g.id]&&(d[p]=g)}const f=Object.assign({},c);f.inputs=d,f.outputs=c.outputs,a.push(f)}}return a}function s5(n,e,t,r){for(let s=e.length-1;s>=0;s--){const i=e[s],o=[];if(i.outputs.forEach(l=>{const c=n[l.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=t(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const d=i.inputs[l];if(!Qt(c.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=c;else{const f=n[d.id];n[d.id]=r(f,c),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aR=20,Ad=3,Uw=7;function i5(n,e,t,r){const s=tt(e),i=o5(n,e,t,s),o=e.length,a=Wg(n,e,t,s,i),l=["Tensor"];return r&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function o5(n,e,t,r){const s=xe(e),i=r[r.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Bd(n):n;if(a>1)for(let c=0;c<s/i;c++){const d=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],zd(l[d+f],0,t).length)}return o}function zd(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(Uw))} + ${parseFloat(n[1].toFixed(Uw))}j`:Ff(n)?r=`'${n}'`:t==="bool"?r=uD(n):r=parseFloat(n.toFixed(Uw)).toString(),Zc(r,e)}function uD(n){return n===0?"false":"true"}function Wg(n,e,t,r,s,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=Bd(n);return[zd(w[0],0,t)]}return t==="bool"?[uD(n[0])]:[n[0].toString()]}if(l===1){if(a>aR){const x=Ad*o;let I=Array.from(n.slice(0,x)),C=Array.from(n.slice((a-Ad)*o,a*o));return t==="complex64"&&(I=Bd(I),C=Bd(C)),["["+I.map((k,E)=>zd(k,s[E],t)).join(", ")+", ..., "+C.map((k,E)=>zd(k,s[a-Ad+E],t)).join(", ")+"]"]}return["["+(t==="complex64"?Bd(n):Array.from(n)).map((x,I)=>zd(x,s[I],t)).join(", ")+"]"]}const c=e.slice(1),d=r.slice(1),f=r[0]*o,p=[];if(a>aR){for(let w=0;w<Ad;w++){const x=w*f,I=x+f;p.push(...Wg(n.slice(x,I),c,t,d,s,!1))}p.push("...");for(let w=a-Ad;w<a;w++){const x=w*f,I=x+f;p.push(...Wg(n.slice(x,I),c,t,d,s,w===a-1))}}else for(let w=0;w<a;w++){const x=w*f,I=x+f;p.push(...Wg(n.slice(x,I),c,t,d,s,w===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let w=1;w<p.length-1;w++)p[w]=" "+p[w]+g;let y=`,
`;for(let w=2;w<l;w++)y+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":y),p}function Bd(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cr{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=xe(e),r!=null){const s=r.length;z(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ln(t,this.size),this.strides=tt(e)}set(e,...t){t.length===0&&(t=[0]),z(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Bi().makeTensor(this.values,this.shape,this.dtype)}}let Bi=null,qc=null;function a5(n){Bi=n}function l5(n){qc=n}class Qn{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=xe(e),this.strides=tt(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return qc.buffer(this.shape,this.dtype,e)}bufferSync(){return qc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Hi(this.shape,e,this.dtype==="complex64")}arraySync(){return Hi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Bi().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>Sl(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Bi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Bi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Sl(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Bi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Bi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return qc.print(this,e)}clone(){return this.throwIfDisposed(),qc.clone(this)}toString(e=!1){const t=this.dataSync();return i5(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),qc.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),Bi().makeVariable(this,e,t,r)}}Object.defineProperty(Qn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ve(){return SI("Tensor",()=>Qn)}ve();class Cy extends Qn{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Qt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Bi().disposeTensor(this),this.dataId=e.dataId,Bi().incRef(this,null)}dispose(){Bi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Cy,Symbol.hasInstance,{value:n=>n instanceof Qn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lR;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(lR||(lR={}));var B1;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(B1||(B1={}));var U1;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(U1||(U1={}));var W1;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(W1||(W1={}));var G1;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(G1||(G1={}));const u5={float32:W1,int32:B1,bool:U1,complex64:G1};function Ds(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return u5[n][e]}function dC(n){return Ds(n,"int32")}function cD(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function hD(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ds(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function dD(n){const e=[];return fD(n,e,new Set),e}function fD(n,e,t){if(n==null)return;if(n instanceof Qn){e.push(n);return}if(!c5(n))return;const r=n;for(const s in r){const i=r[s];t.has(i)||(t.add(i),fD(i,e,t))}}function c5(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ww(n){return n.kernelName!=null}class uR{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class mh{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new uR}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Hs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new e5(this.backendInstance),!0}setupRegisteredKernels(){sR(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){sR(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof xI)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,i=r.then(o=>s<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Hs(`Initialization of backend ${e} failed`),Hs(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Hs(`Initialization of backend ${e} failed`),Hs(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:i}=this.initializeBackend(r);if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,i=this.readSync(t),o=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return mh.nextTensorId++}nextVariableId(){return mh.nextVariableId++}clone(e){const t=re.runKernel(np,{x:e}),r={x:e},s=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return re.runKernel(Wf,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(nR(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let i=0;r.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Ww(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Ww(e)){const{kernelName:y,inputs:w,attrs:x}=e;this.backendName==null&&this.backend;const I=nR(y,this.backendName);z(I!=null,()=>`Cannot find registered kernel '${y}' for backend '${this.backendName}'`),a=()=>{const C=this.backend.numDataIds();l=I.kernelFunc({inputs:w,attrs:x,backend:this.backend});const k=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(y,C,k);const E=k.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(s){const _=this.getTensorsForGradient(y,w,E);r=this.saveTensorsForBackwardMode(_)}return E}}else{const{forwardFunc:y}=e,w=x=>{s&&(r=x.map(I=>this.keep(this.clone(I))))};a=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>y(this.backend,w));const I=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,x,I),I}}const{inputs:d,attrs:f}=e,p=Ww(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(c,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),s&&this.addTapeNode(c,d,t,p,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(y=>d[y]!=null?d[y].shape:null),outputShapes:t.map(y=>y.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const s=rR(e);if(s!=null){const i=s.inputsToSave||[],o=s.outputsToSave||[];let a;s.saveAllInputs?(z(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(c=>t[c])):a=i.map(c=>t[c]);const l=r.filter((c,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let i=e;r==="string"&&Ff(e[0])&&(i=e.map(l=>pl(l)));const o=s.write(i,t,r),a=new Qn(t,r,o,this.nextTensorId());if(this.trackTensor(a,s),r==="string"){const l=this.state.tensorInfo.get(o),c=A6(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,t,r,s){r=r||"float32";const i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:i}=e,o=new Qn(s,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const i=new Cy(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*xy(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Cy||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*xy(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},l=rR(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=c=>(c=c.map((d,f)=>{if(d==null){const p=r[f],g=Mr(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),s(c.length>1?c:c[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=dD(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,t,r,s=!1){if(z(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));z(i instanceof Qn,()=>"The result y returned by f() must be a tensor.");const o=r5(this.state.activeTape,t,i);if(!s&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=r??h5(i.shape),s5(a,o,c=>this.tidy(c),d5);const l=t.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const d of c.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return z(F1(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{z(t.every(a=>a instanceof Qn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((a,l)=>{s[l]=a});const i=(a,l)=>(r=e(...t,l),z(r.value instanceof Qn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),z(F1(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const c=r.gradFunc(a,l),d=Array.isArray(c)?c:[c];z(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),z(d.every(p=>p instanceof Qn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=cs(),r=await this.backend.time(e);return r.wallMs=cs()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new uR;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}mh.nextTensorId=0;mh.nextVariableId=0;function h5(n){const e=II(xe(n),"float32");return re.makeTensor(e,n,"float32")}function pD(){const n=P$();if(n._tfengine==null){const e=new P6(n);n._tfengine=new mh(e)}return M6(n._tfengine.ENV),a5(()=>n._tfengine),n._tfengine}const re=pD();function d5(n,e){const t={a:n,b:e};return re.runKernel(Fh,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(){return typeof navigator<"u"&&navigator!=null}function mD(n){if(n||f5()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function gD(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=pe();ps.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ps.registerFlag("IS_BROWSER",()=>gD());ps.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ps.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ps.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ps.registerFlag("PROD",()=>!1);ps.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ps.getBool("DEBUG"));ps.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ps.registerFlag("IS_TEST",()=>!1);ps.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ps.getBool("DEBUG"));ps.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ps.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ps.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bv(n,e){let t=n;if(gi(n))return e==="string"?[]:[n.length];if(cD(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(hD(n))return[n.buffer.size/(e==null?4:xy(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||gi(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&pe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&yD(n,r,[]),r}function yD(n,e,t){if(t=t||[],!Array.isArray(n)&&!gi(n)){z(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}z(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),z(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)yD(n[s],r,t.concat(s))}function cR(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function G(n,e,t,r="numeric"){if(n instanceof ve())return cR(r,n.dtype,e,t),n;let s=Dh(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),cR(r,s,e,t),n==null||!gi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=bv(n,s);!gi(n)&&!Array.isArray(n)&&(n=[n]);const a=s!=="string"?Ku(n,s):Ru(n,[],!0);return re.makeTensor(a,i,s)}function vD(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>G(i,`${e}[${o}]`,t,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5="__op";function oe(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+p5;const s=(...i)=>{re.startScope(t);try{const o=r(...i);return CI(o)&&console.error("Cannot return a Promise inside of tidy."),re.endScope(o),o}catch(o){throw re.endScope(null),o}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(n,e){const t=G(n,"real","complex"),r=G(e,"imag","complex");bI(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return re.runKernel($I,s)}const Nu=oe({complex_:m5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iv(n,e,t,r){if(r==null)r=Dh(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(hD(n)||cD(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return re.backend.createTensorFromGPUData(n,e||t,r)}if(!gi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Sa(e);const s=xe(e),i=xe(t);z(s===i,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==xe(e.slice(o)):!0;z(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!gi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Ku(n,r):Ru(n,[],!0),re.makeTensor(n,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function th(n,e,t){const r=bv(n,t);return Iv(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sy={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Dl{static join(e){return new Dl(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>gi(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+s.byteLength;this.shards.push({buffer:s,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,i=new ArrayBuffer(s),o=new Uint8Array(i);let a=0;for(let l=r;l<this.shards.length;l++){const c=this.shards[l],f=e+a-c.start,p=a,y=Math.min(t,c.end)-c.start,w=new Uint8Array(c.buffer,f,y-f);if(o.set(w,p),a+=w.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=g5(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function g5(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,i=e(n[s]);if(i===0)return s;i<0?r=s:t=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function go(){return re}function hR(){return re.memory()}function de(n,e){return re.tidy(n,e)}function bt(n){dD(n).forEach(t=>t.dispose())}function _o(n){return re.keep(n)}function xD(n,e,t=1){return re.registerBackend(n,e,t)}function y5(){return re.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gh=4;async function dR(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<s.length;++o){const a=s[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((x,I)=>x+I.length,0)+gh*p.length,y=new Uint8Array(g);let w=0;for(let x=0;x<p.length;x++){const I=p[x],C=new Uint8Array(new Uint32Array([I.length]).buffer);y.set(C,w),w+=gh,y.set(I,w),w+=I.length}f(y)});r.push(d)}else r.push(l.data());e!=null&&(c.group=e),t.push(c)}const i=await Promise.all(r);return{data:b5(i),specs:t}}function v5(n,e){const t=new Dl(n),r={};let s=0;for(const i of e){const o=x5(i,(a,l)=>t.slice(s+a,s+l));r[i.name]=w5(i,t.slice(s,s+o)),s+=o}return r}function x5(n,e){const t=xe(n.shape);let r;if("quantization"in n){const s=n.quantization;r=Sy[s.dtype]}else if(n.dtype==="string"){let s=0;for(let i=0;i<t;i++)s+=gh+new Uint32Array(e(s,s+gh))[0];return s}else r=Sy[n.dtype];return t*r}function w5(n,e){const t=n.name,r=n.dtype,s=n.shape,i=xe(s);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=Sy[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=A5()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);a+=i*c}else if(r==="string"){const l=xe(n.shape);o=[];for(let c=0;c<l;c++){const d=new Uint32Array(e.slice(a,a+gh))[0];a+=gh;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=Sy[r];if(r==="float32")o=new Float32Array(e);else if(r==="int32")o=new Int32Array(e);else if(r==="bool")o=new Uint8Array(e);else if(r==="complex64"){o=new Float32Array(e);const c=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let y=0;y<c.length;y++)c[y]=o[y*2],d[y]=o[y*2+1];const f=th(c,s,"float32"),p=th(d,s,"float32"),g=Nu(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);a+=i*l}return th(o,s,r)}function b5(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(i=>{r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}const fC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function fR(n){return fC?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function I5(n){if(fC)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function C5(n){if(fC){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function S5(n){return Dl.join(n)}function E5(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function k5(n,e,t){const r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function T5(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),k5(n,t,r)}function pC(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:fR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:fR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Dl(n.weightData).byteLength}}function pR(n){const e=[];for(const t of n)e.push(...t.weights);return e}function _5(){const n=t=>{let r=t<<13,s=0;for(;!(r&8388608);)s-=8388608,r<<=1;return r&=-8388609,s+=947912704,r|s},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function R5(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function N5(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function A5(){const n=_5(),e=R5(),t=N5();return r=>{const s=new ArrayBuffer(4*r.length),i=new Uint32Array(s);for(let o=0;o<r.length;o++){const a=r[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lr{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return lr.instance==null&&(lr.instance=new lr),lr.instance}static registerSaveRouter(e){lr.getInstance().saveRouters.push(e)}static registerLoadRouter(e){lr.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return lr.getHandlers(e,"save")}static getLoadHandlers(e,t){return lr.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?lr.getInstance().loadRouters:lr.getInstance().saveRouters).forEach(o=>{const a=o(e,r);a!==null&&s.push(a)}),s}}const $5=n=>lr.getSaveHandlers(n),D5=(n,e)=>lr.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j1="tensorflowjs",H1=1,vu="models_store",ol="model_info_store";function wD(){if(!pe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function q1(n){const e=n.result;e.createObjectStore(vu,{keyPath:"modelPath"}),e.createObjectStore(ol,{keyPath:"modelPath"})}class Au{constructor(e){if(this.indexedDB=wD(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const i=this.indexedDB.open(j1,H1);i.onupgradeneeded=()=>q1(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(vu,"readonly"),c=a.objectStore(vu).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=d=>(o.close(),s(c.error)),a.oncomplete=()=>o.close()}else{t.weightData=Dl.join(t.weightData);const a=pC(t),l=o.transaction(ol,"readwrite");let c=l.objectStore(ol),d;try{d=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return s(p)}let f;d.onsuccess=()=>{f=o.transaction(vu,"readwrite");const p=f.objectStore(vu);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(y){return s(y)}g.onsuccess=()=>r({modelArtifactsInfo:a}),g.onerror=y=>{c=l.objectStore(ol);const w=c.delete(this.modelPath);w.onsuccess=()=>(o.close(),s(g.error)),w.onerror=x=>(o.close(),s(g.error))}},d.onerror=p=>(o.close(),s(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>s(i.error)})}}Au.URL_SCHEME="indexeddb://";const bD=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Au.URL_SCHEME)?P5(n.slice(Au.URL_SCHEME.length)):null;lr.registerSaveRouter(bD);lr.registerLoadRouter(bD);function P5(n){return new Au(n)}function F5(n){return n.startsWith(Au.URL_SCHEME)?n.slice(Au.URL_SCHEME.length):n}class O5{constructor(){this.indexedDB=wD()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(j1,H1);r.onupgradeneeded=()=>q1(r),r.onsuccess=()=>{const s=r.result,i=s.transaction(ol,"readonly"),a=i.objectStore(ol).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),t(a.error)),i.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=F5(e),new Promise((t,r)=>{const s=this.indexedDB.open(j1,H1);s.onupgradeneeded=()=>q1(s),s.onsuccess=()=>{const i=s.result,o=i.transaction(ol,"readwrite"),a=o.objectStore(ol),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{c=i.transaction(vu,"readwrite");const g=c.objectStore(vu).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=y=>r(l.error)};d.onsuccess=f,d.onerror=p=>(f(),i.close(),r(l.error))}},l.onerror=d=>(i.close(),r(l.error)),o.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},s.onerror=i=>r(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa="/",Kc="tensorflowjs_models",ID="info",L5="model_topology",M5="weight_specs",V5="weight_data",z5="model_metadata";function CD(n){return{info:[Kc,n,ID].join(aa),topology:[Kc,n,L5].join(aa),weightSpecs:[Kc,n,M5].join(aa),weightData:[Kc,n,V5].join(aa),modelMetadata:[Kc,n,z5].join(aa)}}function SD(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function B5(n){const e=n.split(aa);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(aa)}function U5(n){return n.startsWith($u.URL_SCHEME)?n.slice($u.URL_SCHEME.length):n}class $u{constructor(e){if(!pe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=CD(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=pC(e),i=Dl.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,I5(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw SD(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=C5(o),t}}$u.URL_SCHEME="localstorage://";const ED=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($u.URL_SCHEME)?W5(n.slice($u.URL_SCHEME.length)):null;lr.registerSaveRouter(ED);lr.registerLoadRouter(ED);function W5(n){return new $u(n)}class G5{constructor(){z(pe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),z(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Kc+aa,r=aa+ID;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(t)&&i.endsWith(r)){const o=B5(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=U5(e);const t=CD(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return SD(t),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mR="://";class yo{constructor(){this.managers={}}static getInstance(){return yo.instance==null&&(yo.instance=new yo),yo.instance}static registerManager(e,t){z(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(mR)&&(e=e.slice(0,e.indexOf(mR))),z(e.length>0,()=>"scheme must not be an empty string.");const r=yo.getInstance();z(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=yo.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(yo.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j5{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!pe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return sD(e)}}if(pe().get("IS_BROWSER")){pe().setPlatform("browser",new j5);try{yo.registerManager($u.URL_SCHEME,new G5)}catch{}try{yo.registerManager(Au.URL_SCHEME,new O5)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5={importFetch:()=>require("node-fetch")};let Gw;class q5{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return pe().global.fetch!=null?pe().global.fetch(e,t):(Gw==null&&(Gw=H5.importFetch()),Gw(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}pe().get("IS_NODE")&&!pe().get("IS_BROWSER")&&pe().setPlatform("node",new q5);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function It(n,e="float32",t){return e=e||"float32",Sa(n),new Cr(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n,e){const t=G(n,"x","cast");if(!N6(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return re.runKernel(Wf,r,s)}const ze=oe({cast_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n){const t={x:G(n,"x","clone","string_or_numeric")};return re.runKernel(np,t)}const Iu=oe({clone_:X5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pD();const Q5={buffer:It,cast:ze,clone:Iu,print:Y5};l5(Q5);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n,e){let t=G(n,"a","add"),r=G(e,"b","add");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(Fh,s)}const Ne=oe({add_:J5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,e){let t=G(n,"a","floorDiv"),r=G(e,"b","floorDiv");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(ep,s)}const kD=oe({floorDiv_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n,e){let t=G(n,"a","div"),r=G(e,"b","div");if([t,r]=Vn(t,r),t.dtype==="int32"&&r.dtype==="int32")return kD(t,r);const s={a:t,b:r},i={};return re.runKernel(Kf,s,i)}const rt=oe({div_:eq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(n,e){let t=G(n,"a","mul"),r=G(e,"b","mul");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(hp,s)}const J=oe({mul_:tq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const e=G(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return re.runKernel(T0,t)}else{const t={x:e};return re.runKernel(w0,t)}}const Qr=oe({abs_:nq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const t={x:G(n,"x","acos")};return re.runKernel(Of,t)}const sq=oe({acos_:rq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n){const t={x:G(n,"x","acosh")};return re.runKernel(Lf,t)}const oq=oe({acosh_:iq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aq(n,e=null,t=!1){const s={x:G(n,"x","all","bool")},i={axis:e,keepDims:t};return re.runKernel(kI,s,i)}const TD=oe({all_:aq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n,e=null,t=!1){const s={x:G(n,"x","any","bool")},i={axis:e,keepDims:t};return re.runKernel(TI,s,i)}const K1=oe({any_:lq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(n,e=0){const r={x:G(n,"x","argMax")},s={axis:e};return re.runKernel(b0,r,s)}const uf=oe({argMax_:uq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(n,e=0){const r={x:G(n,"x","argMin")},s={axis:e};return re.runKernel(I0,r,s)}const hq=oe({argMin_:cq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(n){const t={x:G(n,"x","asin")};return re.runKernel(Mf,t)}const fq=oe({asin_:dq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n){const t={x:G(n,"x","asinh")};return re.runKernel(Vf,t)}const mq=oe({asinh_:pq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(n){const t={x:G(n,"x","atan")};return re.runKernel(zf,t)}const yq=oe({atan_:gq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vq(n,e){let t=G(n,"a","atan2"),r=G(e,"b","atan2");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(Uf,s)}const xq=oe({atan2_:vq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(n){const t={x:G(n,"x","atanh")};return re.runKernel(Bf,t)}const bq=oe({atanh_:wq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ap(n,e,t,r,s="NHWC",i){const o=n[3],a=[...e,o],l=ka(s);return Sr(n,a,t,i,r,null,null,l)}function vi(n,e,t,r,s,i,o="channelsLast"){const[a,l]=cf(e);let c;if(o==="channelsLast")c=[a,l,n[3],n[3]];else if(o==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Sr(n,c,t,r,s,i,!1,o)}function Ea(n,e,t,r,s,i,o="NDHWC"){const[a,l,c]=X1(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,c,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Pl(n,d,t,r,s,!1,f,i)}function Sr(n,e,t,r,s,i,o=!1,a="channelsLast"){let[l,c,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,d,f]=n;else if(a==="channelsFirst")[l,f,c,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,y]=e,[w,x]=cf(t),[I,C]=cf(r),k=nh(p,I),E=nh(g,C),{padInfo:_,outHeight:L,outWidth:P}=Sq(s,c,d,w,x,k,E,i,a),A=o?y*f:y;let $;return a==="channelsFirst"?$=[l,A,L,P]:a==="channelsLast"&&($=[l,L,P,A]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:d,inChannels:f,outHeight:L,outWidth:P,outChannels:A,padInfo:_,strideHeight:w,strideWidth:x,filterHeight:p,filterWidth:g,effectiveFilterHeight:k,effectiveFilterWidth:E,dilationHeight:I,dilationWidth:C,inShape:n,outShape:$,filterShape:e}}function Pl(n,e,t,r,s,i=!1,o="channelsLast",a){let[l,c,d,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,d,f,p]=n;else if(o==="channelsFirst")[l,p,c,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,y,w,,x]=e,[I,C,k]=X1(t),[E,_,L]=X1(r),P=nh(g,E),A=nh(y,_),$=nh(w,L),{padInfo:D,outDepth:R,outHeight:M,outWidth:O}=Eq(s,c,d,f,I,C,k,P,A,$,a),Z=i?x*p:x;let q;return o==="channelsFirst"?q=[l,Z,R,M,O]:o==="channelsLast"&&(q=[l,R,M,O,Z]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:d,inWidth:f,inChannels:p,outDepth:R,outHeight:M,outWidth:O,outChannels:Z,padInfo:D,strideDepth:I,strideHeight:C,strideWidth:k,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:P,effectiveFilterHeight:A,effectiveFilterWidth:$,dilationDepth:E,dilationHeight:_,dilationWidth:L,inShape:n,outShape:q,filterShape:e}}function Iq(n,e,t,r,s){r==null&&(r=mC(n,e,t));const i=n[0],o=n[1],a=hf((i-e+2*r)/t+1,s),l=hf((o-e+2*r)/t+1,s);return[a,l]}function Cq(n,e,t,r,s,i){s==null&&(s=mC(n,e[0],r[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*s>=e[a]&&(o[a]=hf((n[a]-e[a]+2*s)/r[a]+1,i));return o}function mC(n,e,t,r=1){const s=nh(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function cf(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function X1(n){return typeof n=="number"?[n,n,n]:n}function nh(n,e){return e<=1?n:n+(n-1)*(e-1)}function Sq(n,e,t,r,s,i,o,a,l){let c,d,f;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=Iq([e,t],i,r,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/r),f=Math.ceil(t/s);const p=Math.max(0,(d-1)*r+i-e),g=Math.max(0,(f-1)*s+o-t),y=Math.floor(p/2),w=p-y,x=Math.floor(g/2),I=g-x;c={top:y,bottom:w,left:x,right:I,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/s);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],y=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];c={top:p,bottom:g,left:y,right:w,type:p===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT"},d=hf((e-i+p+g)/r+1,a),f=hf((t-o+y+w)/s+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:d,outWidth:f}}function Eq(n,e,t,r,s,i,o,a,l,c,d){let f,p,g,y;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=Cq([e,t,r,1],[a,l,c],1,[s,i,o],n,d);p=x[0],g=x[1],y=x[2]}else if(n==="same"){p=Math.ceil(e/s),g=Math.ceil(t/i),y=Math.ceil(r/o);const w=(p-1)*s+a-e,x=(g-1)*i+l-t,I=(y-1)*o+c-r,C=Math.floor(w/2),k=w-C,E=Math.floor(x/2),_=x-E,L=Math.floor(I/2),P=I-L;f={top:E,bottom:_,left:L,right:P,front:C,back:k,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:y}}function hf(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Du(n){const[e,t,r]=cf(n);return e===1&&t===1&&r===1}function zr(n,e){return Du(n)||Du(e)}function Pu(n){return cf(n).every(e=>e>0)}function ka(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function gs(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")z(ph(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{z(ph(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(n,e){const r={x:G(n,"x","reshape","string_or_numeric")},s={shape:e};return re.runKernel(av,r,s)}const ie=oe({reshape_:kq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tq(n,e,t,r,s){const i=G(n,"x","avgPool","float32"),o=1;z(zr(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),z(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),gs("avgPool",r,s);const c={x:a},d={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let f=re.runKernel(C0,c,d);return f=ze(f,i.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const gC=oe({avgPool_:Tq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(n,e,t,r,s,i="NDHWC"){const o=G(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),z(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),z(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),gs("avgPool3d",r,s);const c={x:a},d={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i};let f=re.runKernel(S0,c,d);return f=ze(f,a.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Rq=oe({avgPool3d_:_q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(n,e=0){z(n.length>=1,()=>"Pass at least one tensor to concat");const t=vD(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Iu(t[0]);const r=t,s={axis:e};return re.runKernel(_0,r,s)}const fs=oe({concat_:Nq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aq(n,e,t=!1,r=!1){let s=G(n,"a","matMul"),i=G(e,"b","matMul");[s,i]=Vn(s,i);const o={a:s,b:i},a={transposeA:t,transposeB:r};return re.runKernel(E0,o,a)}const Xt=oe({matMul_:Aq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $q(n){const t={x:G(n,"x","sigmoid","float32")};return re.runKernel(Ip,t)}const Oh=oe({sigmoid_:$q});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n,e,t){const r=G(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},i={begin:e,size:t};return re.runKernel(dv,s,i)}const dn=oe({slice_:Dq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(n){const t={x:G(n,"x","tanh","float32")};return re.runKernel(_p,t)}const Cv=oe({tanh_:Pq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(n,e,t){const r=G(n,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);z(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),z(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),z(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const i={x:r},o={blockShape:e,crops:t};return re.runKernel(k0,i,o)}const yC=oe({batchToSpaceND_:Fq});function Oq(n){let e;return n.rank===0||n.rank===1?e=ie(n,[1,1,1,n.size]):n.rank===2?e=ie(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n,e,t,r,s,i){i==null&&(i=.001);const o=G(n,"x","batchNorm"),a=G(e,"mean","batchNorm"),l=G(t,"variance","batchNorm");let c;s!=null&&(c=G(s,"scale","batchNorm"));let d;r!=null&&(d=G(r,"offset","batchNorm")),z(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:Oq(o),scale:c,offset:d,mean:a,variance:l},g={varianceEpsilon:i},y=re.runKernel(L0,p,g);return ie(y,o.shape)}const Sv=oe({batchNorm_:Lq});function Mq(n,e,t,r,s,i){const o=G(n,"x","batchNorm"),a=G(e,"mean","batchNorm"),l=G(t,"variance","batchNorm");let c;s!=null&&(c=G(s,"scale","batchNorm"));let d;return r!=null&&(d=G(r,"offset","batchNorm")),z(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),z(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),z(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),d!=null&&z(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Sv(o,a,l,d,c,i)}const Vq=oe({batchNorm2d_:Mq});function zq(n,e,t,r,s,i){const o=G(n,"x","batchNorm"),a=G(e,"mean","batchNorm"),l=G(t,"variance","batchNorm");let c;s!=null&&(c=G(s,"scale","batchNorm"));let d;return r!=null&&(d=G(r,"offset","batchNorm")),z(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),z(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),z(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),d!=null&&z(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Sv(o,a,l,d,c,i)}const Bq=oe({batchNorm3d_:zq});function Uq(n,e,t,r,s,i){const o=G(n,"x","batchNorm"),a=G(e,"mean","batchNorm"),l=G(t,"variance","batchNorm");let c;s!=null&&(c=G(s,"scale","batchNorm"));let d;return r!=null&&(d=G(r,"offset","batchNorm")),z(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),z(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),z(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),d!=null&&z(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Sv(o,a,l,d,c,i)}const Wq=oe({batchNorm4d_:Uq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n,e,t){const r=G(n,"x","bincount"),s=G(e,"weights","bincount");z(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),z(t>=0,()=>`size must be non-negative, but got ${t}.`),z(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const i={x:r,weights:s},o={size:t};return re.runKernel(NI,i,o)}const jq=oe({bincount_:Gq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(n,e){let t=G(n,"broadcastTo","x");const r=t.shape;if(Sa(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=ie(t,c)}const s=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(s[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((c,d)=>c>1?d:-1).filter(c=>c>=0).length===0)return Iu(t);const a={x:t},l={reps:i};return re.runKernel(Rp,a,l)}const Qd=oe({broadcastTo_:Hq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){const t={x:G(n,"x","ceil","float32")};return re.runKernel(Gf,t)}const Kq=oe({ceil_:qq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ev(n,e,t){Sa(n),t=t||Dh(e);const r={shape:n,value:e,dtype:t};return re.runKernel(jI,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n,e,t){const r=G(n,"x","clipByValue");if(z(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Ev(r.shape,e,r.dtype);const s={x:r},i={clipValueMin:e,clipValueMax:t};return re.runKernel(jf,s,i)}const Ys=oe({clipByValue_:Xq});function Yq(n){return fs(n,0)}const Qq=oe({concat1d_:Yq});function Jq(n,e){return fs(n,e)}const Zq=oe({concat2d_:Jq});function e9(n,e){return fs(n,e)}const t9=oe({concat3d_:e9});function n9(n,e){return fs(n,e)}const r9=oe({concat4d_:n9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9(n,e,t,r,s="NHWC",i=[1,1],o){const a=G(n,"x","conv2d","float32"),l=G(e,"filter","conv2d","float32");let c=a,d=!1;a.rank===3&&(d=!0,c=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),z(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),gs("conv2d",r,o);const f=s==="NHWC"?c.shape[3]:c.shape[1];z(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),z(zr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),z(Pu(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),z(Pu(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:c,filter:l},g={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},y=re.runKernel(R0,p,g);return d?ie(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Fu=oe({conv2d_:s9});function i9(n,e,t,r,s="NWC",i=1,o){const a=G(n,"x","conv1d"),l=G(e,"filter","conv1d");let c=a,d=!1;a.rank===2&&(d=!0,c=ie(a,[1,a.shape[0],a.shape[1]])),z(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),z(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),gs("conv1d",r,o),z(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),z(zr(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),z(Pu(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),z(Pu(t),()=>"Error in conv1D: Stride should be larger than 0."),z(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ie(c,[c.shape[0],1,c.shape[1],c.shape[2]]),x=Fu(p,f,[1,t],r,"NHWC",[1,i],o);return d?ie(x,[x.shape[2],x.shape[3]]):ie(x,[x.shape[0],x.shape[2],x.shape[3]])}const _D=oe({conv1d_:i9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9(n,e,t,r,s,i="NHWC",o){z(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,c=!1;e.rank===3&&(c=!0,l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),z(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),z(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),z(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];z(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),z(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),gs("conv2dDerInput",s,o);const p={dy:l,filter:t},g={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,inputShape:a},y=re.runKernel(N0,p,g);return c?ie(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const vC=oe({conv2DBackpropInput_:o9});function a9(n,e,t,r,s,i){const o=G(n,"x","conv2dTranspose"),a=G(e,"filter","conv2dTranspose");return vC(t,o,a,r,s,"NHWC",i)}const RD=oe({conv2dTranspose_:a9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(n,e,t,r,s="NDHWC",i=[1,1,1]){const o=G(n,"x","conv3d"),a=G(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),z(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),z(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),z(zr(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),z(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),z(Pu(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),z(Pu(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:r,dataFormat:s,dilations:i},p=re.runKernel(A0,d,f);return c?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const u9=oe({conv3d_:l9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(n,e,t,r,s){z(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],c=o.shape[4];z(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),z(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),z(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),z(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),z(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:s,strides:r,inputShape:i},p=re.runKernel(FI,d,f);return a?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const ND=oe({conv3DBackpropInput_:c9});function h9(n,e,t,r,s){const i=G(n,"x","conv3dTranspose"),o=G(e,"filter","conv3dTranspose");return ND(t,i,o,r,s)}const d9=oe({conv3dTranspose_:h9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(n){const t={x:G(n,"x","cos","float32")};return re.runKernel(Hf,t)}const xC=oe({cos_:f9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(n){const t={x:G(n,"x","cosh","float32")};return re.runKernel(qf,t)}const AD=oe({cosh_:p9});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(n,e=0,t=!1,r=!1){const i={x:G(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return re.runKernel(OI,i,o)}const Y1=oe({cumprod_:m9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(n,e=0,t=!1,r=!1){const i={x:G(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return re.runKernel($0,i,o)}const $D=oe({cumsum_:g9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9(n,e,t,r=!1){const s=G(n,"x","denseBincount"),i=G(e,"weights","denseBincount");z(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),z(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),z(t>=0,()=>`size must be non-negative, but got ${t}.`),z(i.size===s.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${i.shape}.`);const o={x:s,weights:i},a={size:t,binaryOutput:r};return re.runKernel(MI,o,a)}const gR=oe({denseBincount_:y9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n,e,t="NHWC"){const r=G(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];z(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),z(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),z(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),z(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:t};return re.runKernel(VI,a,l)}const x9=oe({depthToSpace_:v9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n,e,t,r,s="NHWC",i=[1,1],o){const a=G(n,"x","depthwiseConv2d","float32"),l=G(e,"filter","depthwiseConv2d","float32");let c=a,d=!1;a.rank===3&&(d=!0,c=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),z(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=s==="NHWC"?c.shape[3]:c.shape[1];z(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),gs("depthwiseConv2d",r,o);const p={x:c,filter:l},g={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},y=re.runKernel(D0,p,g);return d?ie(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const wC=oe({depthwiseConv2d_:w9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(n,e,t,r,s=[1,1],i="NHWC"){const o=G(n,"x","dilation2d"),a=G(e,"filter","dilation2d");z(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),z(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),z(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,c=!1;o.rank===3&&(l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),z(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:r,dilations:s},p=re.runKernel(P0,d,f);return c?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const I9=oe({dilation2d_:b9});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yh(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const i=t-1-s,o=n[i]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(i)}return r}function rr(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],i=e.length-r-1,o=e[i];(s==null||s===1&&o>1)&&t.unshift(i)}return t}function yt(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let i=n[n.length-s-1];i==null&&(i=1);let o=e[e.length-s-1];if(o==null&&(o=1),i===1)r[t-s-1]=o;else if(o===1)r[t-s-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else r[t-s-1]=i}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n,e){let t=G(n,"a","equal","string_or_numeric"),r=G(e,"b","equal","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(F0,s)}const Fo=oe({equal_:C9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n,e,t){const r=G(e,"a","where"),s=G(t,"b","where"),i=G(n,"condition","where","bool"),o=yt(yt(i.shape,r.shape),s.shape),a=Qd(i,o),l=Qd(r,o),c=Qd(s,o),d={condition:a,t:l,e:c};return re.runKernel(hv,d)}const ts=oe({where_:S9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(n){const t={x:G(n,"x","zerosLike")};return re.runKernel(xv,t)}const Lt=oe({zerosLike_:E9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(n,e){let t=G(n,"a","div"),r=G(e,"b","div");[t,r]=Vn(t,r);const s=rt(t,r),i=Lt(s),o=Fo(r,i);return ts(o,i,s)}const T9=oe({divNoNan_:k9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _9(n,e){const t=G(n,"t1","dot"),r=G(e,"t2","dot");z((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(z(s===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${i}.`),t.rank===1&&r.rank===1){const o=ie(t,[1,-1]),a=ie(r,[-1,1]),l=Xt(o,a);return ie(l,[])}else if(t.rank===1&&r.rank===2){const o=ie(t,[1,-1]),a=ie(r,[r.shape[0],r.shape[1]]),l=Xt(o,a);return ie(l,[l.size])}else if(t.rank===2&&r.rank===1){const o=ie(r,[-1,1]),a=Xt(t,o);return ie(a,[a.size])}else{const o=ie(r,[r.shape[0],r.shape[1]]);return Xt(t,o)}}const R9=oe({dot_:_9});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(n,...e){const t=e.map((s,i)=>G(s,`tensors${i}`,"einsum")),r={equation:n};return re.runKernel(UI,t,r)}const $d=oe({einsum_:N9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(n){const t={x:G(n,"x","elu","float32")};return re.runKernel(Xf,t)}const kv=oe({elu_:A9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n){let e=G(n,"x","erf");z(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ze(e,"float32"));const t={x:e};return re.runKernel(Yf,t)}const DD=oe({erf_:$9});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bC(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function PD(n,e,t){const r=n.length+e.length,s=[];let i=0,o=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[i++]):s.push(e[o++]);return s}function pr(n,e){const t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);const s=e.map(i=>n[i]);return[t,s]}function qn(n,e){const t=e.map(r=>1);return PD(n,t,e)}function Er(n,e,t){z(bC(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Rn(n,e){if(bC(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Fl(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function zn(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n,e=null,t=!1){const s={x:G(n,"x","max")},i={reductionIndices:e,keepDims:t};return re.runKernel(q0,s,i)}const qi=oe({max_:D9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n,e=null,t=!1){const s={x:G(n,"x","min")},i={axis:e,keepDims:t};return re.runKernel(Q0,s,i)}const Ey=oe({min_:P9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(n,e){let t=G(n,"base","pow"),r=G(e,"exp","pow");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(dp,s)}const Ou=oe({pow_:F9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n,e){if((gi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&gi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Iv(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(n){const t={x:G(n,"x","sqrt","float32")};return re.runKernel(Sp,t)}const Vr=oe({sqrt_:O9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(n){const e=G(n,"x","square"),t={};return re.runKernel("Square",{x:e},t)}const gn=oe({square_:L9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M9(n,e=null,t=!1){let r=G(n,"x","sum");r.dtype==="bool"&&(r=ze(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return re.runKernel(fv,s,i)}const nt=oe({sum_:M9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n,e="euclidean",t=null,r=!1){n=G(n,"x","norm");const s=FD(n,e,t);let i=s.shape;if(r){const o=Ct(t,n.shape);i=qn(s.shape,o)}return ie(s,i)}function FD(n,e,t=null){if(n.rank===0)return Qr(n);if(n.rank!==1&&t===null)return FD(ie(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return nt(Qr(n),t);if(e===1/0)return qi(Qr(n),t);if(e===-1/0)return Ey(Qr(n),t);if(e==="euclidean"||e===2)return Vr(nt(Ou(Qr(n),Yt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return qi(nt(Qr(n),t[0]),t[1]-1);if(e===1/0)return qi(nt(Qr(n),t[1]),t[0]);if(e===-1/0)return Ey(nt(Qr(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Vr(nt(gn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Tv=oe({norm_:V9});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(n,e=null,t=!1){return Tv(n,"euclidean",e,t)}const B9=oe({euclideanNorm_:z9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(n){const t={x:G(n,"x","exp")};return re.runKernel(Qf,t)}const Oo=oe({exp_:U9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(n,e=0){const t=G(n,"x","expandDims","string_or_numeric");z(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return re.runKernel(O0,r,s)}const hs=oe({expandDims_:W9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(n){const t={x:G(n,"x","expm1")};return re.runKernel(Jf,t)}const j9=oe({expm1_:G9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9(n,e){const t=G(n,"x","tile","string_or_numeric");z(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return re.runKernel(Rp,r,s)}const Gi=oe({tile_:H9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9(n,e,t,r="float32"){e==null&&(e=n);const s=It([n,e],r),i=n<=e?n:e;for(let a=0;a<i;++a)s.set(1,a,a);const o=ie(s.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Gi(hs(o,0),[t[0],1,1]);if(t.length===2)return Gi(hs(hs(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Gi(hs(hs(hs(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const OD=oe({eye_:q9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(n){const t={x:G(n,"x","floor","float32")};return re.runKernel(Zf,t)}const _v=oe({floor_:K9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(n,e,t=0,r=0){const s=G(n,"x","gather"),i=G(e,"indices","gather","int32"),o={x:s,indices:i},a={axis:t,batchDims:r};return re.runKernel(M0,o,a)}const IC=oe({gather_:X9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y9(n,e){let t=G(n,"a","greater","string_or_numeric"),r=G(e,"b","greater","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(V0,s)}const Qs=oe({greater_:Y9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n,e){let t=G(n,"a","greaterEqual","string_or_numeric"),r=G(e,"b","greaterEqual","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(tp,s)}const Xu=oe({greaterEqual_:Q9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(n){const t={input:G(n,"input","imag")};return re.runKernel(KI,t)}const CC=oe({imag_:J9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z9(n){const t={x:G(n,"x","isFinite")};return re.runKernel(rp,t)}const eK=oe({isFinite_:Z9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n){const t={x:G(n,"x","isInf")};return re.runKernel(sp,t)}const nK=oe({isInf_:tK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const t={x:G(n,"x","isNaN")};return re.runKernel(ip,t)}const sK=oe({isNaN_:rK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n,e=.2){const r={x:G(n,"x","leakyRelu")},s={alpha:e};return re.runKernel(z0,r,s)}const SC=oe({leakyRelu_:iK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n,e){let t=G(n,"a","less","string_or_numeric"),r=G(e,"b","less","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(B0,s)}const ky=oe({less_:oK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n,e){let t=G(n,"a","lessEqual","string_or_numeric"),r=G(e,"b","lessEqual","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(U0,s)}const Lh=oe({lessEqual_:aK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n,e=5,t=1,r=1,s=.5){const i=G(n,"x","localResponseNormalization");z(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),z(ph(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},c={depthRadius:e,bias:t,alpha:r,beta:s},d=re.runKernel(H0,l,c);return a?ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const uK=oe({localResponseNormalization_:lK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n){const t={x:G(n,"x","log","float32")};return re.runKernel(op,t)}const Lo=oe({log_:cK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n){const t={x:G(n,"x","log1p")};return re.runKernel(ap,t)}const LD=oe({log1p_:hK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(n,e){z(F1(n),()=>"The f passed in variableGrads(f) must be a function"),z(e==null||Array.isArray(e)&&e.every(c=>c instanceof Cy),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in re.registeredVariables)e.push(re.registeredVariables[c])}const r=t?e.filter(c=>!c.trainable):null,s=e.length;e=e.filter(c=>c.trainable),z(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const i=!0,{value:o,grads:a}=re.gradients(n,e,null,i);z(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),z(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,d)=>{a[d]!=null&&(l[c.name]=a[d])}),r!=null&&r.forEach(c=>l[c.name]=null),{value:o,grads:l}}function vh(n){return re.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n){const t={x:G(n,"x","neg")};return re.runKernel(Z0,t)}const Mn=oe({neg_:fK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n){const t={x:G(n,"x","softplus")};return re.runKernel(Cp,t)}const $p=oe({softplus_:pK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(n){const e=G(n,"x","logSigmoid");return vh(r=>({value:Mn($p(Mn(r))),gradFunc:o=>J(o,Oh(Mn(r)))}))(e)}const gK=oe({logSigmoid_:mK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n,e){let t=G(n,"a","sub"),r=G(e,"b","sub");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(kp,s)}const ut=oe({sub_:yK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n,e=-1){const t=G(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return vh((s,i)=>{const a=qi(s,e,!0),l=ut(s,a),c=ut(ze(l,"float32"),Lo(nt(Oo(l),e,!0)));return i([c]),{value:c,gradFunc:(f,p)=>{const[g]=p,y=!0,w=Oo(g);return ut(f,J(nt(f,e,y),w))}}})(t)}const MD=oe({logSoftmax_:vK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(n,e=null,t=!1){const r=G(n,"x","logSumExp"),s=Ct(e,r.shape),i=qi(r,s,!0),o=ut(r,i),a=Oo(o),l=nt(a,s),c=Lo(l),d=Ne(ie(i,c.shape),c);if(t){const f=qn(d.shape,s);return ie(d,f)}return d}const VD=oe({logSumExp_:xK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n,e){const t=G(n,"a","logicalAnd","bool"),r=G(e,"b","logicalAnd","bool");yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(W0,s)}const va=oe({logicalAnd_:wK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n){const t={x:G(n,"x","logicalNot","bool")};return re.runKernel(G0,t)}const EC=oe({logicalNot_:bK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n,e){const t=G(n,"a","logicalOr","bool"),r=G(e,"b","logicalOr","bool");yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(j0,s)}const zD=oe({logicalOr_:IK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n,e){const t=G(n,"a","logicalXor","bool"),r=G(e,"b","logicalXor","bool");return yt(t.shape,r.shape),va(zD(n,e),EC(va(n,e)))}const SK=oe({logicalXor_:CK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(n,e,t,r,s){const i=G(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),z(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),z(zr(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),gs("maxPool",r,s);const c={x:a},d={filterSize:e,strides:t,pad:r,dimRoundingMode:s},f=re.runKernel(K0,c,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const kC=oe({maxPool_:EK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n,e=[1,1,1],t,r,s,i="NDHWC"){const o=G(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),z(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),gs("maxPool3d",r,s);const c={x:a},d={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i},f=re.runKernel(X0,c,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const TK=oe({maxPool3d_:kK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n,e){let t=G(n,"a","maximum"),r=G(e,"b","maximum");[t,r]=Vn(t,r),t.dtype==="bool"&&(t=ze(t,"int32"),r=ze(r,"int32")),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(lp,s)}const Ol=oe({maximum_:_K});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n,e=null,t=!1){const s={x:G(n,"x","mean")},i={axis:e,keepDims:t};return re.runKernel(Y0,s,i)}const Hn=oe({mean_:RK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cr(n,e="float32"){if(Sa(n),e==="complex64"){const r=cr(n,"float32"),s=cr(n,"float32");return Nu(r,s)}const t=Mr(xe(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ll(n,e="float32"){if(Sa(n),e==="complex64"){const r=Ll(n,"float32"),s=cr(n,"float32");return Nu(r,s)}const t=II(xe(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(n,e){let t=G(n,"a","minimum"),r=G(e,"b","minimum");[t,r]=Vn(t,r),t.dtype==="bool"&&(t=ze(t,"int32"),r=ze(r,"int32")),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(up,s)}const df=oe({minimum_:NK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(n,e,t){z(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=G(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");z(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let a=0;a<r.rank;a++)z(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),z(e[a][0]>=0&&e[a][0]<=r.shape[a]-s&&e[a][1]>=0&&e[a][1]<=r.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-s} or less than 0 for input of shape ${r.shape}`);const i={paddings:e,mode:t},o={x:r};return re.runKernel(J0,o,i)}const $K=oe({mirrorPad_:AK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(n,e){let t=G(n,"a","mod"),r=G(e,"b","mod");[t,r]=Vn(t,r);const s={a:t,b:r};return re.runKernel(cp,s)}const PK=oe({mod_:DK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(n,e=null,t=!1){n=G(n,"x","moments");const r=Ct(e,n.shape),s=Hn(n,r,t);let i=s.shape;t||(i=qn(s.shape,r));const o=gn(ut(ze(n,"float32"),ie(s,i))),a=Hn(o,r,t);return{mean:s,variance:a}}const TC=oe({moments_:FK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n,e){let t=G(n,"a","notEqual","string_or_numeric"),r=G(e,"b","notEqual","string_or_numeric");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r};return re.runKernel(ev,s)}const Ty=oe({notEqual_:OK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:G(n,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:t,offValue:r};return re.runKernel(nv,o,a)}const BD=oe({oneHot_:LK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n){const t={x:G(n,"x","onesLike")};return re.runKernel(tv,t)}const yi=oe({onesLike_:MK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(n,e,t=0){const r=G(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},i={x:r};return re.runKernel(sv,i,s)}const _C=oe({pad_:VK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zK(n,e,t){const r=G(n,"x","spaceToBatchND");z(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),z(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),z(r.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},i={blockShape:e,paddings:t};return re.runKernel(pv,s,i)}const RC=oe({spaceToBatchND_:zK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n,e,t,r,s,i,o){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");const a=G(n,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(zr(i,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`);const d=vi(l.shape,e,i,s,r),f=[d.dilationHeight,d.dilationWidth];let p;r==="same"?p=WK([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[y,w]=UK([d.inHeight,d.inWidth],f,p),x=g?r:"valid",I=g?l:RC(l,f,y),k=(t==="avg"?()=>gC(I,e,i,x,o):()=>kC(I,e,i,x,o))(),E=g?k:yC(k,f,w);return c?ie(E,[E.shape[1],E.shape[2],E.shape[3]]):E}function UK(n,e,t){const r=t.map(d=>d[0]),s=t.map(d=>d[1]),i=n.concat(r,s),o=e.map((d,f)=>(d-i[f]%d)%d),a=s.map((d,f)=>d+o[f]),l=e.map((d,f)=>[r[f],a[f]]),c=e.map((d,f)=>[0,o[f]]);return[l,c]}function WK(n,e){const r=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),s=r.map(o=>Math.floor(o/2)),i=r.map((o,a)=>o-s[a]);return r.map((o,a)=>[s[a],i[a]])}const GK=oe({pool_:BK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n,e){const t=G(n,"x","prelu"),r=G(e,"alpha","prelu"),s={x:t,alpha:r};return re.runKernel(iv,s)}const NC=oe({prelu_:jK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(n,e=null,t=!1){let r=G(n,"x","prod");r.dtype==="bool"&&(r=ze(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return re.runKernel(ov,s,i)}const qK=oe({prod_:HK});var Gg={exports:{}},KK=Gg.exports,yR;function XK(){return yR||(yR=1,function(n){(function(e,t,r){function s(l){var c=this,d=a();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(l),c.s0<0&&(c.s0+=1),c.s1-=d(l),c.s1<0&&(c.s1+=1),c.s2-=d(l),c.s2<0&&(c.s2+=1),d=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var d=new s(l),f=c&&c.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,d),p.state=function(){return i(d,{})}),p}function a(){var l=4022871197,c=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return c}t.exports?t.exports=o:this.alea=o})(KK,n)}(Gg)),Gg.exports}var jg={exports:{}},YK=jg.exports,vR;function QK(){return vR||(vR=1,function(n){(function(e,t,r){function s(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:c+=a;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new s(a),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var p=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(p+g)/(1<<21);while(y===0);return y},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&i(d,c),f.state=function(){return i(c,{})}),f}t.exports?t.exports=o:this.xor128=o})(YK,n)}(jg)),jg.exports}var Hg={exports:{}},JK=Hg.exports,xR;function ZK(){return xR||(xR=1,function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,d==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new s(a),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var p=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(p+g)/(1<<21);while(y===0);return y},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&i(d,c),f.state=function(){return i(c,{})}),f}t.exports?t.exports=o:this.xorwow=o})(JK,n)}(Hg)),Hg.exports}var qg={exports:{}},e8=qg.exports,wR;function t8(){return wR||(wR=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function c(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}c(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new s(a),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var p=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(p+g)/(1<<21);while(y===0);return y},f.int32=c.next,f.quick=f,d&&(d.x&&i(d,c),f.state=function(){return i(c,{})}),f}t.exports?t.exports=o:this.xorshift7=o})(e8,n)}(qg)),qg.exports}var Kg={exports:{}},n8=Kg.exports,bR;function r8(){return bR||(bR=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,y;return l.w=d=d+1640531527|0,y=f[p+34&127],g=f[p=p+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=f[p]=y^g,l.i=p,y+(d^d>>>16)|0};function c(d,f){var p,g,y,w,x,I=[],C=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,C=Math.max(C,f.length)),y=0,w=-32;w<C;++w)f&&(g^=f.charCodeAt((w+32)%f.length)),w===0&&(x=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,w>=0&&(x=x+1640531527|0,p=I[w&127]^=g+x,y=p==0?y+1:0);for(y>=128&&(I[(f&&f.length||0)&127]=-1),y=127,w=4*128;w>0;--w)g=I[y+34&127],p=I[y=y+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,I[y]=g^p;d.w=x,d.X=I,d.i=y}c(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new s(a),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var p=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(p+g)/(1<<21);while(y===0);return y},f.int32=c.next,f.quick=f,d&&(d.X&&i(d,c),f.state=function(){return i(c,{})}),f}t.exports?t.exports=o:this.xor4096=o})(n8,n)}(Kg)),Kg.exports}var Xg={exports:{}},s8=Xg.exports,IR;function i8(){return IR||(IR=1,function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var f=l.b,p=l.c,g=l.d,y=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^y,y=y-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^y,l.a=y-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var d=0;d<c.length+20;d++)l.b^=c.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new s(a),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var p=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(p+g)/(1<<21);while(y===0);return y},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&i(d,c),f.state=function(){return i(c,{})}),f}t.exports?t.exports=o:this.tychei=o})(s8,n)}(Xg)),Xg.exports}var Yg={exports:{}};const o8={},a8=Object.freeze(Object.defineProperty({__proto__:null,default:o8},Symbol.toStringTag,{value:"Module"})),l8=f3(a8);var u8=Yg.exports,CR;function c8(){return CR||(CR=1,function(n){(function(e,t,r){var s=256,i=6,o=52,a="random",l=r.pow(s,i),c=r.pow(2,o),d=c*2,f=s-1,p;function g(E,_,L){var P=[];_=_==!0?{entropy:!0}:_||{};var A=I(x(_.entropy?[E,k(t)]:E??C(),3),P),$=new y(P),D=function(){for(var R=$.g(i),M=l,O=0;R<c;)R=(R+O)*s,M*=s,O=$.g(1);for(;R>=d;)R/=2,M/=2,O>>>=1;return(R+O)/M};return D.int32=function(){return $.g(4)|0},D.quick=function(){return $.g(4)/4294967296},D.double=D,I(k($.S),t),(_.pass||L||function(R,M,O,Z){return Z&&(Z.S&&w(Z,$),R.state=function(){return w($,{})}),O?(r[a]=R,M):R})(D,A,"global"in _?_.global:this==r,_.state)}function y(E){var _,L=E.length,P=this,A=0,$=P.i=P.j=0,D=P.S=[];for(L||(E=[L++]);A<s;)D[A]=A++;for(A=0;A<s;A++)D[A]=D[$=f&$+E[A%L]+(_=D[A])],D[$]=_;(P.g=function(R){for(var M,O=0,Z=P.i,q=P.j,se=P.S;R--;)M=se[Z=f&Z+1],O=O*s+se[f&(se[Z]=se[q=f&q+M])+(se[q]=M)];return P.i=Z,P.j=q,O})(s)}function w(E,_){return _.i=E.i,_.j=E.j,_.S=E.S.slice(),_}function x(E,_){var L=[],P=typeof E,A;if(_&&P=="object")for(A in E)try{L.push(x(E[A],_-1))}catch{}return L.length?L:P=="string"?E:E+"\0"}function I(E,_){for(var L=E+"",P,A=0;A<L.length;)_[f&A]=f&(P^=_[f&A]*19)+L.charCodeAt(A++);return k(_)}function C(){try{var E;return p&&(E=p.randomBytes)?E=E(s):(E=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(E)),k(E)}catch{var _=e.navigator,L=_&&_.plugins;return[+new Date,e,L,e.screen,k(t)]}}function k(E){return String.fromCharCode.apply(0,E)}if(I(r.random(),t),n.exports){n.exports=g;try{p=l8}catch{}}else r["seed"+a]=g})(typeof self<"u"?self:u8,[],Math)}(Yg)),Yg.exports}var jw,SR;function h8(){if(SR)return jw;SR=1;var n=XK(),e=QK(),t=ZK(),r=t8(),s=r8(),i=i8(),o=c8();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=r,o.xor4096=s,o.tychei=i,jw=o,jw}var AC=h8();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UD{constructor(e,t,r,s,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=AC.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,i,o;do s=2*this.random()-1,i=2*this.random()-1,o=s*s+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*s*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class d8{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=AC.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n,e=0,t=1,r,s){if(Sa(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const i=new UD(e,t,r,!1,s),o=It(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const p8=oe({randomNormal_:f8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8(n,e=0,t=1,r="float32",s){Sa(n);const i=It(n,r),o=new d8(e,t,null,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Dp=oe({randomUniform_:m8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ff(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return re.runKernel(tC,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n){const t={input:G(n,"input","real")};return re.runKernel(nC,t)}const _y=oe({real_:g8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(n){const t={x:G(n,"x","reciprocal")};return re.runKernel(fp,t)}const v8=oe({reciprocal_:y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x8(n){const t={x:G(n,"x","relu")};return re.runKernel(pp,t)}const Yu=oe({relu_:x8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(n){const t={x:G(n,"x","relu6")};return re.runKernel(mp,t)}const WD=oe({relu6_:w8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(n,e){const r={x:G(n,"x","reverse")},s={dims:e};return re.runKernel(cv,r,s)}const Lu=oe({reverse_:b8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(n){const t={x:G(n,"x","round")};return re.runKernel(gp,t)}const GD=oe({round_:I8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(n){const t={x:G(n,"x","rsqrt","float32")};return re.runKernel(yp,t)}const jD=oe({rsqrt_:C8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(n){const t={x:G(n,"x","selu")};return re.runKernel(vp,t)}const HD=oe({selu_:S8});function E8(n,e,t,r,s,i=[1,1],o="NHWC"){const a=G(n,"x","separableConv2d"),l=G(e,"depthwiseFilter","separableConv2d"),c=G(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");z(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),z(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),z(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),z(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),z(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const p=l.shape[2],g=l.shape[3];z(c.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${c.shape[2]}.`);const y=wC(d,l,r,s,o,i),x=Fu(y,c,1,"valid",o);return f?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const qD=oe({separableConv2d_:E8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(n){const t={x:G(n,"x","sign")};return re.runKernel(bp,t)}const T8=oe({sign_:k8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n){const t={x:G(n,"x","sin","float32")};return re.runKernel(xp,t)}const KD=oe({sin_:_8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(n){const t={x:G(n,"x","sinh")};return re.runKernel(wp,t)}const XD=oe({sinh_:R8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(n,e,t){const r=G(n,"x","slice1d");return z(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),dn(r,[e],[t])}const $C=oe({slice1d_:N8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n,e,t){const r=G(n,"x","slice2d");return z(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),dn(r,e,t)}const YD=oe({slice2d_:A8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(n,e,t){const r=G(n,"x","slice3d");return z(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),dn(r,e,t)}const DC=oe({slice3d_:$8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n,e,t){const r=G(n,"x","slice4d");return z(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),dn(r,e,t)}const Ry=oe({slice4d_:D8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P8(n,e=-1){const t=G(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return re.runKernel(gv,r,s)}const PC=oe({softmax_:P8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(n){z(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(GI,e)}const QD=oe({fft_:F8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(n){z(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(qI,e)}const Q1=oe({ifft_:O8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=ie(n,[t,e]);r=Q1(s)}else{const s=[t,2*(e-1)],i=ie(_y(n),[t,e]),o=ie(CC(n),[t,e]),a=Lu(dn(i,[0,1],[t,e-2]),1),l=J(Lu(dn(o,[0,1],[t,e-2]),1),Yt(-1)),c=fs([i,a],1),d=fs([o,l],1),f=ie(Nu(c,d),[s[0],s[1]]);r=Q1(f)}if(r=_y(r),n.rank===3&&n.shape[0]!==0){const s=r,i=n.shape[0];r=ie(r,[i,r.shape[0]/i,r.shape[1]]),s.dispose()}return r}const M8=oe({irfft_:L8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n,e,t=0){const s={x:G(n,"x","split")},i={numOrSizeSplits:e,axis:t};return re.runKernel(mv,s,i)}const Ks=oe({split_:V8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(n,e){z(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const y=n.shape.map(x=>0),w=n.shape.map(x=>x);w[n.shape.length-1]=e,s=dn(n,y,w),t=e}else if(e!=null&&e>t){const y=n.shape.map(w=>w);y[n.shape.length-1]=e-t,s=fs([n,cr(y)],n.shape.length-1),t=e}else s=n;const i=Lt(s),o=ie(Nu(s,i),[r,t]),a=QD(o),l=Math.floor(t/2)+1,c=_y(a),d=CC(a),f=Ks(c,[l,t-l],c.shape.length-1),p=Ks(d,[l,t-l],d.shape.length-1),g=s.shape.slice();return g[s.shape.length-1]=l,ie(Nu(f[0],p[0]),g)}const B8=oe({rfft_:z8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(n,e){let t=G(n,"a","squaredDifference"),r=G(e,"b","squaredDifference");[t,r]=Vn(t,r),yt(t.shape,r.shape);const s={a:t,b:r},i={};return re.runKernel(Ep,s,i)}const W8=oe({squaredDifference_:U8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G8(n,e){const t=G(n,"x","squeeze","string_or_numeric");return ie(t,Al(t.shape,e).newShape)}const Pp=oe({squeeze_:G8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(n,e=0){const t=vD(n,"tensors","stack","string_or_numeric");z(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&z(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return re.runKernel(rv,r,s)}const xa=oe({stack_:j8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(n,e=0){const r={x:G(n,"x","step")},s={alpha:e};return re.runKernel(Np,r,s)}const Fp=oe({step_:H8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(n,e,t,r,s=0,i=0,o=0,a=0,l=0){const d={x:G(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:r,beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return re.runKernel(aC,d,f)}const K8=oe({stridedSlice_:q8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(n){const t={x:G(n,"x","tan","float32")};return re.runKernel(Tp,t)}const Y8=oe({tan_:X8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function As(n,e){_$(n);const t=bv(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Iv(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(n,e,t){if(_$(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=bv(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Iv(n,e,r,t)}function JD(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(i+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(i+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(i+` update.rank != ${s+n.length-r}`);for(let o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(i+` updates.shape[${o+s}] (${t.shape[o+s]}) != shape[${o+s}] (${n[o+s]})`)}function Q8(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}JD(t,e,n)}function Qu(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,i=t.length;let o=1;for(let f=s;f<i;++f)o*=t[f];const a=s<1?1:s,l=xe(e.shape)/a,c=[...tt(t.slice(0,s)),1],d=xe(t);return{sliceRank:s,numUpdates:l,sliceSize:o,strides:c,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J8(n,e=1,t=!0){const r=G(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const i={x:r},o={k:e,sorted:t},[a,l]=re.runKernel(lC,i,o);return{values:a,indices:l}}const Z8=oe({topk_:J8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(n,e=0,t=1,r,s){if(Sa(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new UD(e,t,r,!0,s),o=It(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const ZD=oe({truncatedNormal_:eX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(n,e=0){const t=G(n,"x","unique","string_or_numeric");z(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[i,o]=re.runKernel(cC,r,s);return{values:i,indices:o}}const nX=oe({unique_:tX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n,e,t){const r=G(n,"x","unsortedSegmentSum"),s=G(e,"segmentIds","unsortedSegmentSum","int32");z(ph(t),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:s},o={numSegments:t};return re.runKernel(vv,i,o)}const eP=oe({unsortedSegmentSum_:rX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n,e=0){const t=G(n,"x","unstack","string_or_numeric");z(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return re.runKernel(yv,r,s)}const Mu=oe({unstack_:sX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n,e=!0,t,r){return re.makeVariable(n,e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const r=It(n,"int32"),s=It([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=r.indexToLoc(t[i]),a=i*n.length;s.values.set(o,a)}return s.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(n,e,t){const r=G(n,"x","transpose");if(e==null&&(e=r.shape.map((o,a)=>a).reverse()),z(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{z(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},i={perm:e};return r.dtype==="complex64"?de(()=>{let o=_y(r),a=CC(r);return o=re.runKernel(eh,{x:o},i),a=re.runKernel(eh,{x:a},i),t&&(a=Mn(a)),Nu(o,a)}):re.runKernel(eh,s,i)}const Ot=oe({transpose_:oX});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n,e){if(e==null)return n.shape.slice();if(Qt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n,e,t,r){const s=G(n,"x","dropout");if(z(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),z(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Qn?s.clone():s;const i=aX(s,t),o=1-e,a=rt(_v(Ne(Dp(i,0,1,"float32",r),o)),o);return J(s,a)}const uX=oe({dropout_:lX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cX(n,e,t,r,s,i="NHWC",o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]])),z(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),z(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),z(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];z(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),z(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),gs("conv2dDerFilter",s,o);const f={x:a,dy:l},p={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,filterShape:t};return re.runKernel(DI,f,p)}const FC=oe({conv2DBackpropFilter_:cX});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return J(n,Fp(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function LC(n,e){let t=e;const r=rr(n.shape,e.shape);return r.length>0&&(t=nt(t,r)),ie(t,n.shape)}function MC(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Yu(n);if(e==="elu")return kv(n);if(e==="relu6")return WD(n);if(e==="prelu")return NC(n,t);if(e==="leakyrelu")return SC(n,r);if(e==="sigmoid")return Oh(n);throw new Error(`Unknown fused activation ${e}.`)}const VC=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:d}){if(l=l||"linear",VC(re.state.gradientDepth,l)===!1){z(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let L=Fu(n,e,t,r,s,i,o);return a!=null&&(L=Ne(L,a)),MC(L,l,c,d)}const f=G(n,"x","conv2d","float32"),p=G(e,"filter","conv2d","float32");let g=f,y=!1;f.rank===3&&(y=!0,g=ie(f,[1,f.shape[0],f.shape[1],f.shape[2]])),z(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),z(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),gs("fused conv2d",r,o);const w=s==="NHWC"?g.shape[3]:g.shape[1];z(p.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${p.shape[2]}.`),z(zr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const x=Sr(g.shape,p.shape,t,i,r,o);let I;a!=null&&(I=G(a,"bias","fused conv2d"),[I]=Vn(I,f),s==="NHWC"?yt(x.outShape,I.shape):(z(I.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${I.shape.length}.`),z(I.shape.length===0||I.shape[0]===x.outChannels||I.shape[0]===1,()=>`Error in fused conv2d: bias shape (${I.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let C;if(c!=null){const L=c.shape;if(z(L.length<=1||L.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${L.length}.`),L.length===1)z(L[0]===1||L[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${L}) is not compatible with the number of output channels (${x.outChannels}).`);else if(L.length===3)try{yt(L,x.outShape)}catch{const A=`Error in fused conv2d: PReLU activation weights (${L}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(A)}C=G(c,"prelu weights","fused conv2d")}const k=(L,P)=>{z(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[A,$,D,R]=P,M=OC(L,D,l);z(Du(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const O=vC($.shape,M,A,t,r),Z=FC($,M,A.shape,t,r),q=[O,Z];if(R!=null){const se=LC(R,M);q.push(se)}return q},E={x:g,filter:p,bias:I,preluActivationWeights:C},_={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?vh((P,A,$)=>{let D=re.runKernel(by,E,_);return $([A,P,D]),y&&(D=ie(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:k}})(g,p):vh((P,A,$,D)=>{let R=re.runKernel(by,E,_);return D([A,P,R,$]),y&&(R=ie(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:k}})(g,p,I)}const dX=oe({fusedConv2d_:hX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n,e,t,r,s,i=[1,1],o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},d={strides:r,pad:s,dimRoundingMode:o,dilations:i,filterShape:t};return re.runKernel(zI,c,d)}const pX=oe({depthwiseConv2dNativeBackpropFilter_:fX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n,e,t,r,s,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:t},d={strides:r,pad:s,dimRoundingMode:o,dilations:i,inputShape:n},f=re.runKernel(BI,c,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const gX=oe({depthwiseConv2dNativeBackpropInput_:mX});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(VC(re.state.gradientDepth,i)===!1){let R=Xt(n,e,t,r);return s!=null&&(R=Ne(R,s)),MC(R,i,o,a)}let l=G(n,"a","fused matMul"),c=G(e,"b","fused matMul");[l,c]=Vn(l,c);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=r?c.shape[c.rank-2]:c.shape[c.rank-1],y=l.shape.slice(0,-2),w=c.shape.slice(0,-2),x=xe(y),I=xe(w);z(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${r} must match.`);const k=yt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([p,g]),E=t?ie(l,[x,d,p]):ie(l,[x,p,d]),_=r?ie(c,[I,g,f]):ie(c,[I,f,g]);let L;s!=null&&(L=G(s,"bias","fused matMul"),[L]=Vn(L,l),yt(k,L.shape));let P;o!=null&&(P=G(o,"prelu weights","fused matMul"));const A=(R,M)=>{const[O,Z,q,se]=M,le=OC(ie(R,q.shape),q,i);let j,Q;if(!t&&!r?(j=Xt(le,Z,!1,!0),Q=Xt(O,le,!0,!1)):!t&&r?(j=Xt(le,Z,!1,!1),Q=Xt(le,O,!0,!1)):t&&!r?(j=Xt(Z,le,!1,!0),Q=Xt(O,le,!1,!1)):(j=Xt(Z,le,!0,!0),Q=Xt(le,O,!0,!0)),s!=null){const ee=LC(se,le);return[j,Q,ee]}else return[j,Q]},$={a:E,b:_,bias:L,preluActivationWeights:P},D={transposeA:t,transposeB:r,activation:i,leakyreluAlpha:a};return s==null?vh((M,O,Z)=>{const q=re.runKernel(wy,$,D);return Z([M,O,q]),{value:ie(q,k),gradFunc:A}})(E,_):vh((M,O,Z,q)=>{const se=re.runKernel(wy,$,D);return q([M,O,se,Z]),{value:ie(se,k),gradFunc:A}})(E,_,L)}const ER=oe({fusedMatMul_:yX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(n,e,t,r,s="bilinear",i=0){const o=G(n,"image","cropAndResize"),a=G(e,"boxes","cropAndResize","float32"),l=G(t,"boxInd","cropAndResize","int32"),c=a.shape[0];z(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),z(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),z(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),z(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),z(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const d={image:o,boxes:a,boxInd:l},f={method:s,extrapolationValue:i,cropSize:r};return re.runKernel(LI,d,f)}const xX=oe({cropAndResize_:vX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n){const e=G(n,"image","flipLeftRight","float32");z(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return re.runKernel(HI,t,{})}const bX=oe({flipLeftRight_:wX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IX(n){const e=G(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];z(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),z(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,Gi(e,s)}const CX=oe({grayscaleToRGB_:IX});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n){const e=G(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];z(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),z(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,i=ze(e,"float32"),o=As([.2989,.587,.114]);let a;switch(e.rank){case 2:a=$d("ij,j->i",i,o);break;case 3:a=$d("ijk,k->ij",i,o);break;case 4:a=$d("ijkl,l->ijk",i,o);break;case 5:a=$d("ijklm,m->ijkl",i,o);break;case 6:a=$d("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=hs(a,-1),ze(a,s)}const EX=oe({rgbToGrayscale_:SX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kX(n,e,t=0,r=.5){const s=G(n,"image","rotateWithOffset","float32");z(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const i={image:s},o={radians:e,fillValue:t,center:r};return re.runKernel(hC,i,o)}const TX=oe({rotateWithOffset_:kX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(n,e,t,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),z(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),z(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),z(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),z(e.rank===1,()=>"scores must be a 1D tensor"),z(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),z(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=G(n,"boxes","nonMaxSuppression","float32"),o=G(e,"scores","nonMaxSuppression","float32"),a=Mh(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return re.runKernel(JI,{boxes:i,scores:o},l)}const RX=oe({nonMaxSuppression_:_X});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(n,e,t){const r=AX(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function AX(n,e,t){return $X(n,e,t)}function $X(n,e,t){let r=0,s=n.length,i=0,o=!1;for(;r<s;){i=r+(s-r>>>1);const a=t(e,n[i]);a>0?r=i+1:(s=i,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zC(n,e,t,r,s){return WC(n,e,t,r,s,0)}function BC(n,e,t,r,s,i){return WC(n,e,t,r,s,0,!1,i,!0)}function UC(n,e,t,r,s,i){return WC(n,e,t,r,s,i,!0)}function WC(n,e,t,r,s,i,o=!1,a=!1,l=!1){const c=[];for(let x=0;x<e.length;x++)e[x]>s&&c.push({score:e[x],boxIndex:x,suppressBeginIndex:0});c.sort(kR);const d=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&c.length>0;){const x=c.pop(),{score:I,boxIndex:C,suppressBeginIndex:k}=x;if(I<s)break;let E=!1;for(let _=f.length-1;_>=k;--_){const L=DX(n,C,f[_]);if(L>=r){E=!0;break}if(x.score=x.score*PX(r,d,L),x.score<=s)break}x.suppressBeginIndex=f.length,E||(x.score===I?(f.push(C),p.push(x.score)):x.score>s&&NX(c,x,kR))}const g=f.length,y=t-g;a&&y>0&&(f.push(...new Array(y).fill(0)),p.push(...new Array(y).fill(0)));const w={selectedIndices:f};return o&&(w.selectedScores=p),l&&(w.validOutputs=g),w}function DX(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),d=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),g=(a-i)*(l-o),y=(f-c)*(p-d);if(g<=0||y<=0)return 0;const w=Math.max(i,c),x=Math.max(o,d),I=Math.min(a,f),C=Math.min(l,p),k=Math.max(I-w,0)*Math.max(C-x,0);return k/(g+y-k)}function PX(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function kR(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function FX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=G(n,"boxes","nonMaxSuppressionAsync"),o=G(e,"scores","nonMaxSuppressionAsync"),a=Mh(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),c=l[0],d=l[1],{selectedIndices:f}=zC(c,d,t,r,s);return i!==n&&i.dispose(),o!==e&&o.dispose(),As(f,"int32")}const OX=FX;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=G(n,"boxes","nonMaxSuppression"),a=G(e,"scores","nonMaxSuppression"),l=Mh(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i},f=re.runKernel(eC,c,d);return{selectedIndices:f[0],selectedScores:f[1]}}const MX=oe({nonMaxSuppressionWithScore_:LX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function VX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=G(n,"boxes","nonMaxSuppressionAsync"),a=G(e,"scores","nonMaxSuppressionAsync"),l=Mh(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),d=c[0],f=c[1],{selectedIndices:p,selectedScores:g}=UC(d,f,t,r,s,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:As(p,"int32"),selectedScores:As(g)}}const zX=VX;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=G(n,"boxes","nonMaxSuppression"),a=G(e,"scores","nonMaxSuppression"),l=Mh(o,a,t,r,s,null),c=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:c,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},y=re.runKernel(ZI,p,g);return{selectedIndices:y[0],validOutputs:y[1]}}const UX=oe({nonMaxSuppressionPadded_:BX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function WX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=G(n,"boxes","nonMaxSuppressionAsync"),a=G(e,"scores","nonMaxSuppressionAsync"),l=Mh(o,a,t,r,s,null),c=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:y,validOutputs:w}=BC(p,g,c,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:As(y,"int32"),validOutputs:Yt(w,"int32")}}const GX=WX;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jX(n,e,t=!1,r=!1){const s=G(n,"images","resizeBilinear");z(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),z(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),z(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},c=re.runKernel(uv,a,l);return o?ie(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const nP=oe({resizeBilinear_:jX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(n,e,t=!1,r=!1){const s=G(n,"images","resizeNearestNeighbor");z(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),z(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),z(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),z(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},c=re.runKernel(lv,a,l);return o?ie(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const rP=oe({resizeNearestNeighbor_:HX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(n,e="binary",t=!1,r=.5){const s=G(n,"image","threshold"),i=.2989,o=.587,a=.114,l=s.shape[0]*s.shape[1];let c=J(As([r]),255),d,f,p,g;if(z(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),z(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),z(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),z(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[d,f,p]=Ks(s,[1,1,1],-1);const x=J(d,i),I=J(f,o),C=J(p,a);g=Ne(Ne(x,I),C)}else g=n;if(e==="otsu"){const x=jq(ze(GD(g),"int32"),th([]),256);c=KX(x,l)}const y=t?Lh(g,c):Qs(g,c);return ze(J(y,255),"int32")}function KX(n,e){let t=As([-1]),r=As([0]),s=As([0]),i,o,a,l,c,d;for(let f=0;f<n.size-1;f++){i=dn(n,0,f+1),o=dn(n,f+1),c=rt(nt(i),e),d=rt(nt(o),e);const p=nt(J(i,ff(0,i.size)));a=rt(p,nt(i));const g=Ev(o.shape,i.size),y=Ne(ff(0,o.size),g),w=J(o,y);l=rt(nt(w),nt(o));const x=ut(a,l),I=ut(a,l),C=J(c,d);s=J(J(C,x),I);const k=Qs(s,r);r=ts(k,s,r),t=ts(k,As([f]),t)}return t}const XX=oe({threshold_:qX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n,e,t="nearest",r="constant",s=0,i){const o=G(n,"image","transform","float32"),a=G(e,"transforms","transform","float32");z(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),z(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},c={interpolation:t,fillMode:r,fillValue:s,outputShape:i};return re.runKernel(uC,l,c)}const QX=oe({transform_:YX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(n,e,t){const r=G(n,"a","bandPart");z(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[i,o]=r.shape.slice(-2);let a,l;typeof e=="number"?(z(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),z(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=G(e<0?i:e,"numLower","bandPart")):(z(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ts(ky(e,0),i,df(e,i))),typeof t=="number"?(z(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),z(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=G(t<0?o:t,"numUpper","bandPart")):(z(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ts(ky(t,0),o,df(t,o)));const c=ie(ff(0,i,1,"int32"),[-1,1]),d=ff(0,o,1,"int32"),f=ut(c,d),p=va(Lh(f,a),Xu(f,Mn(l))),g=cr([i,o],r.dtype);return ie(xa(Mu(ie(r,[-1,i,o])).map(y=>ts(p,y,g))),s)}const ZX=oe({bandPart_:JX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n){let e;if(Array.isArray(n)){e=!1,z(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let i=1;i<n.length;++i)z(n[i].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${s})`)}else e=!0,n=Ks(n,n.shape[0],0).map(s=>Pp(s,[0]));z(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(re.tidy(()=>{let i=r[s];if(s>0)for(let o=0;o<s;++o){const a=J(nt(J(t[o],i)),t[o]);i=ut(i,a)}return rt(i,Tv(i,"euclidean"))}));return e?xa(t,0):t}const t7=oe({gramSchmidt_:e7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n7(n,e=!1){if(z(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return TR(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),r=Mu(ie(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],i=[];r.forEach(l=>{const[c,d]=TR(l,e);s.push(c),i.push(d)});const o=ie(xa(s,0),n.shape),a=ie(xa(i,0),n.shape);return[o,a]}}function TR(n,e=!1){return re.tidy(()=>{z(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=OD(t),i=Iu(n);const o=Hw([[1]],[1,1]);let a=Iu(o);const l=t>=r?r:t;for(let c=0;c<l;++c){const d=i,f=a,p=s;[a,i,s]=re.tidy(()=>{const g=dn(i,[c,c],[t-c,1]),y=Tv(g),w=dn(i,[c,c],[1,1]),x=ts(Qs(w,0),Hw([[-1]]),Hw([[1]])),I=ut(w,J(x,y)),C=rt(g,I);C.shape[0]===1?a=Iu(o):a=fs([o,dn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const k=Mn(rt(Xt(x,I),y)),E=dn(i,[c,0],[t-c,r]),_=J(k,a),L=Ot(a);if(c===0)i=ut(E,Xt(_,Xt(L,E)));else{const $=ut(E,Xt(_,Xt(L,E)));i=fs([dn(i,[0,0],[c,r]),$],0)}const P=Ot(_),A=dn(s,[0,c],[t,s.shape[1]-c]);if(c===0)s=ut(A,Xt(Xt(A,a),P));else{const $=ut(A,Xt(Xt(A,a),P));s=fs([dn(s,[0,0],[t,c]),$],1)}return[a,i,s]}),bt([d,f,p])}return!e&&t>r&&(s=dn(s,[0,0],[t,r]),i=dn(i,[0,0],[r,r])),[s,i]})}const r7=oe({qr_:n7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const da={flipLeftRight:bX,grayscaleToRGB:CX,resizeNearestNeighbor:rP,resizeBilinear:nP,rgbToGrayscale:EX,rotateWithOffset:TX,cropAndResize:xX,nonMaxSuppression:RX,nonMaxSuppressionAsync:OX,nonMaxSuppressionWithScore:MX,nonMaxSuppressionWithScoreAsync:zX,nonMaxSuppressionPadded:UX,nonMaxSuppressionPaddedAsync:GX,threshold:XX,transform:QX},s7={bandPart:ZX,gramSchmidt:t7,qr:r7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i7=new Map,o7=new Map;class Vh{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class fi{constructor(){this.classNameMap={}}static getMap(){return fi.instance==null&&(fi.instance=new fi),fi.instance}static register(e){fi.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Te(n,e,t){z(n.className!=null,()=>"Class being registered does not have the static className property defined."),z(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),z(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return fi.register(n),i7.set(s,n),o7.set(n,s),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ml extends Vh{minimize(e,t=!1,r){const{value:s,grads:i}=this.computeGradients(e,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return bt(i),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return dK(e,t)}dispose(){this.iterations_!=null&&bt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Yt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ml,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sP extends Ml{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=re.registeredVariables[r],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:de(()=>Lt(i).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:de(()=>Lt(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[s].variable,c=this.accumulatedUpdates[s].variable;de(()=>{const d=Ne(J(l,this.rho),J(gn(a),1-this.rho)),f=J(rt(Vr(Ne(c,this.epsilon)),Vr(Ne(l,this.epsilon))),a),p=Ne(J(c,this.rho),J(gn(f),1-this.rho));l.assign(d),c.assign(p);const g=Ne(J(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(bt(this.accumulatedGrads.map(e=>e.variable)),bt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iP extends Ml{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=re.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:de(()=>Ev(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const a=this.accumulatedGrads[s].variable;de(()=>{const l=Ne(a,gn(o));a.assign(l);const c=Ne(J(rt(o,Vr(Ne(l,re.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&bt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oP extends Ml{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],de(()=>{this.accBeta1=Yt(t).variable(),this.accBeta2=Yt(r).variable()}),s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);de(()=>{const r=ut(1,this.accBeta1),s=ut(1,this.accBeta2);t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:de(()=>Lt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:de(()=>Lt(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=Ne(J(d,this.beta1),J(c,1-this.beta1)),g=Ne(J(f,this.beta2),J(gn(c),1-this.beta2)),y=rt(p,r),w=rt(g,s);d.assign(p),f.assign(g);const x=Ne(J(rt(y,Ne(Vr(w),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(J(this.accBeta1,this.beta1)),this.accBeta2.assign(J(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&bt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&bt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),de(()=>{this.accBeta1.assign(Ou(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ou(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aP extends Ml{static get className(){return"Adamax"}constructor(e,t,r,s=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],de(()=>{this.iteration=Yt(0).variable(),this.accBeta1=Yt(t).variable()}),s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);de(()=>{const r=ut(1,this.accBeta1),s=rt(-this.learningRate,Ne(J(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Lt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Lt(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=Ne(J(d,this.beta1),J(c,1-this.beta1)),g=J(f,this.beta2),y=Qr(c),w=Ol(g,y);d.assign(p),f.assign(w);const x=Ne(J(rt(s,r),rt(p,Ne(w,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Ne(this.iteration,1)),this.accBeta1.assign(J(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&bt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&bt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GC extends Ml{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const o=re.registeredVariables[r];de(()=>{const a=Ne(J(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=_o(Yt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lP extends GC{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=Yt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=re.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:de(()=>Lt(i).variable(!1))});const o=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[r];a!=null&&de(()=>{let l;const c=Ne(J(this.m,o),a);this.useNesterov?l=Ne(J(this.c,Ne(a,J(c,this.m))),i):l=Ne(J(this.c,c),i),o.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&bt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uP extends Ml{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=re.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=re.registeredVariables[r],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:de(()=>Lt(i).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:de(()=>Lt(i).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:de(()=>Lt(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,c=this.accumulatedMoments[s].variable;de(()=>{const d=Ne(J(l,this.decay),J(gn(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[s].variable,p=Ne(J(f,this.decay),J(a,1-this.decay)),g=rt(J(a,this.learningRate),Vr(ut(d,Ne(gn(p),this.epsilon)))),y=Ne(J(c,this.momentum),g);l.assign(d),f.assign(p),c.assign(y);const w=ut(i,y);i.assign(w)}else{const f=Ne(J(l,this.decay),J(gn(a),1-this.decay)),p=Ne(J(c,this.momentum),rt(J(a,this.learningRate),Vr(Ne(f,this.epsilon))));l.assign(f),c.assign(p);const g=ut(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&bt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&bt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&bt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7=[sP,iP,oP,aP,lP,uP,GC];function l7(){for(const n of a7)Te(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n,e,t,r){o(n),t=t??0,r=r??1,a(t,r);let s=0;const i=l=>(l.then(c=>{const d=t+ ++s/n.length*(r-t);return e(d),c}),l);function o(l){z(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){z(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),z(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),z(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function u7(n,e){e==null&&(e={});const t=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc,r=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(r):await _R(r,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await _R(a,e.onProgress,.5,1)}function c7(n,e){var t;const r=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc;let s=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;s<n.length;){i||(i=(await r(n[s],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await i.read();if(l){s++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,s/n.length);continue}o.enqueue(c);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7="application/octet-stream",d7="application/json";class jC{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(z(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=pe().platform.fetch,z(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&z(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s=E5(e,r);if(t.body.append("model.json",new Blob([JSON.stringify(s)],{type:d7}),"model.json"),e.weightData!=null){const o=Dl.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:h7}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:pC(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=t.modelTopology,s=t.weightsManifest;if(r==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return T5(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),r=pR(e.weightsManifest),s=()=>c7(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:r,getWeightStream:s})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[r,s]=f7(t),i=this.weightPathPrefix||r,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(i+c+s);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),r=pR(e),s=await u7(t,this.loadOptions);return[r,s]}}jC.URL_SCHEME_REGEX=/^https?:\/\//;function f7(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),s=t>e?n.substring(t):"";return[r+"/",s]}function RR(n){return n.match(jC.URL_SCHEME_REGEX)!=null}const cP=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>RR(r)):t=RR(n),t)return hP(n,e)}return null};lr.registerSaveRouter(cP);lr.registerLoadRouter(cP);function hP(n,e){return new jC(n,e)}function p7(n,e){return hP(n,e)}function HC(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(xe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,i=s[s.length-1];let o=1;for(let f=0;f<s.length-1;++f)o*=s[f];const a=n.shape,l=s.slice();l.pop();let c=1;for(let f=i;f<t;++f)c*=a[f],l.push(a[f]);const d=[...tt(n.shape).map(f=>f/c),1].slice(0,i);return[l,o,c,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1=-2,m7=-1;function qC(n,e,t){const r=n.shape.length;z(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),z(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)z(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function g7(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function KC(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function dP(n,e,t,r){const s=[...n];for(let i=s.length;i<r.length;i++)s.push(1);for(let i=0;i<t;i++)i===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function fP(n,e,t){return t<=n?t:t-(e-1)}function pP(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function y7(n,e,t,r,s,i,o,a,l){const c=n.length;let d=new Array(c),f=new Array(c),p=new Array(c);if(e.length&&t>0){const g=e[0],y=t+1;d=mP(o,g,y,r,n),f=gP(a,g,y,s,n),p=dP(i,g,y,n)}else for(let g=0;g<c;g++)d[g]=vP(o,r,i,n,g,l),f[g]=xP(a,s,i,n,g,l),p[g]=yP(i,g,l);return{begin:d,end:f,strides:p}}function mP(n,e,t,r,s){const i=[...s],o=pP(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=fP(e,t,a);let c=r[l];n&1<<l&&(c=0),i[a]=c}return i}function gP(n,e,t,r,s){const i=[...s],o=pP(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=fP(e,t,a);let c=r[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){const l=s[a];i[a]<0&&(i[a]+=l),i[a]=_u(0,i[a],s[a])}return i}function yP(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function vP(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),o=_u(0,o,l-1),o}function xP(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),a>0?o=_u(0,o,l):o=_u(-1,o,l-1),o}function XC(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function YC(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Rv(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(o=>{z(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(s).fill(-1):typeof t=="number"?i=[t,...new Array(s-1).fill(-1)]:t.length<s?i=t.concat(new Array(s-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(z(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,i]}function QC(n,e,t,r,s,i,o,a,l){let c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let k=0;k<f.dims;k++)d&&1<<k&a&&f.numAddAxisAfterEllipsis++,1<<k&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};v7(f,p);let g=!0,y=!0,w=!0;const x=[],I=[];for(let k=0;k<n.length;++k){if(p.strides[k]===0)throw Error(`strides[${k}] must be non-zero`);const E=!!(p.shrinkAxisMask&1<<k),_=n[k];if(_===-1){x.push(E?1:-1);continue}const L=[p.beginMask&1<<k,p.endMask&1<<k],P=[p.strides[k]>0?0:-1,p.strides[k]>0?_:_-1];if(E&&p.strides[k]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&p.strides[k]===1;const A=!!(p.beginMask&1<<k&&p.endMask&1<<k);if(p.beginValid&&p.endValid){if(E){const M=p.begin[k]<0?_+p.begin[k]:p.begin[k];if(p.begin[k]=M,p.end[k]=p.begin[k]+1,M<0||M>=_)throw Error(`slice index ${p.begin[k]} of dimension ${k} out of bounds.`)}else p.begin[k]=NR(p.begin[k],0,p.strides[k],_,L,P),p.end[k]=NR(p.end[k],1,p.strides[k],_,L,P);const R=p.strides[k]===1&&p.begin[k]===0&&p.end[k]===_;g=g&&R,y=y&&(k===0&&p.strides[k]===1||R)}else g=g&&p.strides[k]===1&&A,y=y&&(k===0&&p.strides[k]===1||A);let $,D=!1;if(p.beginValid&&p.endValid?($=p.end[k]-p.begin[k],D=!0):E?($=1,D=!0):A&&_>=0&&(p.strides[k]<0?$=-_:$=_,D=!0),D){let R;$===0||$<0!=p.strides[k]<0?R=0:R=Math.trunc($/p.strides[k])+($%p.strides[k]!==0?1:0),x.push(R)}else x.push(-1)}for(let k=0;k<p.finalShapeGatherIndices.length;++k){const E=p.finalShapeGatherIndices[k];E>=0?I.push(x[E]):E===J1&&I.push(1)}return{finalShapeSparse:I.filter((k,E)=>p.finalShapeGatherIndices[E]!==J1),finalShape:I,isIdentity:g,sliceDim0:y,isSimpleSlice:w,begin:p.begin,end:p.end,strides:p.strides}}function v7(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(J1),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(m7),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function NR(n,e,t,r,s,i){if(s[e])return t>0?i[e]:i[e+1&1];{const o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const x7=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:qC,computeFlatOffset:YC,computeOutShape:KC,getNormalizedAxes:y7,isSliceContinous:XC,maskToAxes:g7,parseSliceParams:Rv,sliceInfo:QC,startForAxis:vP,startIndicesWithElidedDims:mP,stopForAxis:xP,stopIndicesWithElidedDims:gP,stridesForAxis:yP,stridesWithElidedDims:dP},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w7{static sgd(e){return new GC(e)}static momentum(e,t,r=!1){return new lP(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,i=!1){return new uP(e,t,r,s,i)}static adam(e=.001,t=.9,r=.999,s=null){return new oP(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new sP(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,i=0){return new aP(e,t,r,s,i)}static adagrad(e,t=.1){return new iP(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vc=w7;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function wP(){return new Promise(n=>b7(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JC(n,e){const t=n[0].length;n.forEach((s,i)=>{z(s.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),z(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,i)=>{for(let o=0;o<t;o++)z(o===e||s[o]===r[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Ro(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ui;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ui||(Ui={}));function bP(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const i=t[s],o=r[r.length-t.length+s],a=r[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${i} but shape[${s+n}] = ${a}`)}else r[o]=i}return r}function IP(n){const e={FIRST_DIM_SIZE:Ui.FIRST_DIM_SIZE,VALUE_ROWIDS:Ui.VALUE_ROWIDS,ROW_LENGTHS:Ui.ROW_LENGTHS,ROW_SPLITS:Ui.ROW_SPLITS,ROW_LIMITS:Ui.ROW_LIMITS,ROW_STARTS:Ui.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function CP(n){return n.length===0?0:n[0]===Ui.FIRST_DIM_SIZE?n.length-1:n.length}function SP(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const i=n[s],o=e[s+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${i} but ragged tensor input.flatValues.shape[${s-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZC=30;function Nv(n){return n<=ZC?n:O1(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eS(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Op(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(i+1))}return s}function Lp(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):s.push(o);r.push(...s),r.push(0),r.push(...i)}return r}function Mp(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?r?s.push(e[i-1]*n[i]):s.push(n[i]/e[i-1]):s.push(n[i]);return s}function tS(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function nS(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Av=1.7580993408473768,$v=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rS=.3275911,sS=.254829592,iS=-.284496736,oS=1.421413741,aS=-1.453152027,lS=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wa(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function EP(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function kP(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function TP(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function uS(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function _P(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function RP(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const i=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(i),r[s]=Math.sin(i)}return{real:t,imag:r}}function NP(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),i=Math.sin(r);return{real:s,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw="->",I7=/->/g,AR=",",$R="...";function cS(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(I7,"").length)/qw.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${qw}").`);const[r,s]=n.split(qw);z(r.indexOf($R)===-1,()=>`The ellipsis notation ("${$R}") is not supported yet.`);const i=r.split(AR),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<s.length;++p){const g=s[p];if(!i.some(y=>y.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<r.length;++p){const g=r[p];a.indexOf(g)===-1&&g!==AR&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const c=a.length,d=s.length,f=[];for(let p=d;p<c;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function hS(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function dS(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const i=t[s].shape;for(let o=0;o<e[s].length;++o)r[e[s][o]]===void 0?r[e[s][o]]=i[o]:z(r[e[s][o]]===i[o],()=>`Expected dimension ${r[e[s][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function fS(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let o=0;o<s;++o)r.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=C7(e,a);for(const c of l)i.indexOf(c)===-1&&(r[o].push(c),i.push(c))}return{path:t,steps:r}}function pS(n){return n.every((e,t)=>e===t)}function C7(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function mS(n,e,t=0){let r=[];if(typeof e=="number")z(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);z(s<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}z(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function $P(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function DP(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PP(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function FP(n,e){return`size ${n} must be non-negative, not ${e}`}function OP(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function LP(n,e){const t=xe(n),r=xe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function MP(n,e){const t=xe(n),r=xe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1(){return"segment ids must be >= 0"}function VP(){return"segment ids are not increasing"}function zP(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function BP(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n,e){let t=!1,r;for(n<=ZC?(r=n,t=!0):r=O1(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=O1(n,r+1);return r}function WP(n,e,t){const r=[],s=n.length;for(let i=0;i<s;i++)i!==e?r.push(n[i]):r.push(t);return r}function gS(n,e,t,r){const s=e.shape.length,i=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let f=0;f<r;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,c=1,d=1;for(let f=0;f<r;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=r;f<t;f++)a.push(n.shape[f]),c*=n.shape[f];for(let f=r;f<s;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:c,dimSize:o,outputShape:a}}const S7=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:gS,computeOutShape:WP,segOpComputeOptimalWindowSize:UP},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ba(n){try{return n.map(e=>Sl(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function GP(n){return n.map(e=>pl(e))}const E7=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:sS,ERF_A2:iS,ERF_A3:oS,ERF_A4:aS,ERF_A5:lS,ERF_P:rS,PARALLELIZE_THRESHOLD:ZC,get RowPartitionType(){return Ui},SELU_SCALE:$v,SELU_SCALEALPHA:Av,applyActivation:MC,assertAndGetBroadcastShape:yt,assertAxesAreInnerMostDims:Er,assertParamsConsistent:JC,assignToTypedArray:_P,axesAreInnerMostDims:bC,calculateShapes:Qu,checkEinsumDimSizes:dS,checkPadOnDimRoundingMode:gs,combineLocations:PD,combineRaggedTensorToTensorShapes:bP,complexWithEvenIndex:kP,complexWithOddIndex:TP,computeConv2DInfo:Sr,computeConv3DInfo:Pl,computeDefaultPad:mC,computeDilation2DInfo:Ap,computeOptimalWindowSize:Nv,computeOutAndReduceShapes:pr,computeOutShape:Ro,computePool2DInfo:vi,computePool3DInfo:Ea,convertConv2DDataFormat:ka,decodeEinsumEquation:cS,eitherStridesOrDilationsAreOne:zr,expandShapeToKeepDim:qn,exponent:NP,exponents:RP,fromStringArrayToUint8:GP,fromUint8ToStringArray:ba,getAxesPermutation:Rn,getBroadcastDims:yh,getComplexWithIndex:uS,getEinsumComputePath:fS,getEinsumPermutation:hS,getFusedBiasGradient:LC,getFusedDyActivation:OC,getImageCenter:eS,getInnerMostAxes:zn,getPermuted:Lp,getRaggedRank:CP,getReductionAxes:rr,getReshaped:Op,getReshapedPermuted:Mp,getRowPartitionTypesHelper:IP,getSliceBeginCoords:tS,getSliceSize:nS,getSparseFillEmptyRowsIndicesDenseShapeMismatch:AP,getSparseFillEmptyRowsNegativeIndexErrorMessage:$P,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:DP,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:OP,getSparseReshapeInputOutputMismatchErrorMessage:MP,getSparseReshapeInputOutputMultipleErrorMessage:LP,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:PP,getSparseReshapeNegativeOutputDimErrorMessage:FP,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:BP,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Z1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:VP,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:zP,getUndoAxesPermutation:Fl,isIdentityPermutation:pS,log:G6,mergeRealAndImagArrays:wa,prepareAndValidate:HC,prepareSplitSize:mS,segment_util:S7,shouldFuse:VC,slice_util:x7,splitRealAndImagArrays:EP,stridesOrDilationsArePositive:Pu,tupleValuesAreOne:Du,upcastType:Ds,validateDefaultValueShape:SP,validateInput:Q8,validateUpdateShape:JD,warn:Hs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */l7();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jP={kernelName:w0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,Fp(ze(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7={kernelName:Of,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=gn(ze(t,"float32")),s=Vr(ut(Yt(1),r));return Mn(rt(n,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7={kernelName:Lf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Vr(ut(gn(ze(t,"float32")),1));return rt(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7={kernelName:Fh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{let a=n;const l=rr(t.shape,s);return l.length>0&&(a=nt(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=rr(r.shape,s);return l.length>0&&(a=nt(a,l)),ie(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7={kernelName:EI,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7={kernelName:b0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7={kernelName:I0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7={kernelName:Mf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,Vr(ut(Yt(1),gn(ze(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7={kernelName:Vf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Vr(Ne(Yt(1),gn(ze(t,"float32"))));return rt(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7={kernelName:Uf,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{const a=Ne(gn(t),gn(r));let l=J(n,rt(r,a));const c=rr(t.shape,s);return c.length>0&&(l=nt(l,c)),ie(l,t.shape)},b:()=>{const a=Ne(gn(t),gn(r));let l=Mn(J(n,rt(t,a)));const c=rr(r.shape,s);return c.length>0&&(l=nt(l,c)),ie(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7={kernelName:zf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,Ne(gn(ze(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7={kernelName:Bf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,ut(Yt(1),gn(ze(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n,e,t,r,s,i){const o=G(n,"dy","avgPool3dGrad"),a=G(e,"input","avgPool3dGrad");let l=o,c=a,d=!1;a.rank===4&&(d=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),z(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),z(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),gs("avgPool3dGrad",s,i);const f={dy:l,input:c},p={filterSize:t,strides:r,pad:s,dimRoundingMode:i},g=re.runKernel(RI,f,p);return d?ie(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const M7=oe({avgPool3dGrad_:L7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7={kernelName:S0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>M7(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n,e,t,r,s){const i=G(n,"dy","avgPoolGrad"),o=G(e,"input","avgPoolGrad");z(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,c=!1;o.rank===3&&(c=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),z(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),z(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:r,pad:s},p=re.runKernel(_I,d,f);return c?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const B7=oe({avgPoolGrad_:z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:C0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o}=t;return{x:()=>B7(n,r,s,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7={kernelName:E0,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Xt(n,s,!1,!0),b:()=>Xt(r,n,!0,!1)}:!i&&o?{a:()=>Xt(n,s,!1,!1),b:()=>Xt(n,r,!0,!1)}:i&&!o?{a:()=>Xt(s,n,!1,!0),b:()=>Xt(r,n,!1,!1)}:{a:()=>Xt(s,n,!0,!0),b:()=>Xt(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7={kernelName:k0,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>RC(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7={kernelName:z6,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,i=r.shape,o=Array.from(i);for(let l=s.length-1;l>=0;l--)if(s[l]===i[l])o[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>nt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7={kernelName:Wf,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7={kernelName:Gf,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7={kernelName:jf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:i}=t;return{x:()=>ts(va(Xu(r,s),Lh(r,i)),n,Lt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7={kernelName:T0,inputsToSave:["x"],gradFunc:jP.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7={kernelName:_0,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(l=>l.shape),{axis:s}=t,i=Ct(s,e[0].shape)[0],o=r.map(l=>l[i]);return Ks(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7={kernelName:R0,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return z(Du(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>vC(r.shape,n,s,o,a,l),filter:()=>FC(r,n,s.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7={kernelName:N0,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Fu(n,s,i,o,a,1,l),filter:()=>FC(n,r,s.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n,e,t,r,s){let i=n;n.rank===4&&(i=ie(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),z(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),z(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),z(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),z(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),z(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:r,pad:s,filterShape:t};return re.runKernel(PI,a,l)}const eY=oe({conv3DBackpropFilter_:Z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY={kernelName:A0,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i}=t;z(Du(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>ND(o.shape,n,a,s,i),filter:()=>eY(o,n,a.shape,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY={kernelName:Hf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(Mn(KD(ze(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY={kernelName:qf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(XD(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY={kernelName:$0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:i,reverse:o}=t;return{x:()=>{const a=Rn([s],r.rank);let l=$D(n,s,i,!o);return a!=null&&(l=Ot(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY={kernelName:D0,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i,dimRoundingMode:o}=t,a=r??[1,1];z(Du(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return z(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),z(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),z(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),z(zr(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),gs("depthwiseConv2d",i,o),{x:()=>gX(l.shape,n,c,s,i,a,o),filter:()=>pX(l,n,c.shape,s,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oY={kernelName:P0,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,i={x:r,filter:s,dy:n},o={x:r,filter:s,dy:n};return{x:()=>re.runKernel(L1,i,t),filter:()=>re.runKernel(M1,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY={kernelName:Xf,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>re.runKernel(WI,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY={kernelName:Yf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=J(Oo(Mn(gn(t))),2/Math.sqrt(Math.PI));return{x:()=>J(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uY={kernelName:Qf,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY={kernelName:O0,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hY={kernelName:Jf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,Oo(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dY={kernelName:Zf,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fY={kernelName:ep,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{const a=rt(n,ze(r,"float32")),l=rr(t.shape,s);return l.length>0?ie(nt(a,l),t.shape):a},b:()=>{let a=J(n,ze(t,"float32"));const l=rr(r.shape,s);l.length>0&&(a=ie(nt(a,l),r.shape));const c=gn(r);return Mn(rt(a,ze(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pY={kernelName:L0,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,i,o,a]=e,l=a??Yt(1),c=rr(i.shape,s.shape),d=[];if(i.rank===1){for(let E=0;E<s.shape.length-1;++E)d.push(s.shape[E]);d.push(1)}const f=ut(s,i),p=J(n,l),g=jD(Ne(o,Yt(r))),y=J(J(J(g,g),g),Yt(-.5));return{x:()=>i.rank===1?ie(J(J(n,Gi(ie(g,[1,1,1,i.shape[0]]),d)),l),s.shape):ie(J(J(n,g),l),s.shape),mean:()=>{let E=J(J(g,Yt(-1)),p);return i.rank===1&&(E=nt(E,c)),ie(E,i.shape)},variance:()=>{let E=J(J(y,f),p);return i.rank===1&&(E=nt(E,c)),ie(E,i.shape)},scale:()=>{const E=J(f,g);let _=J(n,E);return i.rank===1&&(_=nt(_,c)),ie(_,i.shape)},offset:()=>{let E=n;return i.rank===1&&(E=nt(E,c)),ie(E,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mY={kernelName:M0,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:i,batchDims:o}=t,a=Ct(i,r.shape)[0],l=(c,d,f)=>()=>{const p=c.shape,g=d.size,y=p.slice(0,a),w=y.length,x=p.slice(i,p.length).slice(1),I=x.length,C=DR(0,w),k=DR(w+1,w+1+I),E=PR([y,[g],x]),_=ie(f,E),L=ie(d,[g]),P=PR([[w],C,k]),A=Ot(_,P);let $=eP(A,L,c.shape[a]);const D=Fl(P);return $=Ot($,D),$};if(o===1){const c=r.shape[0],d=r.split(c,0);return{x:()=>xa(d.map((g,y)=>l(g,s.slice(y,1),n.slice(y,1))())).reshape(r.shape),indices:()=>s}}else return{x:l(r,s,n),indices:()=>s}}};function DR(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function PR(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gY={kernelName:tp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>Lt(t),b:()=>Lt(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yY={kernelName:np,gradFunc:n=>({x:()=>ze(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vY={kernelName:rp,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xY={kernelName:sp,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wY={kernelName:ip,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bY={kernelName:z0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,i=Qs(r,0);return{x:()=>ts(i,n,J(n,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IY={kernelName:ap,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,Ne(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY={kernelName:op,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,ze(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SY={kernelName:U6,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const o=Oo(r);return ut(n,J(nt(n,s,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(n,e,t,r=5,s=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:r,bias:s,alpha:i,beta:o};return re.runKernel(XI,a,l)}const kY=oe({localResponseNormalizationBackprop_:EY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TY={kernelName:H0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>kY(r,s,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HP(n,e,t,r){return e.rank<t.rank&&(e=ie(e,qn(e.shape,r))),n.rank<t.rank&&(n=ie(n,qn(n.shape,r))),{x:()=>J(n,ze(Fo(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FR={kernelName:q0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,i=e[0],o=e[1],a=Ct(s,i.shape),l=HP(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Y={kernelName:lp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>J(n,ze(Xu(t,r),"float32")),b:()=>J(n,ze(ky(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(n,e,t,r,s,i,o){const a=G(n,"dy","maxPool3dGrad"),l=G(e,"input","maxPool3dGrad"),c=G(t,"output","maxPool3dGrad");let d=a,f=l,p=c,g=!1;l.rank===4&&(g=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ie(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),z(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),z(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),z(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),gs("maxPool3dGrad",i,o);const y={dy:d,input:f,output:p},w={filterSize:r,strides:s,pad:i,dimRoundingMode:o},x=re.runKernel(QI,y,w);return g?ie(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const NY=oe({maxPool3dGrad_:RY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AY={kernelName:X0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>NY(n,r,s,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(n,e,t,r,s,i,o){const a=G(n,"dy","maxPoolGrad"),l=G(e,"input","maxPoolGrad"),c=G(t,"output","maxPoolGrad");z(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),z(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),z(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),gs("maxPoolGrad",i,o);const d={dy:a,input:l,output:c},f={filterSize:r,strides:s,pad:i,dimRoundingMode:o};return re.runKernel(YI,d,f)}const DY=oe({maxPoolGrad_:$Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PY={kernelName:K0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>DY(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FY={kernelName:Y0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,i=Ct(s,r.shape),a=pr(r.shape,i)[1],l=xe(a);return{x:()=>{const d=r.shape.slice();i.forEach(g=>{d[g]=1});const f=ie(n,d);return rt(J(f,Ll(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OY={kernelName:Q0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[i,o]=e,a=Ct(s,i.shape),l=HP(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LY={kernelName:up,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>J(n,ze(Lh(t,r),"float32")),b:()=>J(n,ze(Qs(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MY={kernelName:J0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>dn(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VY={kernelName:cp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{const a=rr(t.shape,s);return a.length>0?ie(nt(n,a),t.shape):n},b:()=>{const a=J(n,Mn(_v(rt(t,r)))),l=rr(r.shape,s);return l.length>0?ie(nt(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zY={kernelName:hp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{const a=J(n,ze(r,"float32")),l=rr(t.shape,s);return l.length>0?ie(nt(a,l),t.shape):a},b:()=>{const a=J(n,ze(t,"float32")),l=rr(r.shape,s);return l.length>0?ie(nt(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BY={kernelName:Z0,gradFunc:n=>({x:()=>Mn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UY={kernelName:nv,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>cr(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WY={kernelName:tv,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GY={kernelName:rv,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return Mu(n,r).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OR={kernelName:sv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>dn(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jY={kernelName:dp,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,i=t,o=r,a=yt(i.shape,o.shape);return{a:()=>{const d=ze(o,"float32");let f=J(n,J(d,Ou(i,ut(d,Yt(1)))));const p=rr(i.shape,a);return p.length>0&&(f=nt(f,p)),ie(f,i.shape)},b:()=>{const d=Qs(i,0),f=ts(d,Lo(i),Lt(i));let p=J(n,J(s,f));const g=rr(o.shape,a);return g.length>0&&(p=nt(p,g)),ie(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HY={kernelName:iv,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=Qs(t,0);return{x:()=>ts(s,n,J(n,r)),alpha:()=>{let i=ts(s,Lt(n),J(n,t));const o=rr(r.shape,n.shape);return o.length>0&&(i=nt(i,o)),ie(i,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(n,e,t){const r=n.shape.slice();r[t]=1;const s=ie(e,r),i=Y1(n,t,!0,!1),o=Y1(n,t,!0,!0),a=J(i,o);return J(s,a)}function KY(n,e,t){const r=n.shape.length,s=r-t.length,i=Rn(t,r);let o=n;i!=null&&(o=Ot(n,i));const a=o.shape.slice(),c=a.splice(r-t.length,t.length).reduce((p,g)=>p*g,1);a.push(c);const d=o.reshape(a);let f=qY(d,e,s);if(f=f.reshape(o.shape),i!=null){const p=Fl(i);f=Ot(f,p)}return f}const XY={kernelName:ov,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let i=[];return s==null?i=r.shape.map((o,a)=>a):typeof s=="number"?i=[s]:i=s,{x:()=>KY(r,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YY={kernelName:Kf,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{const a=rt(n,ze(r,"float32")),l=rr(t.shape,s);return l.length>0?ie(nt(a,l),t.shape):a},b:()=>{let a=J(n,ze(t,"float32"));const l=rr(r.shape,s);l.length>0&&(a=ie(nt(a,l),r.shape));const c=gn(r);return Mn(rt(a,ze(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QY={kernelName:fp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,Mn(gn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY={kernelName:mp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=J(Lh(t,6),Fp(t));return{x:()=>J(n,ze(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZY={kernelName:pp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,ze(Fp(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eQ={kernelName:av,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tQ={kernelName:uv,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>re.runKernel(sC,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nQ={kernelName:lv,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>re.runKernel(rC,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rQ={kernelName:cv,gradFunc:(n,e,t)=>{const{dims:r}=t,s=Ct(r,n.shape);return{x:()=>Lu(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sQ={kernelName:gp,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ={kernelName:yp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Mn(rt(n,J(Ou(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oQ={kernelName:hv,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ze(Lt(t),"float32"),t:()=>J(n,ze(t,n.dtype)),e:()=>J(n,ze(EC(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ={kernelName:vp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Qs(t,Yt(0)),s=Yt(Av),i=Yt($v),o=J(n,i),a=J(J(n,s),Oo(ze(t,"float32")));return ts(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lQ={kernelName:Ip,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,J(t,ut(Yt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ={kernelName:bp,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cQ={kernelName:xp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(xC(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hQ={kernelName:wp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(AD(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dQ={kernelName:dv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:i}=t,o=r.shape,[a,l]=Rv(r,s,i),c=[];for(let d=0;d<n.rank;d++)c.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>_C(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fQ={kernelName:gv,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,i=!0,o=J(n,r);return{logits:()=>ut(o,J(nt(o,[s],i),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pQ={kernelName:Cp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,Oh(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LR={kernelName:pv,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>yC(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MR={kernelName:mv,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>fs(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mQ={kernelName:Sp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,J(Vr(ze(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gQ={kernelName:iC,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,J(ze(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yQ={kernelName:Ep,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Yt(2);return{a:()=>J(n,J(s,ut(t,r))),b:()=>J(n,J(s,ut(r,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ={kernelName:Np,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xQ={kernelName:kp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=yt(t.shape,r.shape);return{a:()=>{let a=n;const l=rr(t.shape,s);return l.length>0&&(a=nt(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=rr(r.shape,s);return l.length>0&&(a=nt(a,l)),ie(Mn(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ={kernelName:fv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:i}=t;Ct(i,r.shape).forEach(c=>{s[c]=1});const a=ie(n,s),l=J(a,Ll(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bQ={kernelName:Tp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rt(n,gn(xC(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IQ={kernelName:_p,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(ut(Yt(1),gn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CQ={kernelName:Rp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let o=Lt(r);if(r.rank===1)for(let a=0;a<s[0];++a)o=Ne(o,dn(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)o=Ne(o,dn(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)o=Ne(o,dn(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)for(let d=0;d<s[3];++d)o=Ne(o,dn(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SQ={kernelName:eh,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,i=Fl(s);return{x:()=>Ot(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EQ={kernelName:yv,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>xa(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kQ={kernelName:vv,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>TQ(n,t)}}};function TQ(n,e){const t=Ol(e,Lt(e)),r=IC(n,t);let s=Xu(e,Yt(0,"int32"));const i=r.rank-s.rank;for(let a=0;a<i;++a)s=hs(s,a+1);s=va(s,Ll(r.shape,"bool"));const o=Lt(r);return ts(s,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Q={kernelName:xv,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ=[jP,k7,T7,_7,R7,N7,A7,$7,D7,P7,F7,O7,V7,U7,W7,G7,j7,H7,q7,K7,X7,Y7,J7,Q7,tY,nY,rY,sY,iY,oY,YY,aY,lY,uY,cY,hY,fY,dY,pY,mY,gY,yY,vY,xY,wY,bY,IY,CY,SY,TY,FR,FR,_Y,AY,PY,FY,OY,LY,MY,VY,zY,BY,UY,WY,GY,OR,OR,jY,HY,XY,QY,JY,ZY,eQ,tQ,nQ,rQ,sQ,iQ,oQ,aQ,lQ,uQ,cQ,hQ,dQ,fQ,pQ,LR,LR,MR,MR,mQ,yQ,gQ,vQ,xQ,wQ,bQ,IQ,CQ,SQ,EQ,kQ,_Q];for(const n of RQ)j6(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.abs=function(){return this.throwIfDisposed(),Qr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acos=function(){return this.throwIfDisposed(),sq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acosh=function(){return this.throwIfDisposed(),oq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.add=function(n){return this.throwIfDisposed(),Ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.all=function(n,e){return this.throwIfDisposed(),TD(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.any=function(n,e){return this.throwIfDisposed(),K1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMax=function(n){return this.throwIfDisposed(),uf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMin=function(n){return this.throwIfDisposed(),hq(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asScalar=function(){return this.throwIfDisposed(),z(this.size===1,()=>"The array must have only 1 element."),ie(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asType=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as1D=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as2D=function(n,e){return this.throwIfDisposed(),ie(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ie(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),ie(this,[n,e,t,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),ie(this,[n,e,t,r,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asin=function(){return this.throwIfDisposed(),fq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asinh=function(){return this.throwIfDisposed(),mq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan=function(){return this.throwIfDisposed(),yq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan2=function(n){return this.throwIfDisposed(),xq(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atanh=function(){return this.throwIfDisposed(),bq(this)};ve().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),gC(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),yC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),Sv(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Qd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cast=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ceil=function(){return this.throwIfDisposed(),Kq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Ys(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Qn&&(n=[n]),fs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv1d=function(n,e,t,r,s,i){return this.throwIfDisposed(),_D(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),RD(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),Fu(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cos=function(){return this.throwIfDisposed(),xC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cosh=function(){return this.throwIfDisposed(),AD(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Y1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),$D(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),x9(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthwiseConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),wC(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),I9(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.divNoNan=function(n){return this.throwIfDisposed(),T9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.div=function(n){return this.throwIfDisposed(),rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dot=function(n){return this.throwIfDisposed(),R9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.elu=function(){return this.throwIfDisposed(),kv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.equal=function(n){return this.throwIfDisposed(),Fo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.erf=function(){return this.throwIfDisposed(),DD(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),B9(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.exp=function(){return this.throwIfDisposed(),Oo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expandDims=function(n){return this.throwIfDisposed(),hs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expm1=function(){return this.throwIfDisposed(),j9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.fft=function(){return this.throwIfDisposed(),QD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.flatten=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floor=function(){return this.throwIfDisposed(),_v(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floorDiv=function(n){return this.throwIfDisposed(),kD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.gather=function(n,e,t){return this.throwIfDisposed(),IC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Xu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greater=function(n){return this.throwIfDisposed(),Qs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ifft=function(){return this.throwIfDisposed(),Q1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.irfft=function(){return this.throwIfDisposed(),M8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isFinite=function(){return this.throwIfDisposed(),eK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isInf=function(){return this.throwIfDisposed(),nK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isNaN=function(){return this.throwIfDisposed(),sK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.leakyRelu=function(n){return this.throwIfDisposed(),SC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.lessEqual=function(n){return this.throwIfDisposed(),Lh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.less=function(n){return this.throwIfDisposed(),ky(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),uK(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSigmoid=function(){return this.throwIfDisposed(),gK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSoftmax=function(n){return this.throwIfDisposed(),MD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),VD(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log=function(){return this.throwIfDisposed(),Lo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log1p=function(){return this.throwIfDisposed(),LD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalAnd=function(n){return this.throwIfDisposed(),va(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalNot=function(){return this.throwIfDisposed(),EC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalOr=function(n){return this.throwIfDisposed(),zD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalXor=function(n){return this.throwIfDisposed(),SK(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Xt(this,n,e,t)};ve().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),kC(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.max=function(n,e){return this.throwIfDisposed(),qi(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.maximum=function(n){return this.throwIfDisposed(),Ol(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mean=function(n,e){return this.throwIfDisposed(),Hn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.min=function(n,e){return this.throwIfDisposed(),Ey(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.minimum=function(n){return this.throwIfDisposed(),df(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),$K(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mod=function(n){return this.throwIfDisposed(),PK(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mul=function(n){return this.throwIfDisposed(),J(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.neg=function(){return this.throwIfDisposed(),Mn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Tv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.notEqual=function(n){return this.throwIfDisposed(),Ty(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),BD(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.onesLike=function(){return this.throwIfDisposed(),yi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pad=function(n,e){return this.throwIfDisposed(),_C(this,n,e)};ve().prototype.pool=function(n,e,t,r,s,i){return this.throwIfDisposed(),GK(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pow=function(n){return this.throwIfDisposed(),Ou(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prelu=function(n){return this.throwIfDisposed(),NC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prod=function(n,e){return this.throwIfDisposed(),qK(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reciprocal=function(){return this.throwIfDisposed(),v8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu=function(){return this.throwIfDisposed(),Yu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu6=function(){return this.throwIfDisposed(),WD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ie(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshape=function(n){return this.throwIfDisposed(),ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),nP(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),rP(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reverse=function(n){return this.throwIfDisposed(),Lu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rfft=function(){return this.throwIfDisposed(),B8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.round=function(){return this.throwIfDisposed(),GD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rsqrt=function(){return this.throwIfDisposed(),jD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.selu=function(){return this.throwIfDisposed(),HD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.separableConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),qD(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sigmoid=function(){return this.throwIfDisposed(),Oh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sign=function(){return this.throwIfDisposed(),T8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sin=function(){return this.throwIfDisposed(),KD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sinh=function(){return this.throwIfDisposed(),XD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.slice=function(n,e){return this.throwIfDisposed(),dn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softmax=function(n){return this.throwIfDisposed(),PC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softplus=function(){return this.throwIfDisposed(),$p(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),RC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.split=function(n,e){return this.throwIfDisposed(),Ks(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sqrt=function(){return this.throwIfDisposed(),Vr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.square=function(){return this.throwIfDisposed(),gn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squaredDifference=function(n){return this.throwIfDisposed(),W8(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squeeze=function(n){return this.throwIfDisposed(),Pp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Qn?[this,n]:[this,...n];return xa(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.step=function(n){return this.throwIfDisposed(),Fp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stridedSlice=function(n,e,t,r,s,i,o,a){return this.throwIfDisposed(),K8(this,n,e,t,r,s,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sub=function(n){return this.throwIfDisposed(),ut(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sum=function(n,e){return this.throwIfDisposed(),nt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tan=function(){return this.throwIfDisposed(),Y8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tanh=function(){return this.throwIfDisposed(),Cv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tile=function(n){return this.throwIfDisposed(),Gi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toBool=function(){return this.throwIfDisposed(),ze(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toFloat=function(){return this.throwIfDisposed(),ze(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toInt=function(){return this.throwIfDisposed(),ze(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.topk=function(n,e){return this.throwIfDisposed(),Z8(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.transpose=function(n){return this.throwIfDisposed(),Ot(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unique=function(n){return this.throwIfDisposed(),nX(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),eP(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unstack=function(n){return this.throwIfDisposed(),Mu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.where=function(n,e){return this.throwIfDisposed(),ts(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.zerosLike=function(){return this.throwIfDisposed(),Lt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vo.prototype)}}class pi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pi.prototype)}}class Y extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Y.prototype)}}class wt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,wt.prototype)}}class yS extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yS.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qP{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vu(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function xo(n,e){if(!n)throw new yS(e)}function VR(n,e){let t=0;for(const r of n)r===e&&t++;return t}function ds(n){return n.length===1?n[0]:n}function rn(n){return Array.isArray(n)?n:[n]}function ia(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function fu(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let li={};function vS(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function eb(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>eb(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:eb(r))}}}function Vp(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in li)o=li[i];else if(o=e[i],o==null)throw new Y(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new Y(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in li?[a,l]=li.className:o in e&&([a,l]=e[o]),a==null)throw new Y(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const g of Object.keys(li))c[g]=li[g];for(const g of Object.keys(t))c[g]=t[g];const d=i.config;d.customObjects=c;const f=Object.assign({},li);for(const g of Object.keys(t))li[g]=t[g];eb(i.config);const p=l(a,i.config,t,s);return li=Object.assign({},f),p}else{const c=Object.assign({},li);for(const f of Object.keys(t))li[f]=t[f];const d=new a(i.config);return li=Object.assign({},c),d}}}function NQ(n,e){return n<e?-1:n>e?1:0}function vg(n,e){return-1*NQ(n,e)}function ml(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function AQ(n){if(n==null)throw new Y(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Ju(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Y(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function xS(n,e,t=0,r=1/0){return xo(t>=0),xo(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function hr(n,e){Array.isArray(n)?(z(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>hr(t,`element ${r+1} of ${e}`))):z(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${KP(n)}.`)}function KP(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>KP(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function $Q(n,e,t){let r=t!=null?t():cs(),s;return(...o)=>{const a=t!=null?t():cs();return a-r<e||(r=a,s=n(...o)),s}}function XP(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let DQ=0;function YP(){return DQ++}const xg={};function Dv(n=""){return n in xg||(xg[n]=0),xg[n]+=1,n+xg[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const PQ=["channelsFirst","channelsLast"],FQ=["nearest","bilinear"],OQ=["valid","same","causal"],LQ=["max","avg"],MQ=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zc=new Map;function Bn(n){Ju(PQ,"DataFormat",n)}function VQ(n){Ju(FQ,"InterpolationFormat",n)}function Js(n){Ju(OQ,"PaddingMode",n)}function QP(n){Ju(LQ,"PoolMode",n)}const Jd=[],zR="/";function Cu(n,e){Jd.push(n);try{const t=e();return Jd.pop(),t}catch(t){throw Jd.pop(),t}}function zQ(){return Jd.length===0?"":Jd.join(zR)+zR}function JP(n){if(!eF(n))throw new Error("Not a valid tensor name: '"+n+"'");return zQ()+n}function ZP(n){if(!eF(n))throw new Error("Not a valid tensor name: '"+n+"'");zc.has(n)||zc.set(n,0);const e=zc.get(n);if(zc.set(n,zc.get(n)+1),e>0){const t=`${n}_${e}`;return zc.set(t,1),t}else return n}const BQ=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function eF(n){return!!n.match(BQ)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UQ(n){return n===parseInt(n.toString(),10)}function gl(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function xh(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function El(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function Qi(n,e){if(e<n)throw new Y(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Kw;function Zn(){return Kw==null&&(Kw=y5().epsilon()),Kw}function Ji(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function No(n,e){return ze(n,e)}function zp(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ie(n,t)}function WQ(n,e){return de(()=>{if(n.shape.length!==2)throw new Y(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=zp(n,1);return tb(t,[1,e,1])})}function GQ(n){const e=[gl(n.shape)];return ie(n,e)}function jQ(n){if(n.rank<=1)throw new Y(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],gl(n.shape,1)];return ie(n,e)}function Su(n,e,t){return de(()=>{switch(n.rank){case 1:return $C(n,e,t);case 2:return YD(n,[e,0],[t,n.shape[1]]);case 3:return DC(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Ry(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return dn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return dn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Y(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Xw(n,e,t){return de(()=>{switch(n.rank){case 1:return $C(n,e,t);case 2:return YD(n,[0,e],[n.shape[0],t]);case 3:return DC(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Ry(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Y(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function wg(n,e,t,r){return de(()=>{switch(n.rank){case 1:return $C(n,e,t);case 2:switch(r){case 1:return Su(n,e,t);case 2:return Xw(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Su(n,e,t);case 2:return DC(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Xw(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Su(n,e,t);case 2:return Ry(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Ry(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Xw(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${r}`)}default:throw new Y(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function wS(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),fs(n,e)}function BR(n,e){switch(n.rank){case 1:return Qq([n,e]);case 2:return Zq([n,e],0);case 3:return t9([n,e],0);case 4:return r9([n,e],0);default:throw new Y(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function tb(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Y(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Gi(n,e)}function Pv(n,e=0,t=1,r,s){return p8(n,e,t,r,s)}function Ao(n,e,t,r){if(n.rank<2||e.rank<2)throw new wt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(s!==i)throw new wt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return ER({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?nb(n.rank,r,Ji()):null,activation:t});{const s=n.shape.slice(),i=s.pop();n=ie(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],d=Array.from({length:e.rank},(y,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=ie(Ot(e,d),[l,-1]);const f=[...s,...c];return ie(ER({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?nb(n.rank,r,Ji()):null,activation:t}),f)}}function tF(n,e,t){return de(()=>(Array.isArray(e)?e=As(e,"int32"):e=ze(e,"int32"),IC(n,e,t)))}function Bp(n){return J(n,n)}function nb(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new Y(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?ie(e,[1,r[0],1,1,1]):ie(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?ie(e,[1,1,1,1,r[0]]):ie(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?ie(e,[1,r[0],1,1]):ie(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?ie(e,[1,1,1,r[0]]):ie(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?ie(e,[1,r[0],1]):ie(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?ie(e,[1,1,r[0]]):ie(e,[1].concat(r))}else if(n<3)return e;throw new Y(`Unsupported input rank by biasAdd: ${e.rank}`)}function no(n,e,t){return de(()=>(t==null&&(t=Ji()),Bn(t),Ne(n,nb(n.rank,e,t))))}function HQ(n,e=1){if(e!==1)throw new wt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return kv(n)}function qQ(n){return de(()=>rt(n,Ne(Qr(n),1)))}function nF(n,e,t,r){return de(()=>uX(n,e,t,r))}function KQ(n){return de(()=>{const e=Ne(.5,J(.2,n));return Ys(e,0,1)})}function Up(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XQ=["fanIn","fanOut","fanAvg"],YQ=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QQ(n){Ju(XQ,"FanMode",n)}function JQ(n){Ju(YQ,"Distribution",n)}class xi extends Vh{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class rF extends xi{apply(e,t){return cr(e,t)}}rF.className="Zeros";Te(rF);class bS extends xi{apply(e,t){return Ll(e,t)}}bS.className="Ones";Te(bS);class sF extends xi{constructor(e){if(super(),typeof e!="object")throw new Y(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new Y(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return de(()=>J(Yt(this.value),Ll(e,t)))}getConfig(){return{value:this.value}}}sF.className="Constant";Te(sF);class iF extends xi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Dp(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}iF.className="RandomUniform";Te(iF);class oF extends xi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new wt(`randomNormal does not support dType ${t}.`);return Pv(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}oF.className="RandomNormal";Te(oF);class aF extends xi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new wt(`truncatedNormal does not support dType ${t}.`);return ZD(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}aF.className="TruncatedNormal";Te(aF);class lF extends xi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return de(()=>{if(e.length!==2||e[0]!==e[1])throw new Y("Identity matrix initializer can only be used for 2D square matrices.");return J(this.gain,OD(e[0]))})}getConfig(){return{gain:this.gain}}}lF.className="Identity";Te(lF);function ZQ(n,e="channelsLast"){let t,r;if(Bn(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=gl(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=gl(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=gl(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class Ps extends xi{constructor(e){if(super(),e.scale<0)throw new Y(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,QQ(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,JQ(this.distribution),this.seed=e.seed}apply(e,t){const r=ZQ(e),s=r[0],i=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,s):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(s+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new wt(`${this.getClassName()} does not support dType ${t}.`);return ZD(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return Dp(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ps.className="VarianceScaling";Te(Ps);class IS extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}IS.className="GlorotUniform";Te(IS);class CS extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}CS.className="GlorotNormal";Te(CS);class SS extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}SS.className="HeNormal";Te(SS);class ES extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}ES.className="HeUniform";Te(ES);class kS extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}kS.className="LeCunNormal";Te(kS);class TS extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}TS.className="LeCunUniform";Te(TS);class uF extends xi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return de(()=>{if(e.length<2)throw new wt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=xe(e.slice(0,-1)),s=e[e.length-1],i=r*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(s,r),Math.min(s,r)],a=Pv(o,0,1,t,this.seed),l=s7.qr(a,!1);let c=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return c=J(c,f.sign()),r<s&&(c=c.transpose()),J(Yt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}uF.className="Orthogonal";Te(uF);const UR={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function WR(n,e={}){return Vp(n,fi.getMap().classNameMap,e,"initializer")}function _n(n){return vS(n)}function Cn(n){if(typeof n=="string"){const e=n in UR?UR[n]:n;if(e==="GlorotNormal")return new CS;if(e==="GlorotUniform")return new IS;if(e==="HeNormal")return new SS;if(e==="HeUniform")return new ES;if(e==="LeCunNormal")return new kS;if(e==="LeCunUniform")return new TS;{const t={};return t.className=e,t.config={},WR(t)}}else return n instanceof xi?n:WR(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rb(n){return Array.isArray(n)&&Array.isArray(n[0])}function Ny(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function ct(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new Y(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Ut(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Y(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ay(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const GR="Variable";class eJ{constructor(e,t="float32",r=GR,s=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=YP(),r=r??GR,this.originalName=JP(r),this.name=ZP(this.originalName),this.trainable_=s,this.constraint=i,this.val=iX(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),tJ(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function tJ(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function sb(n){return n.map(e=>e.read())}function _S(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class er{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Mo{constructor(e,t,r,s,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=i,this.outputTensorIndex=a,this.id=YP(),o!=null&&(this.originalName=JP(o),this.name=ZP(this.originalName)),this.rank=t.length}}let nJ=0;class Fv{constructor(e,t){this.callArgs=t,this.id=nJ++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let rJ=0;class St extends Vh{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=rJ++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=ia(r)+"_"+Dv(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),r=[i].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new pi(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Y(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ds(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ds(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new vo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new vo(`Layer ${this.name} is not connected, no input to return.`);return ds(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new vo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new vo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ds(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=rn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=rn(this.inputSpec);if(t.length!==r.length)throw new Y(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const i=t[s],o=r[s];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new Y(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new Y(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new Y(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new Y(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const c in o.axes){const d=Number(c),f=o.axes[c],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new Y(`Input ${s} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],d=i.shape[l];if(c!=null&&d!=null&&c!==d)throw new Y(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=rn(e),s=oJ(e),i=aJ(e);if(s===i)throw new Y("Arguments to apply() must be all SymbolicTensors or all Tensors");return Cu(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of rn(e))o.push(a.shape);this.build(ds(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=rn(o),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=ds(l),this.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=sJ(e),a=this.computeOutputShape(o);let l;const c=iJ(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Mo(c,d,this,rn(e),t,this.name,f)):l=new Mo(c,a,this,rn(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new vo(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new vo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new pi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Ay(this.weights)}build(e){this.built=!0}getWeights(e=!1){return sb(e?this.trainableWeights:this.weights)}setWeights(e){de(()=>{const t=this.weights;if(t.length!==e.length)throw new Y(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=sb(t);for(let i=0;i<s.length;++i){const o=s[i],a=t[i],l=e[i];if(!Qt(o.shape,l.shape))throw new Y(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}_S(r)})}addWeight(e,t,r,s,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new Y(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():Cn("zeros"));const c=s.apply(t,r),d=new eJ(c,r,e,o,a);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=rn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),i=rn(t),o=rn(s);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,r,s,i,o,a=null){const l=rn(e);t=rn(t),r=rn(r),s=rn(s),i=Ny(i),o=Ny(o);const c=[],d=[],f=[];for(const p of l)c.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new Fv({outboundLayer:this,inboundLayers:c,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function sJ(n){n=rn(n);const e=[];for(const t of n)e.push(t.shape);return ds(e)}function iJ(n){return"float32"}function cF(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let i=0;i<r.inboundLayers.length;i++){const o=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=cF(o,a,l);for(const d of c)s.indexOf(d)===-1&&s.push(d)}return s}}}function oJ(n){let e=!0;for(const t of rn(n))if(!(t instanceof Mo)){e=!1;break}return e}function aJ(n){let e=!0;for(const t of rn(n))if(t instanceof Mo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wp extends St{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Dv("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new Y("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new Y("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new Y("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new Mo(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new Fv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Y(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Wp.className="InputLayer";Te(Wp);function lJ(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Y("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Wp({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uJ(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ze(e,n.dtype)}catch{throw new Y(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class al{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof al)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=uJ(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new Y(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Mo){if(this.id2Value[e.id]==null)throw new Y(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Y(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Mo){if(this.id2Value[e.id]==null)throw new Y(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Y(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&bt(this.id2Mask)}}const $y=new qP,Dy=new qP;function cJ(n){$y!=null&&$y.setMaxEntries(n),Dy!=null&&Dy.setMaxEntries(n)}function Ud(n,e,t,r){const s=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(y=>y.name),l=[],c=e.names();for(const y of a)c.indexOf(y)!==-1?l.push(e.getValue(y)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=$y.get(d),p;if(f==null){const y=hJ(o,e);f=y.sorted,p=y.recipientCounts,$y.put(d,f),Dy.put(d,p)}p={},s||Object.assign(p,Dy.get(d));const g=new al(e);for(let y=0;y<f.length;++y){const w=f[y],x=w.sourceLayer;if(x instanceof Wp)continue;const I=[],C=[],k=[];let E=!1;for(const $ of w.inputs){const D=g.getValue($),R=g.getMask($);I.push(D),C.push(R),R!=null&&(E=!0),s||(p[$.name]--,p[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!D.isDisposed&&$.sourceLayer.stateful!==!0&&k.push(D))}E&&(t=t||{},t.mask=C[0]);const _=rn(x.apply(I,t));let L=null;x.supportsMasking&&(L=x.computeMask(I,C));const P=fJ(w),A=Array.isArray(P)?P:[P];for(let $=0;$<A.length;++$){g.hasKey(A[$])||g.add(A[$],_[$],Array.isArray(L)?L[0]:L);const D=a.indexOf(A[$].name);D!==-1&&(l[D]=_[$])}s||bt(k)}return g.disposeMasks(),i?l:l[0]}function hJ(n,e){z(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=jR(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const i of n){const{sorted:o,recipientMap:a}=jR(i,e);for(const l of o)s.has(l.name)||(t.push(l),s.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:t,recipientCounts:dJ(r)}}function dJ(n){const e={};for(const t in n)e[t]=n[t].size;return e}function jR(n,e){const t=new Set,r=[],s={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const c of a.inputs)s[c.name]==null&&(s[c.name]=new Set),s[c.name].add(a.name),!t.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:s}}function fJ(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pJ=pe();pJ.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,cJ);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RS(n,e){return de(()=>Vr(nt(J(n,n),e,!0)))}class Gp extends Vh{getConfig(){return{}}}class hF extends Gp{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=RS(e,this.axis),r=Ys(t,0,this.maxValue);return J(e,rt(r,Ne(Zn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}hF.className="MaxNorm";Te(hF);class dF extends Gp{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>rt(e,Ne(Zn(),RS(e,this.axis))))}getConfig(){return{axis:this.axis}}}dF.className="UnitNorm";Te(dF);class fF extends Gp{apply(e){return Yu(e)}}fF.className="NonNeg";Te(fF);class pF extends Gp{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=RS(e,this.axis),r=Ne(J(this.rate,Ys(t,this.minValue,this.maxValue)),J(1-this.rate,t));return J(e,rt(r,Ne(Zn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}pF.className="MinMaxNorm";Te(pF);const HR={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function tr(n){return vS(n)}function qR(n,e={}){return Vp(n,fi.getMap().classNameMap,e,"constraint")}function nr(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in HR?HR[n]:n,config:{}};return qR(t)}else return n instanceof Gp?n:qR(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function au(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const i=n[s];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(s),r.push(o)}}if(e.length>0){const s=await Promise.all(e);for(let i=0;i<s.length;++i)n[t[i]]=s[i][0];bt(r)}}function mF(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var KR;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(KR||(KR={}));const mJ=125;class pf{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class gJ{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class yJ extends pf{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const i=t[s];if(typeof i=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+i*r;else{let o;s in this.totals?o=this.totals[s]:this.totals[s]=0;const a=de(()=>Ne(this.totals[s],J(i,r)));this.totals[s]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:de(()=>{const s=J(rt(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),_o(t[r])}))}}class vJ extends pf{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),r.push(a)}}const s=await Promise.all(e);for(let i=0;i<s.length;++i)this.history[t[i]][r[i]].dispose(),this.history[t[i]][r[i]]=s[i][0]}}class xJ extends pf{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||wP,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=mJ),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");P1(this.yieldEvery)&&(this.maybeWait=$Q(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await au(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await au(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await au(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await au(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await au(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):P1(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await au(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await au(e),await this.trainEnd(e))}}function gF(n,e){return n==null&&(n={}),n instanceof pf?[n]:Array.isArray(n)&&n[0]instanceof pf?n:rn(n).map(r=>new xJ(r,e))}class ci{constructor(){}static registerCallbackConstructor(e,t){z(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ci.checkForDuplicate(t),ci.constructors[e]==null&&(ci.constructors[e]=[]),ci.constructors[e].push(t)}static checkForDuplicate(e){for(const t in ci.constructors)ci.constructors[+t].forEach(s=>{if(s===e)throw new Y("Duplicate callback constructor.")})}static clear(){ci.constructors={}}static createCallbacks(e){const t=[];for(const r in ci.constructors){const s=+r;e>=s&&t.push(...ci.constructors[s])}return t.map(r=>new r)}}ci.constructors={};function yF(n,e,t,r,s,i,o,a,l){const c=new vJ,d=[new yJ,...ci.createCallbacks(e)];n!=null&&d.push(...n),d.push(c);const f=new gJ(d);return f.setParams({epochs:t,initialEpoch:r,samples:s,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $o(n,e={},t=!1){return Vp(n,fi.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Py(n,e){return de(()=>{n.dtype!=="float32"&&(n=ze(n,"float32"));const t=nt(Bp(n),e,!0),r=Ev(t.shape,Zn()),s=Vr(Ol(t,r));return rt(n,s)})}function Ov(n,e){return de(()=>Hn(Bp(ut(e,n)),-1))}function NS(n,e){return de(()=>Hn(Qr(ut(e,n)),-1))}function AS(n,e){return de(()=>{const t=ut(n,e),r=Ys(Qr(n),Zn(),Number.MAX_VALUE),s=Qr(rt(t,r));return J(100,Hn(s,-1))})}function wJ(n,e){return de(()=>{const t=Ys(e,Zn(),Number.MAX_VALUE),r=Lo(Ne(1,t)),s=Ys(n,Zn(),Number.MAX_VALUE),i=Lo(Ne(1,s));return Hn(Bp(ut(r,i)),-1)})}function bJ(n,e){return de(()=>{const t=Ol(0,ut(1,J(n,e)));return Hn(Bp(t),-1)})}function IJ(n,e){return de(()=>{const t=Ol(0,ut(1,J(n,e)));return Hn(t,-1)})}function CJ(n,e){return de(()=>{const t=nt(J(n,e),-1),r=qi(J(ut(1,n),e),-1);return Ol(0,Ne(1,ut(r,t)))})}function SJ(n,e){return de(()=>{const t=Math.log(2),r=ut(e,n),s=ut(Ne(r,$p(J(-2,r))),t);return Hn(s,-1)})}function mf(n,e,t=!1){return de(()=>{if(t)e=PC(e);else{const r=nt(e,e.shape.length-1,!0);e=rt(e,r)}return e=Ys(e,Zn(),1-Zn()),Mn(nt(J(ze(n,"float32"),Lo(e)),e.shape.length-1))})}function Fy(n,e,t=!1){return de(()=>{const r=ze(_v(GQ(n)),"int32");e=Ys(e,Zn(),1-Zn());const s=e.shape,i=ie(BD(r,s[s.length-1]),s);return mf(i,e,t)})}function EJ(n,e){if(!Qt(n.shape,e.shape))throw new Y(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return de(()=>{const t=Yu(e),r=Mn(Qr(e));return Ne(ut(t,J(e,n)),LD(Oo(r)))})}function Lv(n,e){return de(()=>{let t;return t=Ys(e,Zn(),1-Zn()),t=Lo(rt(t,ut(1,t))),Hn(EJ(n,t),-1)})}function kJ(n,e){return de(()=>{const t=Ys(n,Zn(),1),r=Ys(e,Zn(),1);return nt(J(n,Lo(rt(t,r))),-1)})}function TJ(n,e){return de(()=>{const t=Lo(Ne(Zn(),e));return Hn(ut(e,J(n,t)),-1)})}function vF(n,e){return de(()=>{const t=Py(n,-1),r=Py(e,-1),s=J(t,r);return Mn(nt(s,-1))})}const Oy={meanSquaredError:Ov,meanAbsoluteError:NS,meanAbsolutePercentageError:AS,meanSquaredLogarithmicError:wJ,squaredHinge:bJ,hinge:IJ,categoricalHinge:CJ,logcosh:SJ,categoricalCrossentropy:mf,sparseCategoricalCrossentropy:Fy,binaryCrossentropy:Lv,kullbackLeiblerDivergence:kJ,poisson:TJ,cosineProximity:vF};function Yw(n){if(typeof n=="string"){if(n in Oy)return Oy[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Y(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xF(n,e){return de(()=>{const t=J(.5,yi(e)),r=No(Qs(e,t),n.dtype);return Hn(Fo(n,r),-1)})}function wF(n,e){return de(()=>No(Fo(uf(n,-1),uf(e,-1)),"float32"))}function _J(n,e){return de(()=>ze(nt(va(Fo(n,1),Fo(e,1))),"float32"))}function RJ(n,e){return de(()=>ze(nt(va(Fo(n,0),Fo(e,1))),"float32"))}function NJ(n,e){return de(()=>{const t=_J(n,e),r=RJ(n,e),s=Ne(t,r);return ze(ts(Qs(s,0),rt(t,s),0),"float32")})}function AJ(n,e){return Lv(n,e)}function $J(n,e){return n.rank===e.rank&&(n=Pp(n,[n.rank-1])),e=uf(e,-1),e.dtype!==n.dtype&&(e=ze(e,n.dtype)),ze(Fo(n,e),"float32")}const DJ=Ov,PJ=Ov,FJ=NS,OJ=NS,LJ=AS,MJ=AS,bF=mf,VJ=vF,IF=Fy,Ly={binaryAccuracy:xF,categoricalAccuracy:wF,precision:NJ,categoricalCrossentropy:bF,sparseCategoricalCrossentropy:IF,mse:DJ,MSE:PJ,mae:FJ,MAE:OJ,mape:LJ,MAPE:MJ,cosine:VJ};function zJ(n){if(typeof n=="string"&&n in Ly)return Ly[n];if(typeof n!="string"&&n!=null)return n;throw new Y(`Unknown metric ${n}`)}function bg(n){if(xo(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Oy))if(Oy[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Ly))if(Ly[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BJ(n){const e={Adagrad:()=>Vc.adagrad(.01),Adadelta:()=>Vc.adadelta(1,.95,Zn()),Adam:()=>Vc.adam(.001,.9,.999,Zn()),Adamax:()=>Vc.adamax(.002,.9,.999,Zn(),0),RMSProp:()=>Vc.rmsprop(.001,.9,0,Zn()),SGD:()=>Vc.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Y(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XR=1*1024*1024;function YR(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!ib(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>XR&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${XR}.`)}}function ib(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!ib(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!ib(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UJ(n,e,t,r=console.log){const s=GJ(n),i=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!s){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}r("_".repeat(e)),My(i,t,r),r("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)s?jJ(a[d],t,r):HJ(a[d],t,o,r),r((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=WJ(n),c=Ay(n.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function WJ(n){let e;return n.collectedTrainableWeights!=null?e=Ay(n.collectedTrainableWeights):e=Ay(n.trainableWeights),e}function GJ(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let i=!1;for(const o of s.inboundNodes)if(r.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function My(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function jJ(n,e,t){let r,s;try{s=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,s,r,n.countParams().toString()];My(a,e,t)}function HJ(n,e,t,r){let s,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,y=f.nodeIndices[p],w=f.tensorIndices[p];o.push(`${g}[${y}][${w}]`)}const a=n.name,l=n.getClassName(),c=o.length===0?"":o[0],d=[`${a} (${l})`,i,s,n.countParams().toString(),c];My(d,e,r);for(let f=1;f<o.length;++f)My(["","","","",o[f]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CF(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Vy(n,e){if(n===null)return null;if(typeof n=="string")return fu(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];CF(e,s,i)?t.push(i):t.push(Vy(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const i=fu(r);t[i]=Vy(s,i)}}return t}}function ob(n,e){if(n==null)return null;if(typeof n=="string")return ia(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];CF(e,s,i)?t.push(i):t.push(ob(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],i=ia(r);(r==="name"||r==="className")&&typeof s=="string"?t[i]=s:t[i]=ob(s,r)}return t}}/** @license See the LICENSE file. */const SF="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qJ=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Vi extends St{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=Dv(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ml(this.inputs).length!==this.inputs.length)throw new Y(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);ml(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const k=C.sourceLayer,E=C.nodeIndex,_=C.tensorIndex;this.outputLayers.push(k),this.outputLayersNodeIndices.push(E),this.outputLayersTensorIndices.push(_)}for(const C of this.inputs){const k=C.sourceLayer,E=C.nodeIndex,_=C.tensorIndex;xo(E===0,"input layer has >1 nodes"),xo(_===0,"input layer has >1 tensors"),this.inputLayers.push(k),this.inputLayersNodeIndices.push(E),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const k=this.inputLayers[C];if(!(k instanceof Wp))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${k.getClassName()}.`);this.inputNames.push(k.name),this.feedInputShapes.push(k.batchInputShape),this.feedInputNames.push(k.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},r={},s={},i={},o={},a=[],l=(C,k,E,_,L,P)=>{(_==null||L==null||P==null)&&(_=C.sourceLayer,L=C.nodeIndex,P=C.tensorIndex);const A=_.inboundNodes[L];if(E.indexOf(A)!==-1)throw new pi(`The tensor ${C.name} at layer "${_.name}" is part of a cycle.`);if(k.indexOf(A)!==-1)return;this.containerNodes.add(Vi.nodeKey(_,L)),_.id in o||(o[_.id]=Object.keys(o).length),E.indexOf(A)===-1&&E.push(A);const $=A.inboundLayers.length;for(let D=0;D<$;D++){const R=A.inputTensors[D],M=A.inboundLayers[D],O=A.nodeIndices[D],Z=A.tensorIndices[D];l(R,k,E,M,O,Z)}for(k.push(A);E.indexOf(A)>=0;)E.splice(E.indexOf(A),1);a.push(A)},c=[],d=[];for(const C of this.outputs)l(C,c,d);const f=a.slice().reverse();for(const C of f){r[C.id]=C,C.id in t||(t[C.id]=0);let k=t[C.id];const E=s[C.outboundLayer.id]==null?0:s[C.outboundLayer.id];k=Math.max(k,E),s[C.outboundLayer.id]=k,i[C.outboundLayer.id]=C.outboundLayer,t[C.id]=k;for(let _=0;_<C.inboundLayers.length;_++){const L=C.inboundLayers[_],P=C.nodeIndices[_],A=L.inboundNodes[P],$=t[A.id]==null?0:t[A.id];t[A.id]=Math.max(k+1,$),r[A.id]=A}}const p={};for(const C in t){const k=t[C];k in p||(p[k]=[]),p[k].push(r[C])}const g={};for(const C in s){const k=s[C];k in g||(g[k]=[]),g[k].push(i[C])}let y=Object.keys(g).map(C=>parseInt(C,10)).sort(vg);this.layers=[];for(const C of y){const k=g[C];k.sort((E,_)=>{const L=o[E.id],P=o[_.id];return L<P?-1:L>P?1:0});for(const E of k)E instanceof Vi&&this.internalContainerRefs.push(E),this.layers.push(E)}this.layersByDepth=g,y=Object.keys(p).map(C=>parseInt(C,10)).sort(vg);const w=this.inputs.slice(),x=[];for(const C of y)for(const k of p[C]){const E=k.outboundLayer;if(E!=null){for(const _ of k.inputTensors)if(w.indexOf(_)===-1)throw new pi(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${E.name}". The following previous layers were accessed without issue: ${x}`);for(const _ of k.outputTensors)w.push(_);x.push(E.name)}}this.nodesByDepth=p;const I=this.layers.map(C=>C.name);for(const C of I){const k=I.filter(E=>E===C).length;if(k!==1)throw new pi(`The name "${C}" is used ${k} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(I))}this.outboundNodes=[],this.inboundNodes=[],new Fv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Y("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const i=qJ(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const d=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(r[d]!=null)throw new Y(`Duplicate weight name: ${d}`);r[d]=c,s++}const o=[];for(const a in e){let l=a;if(r[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(r[l]!=null)o.push([r[l],e[a]]);else if(t)throw new Y(`Provided weight data has no target variable: ${a}`);delete r[l]}if(t){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new Y(`${a.length} of ${s} weights are not set: ${a}`)}_S(o)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],i=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!s.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${SF}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=ob(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return de(()=>{e=rn(e);const r=new al;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return Ud(this.outputs,r,t)})}computeMask(e,t){return de(()=>{e=rn(e);let r;return t==null?r=Vu(null,e.length):r=rn(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=Ny(e);if(t.length!==this.inputLayers.length)throw new Y(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],c=t[a],d=l.name+"_0_0";r[d]=c}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(vg);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const c of l){const d=c.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const f=[];for(let w=0;w<c.inboundLayers.length;w++){const x=c.inboundLayers[w],I=c.nodeIndices[w],C=c.tensorIndices[w],k=`${x.name}_${I}_${C}`,E=r[k];f.push(E)}const p=d.computeOutputShape(ds(f)),g=Ny(p),y=d.inboundNodes.indexOf(c);for(let w=0;w<g.length;w++){const x=`${d.name}_${y}_${w}`;r[x]=g[w]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${c}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];xo(l in r),i.push(r[l])}return ds(i)}runInternalGraph(e,t){t==null&&(t=Vu(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],d=e[l],f=t[l];r[c.id]=[d,f]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(vg);for(const l of s){const c=this.nodesByDepth[l];for(const d of c){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,y=new Array;for(const w of p)w.id in r&&y.push(r[w.id]);if(y.length===p.length){let w={},x,I,C,k;if(d.callArgs!=null&&(w=d.callArgs),y.length===1){const[E,_]=y[0];w.mask==null&&(w.mask=_),C=rn(f.call(E,w)),k=rn(f.computeMask(E,_)),x=[E],I=[_]}else x=y.map(E=>E[0]),I=y.map(E=>E[1]),w.mask==null&&(w.mask=I),C=rn(f.call(x,w)),k=rn(f.computeMask(x,I));if(f.activityRegularizer)throw new wt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let E=0;E<g.length;++E){const _=g[E],L=C[E],P=k[E];r[_.id]=[L,P]}}}}const i=[],o=[],a=[];for(const l of this.outputs){xo(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[c,d]=r[l.id];a.push(c.shape),i.push(c),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof Vi?1:0;for(let i=0;i<s.inboundNodes.length;i++){const o=Vi.nodeKey(s,i);this.containerNodes.has(o)&&(t[o]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new Y("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new Y(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new Y(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return de(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=Vi.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=Vi.nodeKey(o,f);let y={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),y=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),y={}}if(p.inboundLayers.length>0){const w=[];for(let x=0;x<p.inboundLayers.length;x++){const I=p.inboundLayers[x],C=p.nodeIndices[x],k=p.tensorIndices[x],E=Vi.nodeKey(I,C);let _=t[E];_==null&&(_=0),w.push([I.name,_,k,y])}c.push(w)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=c,r.push(d)}e.layers=r;const s=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=Vi.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let d=t[c];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];s.push([a.name,d,f])}e.inputLayers=s;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=Vi.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let d=t[c];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,r={},s=!1){const i={},o={};function a(x,I){x.name in o?o[x.name].push(I):o[x.name]=[I]}function l(x,I){const C=[];let k;for(const E of I){const _=E[0],L=E[1],P=E[2];if(k=E[3]==null?{}:E[3],!(_ in i)){a(x,I);return}const A=i[_];if(A.inboundNodes.length<=L){a(x,I);return}const $=A.inboundNodes[L];C.push($.outputTensors[P])}C.length>0&&x.apply(ds(C),k)}function c(x){const I=x.name,C=$o(x,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(s),i[I]=C,x.inboundNodes.forEach(E=>{if(!(E instanceof Array))throw new Y(`Corrupted configuration, expected array for nodeData: ${E}`);a(C,E)})}const d=t.name,f=t.layers;for(const x of f)c(x);for(;!AQ(o);)for(const x of f){const I=i[x.name];if(I.name in o){const C=o[I.name];delete o[I.name];for(const k of C)l(I,k)}}const p=[],g=[],y=t.inputLayers;for(const x of y){const I=x[0],C=x[1],k=x[2];xo(I in i);const _=i[I].inboundNodes[C].outputTensors;p.push(_[k])}const w=t.outputLayers;for(const x of w){const I=x[0],C=x[1],k=x[2];xo(I in i);const _=i[I].inboundNodes[C].outputTensors;g.push(_[k])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new Y("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){de(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KJ(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(i=>{i in n?s.push(n[i]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function EF(n,e){return KJ(n,e,"classWeight")}async function kF(n,e,t,r){if(t!=null){const s=de(()=>{if(n.shape.length===1)return Iu(n);if(n.shape.length===2){if(n.shape[1]>1)return uf(n,1);if(n.shape[1]===1)return ie(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await s.data());bt(s);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),As(o,"float32")}else return null}function XJ(n,e){return J(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const YJ=32;function TF(n,e){let t,r;const s=e;t=s.xs,r=s.ys,z(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=QR("input",n.inputNames,t),o=QR("output",n.outputNames,r),a=i[0].shape[0];z(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),z(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)z(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)z(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function QR(n,e,t){if(t instanceof Qn)return[t];if(Array.isArray(t))return z(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new Y(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function QJ(n){if(n.length===3)throw new wt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function JJ(n,e,t){const r=t.batchesPerEpoch!=null;if(z(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),z(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),z(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),z(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),z(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let i,o;if(s)if(JR(t.validationData))z(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=QJ(t.validationData);i=x.xs,o=x.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;s?c=l.slice().concat(l.map(x=>"val_"+x)):c=l.slice();const d=gF(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=yF(d,f,t.epochs,null,null,ZJ(e,t),null,s,c);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let y=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;y<t.epochs;){const x={};await p.onEpochBegin(y);let I=0,C=0;for(r||(w=await e.iterator());!r||I<t.batchesPerEpoch;){const k=await w.next();if(r&&k.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${I} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(k.value!=null){const{xs:E,ys:_}=TF(n,k.value),L={};L.batch=C,L.size=E[0].shape[0],await p.onBatchBegin(C,L);const P=[];if(t.classWeight!=null){const D=EF(t.classWeight,n.outputNames);for(let R=0;R<D.length;++R)P.push(await kF(_[R],null,D[R]))}const A=E.concat(_).concat(P),$=a(A);bt(A);for(let D=0;D<l.length;++D){const R=l[D],M=$[D];L[R]=M,_o(M)}await p.onBatchEnd(C,L),mF(L),C++,I++}if(r?I>=t.batchesPerEpoch:k.done){if(s){let E;JR(t.validationData)?E=rn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):E=rn(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?YJ:t.validationBatchSize,verbose:0}));for(let _=0;_<n.metricsNames.length;++_)x[`val_${n.metricsNames[_]}`]=E[_]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(y,x),y++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function ZJ(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function JR(n){return typeof n.iterator=="function"}function eZ(n){return typeof n.next=="function"}async function tZ(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let i=[];if(t.verbose>0)throw new wt("Verbose mode is not implemented yet.");z(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=eZ(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<t.batches;){const c=await o.next();if(i=de(()=>{if(c.value){const{xs:d,ys:f}=TF(n,c.value),p=d.concat(f),g=de(()=>s(p));if(bt(p),l===0)for(let w=0;w<g.length;++w)i.push(Yt(0));const y=p[0].shape[0];for(let w=0;w<g.length;++w){const x=g[w],I=i[w];i[w]=de(()=>Ne(i[w],J(y,x))),l>0&&bt(I)}bt(g),a+=y,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){const d=i[c];i[c]=rt(i[c],a),bt(d)}return ds(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qw(n){z(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Dd(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>Su(r,e,t-e)):Su(n,e,t-e)}function ab(n,e){return de(()=>n==null?null:Array.isArray(n)?n.map(t=>ab(t,e)):tF(n,e.dtype==="int32"?e:ze(e,"int32")))}function Jw(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function _F(n){const e=[];n instanceof Qn&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(zp(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Mi(n,e){if(n==null)return;const t=[];if(e instanceof Qn)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const i=e[s];t.push(i.id)}const r=[];if(n instanceof Qn)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const i=n[s];t.indexOf(i.id)===-1&&r.push(i)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nZ(n){return n instanceof Qn}function lb(n){return Array.isArray(n)}function ZR(n){return!nZ(n)&&!lb(n)}function eN(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(lb(n)&&n.length>0)o=!0;else if(ZR(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new Y(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(ZR(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new Y(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(lb(n)){if(n=n,n.length!==e.length)throw new Y(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new Y(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=_F(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new Y(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const c=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&c!==d)throw new Y(`${s} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function rZ(n,e,t){const r=ml(n.map(i=>i.shape[0]));r.sort();const s=ml(e.map(i=>i.shape[0]));if(s.sort(),r.length>1)throw new Y(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(s.length>1)throw new Y(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(r.length>0&&s.length>0&&!Qt(r,s))throw new Y(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function sZ(n,e,t){const r=[Ov,Lv,mf];for(let s=0;s<n.length;++s){const i=n[s],o=e[s],a=t[s];if(o!=null){if(o===mf&&i.shape[i.shape.length-1]===1)throw new Y(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const l=i.shape.slice(1),c=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=c[d];if(p!=null&&f!==p)throw new Y(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function tN(n,e,t,r=!0,s=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new Y(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new Y(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new Y(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const c=a.shape[l],d=t[o][l];if(d!=null&&d!==c)throw new Y(`Error when checking ${s}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function iZ(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let i=t.hasOwnProperty(s)?t[s]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}const oZ="layers-model";class rh extends Vi{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new Y("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");UJ(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=BJ(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ml))throw new Y("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new Y(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(Yw(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Y(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>Yw(a))}else{const o=Yw(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Cu("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const s=iZ(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Cu("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=s[o];(c=>{const d="";let f,p,g;for(const y of c){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const x=this.internalOutputShapes[o];x[x.length-1]===1||this.lossFunctions[o]===Lv?["accuracy","acc"].indexOf(y)!==-1?p=xF:["crossentropy","ce"].indexOf(y)!==-1&&(p=AJ):this.lossFunctions[o]===Fy?["accuracy","acc"].indexOf(y)!==-1?p=$J:["crossentropy","ce"].indexOf(y)!==-1&&(p=IF):["accuracy","acc"].indexOf(y)!==-1?p=wF:["crossentropy","ce"].indexOf(y)!==-1&&(p=bF);let I;["accuracy","acc"].indexOf(y)!==-1?I="acc":["crossentropy","ce"].indexOf(y)!==-1&&(I="ce"),g=p,f=d+I}else g=zJ(y),f=d+bg(y);let w;Cu(f,()=>{w=g}),i(o,f,w)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;Qw(s);const o=this.standardizeUserDataXY(e,t,!0,s);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,s,r.verbose,r.steps);return ds(c)}finally{Mi(o[0],e),Mi(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),tZ(this,e,t)}checkNumSamples(e,t,r,s="steps"){let i;if(r!=null){if(i=null,t!=null)throw new Y(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new Y(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new Y("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],i=this.retrieveSymbolicTensors(s),o=new al;if(e instanceof Qn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Y(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new Y(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=Ud(i,o);return r?a:a[0]}retrieveSymbolicTensors(e){const t=Vu(null,e.length);let r=e.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((i,o)=>{i==null&&s.push(e[o])}),new Y(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return de(()=>{const s=this.checkNumSamples(e);if(r)throw new wt("Verbose predictLoop() is not implemented yet.");const i=Jw(s,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)de(()=>{const c=i[a][0],d=i[a][1],f=Dd(e,c,d),p=[];if(Array.isArray(f))for(let y=0;y<f.length;++y)p.push({key:this.inputs[y],value:f[y]});else p.push({key:this.inputs[0],value:f});const g=new al(p);return Ud(this.outputs,g)}).forEach((c,d)=>o[d].push(c));return ds(o.map(a=>fs(a,0)))})}predict(e,t={}){const r=_F(e);tN(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return Qw(s),this.predictLoop(r,s)}finally{Mi(r,e)}}predictOnBatch(e){tN(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new pi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Fy?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=eN(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=eN(t,this.feedOutputNames,i,!1,"target"),rZ(e,t),sZ(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new Y(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(r!=null)throw new Error("sample weight is not supported yet.");let c=null;if(s!=null){const d=EF(s,this.outputNames);c=[];for(let f=0;f<d.length;++f)c.push(await kF(l[f],null,d[f]))}return[a,l,c]}testLoop(e,t,r,s=0,i){return de(()=>{const o=this.checkNumSamples(t,r,i,"steps"),a=[];if(s>0)throw new wt("Verbose mode is not implemented yet.");if(i!=null)throw new wt("steps mode in testLoop() is not implemented yet");{const l=Jw(o,r),c=As(Qi(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=Su(c,f,p-f),y=ab(t,g),w=e(y);if(d===0)for(let x=0;x<w.length;++x)a.push(Yt(0));for(let x=0;x<w.length;++x){const I=w[x];a[x]=Ne(a[x],J(p-f,I))}}for(let d=0;d<a.length;++d)a[d]=rt(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let i=s;if(VR(e,s)>1){const o=VR(e.slice(0,r),s);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let w=0;w<this.inputs.length;++w)f.push({key:this.inputs[w],value:r[w]});const p=new al(f),g=Ud(this.outputs,p,{training:!0});let y;for(let w=0;w<this.lossFunctions.length;++w){const x=this.lossFunctions[w];let I=x(s[w],g[w]);i[w]!=null&&(I=XJ(I,i[w]));const C=Hn(I);t.push(C),w===0?y=I:y=Ne(y,I)}for(let w=0;w<this.metricsTensors.length;++w){let x;if(this.outputs.length>1&&w<this.outputs.length)x=t[w];else{const I=this.metricsTensors[w][0],C=this.metricsTensors[w][1];x=Hn(I(s[C],g[C]))}_o(x),o.push(x)}return y=Hn(y),this.calculateLosses().forEach(w=>{y=Ne(y,w)}),y},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>de(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:s[c]});const a=new al(o),l=Ud(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const d=this.lossFunctions[c],f=Hn(d(i[c],l[c]));c===0?r=f:r=Ne(r,f),t.push(r)}for(let c=0;c<this.metricsTensors.length;++c){const d=this.metricsTensors[c][0],f=this.metricsTensors[c][1],p=Hn(d(i[f],l[f]));t.push(p)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,i,o,a,l,c,d,f,p;try{const g=r.batchSize==null?32:r.batchSize;Qw(g);const w=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,g);s=w[0],i=w[1],p=w[2];let x=!1,I;if(r.validationData!=null&&r.validationData.length>0){if(x=!0,r.validationData.length===2)l=r.validationData[0],c=r.validationData[1];else throw r.validationData.length===3?new wt("validationData including sample weights is not supported yet."):new Y(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const D=await this.standardizeUserData(l,c,null,null,!0,g);d=D[0],f=D[1],I=d.concat(f)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){x=!0;const $=Math.floor(s[0].shape[0]*(1-r.validationSplit)),D=s[0].shape[0];d=Dd(s,$,D),o=s,s=Dd(s,0,$),f=Dd(i,$,D),a=i,i=Dd(i,0,$),I=d.concat(f)}else r.validationSteps!=null&&(x=!0);const C=s.concat(i).concat(p);this.checkTrainableWeightsConsistency();const k=this.makeTrainFunction(),E=this.getDedupedMetricsNames();let _,L;x?(this.makeTestFunction(),_=this.testFunction,L=E.slice().concat(E.map($=>"val_"+$))):(_=null,I=[],L=E.slice());const P=gF(r.callbacks,r.yieldEvery);return await this.fitLoop(k,C,E,g,r.epochs,r.verbose,P,_,I,r.shuffle,L,r.initialEpoch,null,null)}finally{this.isTraining=!1,Mi(s,e),Mi(i,t),Mi(o,e),Mi(a,t),Mi(d,l),Mi(f,c),p!=null&&bt(p)}}async fitLoop(e,t,r,s,i,o,a,l,c,d,f,p,g,y){s==null&&(s=32),i==null&&(i=1),d==null&&(d=!0),p==null&&(p=0);let w=!1;if(l!=null&&c!=null&&(w=!0),y!=null&&(w=!0,g==null))throw new Y("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,s,g,"steps_per_epoch");let I;x!=null&&(I=Qi(0,x)),o==null&&(o=1);const{callbackList:C,history:k}=yF(a,o,i,p,x,g,s,w,f);C.setModel(this),this.history=k,await C.onTrainBegin(),this.stopTraining_=!1;for(let E=p;E<i;++E){await C.onEpochBegin(E);const _={};if(g!=null)throw new wt("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new wt("batch shuffling is not implemneted yet");d&&T6(I);const L=As(I),P=Jw(x,s);for(let A=0;A<P.length;++A){const $={};if(await C.onBatchBegin(A,$),de(()=>{const D=P[A][0],R=P[A][1],M=Su(L,D,R-D);$.batch=A,$.size=R-D;const O=ab(t,M),Z=e(O);for(let q=0;q<r.length;++q){const se=r[q],le=Z[q];$[se]=le,_o(le)}if(A===P.length-1&&w){const q=this.testLoop(l,c,s);for(let se=0;se<r.length;++se){const le=r[se],j=q[se];_o(j),_["val_"+le]=j}}}),await C.onBatchEnd(A,$),mF($),this.stopTraining_)break}L.dispose()}if(await C.onEpochEnd(E,_),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return JJ(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],i=r[1],a=this.makeTrainFunction()(s.concat(i)),l=[];for(const c of a){const d=await c.data();l.push(d[0])}return bt(a),Mi(r[0],e),Mi(r[1],t),ds(l)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,i=this.getWeights(r);for(let o=0;o<s.length;++o)r&&!s[o].trainable||t.push({name:s[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=hR().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-hR().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ia(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ia(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=ia(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ia(bg(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ia(bg(e)));{const e={};for(const t in this.metrics)e[t]=ia(bg(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Vy(e.optimizer_config),r=$o(t);let s;if(typeof e.loss=="string")s=fu(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(o=>fu(o));else if(e.loss!=null){s={};for(const o in e.loss)s[o]=fu(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>fu(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=fu(e.metrics[o])}this.compile({loss:s,metrics:i,optimizer:r})}async save(e,t){if(typeof e=="string"){const c=$5(e);if(c.length===0)throw new Y(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new Y(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new Y("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await dR(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:oZ,generatedBy:`TensorFlow.js tfjs-layers v${SF}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:d,specs:f}=await dR(await this.optimizer.getWeights(),c);r.specs.push(...f),r.data=S5([r.data,d])}return this.userDefinedMetadata!=null&&(YR(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){YR(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}rh.className="Model";Te(rh);class RF extends rh{}RF.className="Functional";Te(RF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function aZ(n,e){if(e==null&&(e={}),typeof n=="string"){const t=D5(n,e);if(t.length===0)t.push(p7(n,e));else if(t.length>1)throw new Y(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return lZ(n,void 0,e)}async function lZ(n,e,t){if(t==null&&(t={}),n.load==null)throw new Y("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await n.load();let s=r.modelTopology;s.model_config!=null&&(s=s.model_config);const i=t.strict==null?!0:t.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,a=$o(Vy(s),e,o),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new Y("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:d}=uZ(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),bt(c),bt(d.map(f=>f.tensor))}return a}function uZ(n,e){const t=v5(n,e),r={},s=[];return e.forEach(i=>{i.group==="optimizer"?s.push({name:i.name,tensor:t[i.name]}):r[i.name]=t[i.name]}),{modelWeights:r,optimizerWeights:s}}class gf extends rh{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Dv("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new Y(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof gf||e instanceof rh;let r;if(t){if(r=e,r.outputs.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new Y("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new Y("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=lJ({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new Y(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=cF(this.outputs[0])}this.inboundNodes=[],new Fv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Vu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ut(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new rh({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new Y("Legacy serialization format not supported yet.");i=t}else z(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof gf))throw new wt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=$o(l,void 0,s);s&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new Y("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new Y("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}gf.className="Sequential";Te(gf);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Br=class extends Vh{getConfig(){return{}}};class NF extends Br{apply(e,t=1){return HQ(e,t)}}NF.className="elu";Te(NF);class AF extends Br{apply(e){return HD(e)}}AF.className="selu";Te(AF);class $F extends Br{apply(e){return Yu(e)}}$F.className="relu";Te($F);class DF extends Br{apply(e){return de(()=>df(6,Yu(e)))}}DF.className="relu6";Te(DF);class PF extends Br{apply(e){return e}}PF.className="linear";Te(PF);class FF extends Br{apply(e){return Oh(e)}}FF.className="sigmoid";Te(FF);class OF extends Br{apply(e){return KQ(e)}}OF.className="hardSigmoid";Te(OF);class LF extends Br{apply(e){return $p(e)}}LF.className="softplus";Te(LF);class MF extends Br{apply(e){return qQ(e)}}MF.className="softsign";Te(MF);class VF extends Br{apply(e){return Cv(e)}}VF.className="tanh";Te(VF);let $S=class extends Br{apply(e,t=-1){return PC(e,t)}};$S.className="softmax";Te($S);class zF extends Br{apply(e,t=-1){return MD(e,t)}}zF.className="logSoftmax";Te(zF);class BF extends Br{apply(e){return de(()=>de(()=>{const t=Math.sqrt(2),r=J(.5,Ne(1,DD(rt(e,t))));return J(e,r)}))}}BF.className="gelu";Te(BF);class UF extends Br{apply(e){return de(()=>J(.5,J(e,Ne(1,Cv(J(Vr(rt(2,Math.PI)),Ne(e,J(.044715,Ou(e,3)))))))))}}UF.className="gelu_new";Te(UF);class WF extends Br{apply(e){return de(()=>J(e,Cv($p(e))))}}WF.className="mish";Te(WF);class GF extends Br{apply(e,t=1){return de(()=>J(Oh(J(e,t)),e))}}GF.className="swish";Te(GF);function kl(n){return n.getClassName()}function Zw(n,e={}){return Vp(n,fi.getMap().classNameMap,e,"activation")}function Tl(n){if(n==null){const e={};return e.className="linear",e.config={},Zw(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Zw(e)}else return n instanceof Br?n:Zw(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cZ(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class jF extends Vh{}class HF extends jF{constructor(e){super(),cZ(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return de(()=>{let t=cr([1]);return this.hasL1&&(t=Ne(t,nt(J(this.l1,Qr(e))))),this.hasL2&&(t=Ne(t,nt(J(this.l2,Bp(e))))),ie(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}HF.className="L1L2";Te(HF);const nN={l1l2:"L1L2"};function un(n){return vS(n)}function rN(n,e={}){return Vp(n,fi.getMap().classNameMap,e,"regularizer")}function Sn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in nN?nN[n]:n,config:{}};return rN(t)}else return n instanceof jF?n:rN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qF extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=ct(e);let r=Yu(e);return this.maxValue!=null&&(r=Ys(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}qF.className="ReLU";Te(qF);class KF extends St{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=ct(e);return SC(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}KF.className="LeakyReLU";Te(KF);class XF extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Cn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Sn(e.alphaRegularizer),this.alphaConstraint=nr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new Y(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ut(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new er({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=ct(e),NC(e,this.alpha.read())}getConfig(){const e={alphaInitializer:_n(this.alphaInitializer),alphaRegularizer:un(this.alphaRegularizer),alphaConstraint:tr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}XF.className="PReLU";Te(XF);let YF=class extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new wt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=ct(e);return kv(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};YF.className="ELU";Te(YF);class QF extends St{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=ct(e);return J(r,ze(Qs(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}QF.className="ThresholdedReLU";Te(QF);class JF extends St{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new $S().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return de(()=>{let r=ct(e);const s=t.mask;if(s!=null){const i=J(ut(Ll(r.shape),ze(s,r.dtype)),Yt(-1e9));r=Ne(r,i)}return this.axis instanceof Array?this.axis.length>1?Oo(ut(r,VD(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}JF.className="Softmax";Te(JF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sh(n,e,t){if(typeof n=="number")return Vu(n,e);if(n.length!==e)throw new Y(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!UQ(s))throw new Y(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function Ki(n,e,t,r,s=1){if(n==null)return n;const i=e+(e-1)*(s-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function wo(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+El([t-e,0]);else if(r==="same")n=n*e;else throw new Y(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DS(n,e){return de(()=>(Bn(e),e==="channelsFirst"?Ot(n,[0,2,3,1]):n))}function ZF(n,e){return de(()=>(Bn(e),e==="channelsFirst"?Ot(n,[0,2,3,4,1]):n))}function hZ(n,e,t,r=1,s="valid",i,o=1){return de(()=>{if(i==null&&(i=Ji()),Bn(i),n.shape.length!==3)throw new Y(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new Y(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new Y(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=Ot(n,[0,2,1])),s==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=_D(n,e,r,s==="same"?"same":"valid","NWC",o);return t!=null&&(a=no(a,t)),a})}function sN(n,e,t,r=[1,1],s="valid",i,o,a=null){return de(()=>{if(i==null&&(i=Ji()),Bn(i),n.rank!==3&&n.rank!==4)throw new Y(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new Y(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=DS(n,i);if(s==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=dX({x:l,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=Ot(l,[0,3,1,2])),l})}function dZ(n,e,t,r=[1,1,1],s="valid",i,o){return de(()=>{if(i==null&&(i=Ji()),Bn(i),n.rank!==4&&n.rank!==5)throw new Y(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new Y(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=ZF(n,i);if(s==="causal")throw new wt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=u9(a,e,r,s==="same"?"same":"valid","NDHWC",o),t!=null&&(a=no(a,t)),i==="channelsFirst"&&(a=Ot(a,[0,4,1,2,3])),a})}class Mv extends St{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Mv.verifyArgs(t),this.rank=e,hr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new wt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=sh(t.kernelSize,e,"kernelSize"),this.strides=sh(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Js(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Bn(this.dataFormat),this.activation=Tl(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Cn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=nr(t.biasConstraint),this.biasRegularizer=Sn(t.biasRegularizer),this.activityRegularizer=Sn(t.activityRegularizer),this.dilationRate=sh(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new Y(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new Y(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new Y(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(xo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!xS(e.kernelSize,"number",1,3))throw new Y(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:kl(this.activation),useBias:this.useBias,biasInitializer:_n(this.biasInitializer),biasRegularizer:un(this.biasRegularizer),activityRegularizer:un(this.activityRegularizer),biasConstraint:tr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class zh extends Mv{constructor(e,t){super(e,t),this.kernel=null,zh.verifyArgs(t),this.filters=t.filters,hr(this.filters,"filters"),this.kernelInitializer=Cn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=nr(t.kernelConstraint),this.kernelRegularizer=Sn(t.kernelRegularizer)}build(e){e=Ut(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return de(()=>{e=ct(e);let r;const s=this.bias==null?null:this.bias.read(),i=XP(this.activation.getClassName());if(i!=null&&this.rank===2)r=sN(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=hZ(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=sN(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=dZ(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new wt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=Ut(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<r.length;++i){const o=Ki(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:_n(this.kernelInitializer),kernelRegularizer:un(this.kernelRegularizer),kernelConstraint:tr(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new Y(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class jp extends zh{constructor(e){super(2,e),jp.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xS(e.kernelSize,"number",1,2))throw new Y(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}jp.className="Conv2D";Te(jp);class Hp extends zh{constructor(e){super(3,e),Hp.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new Y(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Hp.className="Conv3D";Te(Hp);class eO extends jp{constructor(e){if(super(e),this.inputSpec=[new er({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new Y(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ut(e),e.length!==4)throw new Y("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new er({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return de(()=>{let r=ct(e);if(r.shape.length!==4)throw new Y(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=s[o],c=s[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],y=wo(l,p,d,this.padding),w=wo(c,g,f,this.padding),x=[i,y,w,this.filters];this.dataFormat!=="channelsLast"&&(r=Ot(r,[0,2,3,1]));let I=RD(r,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=Ot(I,[0,3,1,2])),this.bias!=null&&(I=no(I,this.bias.read(),this.dataFormat)),this.activation!=null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=Ut(e);const t=e.slice();let r,s,i;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3):(r=3,s=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[r]=this.filters,t[s]=wo(t[s],l,o,this.padding),t[i]=wo(t[i],c,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}eO.className="Conv2DTranspose";Te(eO);class tO extends Hp{constructor(e){if(super(e),this.inputSpec=[new er({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new Y(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ut(e),e.length!==5)throw new Y("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new er({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return de(()=>{let r=ct(e);if(r.shape.length!==5)throw new Y(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=s[l],d=s[o],f=s[a],p=this.kernelSize[0],g=this.kernelSize[1],y=this.kernelSize[2],w=this.strides[0],x=this.strides[1],I=this.strides[2],C=wo(c,w,p,this.padding),k=wo(d,x,g,this.padding),E=wo(f,I,y,this.padding),_=[i,C,k,E,this.filters];this.dataFormat!=="channelsLast"&&(r=Ot(r,[0,2,3,4,1]));let L=d9(r,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(L=Ot(L,[0,4,1,2,3])),this.bias!==null&&(L=no(L,this.bias.read(),this.dataFormat)),this.activation!==null&&(L=this.activation.apply(L)),L})}computeOutputShape(e){e=Ut(e);const t=e.slice();let r,s,i,o;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3,o=4):(r=4,s=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[r]=this.filters,t[s]=wo(t[s],d,a,this.padding),t[i]=wo(t[i],f,l,this.padding),t[o]=wo(t[o],p,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}tO.className="Conv3DTranspose";Te(tO);class nO extends zh{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new Y("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new Y("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new Y(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Cn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Sn(t.depthwiseRegularizer),this.depthwiseConstraint=nr(t.depthwiseConstraint),this.pointwiseInitializer=Cn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Sn(t.pointwiseRegularizer),this.pointwiseConstraint=nr(t.pointwiseConstraint)}build(e){if(e=Ut(e),e.length<this.rank+2)throw new Y(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new Y(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new er({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return de(()=>{e=ct(e);let r;if(this.rank===1)throw new wt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ot(e,[0,2,3,1])),r=qD(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=no(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Ot(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=_n(this.depthwiseInitializer),e.pointwiseInitializer=_n(this.pointwiseInitializer),e.depthwiseRegularizer=un(this.depthwiseRegularizer),e.pointwiseRegularizer=un(this.pointwiseRegularizer),e.depthwiseConstraint=tr(this.depthwiseConstraint),e.pointwiseConstraint=tr(this.pointwiseConstraint),e}}nO.className="SeparableConv";class rO extends nO{constructor(e){super(2,e)}}rO.className="SeparableConv2D";Te(rO);class Vv extends zh{constructor(e){super(1,e),Vv.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xS(e.kernelSize,"number",1,1))throw new Y(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Vv.className="Conv1D";Te(Vv);class sO extends St{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return de(()=>{if(e=ct(e),this.dataFormat==="channelsLast"){const r=wg(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return wg(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=wg(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return wg(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}sO.className="Cropping2D";Te(sO);class iO extends St{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,VQ(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return de(()=>{let r=ct(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=Ot(r,[0,2,3,1]);const i=this.size[0]*s[2],o=this.size[1]*s[3],a=this.interpolation==="nearest"?da.resizeNearestNeighbor(r,[i,o]):da.resizeBilinear(r,[i,o]);return Ot(a,[0,3,1,2])}else{const i=this.size[0]*s[1],o=this.size[1]*s[2];return this.interpolation==="nearest"?da.resizeNearestNeighbor(r,[i,o]):da.resizeBilinear(r,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}iO.className="UpSampling2D";Te(iO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fZ(n,e,t=[1,1],r="valid",s,i){return de(()=>{s==null&&(s=Ji()),Bn(s);let o=DS(n,s);if(n.rank!==4)throw new Y(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new Y(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=wC(o,e,t,r==="same"?"same":"valid","NHWC",i),s==="channelsFirst"&&(o=Ot(o,[0,3,1,2])),o})}class oO extends Mv{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Cn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=nr(e.depthwiseConstraint),this.depthwiseRegularizer=Sn(e.depthwiseRegularizer)}build(e){if(e=Ut(e),e.length<4)throw new Y(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new Y(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{e=ct(e);let r=fZ(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=no(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=Ut(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Ki(t,this.kernelSize[0],this.padding,this.strides[0]),o=Ki(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,o]:[e[0],i,o,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=_n(this.depthwiseInitializer),e.depthwiseRegularizer=un(this.depthwiseRegularizer),e.depthwiseConstraint=tr(this.depthwiseRegularizer),e}}oO.className="DepthwiseConv2D";Te(oO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aO(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new Y("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(i){return i==null||Array.isArray(i)?i:[i]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function lO(n,e,t,r=!1,s,i,o=!1,a=!1){return de(()=>{const l=e.shape.length;if(l<3)throw new Y(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Qi(2,l));e=Ot(e,c),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=ze(ze(s,"bool"),"float32"),s.rank===l-1&&(s=hs(s,-1)),s=Ot(s,c)),r&&(e=Lu(e,0),s!=null&&(s=Lu(s,0)));const d=[];let f,p=t;const g=e.shape[0],y=Mu(e);let w;s!=null&&(w=Mu(s));for(let I=0;I<g;++I){const C=y[I],k=de(()=>n(C,p));if(s==null)f=k[0],p=k[1];else{const E=de(()=>{const _=w[I],L=ut(yi(_),_),P=Ne(J(k[0],_),J(p[0],L)),A=p.map(($,D)=>Ne(J(k[1][D],_),J($,L)));return{output:P,newStates:A}});f=E.output,p=E.newStates}a&&d.push(f)}let x;return a&&(x=xa(d,1)),[f,x,p]})}class Vl extends St{constructor(e){super(e);let t;if(e.cell==null)throw new Y("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new OS({cells:e.cell}):t=e.cell,t.stateSize==null)throw new Y("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new er({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Qi(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){rb(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[s].concat(i)}else return s}computeMask(e,t){return de(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(i=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new wt("Constants support is not implemented in RNN yet.");rb(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new er({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Qt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new Y(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new er({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new vo("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>cr([r,s])):this.states_=[cr([r,this.cell.stateSize])];else if(e==null)bt(this.states_),this.keptStates!=null&&(bt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>cr([r,s])):this.states_[0]=cr([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Y(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):bt(this.states_);for(let s=0;s<this.states_.length;++s){const i=e[s],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[r,o];if(!Qt(i.shape,a))throw new Y(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>_o(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=aO(e,r,s,this.numConstants);e=i.inputs,r=i.initialState,s=i.constants;let o=[],a=[];if(r!=null){t.initialState=r,o=o.concat(r),this.stateSpec=[];for(const c of r)this.stateSpec.push(new er({shape:c.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(t.constants=s,o=o.concat(s),this.numConstants=s.length),o[0]instanceof Mo){const c=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(c,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let i=t==null?null:t.initialState;e=ct(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new Y(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},c=lO((y,w)=>{const x=this.cell.call([y].concat(w),a);return[x[0],x.slice(1)]},e,i,this.goBackwards,r,null,this.unroll,this.returnSequences),d=c[0],f=c[1],p=c[2];this.stateful&&this.resetStates(p,s);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return de(()=>{let t=cr(e.shape);return t=nt(t,[1,2]),t=zp(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?tb(t,[1,r]):t):this.cell.stateSize>1?[tb(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Vl.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,i=$o(s,r);return new e(Object.assign(t,{cell:i}))}}Vl.className="RNN";Te(Vl);class zv extends St{}class PS extends zv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,hr(this.units,"units"),this.activation=Tl(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Cn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Cn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Cn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Sn(e.kernelRegularizer),this.recurrentRegularizer=Sn(e.recurrentRegularizer),this.biasRegularizer=Sn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=xh([1,El([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xh([1,El([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ut(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new Y(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>yi(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>yi(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Ao(J(e,o),this.kernel.read()):i=Ao(e,this.kernel.read()),this.bias!=null&&(i=no(i,this.bias.read())),a!=null&&(r=J(r,a));let l=Ne(i,Ao(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:kl(this.activation),useBias:this.useBias,kernelInitializer:_n(this.kernelInitializer),recurrentInitializer:_n(this.recurrentInitializer),biasInitializer:_n(this.biasInitializer),kernelRegularizer:un(this.kernelRegularizer),recurrentRegularizer:un(this.recurrentRegularizer),biasRegularizer:un(this.biasRegularizer),activityRegularizer:un(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}PS.className="SimpleRNNCell";Te(PS);class uO extends Vl{constructor(e){e.cell=new PS(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return new e(t)}}uO.className="SimpleRNN";Te(uO);class FS extends zv{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Y("GRUCell does not support reset_after parameter set to true.");this.units=e.units,hr(this.units,"units"),this.activation=Tl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Tl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Cn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Cn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Cn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Sn(e.kernelRegularizer),this.recurrentRegularizer=Sn(e.recurrentRegularizer),this.biasRegularizer=Sn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=xh([1,El([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xh([1,El([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ut(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new Y(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>yi(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>yi(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=J(e,i[0]));let d=Ao(e,this.kernel.read());this.useBias&&(d=no(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=J(s,o[0]));const f=this.recurrentKernel.read(),[p,g]=Ks(f,[2*this.units,this.units],f.rank-1),y=Ao(s,p),[w,x,I]=Ks(d,3,d.rank-1),[C,k]=Ks(y,2,y.rank-1);a=this.recurrentActivation.apply(Ne(w,C)),l=this.recurrentActivation.apply(Ne(x,k));const E=Ao(J(l,s),g);c=this.activation.apply(Ne(I,E));const _=Ne(J(a,s),J(Ne(1,Mn(a)),c));return[_,_]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:kl(this.activation),recurrentActivation:kl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:_n(this.kernelInitializer),recurrentInitializer:_n(this.recurrentInitializer),biasInitializer:_n(this.biasInitializer),kernelRegularizer:un(this.kernelRegularizer),recurrentRegularizer:un(this.recurrentRegularizer),biasRegularizer:un(this.biasRegularizer),activityRegularizer:un(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}FS.className="GRUCell";Te(FS);class cO extends Vl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new FS(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}cO.className="GRU";Te(cO);class Bv extends zv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,hr(this.units,"units"),this.activation=Tl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Tl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Cn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Cn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Cn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Sn(e.kernelRegularizer),this.recurrentRegularizer=Sn(e.recurrentRegularizer),this.biasRegularizer=Sn(e.biasRegularizer),this.kernelConstraint=nr(e.kernelConstraint),this.recurrentConstraint=nr(e.recurrentConstraint),this.biasConstraint=nr(e.biasConstraint),this.dropout=xh([1,El([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xh([1,El([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ut(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;s=new(t=class extends xi{apply(l,c){const d=i.apply([o]),f=new bS().apply([o]),p=i.apply([o*2]);return BR(BR(d,f),p)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return de(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new Y(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>yi(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>yi(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,d,f;0<this.dropout&&this.dropout<1&&(e=J(e,o[0]));let p=Ao(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=J(s,a[0])),p=Ne(p,Ao(s,this.recurrentKernel.read())),this.useBias&&(p=no(p,this.bias.read()));const[g,y,w,x]=Ks(p,4,p.rank-1);l=this.recurrentActivation.apply(g),c=this.recurrentActivation.apply(y),d=Ne(J(c,i),J(l,this.activation.apply(w))),f=this.recurrentActivation.apply(x);const I=J(f,this.activation.apply(d));return[I,I,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:kl(this.activation),recurrentActivation:kl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:_n(this.kernelInitializer),recurrentInitializer:_n(this.recurrentInitializer),biasInitializer:_n(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:un(this.kernelRegularizer),recurrentRegularizer:un(this.recurrentRegularizer),biasRegularizer:un(this.biasRegularizer),activityRegularizer:un(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),recurrentConstraint:tr(this.recurrentConstraint),biasConstraint:tr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Bv.className="LSTMCell";Te(Bv);class hO extends Vl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Bv(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}hO.className="LSTM";Te(hO);class OS extends zv{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return de(()=>{e=e;let r=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(r.splice(0,a.stateSize.length)):s.push(r.splice(0,1));s.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=s[a],a===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=l.call(o,t),i.push(o.slice(1))}r=[];for(const a of i.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(e){rb(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{Cu(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,r={}){const s=[];for(const i of t.cells)s.push($o(i,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return sb(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,i=e.splice(s);for(let o=0;o<r.weights.length;++o)t.push([r.weights[o],i[o]])}_S(t)}}OS.className="StackedRNNCells";Te(OS);function _l(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):nF(e(),t),a=()=>Up(o,e,r);return!s||s<=1?_o(a().clone()):Array(s).fill(void 0).map(a).map(c=>_o(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var pZ=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class dO extends Vl{constructor(e){if(e.unroll)throw new wt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new wt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new er({ndim:5})]}call(e,t){return de(()=>{if(this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Y("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return de(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)],o=cr(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new vo("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)];if(r[0]==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>cr(i)):this.states_=[cr(i)];else if(e==null)bt(this.states_),this.keptStates!=null&&(bt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>cr(i)):this.states_[0]=cr(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Y(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):bt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=i;if(!Qt(l.shape,c))throw new Y(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>_o(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",c=e[l?3:2],d=e[l?4:3],f=Ki(c,s[0],i,o[0],a[0]),p=Ki(d,s[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[r,f,p]:[f,p,r]]}}dO.className="ConvRNN2D";class LS extends Bv{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,hr(this.filters,"filters"),this.kernelSize=sh(r,2,"kernelSize"),this.kernelSize.forEach(l=>hr(l,"kernelSize")),this.strides=sh(s||1,2,"strides"),this.strides.forEach(l=>hr(l,"strides")),this.padding=i||"valid",Js(this.padding),this.dataFormat=o||"channelsLast",Bn(this.dataFormat),this.dilationRate=sh(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>hr(l,"dilationRate"))}build(e){var t;e=Ut(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new Y(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],i=4,o=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,d=this.filters;l=new(t=class extends xi{apply(p,g){const y=c.apply([d]),w=Ll([d]),x=c.apply([d*2]);return wS([y,w,x])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return de(()=>{if(e.length!==3)throw new Y(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>yi(s),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(ee,U,H)=>!U||!U[H]?ee:J(U[H],ee);let d=c(s,l,0),f=c(s,l,1),p=c(s,l,2),g=c(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>yi(i),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const y=this.recurrentDropoutMask;let w=c(i,y,0),x=c(i,y,1),I=c(i,y,2),C=c(i,y,3);const k=3,[E,_,L,P]=Ks(this.kernel.read(),a,k),[A,$,D,R]=this.useBias?Ks(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,E,A,this.padding),f=this.inputConv(f,_,$,this.padding),p=this.inputConv(p,L,D,this.padding),g=this.inputConv(g,P,R,this.padding);const[M,O,Z,q]=Ks(this.recurrentKernel.read(),a,k);w=this.recurrentConv(w,M),x=this.recurrentConv(x,O),I=this.recurrentConv(I,Z),C=this.recurrentConv(C,q);const se=this.recurrentActivation.apply(Ne(d,w)),le=this.recurrentActivation.apply(Ne(f,x)),j=Ne(J(le,o),J(se,this.activation.apply(Ne(p,I)))),Q=J(this.recurrentActivation.apply(Ne(g,C)),this.activation.apply(j));return[Q,Q,j]})}getConfig(){const e=super.getConfig(),t=pZ(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}inputConv(e,t,r,s){const i=Fu(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?no(i,r,this.dataFormat):i}recurrentConv(e,t){return Fu(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}LS.className="ConvLSTM2DCell";Te(LS);class fO extends dO{constructor(e){const t=new LS(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}fO.className="ConvLSTM2D";Te(fO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class MS extends St{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,i=this.getNoiseShape(r);return Up(()=>nF(r,this.rate,i,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}MS.className="Dropout";Te(MS);class pO extends MS{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}pO.className="SpatialDropout1D";Te(pO);class mO extends St{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,hr(this.units,"units"),this.activation=Tl(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Cn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Cn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=nr(e.kernelConstraint),this.biasConstraint=nr(e.biasConstraint),this.kernelRegularizer=Sn(e.kernelRegularizer),this.biasRegularizer=Sn(e.biasRegularizer),this.activityRegularizer=Sn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ut(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ut(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e),s=XP(this.activation.getClassName());let i;return s!=null?i=Ao(r,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Ao(r,this.kernel.read()),this.bias!=null&&(i=no(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:kl(this.activation),useBias:this.useBias,kernelInitializer:_n(this.kernelInitializer),biasInitializer:_n(this.biasInitializer),kernelRegularizer:un(this.kernelRegularizer),biasRegularizer:un(this.biasRegularizer),activityRegularizer:un(this.activityRegularizer),kernelConstraint:tr(this.kernelConstraint),biasConstraint:tr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}mO.className="Dense";Te(mO);class gO extends St{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ut(e);for(const t of e.slice(1))if(t==null)throw new Y(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],gl(e,1)]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let r=ct(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let i=2;i<r.rank;++i)s.push(i);s.push(1),r=Ot(r,s)}return jQ(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}gO.className="Flatten";Te(gO);class yO extends St{constructor(e){super(e),this.supportsMasking=!0,this.activation=Tl(e.activation)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e);return this.activation.apply(r)})}getConfig(){const e={activation:kl(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}yO.className="Activation";Te(yO);class vO extends St{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return de(()=>(e=ct(e),WQ(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}vO.className="RepeatVector";Te(vO);class xO extends St{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let i=1,o=null;for(let l=0;l<s.length;++l){const c=s[l];if(this.isUnknown(c))if(o===null)o=l;else throw new Y("Can only specifiy one unknown dimension.");else i*=c}const a=gl(e);if(o!==null){if(i===0||a%i!==0)throw new Y(r);s[o]=a/i}else if(a!==i)throw new Y(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e),s=r.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return ie(r,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}xO.className="Reshape";Te(xO);class wO extends St{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Qi(1,e.dims.length+1);if(!Qt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new er({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ut(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return Ot(ct(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}wO.className="Permute";Te(wO);class bO extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=ct(e);return K1(Ty(r,this.maskValue),-1)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e),o=K1(Ty(r,this.maskValue),-1,!0);return J(r,ze(o,r.dtype))})}}bO.className="Masking";Te(bO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class IO extends St{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(rn(e.inputLength))}this.inputDim=e.inputDim,hr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,hr(this.outputDim,"outputDim"),this.embeddingsInitializer=Cn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Sn(e.embeddingsRegularizer),this.activityRegularizer=Sn(e.activityRegularizer),this.embeddingsConstraint=nr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return de(()=>this.maskZero?(e=ct(e),Ty(e,Lt(e))):null)}computeOutputShape(e){if(e=Ut(e),this.inputLength==null)return[...e,this.outputDim];const t=rn(this.inputLength);if(t.length!==e.length-1)throw new Y(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const i=t[s],o=e[s+1];if(i!=null&&o!=null&&i!==o)throw new Y(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[r]=o),r++}}return[e[0],...t,this.outputDim]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let r=ct(e);r.dtype!=="int32"&&(r=No(r,"int32"));const s=tF(this.embeddings.read(),ie(r,[r.size]));return ie(s,Ut(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:_n(this.embeddingsInitializer),embeddingsRegularizer:un(this.embeddingsRegularizer),activityRegularizer:un(this.activityRegularizer),embeddingsConstraint:tr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}IO.className="Embedding";Te(IO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zu extends St{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new wt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const i=e[e.length-t.length+s],o=t[s];if(i==null||o==null||i<0||o<0)r.push(null);else if(i===1)r.push(o);else if(o===1)r.push(i);else{if(i!==o)throw new Y("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(i)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ut(e)]),e=e,e.length<2)throw new Y(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=ml(t),t.length>1)throw new Y(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const s=e.map(i=>i.length);e.indexOf(null)===-1&&ml(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return de(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(i=>i.rank);if(s.indexOf(null)===-1){const i=El(s);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=zp(o,1);r.push(o)}return this.mergeFunction(r)}else{let i=!1;for(const l of e){const c=l.rank;if(c==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=ie(l,[f].concat(gl(d.slice(1))));g=Ot(g,[1,0]),g=ie(g,p),r.push(g),i=!0}else if(c>1){const d=Qi(1,c).concat([0]);r.push(Ot(l,d)),i=!0}else r.push(l)}let o=this.mergeFunction(r);const a=o.rank;if(i){if(a==null){const l=o.shape,c=l.length,d=l[c-1],f=[d].concat(l.slice(0,l.length-1));o=ie(Ot(ie(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(Qi(0,a-1));o=Ot(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=ml(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return de(()=>{if(t==null)return null;if(!Array.isArray(t))throw new Y("`mask` should be an Array");if(!Array.isArray(e))throw new Y("`inputs` should be an Array");if(t.length!==e.length)throw new Y(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:hs(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=va(r,t[s]);return r})}}class CO extends Zu{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Ne(t,e[r]);return t})}}CO.className="Add";Te(CO);class SO extends Zu{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=J(t,e[r]);return t})}}SO.className="Multiply";Te(SO);class EO extends Zu{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Ne(t,e[r]);return J(1/e.length,t)})}}EO.className="Average";Te(EO);class kO extends Zu{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Ol(t,e[r]);return t})}}kO.className="Maximum";Te(kO);class TO extends Zu{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=df(t,e[r]);return t})}}TO.className="Minimum";Te(TO);class _O extends Zu{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new Y("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const i=e[s].slice();i.splice(this.axis,1);let o=!1;for(const a of r)if(Qt(a,i)){o=!0;break}o||r.push(i)}if(r.length>1)throw new Y("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return de(()=>wS(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new Y("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const i of t.slice(1)){if(r[s]==null||i[s]==null){r[s]=null;break}r[s]+=i[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new Y("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Y("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Y(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return de(()=>{let r=!0;if(t.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const s=[];for(let o=0;o<e.length;++o)t[o]==null?s.push(ze(yi(e[o]),"bool")):t[o].rank<e[o].rank?s.push(hs(t[o],-1)):s.push(t[o]);const i=fs(s,this.axis);return TD(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}_O.className="Concatenate";Te(_O);function Pd(n,e){for(;n<0;)n+=e;return n}function mZ(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new wt("batchDot is not implemented for tensors of 4D or higher rank yet");if(z(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),z(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new wt("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const i=t;return de(()=>{let o;if(r>s){o=r-s;const l=[];for(let c=0;c<o;++c)l.push(1);e=ie(e,e.shape.concat(l))}else if(s>r){o=s-r;const l=[];for(let c=0;c<o;++c)l.push(1);n=ie(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=nt(J(n,e),i[0]):a=nt(J(Ot(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,c=i[1]===e.shape.length-1;a=Xt(n,e,l,c)}if(o>0){let l;r>s?l=r+s-3:l=r-1;const c=[];for(let d=l;d<l+o;++d)c.push(d);a=Pp(a,c)}return a.shape.length===1&&(a=hs(a,1)),a})}class RO extends Zu{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){z(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new Y(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new Y(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,o)=>Pd(i,e[o].shape.length)):s=[Pd(this.axes,t.shape.length),Pd(this.axes,r.shape.length)],this.normalize&&(t=Py(t,s[0]),r=Py(r,s[1])),mZ(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Pd(this.axes,e.length),Pd(this.axes,t.length)],r}computeOutputShape(e){z(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const i=t.concat(r);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}RO.className="Dot";Te(RO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NO extends St{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e);return Up(()=>Ne(Pv(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}NO.className="GaussianNoise";Te(NO);class AO extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const r=ct(e);return this.rate>0&&this.rate<1?Up(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return J(r,Pv(r.shape,1,i))},()=>r,t.training||!1):r})}}AO.className="GaussianDropout";Te(AO);class $O extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||ct(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Up(()=>{const i=ct(e),l=-1.6732632423543772*1.0507009873554805;let c=Xu(Dp(r),this.rate);c=No(c,"float32");const d=((1-this.rate)*(1+this.rate*l**2))**-.5,f=-d*l*this.rate,p=Ne(J(i,c),J(Ne(c,-1),l));return Ne(J(p,d),f)},()=>ct(e),t.training||!1)}return e})}}$O.className="AlphaDropout";Te($O);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yf(n,e,t,r,s,i=.001){let o;if(n.rank===2)o=Vq(n,e,t,r,s,i);else if(n.rank===3)o=Bq(n,e,t,r,s,i);else if(n.rank===4)o=Wq(n,e,t,r,s,i);else throw new wt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function gZ(n,e,t,r,s=.001){return de(()=>{const i=TC(n,r),o=i.mean,a=i.variance;return[yf(n,o,a,t,e,s),o,a]})}function yZ(n,e,t,r,s=.001){return de(()=>{const i=TC(n,r),o=i.mean,a=i.variance,l=[];for(const y of Qi(0,n.rank))r.indexOf(y)!==-1?l.push(1):l.push(n.shape[y]);const c=ie(o,l),d=ie(a,l),f=e==null?null:ie(e,l),p=t==null?null:ie(t,l);return[yf(n,c,d,p,f,s),o,a]})}function vZ(n,e,t,r,s=.001){return Qt(r.slice().sort(),Qi(0,n.rank-1))?gZ(n,e,t,r,s):yZ(n,e,t,r,s)}class DO extends St{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Cn(e.betaInitializer||"zeros"),this.gammaInitializer=Cn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Cn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Cn(e.movingVarianceInitializer||"ones"),this.betaConstraint=nr(e.betaConstraint),this.gammaConstraint=nr(e.gammaConstraint),this.betaRegularizer=Sn(e.betaRegularizer),this.gammaRegularizer=Sn(e.gammaRegularizer)}build(e){e=Ut(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new Y(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new er({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return de(()=>{const r=t.training==null?!1:t.training,s=ct(e),i=s.shape,o=i.length,a=Qi(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Vu(1,o);c[l]=i[l];const d=a.slice();d.sort();const f=!Qt(d,Qi(0,o).slice(0,o-1)),p=()=>{if(f){const C=ie(this.movingMean.read(),c),k=ie(this.movingVariance.read(),c),E=this.center?ie(this.beta.read(),c):null,_=this.scale?ie(this.gamma.read(),c):null;return yf(s,C,k,E,_,this.epsilon)}else return yf(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return p();const[g,y,w]=vZ(s,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(C,k,E)=>{de(()=>{const _=1-E,L=C.read(),P=J(ut(L,k),_);C.write(ut(L,P))})};return(()=>{x(this.movingMean,y,this.momentum),x(this.movingVariance,w,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:_n(this.betaInitializer),gammaInitializer:_n(this.gammaInitializer),movingMeanInitializer:_n(this.movingMeanInitializer),movingVarianceInitializer:_n(this.movingVarianceInitializer),betaRegularizer:un(this.betaRegularizer),gammaRegularizer:un(this.gammaRegularizer),betaConstraint:tr(this.betaConstraint),gammaConstraint:tr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}DO.className="BatchNormalization";Te(DO);class PO extends St{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Cn(e.betaInitializer||"zeros"),this.gammaInitializer=Cn(e.gammaInitializer||"ones"),this.betaRegularizer=Sn(e.betaRegularizer),this.gammaRegularizer=Sn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ut(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==ml(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=ct(e),s=r.shape,i=s.length;return de(()=>{let{mean:a,variance:l}=TC(r,this.axis,!0);const c=Vu(1,i);for(const w of this.axis)c[w]=s[w];const d=w=>w!=null&&w.shape.length!==i?ie(w,c):w;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],y=[];for(let w=0;w<i;++w)this.axis.indexOf(w)!==-1?(g.push(s[w]),y.push(1)):(g.push(1),y.push(s[w]));return a=Gi(a,g),l=Gi(l,g),f!=null&&(f=Gi(f,y)),p!=null&&(p=Gi(p,y)),yf(r,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:_n(this.betaInitializer),gammaInitializer:_n(this.gammaInitializer),betaRegularizer:un(this.betaRegularizer),gammaRegularizer:un(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}PO.className="LayerNormalization";Te(PO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xZ(n,e,t){return de(()=>{if(n.rank!==4)throw new Y(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Y("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ji()),t!=="channelsLast"&&t!=="channelsFirst")throw new Y(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],_C(n,r)})}class FO extends St{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ji():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new Y(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new Y(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new Y(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){e=Ut(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return de(()=>xZ(ct(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}FO.className="ZeroPadding2D";Te(FO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uv(n,e,t,r,s,i){return de(()=>{Bn(s),QP(i),Js(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=Ji()),i==null&&(i="max"),n=DS(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=kC(n,e,t,a):o=gC(n,e,t,a),s==="channelsFirst"&&(o=Ot(o,[0,3,1,2])),o})}function OO(n,e,t,r,s,i){return de(()=>{Bn(s),QP(i),Js(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Ji()),i==null&&(i="max"),n=ZF(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=TK(n,e,t,a):o=Rq(n,e,t,a),s==="channelsFirst"&&(o=Ot(o,[0,4,1,2,3])),o})}class LO extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new Y(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(hr(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new Y(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Js(this.padding),this.inputSpec=[new er({ndim:3})]}computeOutputShape(e){e=Ut(e);const t=Ki(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return de(()=>{this.invokeCallHook(e,t),e=zp(ct(e),2);const r=this.poolingFunction(ct(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Pp(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class MO extends LO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),Uv(e,t,r,s,i,"max")}}MO.className="MaxPooling1D";Te(MO);class VO extends LO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),Uv(e,t,r,s,i,"avg")}}VO.className="AveragePooling1D";Te(VO);class zO extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new Y(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];hr(this.poolSize,"poolSize"),hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bn(this.dataFormat),Js(this.padding),this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){e=Ut(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Ki(t,this.poolSize[0],this.padding,this.strides[0]),r=Ki(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(ct(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class BO extends zO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),Uv(e,t,r,s,i,"max")}}BO.className="MaxPooling2D";Te(BO);class UO extends zO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),Uv(e,t,r,s,i,"avg")}}UO.className="AveragePooling2D";Te(UO);class WO extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new Y(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];hr(this.poolSize,"poolSize"),hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bn(this.dataFormat),Js(this.padding),this.inputSpec=[new er({ndim:5})]}computeOutputShape(e){e=Ut(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Ki(t,this.poolSize[0],this.padding,this.strides[0]),r=Ki(r,this.poolSize[1],this.padding,this.strides[1]),s=Ki(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(ct(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class GO extends WO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),OO(e,t,r,s,i,"max")}}GO.className="MaxPooling3D";Te(GO);class jO extends WO{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Bn(i),Js(s),OO(e,t,r,s,i,"avg")}}jO.className="AveragePooling3D";Te(jO);class HO extends St{constructor(e){super(e),this.inputSpec=[new er({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new wt}}class qO extends HO{constructor(e){super(e||{})}call(e,t){return de(()=>{const r=ct(e);return Hn(r,1)})}}qO.className="GlobalAveragePooling1D";Te(qO);class KO extends HO{constructor(e){super(e||{})}call(e,t){return de(()=>{const r=ct(e);return qi(r,1)})}}KO.className="GlobalMaxPooling1D";Te(KO);class XO extends St{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bn(this.dataFormat),this.inputSpec=[new er({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new wt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class YO extends XO{call(e,t){return de(()=>{const r=ct(e);return this.dataFormat==="channelsLast"?Hn(r,[1,2]):Hn(r,[2,3])})}}YO.className="GlobalAveragePooling2D";Te(YO);class QO extends XO{call(e,t){return de(()=>{const r=ct(e);return this.dataFormat==="channelsLast"?qi(r,[1,2]):qi(r,[2,3])})}}QO.className="GlobalMaxPooling2D";Te(QO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JO extends St{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,i=$o(s,r);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class ZO extends JO{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ut(e),e.length<3)throw new Y(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ut(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return de(()=>(e=ct(e),lO((o,a)=>[ct(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}ZO.className="TimeDistributed";Te(ZO);function wZ(n){Ju(MQ,"BidirectionalMergeMode",n)}const bZ="concat";class eL extends JO{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=$o(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=$o(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?bZ:e.mergeMode,wZ(this.mergeMode),e.weights)throw new wt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,i;return this.returnState&&(i=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[r].concat(i).concat(i.slice()):ds(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=aO(e,r,s,this.numConstants);if(e=i.inputs,r=i.initialState,s=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const o=[],a=[];if(r!=null){const c=r.length;if(c%2>0)throw new Y("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push(...r);const d=r.map(f=>new er({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,c/2),this.backwardLayer.stateSpec=d.slice(c/2),a.push(...d)}if(s!=null)throw new wt("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Mo;for(const c of o)if(c instanceof Mo!==l)throw new Y("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(c,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const r=t.initialState;let s,i;if(r==null)s=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=r.slice(0,r.length/2),c=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let o;this.returnState&&(Array.isArray(s)&&(o=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Lu(i,1));let a;return this.mergeMode==="concat"?a=wS([s,i]):this.mergeMode==="sum"?a=Ne(s,i):this.mergeMode==="ave"?a=J(.5,Ne(s,i)):this.mergeMode==="mul"?a=J(s,i):this.mergeMode==null&&(a=[s,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Cu(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Cu(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(i).concat(i):[r].concat(i).concat(i)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=$o(t.layer);if(delete t.layer,t.numConstants!=null)throw new wt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}eL.className="Bidirectional";Te(eL);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tL extends St{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>(e=ct(e),e.dtype!=="float32"&&(e=No(e,"float32")),Ne(J(e,this.scale),this.offset)))}}tL.className="Rescaling";Te(tL);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:IZ,cropAndResize:CZ}=da;class nL extends St{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,i,o,a,l){return de(()=>{let c,d=!1;const f=t/o,p=r/a,g=(s+t)/o,y=(i+r)/a,w=[f,p,g,y],x=[];e.rank===3?(d=!0,c=xa([e])):c=e;for(let _=0;_<c.shape[0];_++)x.push(w);const I=th(x,[x.length,4]),C=ff(0,x.length,1,"int32"),E=CZ(c,I,C,[s,i],"nearest");return No(d?ct(Mu(E)):E,l)})}upsize(e,t,r,s){return de(()=>{const i=IZ(e,[t,r]);return No(i,s)})}call(e,t){return de(()=>{const r=ct(e),s=r.dtype,i=r.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(r,l,c,this.height,this.width,o,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ut(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}nL.className="CenterCrop";Te(nL);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function SZ(n,e,t,r){let s=ct(n);if(s.dtype!=="int32"&&(s=No(s,"int32")),e==="int")return s;const i=s.shape;if(s.rank===0&&(s=hs(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=hs(s,-1)),s.rank>2)throw new Y(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${s.rank}.`);const o=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof r<"u"&&e==="count"?l=gR(a,r,t,o):l=gR(a,[],t,o),e!=="tfIdf")return l;if(r)return J(l,r);throw new Y("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rL extends St{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Ut(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return de(()=>{e=ct(e),e.dtype!=="int32"&&(e=No(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new Y(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=ct(t.countWeights)}const s=qi(e),i=Ey(e),o=Qs(this.numTokens,s).bufferSync().get(0),a=Xu(i,0).bufferSync().get(0);if(!(o&&a))throw new Y(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return SZ(e,this.outputMode,this.numTokens,r)})}}rL.className="CategoryEncoding";Te(rL);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const EZ=["bilinear","nearest"],iN=new Set(EZ);class sL extends St{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(iN.has(e.interpolation))this.interpolation=e.interpolation;else throw new Y(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ut(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return da.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return da.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...iN]} are supported`)})}}sL.className="Resizing";Te(sL);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iL{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}iL.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oL extends St{constructor(e){super(e),this.randomGenerator=new iL(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}oL.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kZ=["bilinear","nearest"],oN=new Set(kZ);class aL extends oL{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new Y(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new Y(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new Y(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(oN.has(r))this.interpolation=r;else throw new Y(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ut(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return de(()=>{const r=ct(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=Dp([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return da.resizeBilinear(e,o);case"nearest":return da.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...oN]} are supported`)}})}}aL.className="RandomWidth";Te(aL);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ=pe();TZ.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var aN;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(aN||(aN={}));var lN;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(lN||(lN={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var uN;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(uN||(uN={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&z(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Z=tP;class Wv extends xI{nextDataId(){return Wv.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new T$(this,go())}write(e,t,r){this.firstUse&&(this.firstUse=!1,pe().get("IS_NODE")&&Hs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Ff(r[0])){const i=r.map(o=>pl(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,i){this.data.set(e,{values:t,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return wa(s,i)}return D6(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Sl(s));return It(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return It(e.shape,e.dtype,t)}makeOutput(e,t,r){return go().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=cs();return e(),{kernelMs:cs()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ye([e],"where");const t=this.readSync(e.dataId);return _Z(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Wv.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const RZ=n=>{const{x:e}=n.inputs,t=n.backend;Ye(e,"abs");let r=new Float32Array(xe(e.shape));const s=t.data.get(e.dataId).values;return r=lL(s),t.makeOutput(r,e.shape,e.dtype)},NZ={kernelName:w0,backendName:"cpu",kernelFunc:RZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n){return(e,t,r,s,i)=>{const o=yt(e,t),a=o.length,l=tt(o),c=xe(o),d=Lr(i,c),f=e.length,p=t.length,g=tt(e),y=tt(t),w=yh(e,o),x=yh(t,o);if(w.length+x.length===0)for(let I=0;I<d.length;++I)d[I]=n(r[I%r.length],s[I%s.length]);else for(let I=0;I<d.length;++I){const C=Ph(I,a,l),k=C.slice(-f);w.forEach(P=>k[P]=0);const E=To(k,f,g),_=C.slice(-p);x.forEach(P=>_[P]=0);const L=To(_,p,y);d[I]=n(r[E],s[L])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ns(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=t.makeTensorInfo(r.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(s.shape,"float32",o)},a}const AZ={kernelName:$I,backendName:"cpu",kernelFunc:Ns};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zy(n,e,t="float32"){if(t==="complex64"){const s=zy(n,e,"float32"),i=zy(n,e,"float32");return Ns({inputs:{real:s,imag:i},backend:n})}const r=Mr(xe(e),t);return n.makeTensorInfo(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vo(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const $Z={kernelName:np,backendName:"cpu",kernelFunc:Vo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zu(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const DZ={kernelName:nC,backendName:"cpu",kernelFunc:zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=Ku([0],t),[i,o]=Un((a,l)=>a!==l?1:0)(e,[],n,s,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function Rl(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return Vo({inputs:{x:s},backend:t});const d=zy(t,s.shape,s.dtype),f=Rl({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),p=Ns({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(s.dtype==="complex64"){const d=zu({inputs:{input:s},backend:t}),f=Rl({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!N$(s.dtype,i)){const d=Vo({inputs:{x:s},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(s.dataId).values,[a,l,c]=uL(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,c)}const PZ={kernelName:Wf,backendName:"cpu",kernelFunc:Rl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sr(n,e,t,r){return t==null?({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;Ye([o,a],n);const c=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?ba(c):c,p=o.dtype==="string"?ba(d):d,g=r||o.dtype,[y,w]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(w,g,y)}:({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=Rl({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(c.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,y=l.data.get(p.dataId).values,w=Rl({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(w.dataId),I=x.complexTensorInfos.real,C=x.complexTensorInfos.imag,k=l.data.get(I.dataId).values,E=l.data.get(C.dataId).values,[_,L,P]=t(o.shape,a.shape,g,y,k,E),A=l.makeTensorInfo(P,"float32",_),$=l.makeTensorInfo(P,"float32",L),D=Ns({inputs:{real:A,imag:$},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(A),l.disposeIntermediateTensorInfo($),D}else{const c=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=r||o.dtype,[p,g]=e(o.shape,a.shape,c,d,f);return l.makeTensorInfo(g,f,p)}}}function VS(n){return(e,t,r,s,i,o)=>{const a=yt(e,t),l=xe(a),c=a.length,d=tt(a),f=Lr("float32",l),p=Lr("float32",l),g=yh(e,a),y=yh(t,a),w=wa(r,s),x=wa(i,o),I=e.length,C=tt(e),k=t.length,E=tt(t);if(g.length+y.length===0)for(let _=0;_<f.length;_++){const L=_%w.length,P=_%x.length,A=n(w[L*2],w[L*2+1],x[P*2],x[P*2+1]);f[_]=A.real,p[_]=A.imag}else for(let _=0;_<f.length;_++){const L=Ph(_,c,d),P=L.slice(-I);g.forEach(M=>P[M]=0);const A=To(P,I,C),$=L.slice(-k);y.forEach(M=>$[M]=0);const D=To($,k,E),R=n(w[A*2],w[A*2+1],x[D*2],x[D*2+1]);f[_]=R.real,p[_]=R.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cL=Un((n,e)=>n+e),FZ=VS((n,e,t,r)=>({real:n+t,imag:e+r})),wh=sr(Fh,cL,FZ),OZ={kernelName:Fh,backendName:"cpu",kernelFunc:wh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zS(n,e,t,r,s){const i=xe(r),o=Mr(s,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function hL(n,e,t,r=!1){const s=n.shape[0],i=n.shape[1],o=It([s,t],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL=Un((n,e)=>n&e),LZ=sr(AI,dL),MZ={kernelName:AI,backendName:"cpu",kernelFunc:LZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zo(n){return(e,t,r)=>{const s=Ln(t,e.length);for(let i=0;i<e.length;++i)s[i]=n(e[i],r);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(n,e,t){const r=zo(e);return zl(n,r,t)}function zl(n,e,t){return({inputs:r,attrs:s,backend:i})=>{const{x:o}=r;Ye(o,n);const a=i,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=ba(l)}else c=l;const d=t||o.dtype,f=e(c,d,s);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fL=zo(n=>Math.ceil(n)),VZ=zl(Gf,fL),zZ={kernelName:Gf,backendName:"cpu",kernelFunc:VZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(n,e,t,r){const s=Ln(t,xe(e));if(r&&t!=="string"){let i=0;n.forEach(o=>{const a=xe(o.shape);s.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?ba(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const d=c*e[1]+i;for(let f=0;f<o.shape[1];++f)s[d+f]=a[l++]}i+=o.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mL=Un((n,e)=>n===e?1:0),gL=sr(F0,mL,null,"bool"),BZ={kernelName:F0,backendName:"cpu",kernelFunc:gL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yL=zo(n=>Math.exp(n)),vL=zl(Qf,yL,"float32"),UZ={kernelName:Qf,backendName:"cpu",kernelFunc:vL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xL=zo(n=>Math.expm1(n)),WZ=zl(Jf,xL),GZ={kernelName:Jf,backendName:"cpu",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL=zo(n=>Math.floor(n)),jZ=zl(Zf,wL),HZ={kernelName:Zf,backendName:"cpu",kernelFunc:jZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bL=Un((n,e)=>Math.floor(n/e)),qZ=sr(ep,bL,null,"int32"),KZ={kernelName:ep,backendName:"cpu",kernelFunc:qZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IL(n,e,t,r,s,i,o,a,l){const c=It([r,i],t);for(let d=0;d<r;d++){const f=[];let p=0;for(let g=0;g<s;g++){const y=n[d*s+g];p+=y*o[g],f.push(y)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)c.values[d*i+g]=e.get(...e.indexToLoc(p*i+g))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(n,e,t){const r=It(t,n.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(r.values[s]=n.values[d])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SL=Un((n,e)=>n>e?1:0),XZ=sr(V0,SL,null,"bool"),YZ={kernelName:V0,backendName:"cpu",kernelFunc:XZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EL=Un((n,e)=>n>=e?1:0),QZ=sr(tp,EL,null,"bool"),JZ={kernelName:tp,backendName:"cpu",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=Un((n,e)=>n<e?1:0),ZZ=sr(B0,kL,null,"bool"),eee={kernelName:B0,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=Un((n,e)=>n<=e?1:0),tee=sr(U0,TL,null,"bool"),nee={kernelName:U0,backendName:"cpu",kernelFunc:tee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(n,e,t){const r=(e-n)/(t-1),s=Mr(t,"float32");s[0]=n;for(let i=1;i<s.length;i++)s[i]=s[i-1]+r;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL=zo(n=>Math.log(n)),ree=zl(op,RL),see={kernelName:op,backendName:"cpu",kernelFunc:ree};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(n,e,t,r){const s=Lr(r,xe(t));for(let i=0;i<s.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const c=n[o+l];(Number.isNaN(c)||c>a)&&(a=c)}s[i]=a}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AL=Un((n,e)=>Math.max(n,e)),iee=sr(lp,AL),oee={kernelName:lp,backendName:"cpu",kernelFunc:iee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $L=Un((n,e)=>Math.min(n,e)),aee=sr(up,$L),lee={kernelName:up,backendName:"cpu",kernelFunc:aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS=Un((n,e)=>n*e),uee=VS((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t})),Gv=sr(hp,BS,uee),cee={kernelName:hp,backendName:"cpu",kernelFunc:Gv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(n,e,t){const r=$l(-1,t);return BS([],e,r,n,t)}function hee(n){const{inputs:e,backend:t}=n,{x:r}=e;Ye(r,"neg");const s=t.data.get(r.dataId).values,[i,o]=DL(s,r.shape,r.dtype);return t.makeTensorInfo(o,r.dtype,i)}const dee={kernelName:Z0,backendName:"cpu",kernelFunc:hee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL=Un((n,e)=>n!==e?1:0),fee=sr(ev,PL,null,"bool"),pee={kernelName:ev,backendName:"cpu",kernelFunc:fee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(n,e,t,r,s){const i=e.length,o=xe(e),a=tt(e),l=tt(s),c=Lr(t,xe(s));for(let d=0;d<o;++d){const f=Ph(d,i,a),p=new Array(f.length);for(let y=0;y<p.length;y++)p[y]=f[r[y]];const g=To(p,i,l);c[g]=n[d]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ms(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:i}=t;Ye(s,"transpose");const o=s.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=s.shape[i[f]];const l=r.data.get(s.dataId).values,c=US(l,s.shape,s.dtype,i,a);return{dataId:r.write(c,a,s.dtype),shape:a,dtype:s.dtype}}const mee={kernelName:eh,backendName:"cpu",kernelFunc:ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(n,e,t,r){const[s,i]=pr(n,r),o=Ds(e,"int32"),a=Mr(xe(s),o),l=xe(i);for(let c=0;c<a.length;++c){const d=c*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[c]=f}return{outVals:a,outShape:s,outDtype:o}}function gee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ye(s,"prod");const a=s.shape.length,l=Ct(i,s.shape),c=Rn(l,a);let d=l,f=s;const p=[];c!=null&&(f=ms({inputs:{x:s},backend:t,attrs:{perm:c}}),p.push(f),d=zn(d.length,a));const g=t.data.get(f.dataId).values,{outVals:y,outShape:w,outDtype:x}=FL(f.shape,f.dtype,g,d);let I=w;return o&&(I=qn(w,l)),p.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(I,x,y)}const yee={kernelName:ov,backendName:"cpu",kernelFunc:gee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vee(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const i=Ph(s,e.length,tt(e)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${t})`)}})}function xee(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function wee(n,e,t,r){const s=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);xee(t,r);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const d=e[c+1];for(let f=1;f<l+1;++f)a[c].push(f*d)}for(let c=0;c<n.length;++c){let d=n[c],f=n[c]+1;for(let p=0;p<t.length;++p){const g=t[p],y=p+e.length-1;if(y>=0){const w=a[y],x=w[w.length-1]-g[d];for(let I=d;I<f;++I)a[y].push(g[I+1]+x)}d=g[d],f=g[f]}f!==d&&(s.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:s,numValues:i}}function bee(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=Ln("int32",r);e.push(s),n[t].forEach((i,o)=>s[o]=i)}return e}function cN(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Iee(n,e,t,r,s,i){const o=cN(e,2)[1],a=cN(i,2)[1];let l=0;for(const c of t)for(let d=c[0];d<c[1];++d){for(let f=0;f<r;++f)s[l*a+f]=n[d*o+f];++l}}function Cee(n,e,t,r,s){const i=e.slice();i[0]=s;const o=Ln(t,xe(i)),a=n.length,l=a===0?0:a/e[0];return Iee(n,e,r,l,o,i),[o,i]}function OL(n,e,t,r,s,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(vee(i,o,l),r.length===0)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:d,valueSlices:f,numValues:p}=wee(i,o,n,c),g=bee(d),y=Cee(t,r,s,f,p);return[g,y[0],y[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hN=2147483647;function LL(n,e,t,r,s,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,c=o.length===0,d=[];a||d.push(e[0]),l||d.push(s[0]),c||d.push(o[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=Ln("int32",f+1);p[0]=0;for(let x=0;x<f;++x){const I=a?n[0]:n[x],C=l?r[0]:r[x],k=c?i[0]:i[x];if(k===0)throw new Error("Requires delta != 0");let E;if(k>0&&C<I||k<0&&C>I)E=0;else if(E=Math.ceil(Math.abs((C-I)/k)),E>hN)throw new Error(`Requires ((limit - start) / delta) <= ${hN}`);p[x+1]=p[x]+E}const g=p[f],y=Ln(t,g);let w=0;for(let x=0;x<f;++x){const I=p[x+1]-p[x];let C=a?n[0]:n[x];const k=c?i[0]:i[x];for(let E=0;E<I;++E)y[w++]=C,C+=k}return[p,y]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ui=Ui;class By{constructor(e,t,r,s,i,o,a,l,c,d){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=IP(d),this.raggedRank=CP(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ui.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ui.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ui.VALUE_ROWIDS:return By.getMaxWidthValueRowID(t);case ui.ROW_SPLITS:return By.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${ui[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const i=e[s+1]-e[s];i>r&&(r=i)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==s&&(s=a,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return fN(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;SP(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=bP(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),i=[];let o=0;for(let a=0;a<s;++a,o+=t)i.push(o);for(let a=s;a<e;++a)i.push(-1);return z(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,r,s){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let c=Math.min(s,l),d=t[a];d===-1&&(c=0);for(let f=0;f<c;++f)o.push(d),d+=r;for(let f=0;f<l-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,r,s){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];o.push(c);for(let d=1;d<i;++d){const f=e[d];if(f===l)c>=0&&(++a,a<s?c+=r:c=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,r,s){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ui.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,s);case ui.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,r,s);default:throw new Error(`Unsupported partition type: ${ui[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case ui.FIRST_DIM_SIZE:return e[0];case ui.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ui.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ui[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*r[l+1];const i=fN(r,!1),o=Ln(this.valuesDType,xe(i));if(s[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(t,s[0],r[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,s[c],r[c]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,r,s){if(r.length===0)return;const i=this.values,o=r;let a=s.slice();a=a.slice(e+1);const l=xe(a),c=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const y=this.defaultValueShape;de(()=>{const w=ie(d,y);d=Qd(w,a).dataSync()})}let f=0,p=0,g=0;for(let y=0;y<=c;++y){let w=y<c?t[y]:-1;if(w===g){++g;continue}if(p<g){const x=i.subarray(f*l),I=o.subarray(p*l),C=(g-p)*l;dN(I,x,C)}if(y>=c){const x=r.length;w=Math.floor(x/l)}if(w>g)if(this.defaultValue.length===1)o.subarray(g*l,w*l).fill(this.defaultValue[0]),g=w;else for(;w>g;){const x=o.slice(g*l);dN(x,d,l),++g}w<0?(f=y+1,p=g):(f=y,p=g,g=p+1)}}}function dN(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function fN(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function ML(n,e,t,r,s,i,o,a,l,c){return new By(n,e,t,r,s,i,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(n,e,t,r){const s=n===e,i=n<e&&t<0,o=e<n&&t>1;if(s||i||o)return Mr(0,r);const a=Math.abs(Math.ceil((e-n)/t)),l=Mr(a,r);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL=zo(n=>1/Math.sqrt(n)),See=zl(yp,zL),Eee={kernelName:yp,backendName:"cpu",kernelFunc:See};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xu(n,e,t,r,s,i,o,a,l,c){const d=[r/s,s],f=n.values,p=e.values;if(r===0)return It(t,e.dtype);const g=l instanceof Cr?l:It(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let y=0;y<i;y++){const w=[];let x=0;for(let I=0;I<o;I++){const C=f[y*o+I];w.push(C),x+=C*a[I]}if(x<0||x>=r/s)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let I=0;I<s;I++)c?g.values[x*s+I]+=p[y*s+I]:g.values[x*s+I]=e.rank===0?p[0]:p[y*s+I]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kee=zo(n=>1/(1+Math.exp(-n))),BL=on(Ip,n=>1/(1+Math.exp(-n))),Tee={kernelName:Ip,backendName:"cpu",kernelFunc:BL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(n,e,t,r,s){const i=XC(r,e,t),o=xe(t),a=tt(r);if(i){const f=YC(e,a);return s==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=s==="string"?ba(n):n,c=It(r,s,l),d=It(t,s);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((y,w)=>y+e[w]);d.set(c.get(...g),...p)}return s==="string"?GP(d.values):d.values}function Bu(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r;Ye(s,"slice");const[a,l]=Rv(s,i,o);qC(s,a,l);const c=t.data.get(s.dataId).values,d=UL(c,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,d)}const _ee={kernelName:dv,backendName:"cpu",kernelFunc:Bu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(n,e,t,r,s,i,o){const a=e[0],l=i[0],c=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(AP(a));const x=Ln(t,0),I=Ln(s,0);return[x,[0,f],I,c,d]}let p=!0,g=0;const y=new Array(l).fill(0);for(let x=0;x<a;++x){const I=n[x*f];if(I<0)throw new Error($P(x,I));if(I>=l)throw new Error(DP(x,I,l));++y[I],p=p&&I>=g,g=I}let w=!0;for(let x=0;x<l;++x){const I=y[x]===0;c[x]=I,w=w&&!I,y[x]=Math.max(y[x],1),x>0&&(y[x]+=y[x-1])}if(w&&p){const x=n,I=r;for(let C=0;C<a;++C)d[C]=C;return[x,[a,f],I,c,d]}else{const x=y[l-1],I=Ln(t,x*f),C=Ln(s,x),k=new Array(l).fill(0);for(let E=0;E<a;++E){const _=n[E*f],L=k[_],P=(_===0?0:y[_-1])+L;k[_]++;for(let A=0;A<f;++A)I[P*f+A]=n[E*f+A];C[P]=r[E],d[E]=P}for(let E=0;E<l;++E)if(k[E]===0){const L=E===0?0:y[E-1];I[L*f+0]=E;for(let P=1;P<f;++P)I[L*f+P]=0;C[L]=o}return[I,[x,f],C,c,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(n,e,t,r,s){const i=xe(r),o=e[0],a=s.length,l=[];let c=1,d=-1;for(let x=0;x<a;++x){const I=s[x];if(I===-1){if(d!==-1)throw new Error(PP(d,x));d=x,l.push(1)}else{if(I<0)throw new Error(FP(x,I));c*=I,l.push(I)}}if(d!==-1){if(c<=0)throw new Error(OP());const x=Math.trunc(i/c);if(c*x!==i)throw new Error(LP(r,l));l[d]=x}if(xe(l)!==i)throw new Error(MP(r,l));const p=r.length,g=[];if(p>0){g[p-1]=1;for(let x=p-2;x>=0;--x)g[x]=g[x+1]*r[x+1]}const y=[];if(a>0){y[a-1]=1;for(let x=a-2;x>=0;--x)y[x]=y[x+1]*l[x+1]}const w=Ln(t,o*a);for(let x=0;x<o;++x){let I=0;for(let C=0;C<p;++C)I+=n[x*p+C]*g[C];for(let C=0;C<a;++C)w[x*a+C]=Math.trunc(I/y[C]),I%=y[C]}return[w,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WS(n,e,t,r,s,i=!1,o=0){const a=r.length,l=[e[0],n.length/e[0]],c=l[1],f=a>0?s[a-1]+1:0;if(f<0)throw new Error(Z1());const p=e.slice();p[0]=f;const g=p.reduce((k,E)=>k*E,1),y=Ln(t,g);if(a===0)return f>0&&y.fill(o),[y,p];if(f<=0)throw new Error(Z1());let w=0,x=1,I=0,C=s[w];for(;;){let k=0;if(x<a){if(k=s[x],C===k){++x;continue}if(C>=k)throw new Error(VP())}if(C<0||C>=f)throw new Error(zP(C,f));C>I&&y.fill(o,I*c,C*c);for(let E=w;E<x;++E){const _=r[E];if(_<0||_>=l[0])throw new Error(BP(E,r[E],l[0]));for(let L=0;L<c;L++)y[C*c+L]+=n[_*c+L]}if(i)for(let E=0;E<c;E++)y[C*c+E]/=x-w;if(w=x,++x,I=C+1,C=k,x>a)break}return I<f&&y.fill(o,I*c,f*c),[y,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ree=zo(n=>Math.sqrt(n)),Nee=on(Sp,n=>Math.sqrt(n)),Aee={kernelName:Sp,backendName:"cpu",kernelFunc:Nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL=Un((n,e)=>{const t=n-e;return t*t}),$ee=sr(Ep,jL),Dee={kernelName:Ep,backendName:"cpu",kernelFunc:$ee};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL=zo((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),Pee=zl(oC,HL),Fee={kernelName:oC,backendName:"cpu",kernelFunc:Pee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(n,e,t,r){const s=It(n,e.dtype);for(let i=0;i<s.size;i++){const o=s.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+r[l];s.set(e.get(...a),...o)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oee{constructor(e,t,r,s,i,o){this.separator=pl(e),this.nGramWidths=t,this.leftPad=pl(r),this.rightPad=pl(s),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(c+d),p=t+(c>0?0:a-l);let g=0;g+=c*this.leftPad.length;for(let C=0;C<f;++C)g+=e[p+C].length;g+=d*this.rightPad.length;const y=c+d+f-1;g+=y*this.separator.length,r[s+a]=new Uint8Array(g);const w=r[s+a];let x=0;const I=C=>C.forEach(k=>w[x++]=k);for(let C=0;C<c;++C)I(this.leftPad),I(this.separator);for(let C=0;C<f-1;++C)I(e[p+C]),I(this.separator);if(f>0){I(e[p+f-1]);for(let C=0;C<d;++C)I(this.separator),I(this.rightPad)}else{for(let C=0;C<d-1;++C)I(this.rightPad),I(this.separator);I(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<s;++c){let d=t[c]>=l;if(d=d&&t[c]<=r,!d)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${r}]`);l=t[c]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const i=s-1,o=Ln("int32",s);if(r===0||s===0){const l=new Array(r);for(let c=0;c<=i;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const c=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(c,f)}),this.preserveShort&&c>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const c=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,c,a,d,g,f),d+=g}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,c,a,d,1,p)}}return[a,o]}}function KL(n,e,t,r,s,i,o,a){return new Oee(t,r,s,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lee(n,e,t,r){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)r.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&r.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(s,i);(!t||o.length!==0)&&r.push(o),s=i+1}}function XL(n,e,t){const r=n.length,s=[];let i=0,o=0;const a=new Array(r);for(let p=0;p<r;++p){const g=s.length;Lee(n[p],e,t,s);const y=s.length-g;a[p]=y,i+=y,o=Math.max(o,y)}const l=Ln("int32",i*2),c=new Array(i),d=[r,o];let f=0;for(let p=0;p<r;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,c[f]=s[f],++f;return[l,c,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n,e){const t=Ln("int32",n.length);for(let r=0;r<n.length;++r)t[r]=J6(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL=Un((n,e)=>n-e),Mee=VS((n,e,t,r)=>({real:n-t,imag:e-r})),GS=sr(kp,QL,Mee),Vee={kernelName:kp,backendName:"cpu",kernelFunc:GS};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=It(t,n.dtype);for(let s=0;s<r.values.length;++s){const i=r.indexToLoc(s),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);r.values[s]=n.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wd=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function ZL(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const a=r-t+1,l=e-t+1,c=Math.log(a),d=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(r,Math.floor(e+(a-l)*d/a+f));ZL(n,e,p,g)}const s=n[e];let i=t,o=r;for(Hc(n,t,e),Wd(n[r],s)>0&&Hc(n,t,r);i<o;){for(Hc(n,i,o),i++,o--;Wd(n[i],s)<0;)i=i+1;for(;Wd(n[o],s)>0;)o=o-1}Wd(n[t],s)===0?Hc(n,t,o):(o=o+1,Hc(n,o,r)),o<=e&&(t=o+1),e<=o&&(r=o-1)}}function eM(n,e,t,r,s){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Lr(t,o*r),c=Lr("int32",o*r);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let y=new Array(g.length);g.forEach((C,k)=>y[k]={value:C,index:k}),r<y.length&&(ZL(y,r),y=y.slice(0,r)),s&&y.sort(Wd);const w=f*r,x=l.subarray(w,w+r),I=c.subarray(w,w+r);for(let C=0;C<r;C++)x[C]=y[C].value,I[C]=y[C].index}const d=e.slice();return d[d.length-1]=r,[It(d,t,l),It(d,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tM(n,e,t,r){const s=Ct(e,t)[0],i=[1,t[0],1];for(let y=0;y<s;y++)i[0]*=t[y];i[1]=t[s];for(let y=s+1;y<t.length;y++)i[2]*=t[y];const o=new Map,a=new Int32Array(t[s]),l=new Cr(i,r,n),c=[],d=i[0]===1&&i[2]===1;for(let y=0;y<t[s];y++){let w;if(d)w=n[y].toString();else{const I=[];for(let C=0;C<i[0];C++)for(let k=0;k<i[2];k++)I.push(l.get(C,y,k));w=I.join(",")}const x=o.get(w);if(x!=null)a[y]=x;else{const I=o.size;o.set(w,I),a[y]=I,c.push(y)}}const f=i.slice();f[1]=o.size;const p=new Cr(f,r);c.forEach((y,w)=>{for(let x=0;x<i[0];x++)for(let I=0;I<i[2];I++)p.set(l.get(x,y,I),x,w,I)});const g=t.slice();return g[s]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zee=Object.freeze(Object.defineProperty({__proto__:null,addImpl:cL,bincountImpl:zS,bincountReduceImpl:hL,bitwiseAndImpl:dL,castImpl:uL,ceilImpl:fL,concatImpl:pL,equalImpl:mL,expImpl:yL,expm1Impl:xL,floorDivImpl:bL,floorImpl:wL,gatherNdImpl:IL,gatherV2Impl:CL,greaterEqualImpl:EL,greaterImpl:SL,lessEqualImpl:TL,lessImpl:kL,linSpaceImpl:_L,logImpl:RL,maxImpl:NL,maximumImpl:AL,minimumImpl:$L,multiplyImpl:BS,negImpl:DL,notEqualImpl:PL,prodImpl:FL,raggedGatherImpl:OL,raggedRangeImpl:LL,raggedTensorToTensorImpl:ML,rangeImpl:VL,rsqrtImpl:zL,scatterImpl:xu,sigmoidImpl:kee,simpleAbsImpl:lL,sliceImpl:UL,sparseFillEmptyRowsImpl:WL,sparseReshapeImpl:GL,sparseSegmentReductionImpl:WS,sqrtImpl:Ree,squaredDifferenceImpl:jL,staticRegexReplaceImpl:HL,stridedSliceImpl:qL,stringNGramsImpl:KL,stringSplitImpl:XL,stringToHashBucketFastImpl:YL,subImpl:QL,tileImpl:JL,topKImpl:eM,transposeImpl:US,uniqueImpl:tM},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xD("cpu",()=>new Wv,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM=on(Xf,n=>n>=0?n:Math.exp(n)-1),Bee={kernelName:Xf,backendName:"cpu",kernelFunc:nM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rM(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r;Ye([s],"leakyRelu");const o=xe(s.shape),a=t.data.get(s.dataId).values,l=Lr("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return t.makeTensorInfo(s.shape,"float32",l)}const Uee={kernelName:z0,backendName:"cpu",kernelFunc:rM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wee=Un((n,e)=>n<0?e*n:n);function sM(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;Ye([r,s],"prelu");const i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,[a,l]=Wee(r.shape,s.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const Gee={kernelName:iv,backendName:"cpu",kernelFunc:sM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iM=on(pp,n=>Math.max(0,n)),jee={kernelName:pp,backendName:"cpu",kernelFunc:iM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oM=on(mp,n=>Math.min(Math.max(0,n),6)),Hee={kernelName:mp,backendName:"cpu",kernelFunc:oM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uy(n,e,t,r,s){if(t==="linear")return Vo({inputs:{x:e},backend:n});if(t==="relu")return iM({inputs:{x:e},backend:n});if(t==="elu")return nM({inputs:{x:e},backend:n});if(t==="relu6")return oM({inputs:{x:e},backend:n});if(t==="prelu")return sM({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return rM({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return BL({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fn(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=xe(s.shape),a=R$(i,o),l=xe(a);z(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const c=t.data.get(s.dataId);if(c.complexTensorInfos!=null){const d=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const qee={kernelName:av,backendName:"cpu",kernelFunc:fn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;Ye([s,i],"matMul");const l=s.shape.length,c=i.shape.length,d=o?s.shape[l-2]:s.shape[l-1],f=a?i.shape[c-1]:i.shape[c-2],p=o?s.shape[l-1]:s.shape[l-2],g=a?i.shape[c-2]:i.shape[c-1],y=s.shape.slice(0,-2),w=i.shape.slice(0,-2),x=xe(y),I=xe(w),k=yt(s.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);z(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${s.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const E=o?[x,d,p]:[x,p,d],_=a?[I,g,f]:[I,f,g],L=fn({inputs:{x:s},backend:t,attrs:{shape:E}}),P=fn({inputs:{x:i},backend:t,attrs:{shape:_}}),A=o?L.shape[1]:L.shape[2],$=o?L.shape[2]:L.shape[1],D=a?P.shape[1]:P.shape[2],R=Math.max(x,I),M=t.data.get(L.dataId).values,O=t.data.get(P.dataId).values,Z=tt(L.shape),q=tt(P.shape),[se,le,j]=o?[Z[0],1,Z[1]]:[Z[0],Z[1],1],[Q,ee,U]=a?[1,q[1],q[0]]:[q[1],1,q[0]],H=$*D,ue=It([R,$,D],L.dtype),Ie=ue.values,be=t.blockSize;for(let ke=0;ke<R;ke++){const De=ke%x,Fe=ke%I;for(let Ae=0;Ae<$;Ae+=be){const Ge=Math.min(Ae+be,$);for(let st=0;st<D;st+=be){const Et=Math.min(st+be,D);for(let gt=0;gt<A;gt+=be){const Wt=Math.min(gt+be,A);for(let Rt=Ae;Rt<Ge;Rt++)for(let kt=st;kt<Et;kt++){let Ht=0;for(let qt=gt;qt<Wt;qt++){const mr=M[De*se+Rt*le+qt*j],nn=O[qt*Q+kt*ee+Fe*U];Ht+=mr*nn}Ie[ke*H+(Rt*D+kt)]+=Ht}}}}}return t.disposeIntermediateTensorInfo(L),t.disposeIntermediateTensorInfo(P),t.makeTensorInfo(k,ue.dtype,ue.values)}const Kee={kernelName:E0,backendName:"cpu",kernelFunc:aM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xee(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:d,leakyreluAlpha:f}=r;let p,g,y;const w=[];p=aM({inputs:{a:s,b:i},attrs:{transposeA:l,transposeB:c},backend:t}),o&&(g=wh({inputs:{a:p,b:o},backend:t}),w.push(p),p=g),d&&(y=Uy(t,p,d,a,f),w.push(p),p=y);for(const I of w)t.disposeIntermediateTensorInfo(I);return p}const Yee={kernelName:wy,backendName:"cpu",kernelFunc:Xee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qee=on(Of,n=>Math.acos(n)),Jee={kernelName:Of,backendName:"cpu",kernelFunc:Qee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee=on(Lf,n=>Math.acosh(n)),ete={kernelName:Lf,backendName:"cpu",kernelFunc:Zee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tte(n){const{inputs:e,backend:t}=n,r=e;Ye(e,"addN");const s=r.map(a=>t.data.get(a.dataId).values),i=It(r[0].shape,r[0].dtype),o=i.values;for(let a=0;a<r.length;a++){const l=s[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const nte={kernelName:EI,backendName:"cpu",kernelFunc:tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ye(s,"all");const a=Ct(i,s.shape);let l=a;const c=Rn(l,s.shape.length);let d=s;c!=null&&(d=ms({inputs:{x:s},backend:t,attrs:{perm:c}}),l=zn(l.length,s.shape.length)),Er("all",l,d.shape.length);const[f,p]=pr(d.shape,l),g=xe(p),y=Mr(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let I=0;I<y.length;++I){const C=I*g;let k=w[C];for(let E=0;E<g;++E){const _=w[C+E];k=k&&_}y[I]=k}c!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(f,d.dtype,y);if(o){const I=qn(f,a),C=fn({inputs:{x},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(x),C}return x}const ste={kernelName:kI,backendName:"cpu",kernelFunc:rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ye(s,"any");const a=Ct(i,s.shape);let l=a;const c=Rn(l,s.shape.length);let d=s;c!=null&&(d=ms({inputs:{x:s},backend:t,attrs:{perm:c}}),l=zn(l.length,s.shape.length)),Er("any",l,d.shape.length);const[f,p]=pr(d.shape,l),g=xe(p),y=Mr(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let I=0;I<y.length;++I){const C=I*g;let k=w[C];for(let E=0;E<g;++E){const _=w[C+E];k=k||_}y[I]=k}c!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(f,d.dtype,y);if(o){const I=qn(f,a),C=fn({inputs:{x},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(x),C}return x}const ote={kernelName:TI,backendName:"cpu",kernelFunc:ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ate(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Ye(s,"argMax");let o=Ct(i,s.shape);const a=Rn(o,s.shape.length);let l=s;const c=[];a!=null&&(l=ms({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),o=zn(o.length,l.shape.length)),o=[o[0]],Er("argMax",o,l.shape.length);const[d,f]=pr(l.shape,o),p=xe(d),g=Mr(p,"int32"),y=xe(f),w=t.data.get(l.dataId).values;for(let x=0;x<g.length;++x){const I=x*y;let C=w[I],k=0;for(let E=0;E<y;++E){const _=w[I+E];_>C&&(C=_,k=E)}g[x]=k}return c.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",g)}const lte={kernelName:b0,backendName:"cpu",kernelFunc:ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Ye(s,"argMin");let o=Ct(i,s.shape);const a=Rn(o,s.shape.length);let l=s;const c=[];a!=null&&(l=ms({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),o=zn(o.length,l.shape.length)),o=[o[0]],Er("argMin",o,l.shape.length);const[d,f]=pr(l.shape,o),p=xe(d),g=Mr(p,"int32"),y=xe(f),w=t.data.get(l.dataId).values;for(let x=0;x<g.length;++x){const I=x*y;let C=w[I],k=0;for(let E=0;E<y;++E){const _=w[I+E];_<C&&(C=_,k=E)}g[x]=k}return c.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",g)}const cte={kernelName:I0,backendName:"cpu",kernelFunc:ute};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hte=on(Mf,n=>Math.asin(n)),dte={kernelName:Mf,backendName:"cpu",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fte=on(Vf,n=>Math.asinh(n)),pte={kernelName:Vf,backendName:"cpu",kernelFunc:fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte=on(zf,n=>Math.atan(n)),gte={kernelName:zf,backendName:"cpu",kernelFunc:mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte=Un((n,e)=>Math.atan2(n,e)),vte=sr(Uf,yte),xte={kernelName:Uf,backendName:"cpu",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wte=on(Bf,n=>Math.atanh(n)),bte={kernelName:Bf,backendName:"cpu",kernelFunc:wte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(n,e,t,r,s,i){const o=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,c=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=s.padInfo.top,g=s.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=It(s.outShape,t),x=w.values,I=s.outShape[1]*s.outShape[2]*s.outShape[3],C=s.outShape[2]*s.outShape[3],k=s.outShape[3];for(let E=0;E<s.batchSize;++E){const _=E*I,L=E*r[0];for(let P=0;P<s.inChannels;++P)for(let A=0;A<s.outHeight;++A){const $=A*o-p,D=Math.max(0,$),R=Math.min(s.inHeight,d+$),M=_+A*C;for(let O=0;O<s.outWidth;++O){const Z=O*a-g,q=Math.max(0,Z),se=Math.min(s.inWidth,f+Z);let le=y,j=0,Q=0;for(let U=D;U<R;U+=l){const H=L+U*r[1];for(let ue=q;ue<se;ue+=c){const Ie=H+ue*r[2],be=n[Ie+P];i==="max"&&be>le?le=be:i==="avg"&&(j+=be,Q++)}if(isNaN(le))break}const ee=M+O*k+P;x[ee]=i==="avg"?j/Q:le}}}return w}function lM(n,e,t,r,s=!1,i=!1){const o=It(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,d=r.dilationWidth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.top,y=r.padInfo.left,w=It(e,t,n);for(let x=0;x<r.batchSize;++x)for(let I=0;I<r.inChannels;++I)for(let C=0;C<r.outHeight;++C){const k=C*a-g;let E=k;for(;E<0;)E+=c;const _=Math.min(r.inHeight,f+k);for(let L=0;L<r.outWidth;++L){const P=L*l-y;let A=P;for(;A<0;)A+=d;const $=Math.min(r.inWidth,p+P);let D=Number.NEGATIVE_INFINITY,R=-1;for(let M=E;M<_;M+=c){const O=M-k;for(let Z=A;Z<$;Z+=d){const q=Z-P,se=w.get(x,M,Z,I);se>D&&(D=se,s?R=i?((x*r.inHeight+M)*r.inWidth+Z)*r.inChannels+I:(M*r.inWidth+Z)*r.inChannels+I:R=O*p+q)}}o.set(R,x,C,L,I)}}return o}function uM(n,e,t,r,s,i){const o=s.strideDepth,a=s.strideHeight,l=s.strideWidth,c=s.dilationDepth,d=s.dilationHeight,f=s.dilationWidth,p=s.effectiveFilterDepth,g=s.effectiveFilterHeight,y=s.effectiveFilterWidth,w=s.padInfo.front,x=s.padInfo.top,I=s.padInfo.left,C=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,k=It(s.outShape,t),E=k.values,_=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],L=s.outShape[2]*s.outShape[3]*s.outShape[4],P=s.outShape[3]*s.outShape[4],A=s.outShape[4];for(let $=0;$<s.batchSize;++$){const D=$*_,R=$*r[0];for(let M=0;M<s.inChannels;++M)for(let O=0;O<s.outDepth;++O){const Z=O*o-w;let q=Z;for(;q<0;)q+=c;const se=Math.min(s.inDepth,p+Z),le=D+O*L;for(let j=0;j<s.outHeight;++j){const Q=j*a-x;let ee=Q;for(;ee<0;)ee+=d;const U=Math.min(s.inHeight,g+Q),H=le+j*P;for(let ue=0;ue<s.outWidth;++ue){const Ie=ue*l-I;let be=Ie;for(;be<0;)be+=f;const ke=Math.min(s.inWidth,y+Ie),De=H+ue*A;let Fe=C,Ae=0,Ge=0;for(let Et=q;Et<se;Et+=c){const gt=R+Et*r[1];for(let Wt=ee;Wt<U;Wt+=d){const Rt=gt+Wt*r[2];for(let kt=be;kt<ke;kt+=f){const Ht=Rt+kt*r[3],qt=n[Ht+M];if(i==="max"&&qt>Fe?Fe=qt:i==="avg"&&(Ae+=qt,Ge++),isNaN(Fe))break}if(isNaN(Fe))break}if(isNaN(Fe))break}const st=De+M;E[st]=i==="avg"?Ae/Math.max(Ge,1):Fe}}}}return k}function Ite(n,e){const t=It(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let x=0;x<e.inChannels;++x)for(let I=0;I<e.outDepth;++I){const C=I*r-p;let k=C;for(;k<0;)k+=o;const E=Math.min(e.inDepth,c+C);for(let _=0;_<e.outHeight;++_){const L=_*s-g;let P=L;for(;P<0;)P+=a;const A=Math.min(e.inHeight,d+L);for(let $=0;$<e.outWidth;++$){const D=$*i-y;let R=D;for(;R<0;)R+=l;const M=Math.min(e.inWidth,f+D);let O=Number.NEGATIVE_INFINITY,Z=-1;for(let q=k;q<E;q+=o){const se=q-C;for(let le=P;le<A;le+=a){const j=le-L;for(let Q=R;Q<M;Q+=l){const ee=Q-D,U=n.get(w,q,le,Q,x);U>=O&&(O=U,Z=se*d*f+j*d+ee)}}}t.set(Z,w,I,_,$,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ye(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(zr(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=vi(s.shape,i,o,c,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&Qt(d.inShape,d.outShape))f=Vo({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,g=tt(s.shape),y=jS(p,s.shape,s.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,s.dtype,y.values)}return f}const Ste={kernelName:C0,backendName:"cpu",kernelFunc:Cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ete(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;Ye(s,"avgPool3d");const d=Ea(s.shape,i,o,1,a,l,c),f=t.data.get(s.dataId).values,p=uM(f,s.shape,s.dtype,tt(s.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const kte={kernelName:S0,backendName:"cpu",kernelFunc:Ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;Ye([s,i],"avgPool3DGrad");const d=Ea(i.shape,o,a,1,l,c),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,y=d.filterDepth,w=d.filterHeight,x=d.filterWidth,I=d.dilationDepth,C=d.dilationHeight,k=d.dilationWidth,E=d.effectiveFilterDepth,_=d.effectiveFilterHeight,L=d.effectiveFilterWidth,P=E-1-d.padInfo.front,A=L-1-d.padInfo.left,$=_-1-d.padInfo.top,D=It(i.shape,"float32"),R=1/(y*w*x),M=t.bufferSync(s);for(let O=0;O<d.batchSize;++O)for(let Z=0;Z<d.inChannels;++Z)for(let q=0;q<d.inDepth;++q)for(let se=0;se<d.inHeight;++se)for(let le=0;le<d.inWidth;++le){const j=q-P,Q=se-$,ee=le-A;let U=0;for(let H=0;H<E;H+=I){const ue=(j+H)/f;if(!(ue<0||ue>=d.outDepth||Math.floor(ue)!==ue))for(let Ie=0;Ie<_;Ie+=C){const be=(Q+Ie)/p;if(!(be<0||be>=d.outHeight||Math.floor(be)!==be))for(let ke=0;ke<L;ke+=k){const De=(ee+ke)/g;if(De<0||De>=d.outWidth||Math.floor(De)!==De)continue;const Fe=M.get(O,ue,be,De,Z);U+=Fe}}}D.set(U*R,O,q,se,le,Z)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const _te={kernelName:RI,backendName:"cpu",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rte(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Ye([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,d=vi(o.shape,a,l,1,c),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,y=d.filterWidth,w=d.dilationHeight,x=d.dilationWidth,I=d.effectiveFilterHeight,C=d.effectiveFilterWidth,k=C-1-d.padInfo.left,E=I-1-d.padInfo.top,_=It(o.shape,"float32"),L=1/(g*y),P=t.data.get(s.dataId).values,A=It(s.shape,"float32",P);for(let $=0;$<d.batchSize;++$)for(let D=0;D<d.inChannels;++D)for(let R=0;R<d.inHeight;++R)for(let M=0;M<d.inWidth;++M){const O=R-E,Z=M-k;let q=0;for(let se=0;se<I;se+=w){const le=(O+se)/f;if(!(le<0||le>=d.outHeight||Math.floor(le)!==le))for(let j=0;j<C;j+=x){const Q=(Z+j)/p;if(Q<0||Q>=d.outWidth||Math.floor(Q)!==Q)continue;const ee=A.get($,le,Q,D);q+=ee}}_.set(q*L,$,R,M,D)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const Nte={kernelName:_I,backendName:"cpu",kernelFunc:Rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ate(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:i,offset:o,mean:a,variance:l}=e;z(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ye([s,a,l,i,o],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);const d=t.data.get(s.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),y=o?t.data.get(o.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),x=y.length,I=g.length,C=p.length,k=f.length;let E=0,_=0,L=0,P=0;for(let A=0;A<d.length;++A)w[A]=y[E++]+(d[A]-f[_++])*g[L++]/Math.sqrt(p[P++]+c),E>=x&&(E=0),_>=k&&(_=0),L>=I&&(L=0),P>=C&&(P=0);return t.makeTensorInfo(s.shape,s.dtype,w)}const $te={kernelName:L0,backendName:"cpu",kernelFunc:Ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;Ye([s],"batchToSpaceND");const a=i.reduce((I,C)=>I*C),l=Op(s.shape,i,a),c=Lp(l.length,i.length),d=Mp(s.shape,i,a),f=tS(o,i.length),p=nS(d,o,i.length),g=fn({inputs:{x:s},backend:t,attrs:{shape:l}}),y=ms({inputs:{x:g},backend:t,attrs:{perm:c}}),w=fn({inputs:{x:y},backend:t,attrs:{shape:d}}),x=Bu({inputs:{x:w},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),x}const Pte={kernelName:k0,backendName:"cpu",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,c=zS(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}const Ote={kernelName:NI,backendName:"cpu",kernelFunc:Fte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lte(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=yt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Mte={kernelName:F$,backendName:"cpu",kernelFunc:Lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vte=on(jf,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),zte={kernelName:jf,backendName:"cpu",kernelFunc:Vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bte=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(xe(e.shape)),s=t.data.get(e.dataId),i=s.complexTensorInfos.real,o=s.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const d=a[c],f=l[c];r[c]=Math.hypot(d,f)}return t.makeOutput(r,e.shape,"float32")},Ute={kernelName:T0,backendName:"cpu",kernelFunc:Bte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bh(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const Wte={kernelName:KI,backendName:"cpu",kernelFunc:bh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ih(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=Ct(s,e[0].shape)[0],o=e.map(w=>w.shape);JC(o,i);let a=Ro(e.map(w=>w.shape),i);if(xe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(w=>xe(w.shape)>0);if(l.length===1)return Vo({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(E=>zu({inputs:{input:E},backend:t})),x=l.map(E=>bh({inputs:{input:E},backend:t})),I=Ih({inputs:w,backend:t,attrs:{axis:i}}),C=Ih({inputs:x,backend:t,attrs:{axis:i}}),k=Ns({inputs:{real:I,imag:C},backend:t});return w.forEach(E=>t.disposeIntermediateTensorInfo(E)),x.forEach(E=>t.disposeIntermediateTensorInfo(E)),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),k}const c=l.map(w=>{const I=[-1,xe(w.shape.slice(i))];return fn({inputs:{x:w},backend:t,attrs:{shape:I}})}),d=c.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));a=Ro(c.map(w=>w.shape),1);const f=c[0].shape[0]===1,p=pL(d,a,e[0].dtype,f),g=Ro(l.map(w=>w.shape),i),y=t.makeTensorInfo(g,e[0].dtype,p);return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const Gte={kernelName:_0,backendName:"cpu",kernelFunc:Ih};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cM(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:d}=r;Ye([s,i],"conv2d");const f=ka(l),p=Sr(s.shape,i.shape,o,c,a,d,!1,f),g=p.filterHeight,y=p.filterWidth,w=p.dilationHeight,x=p.dilationWidth,I=p.padInfo.left,C=p.padInfo.top,k=p.dataFormat==="channelsLast",E=new Cr(p.outShape,s.dtype),_=tt(s.shape),L=tt(i.shape),P=_[0],A=k?_[1]:_[2],$=k?_[2]:1,D=k?1:_[1],R=E.strides[0],M=k?E.strides[1]:E.strides[2],O=k?E.strides[2]:1,Z=k?1:E.strides[1],q=t.data.get(s.dataId).values,se=t.data.get(i.dataId).values,le=E.values;for(let j=0;j<p.batchSize;++j){const Q=j*P,ee=j*R;for(let U=0;U<p.outHeight;++U){const H=ee+U*M,ue=U*p.strideHeight-C;for(let Ie=0;Ie<g;++Ie){const be=ue+Ie*w;if(be<0||be>=p.inHeight)continue;const ke=Ie*L[0],De=Q+be*A;for(let Fe=0;Fe<p.outWidth;++Fe){const Ae=H+Fe*O,Ge=Fe*p.strideWidth-I;for(let st=0;st<y;++st){const Et=Ge+st*x;if(Et<0||Et>=p.inWidth)continue;const gt=ke+st*L[1],Wt=De+Et*$;let Rt=gt;for(let kt=0;kt<p.inChannels;++kt){const Ht=q[Wt+kt*D];for(let qt=0;qt<p.outChannels;++qt)le[Ae+qt*Z]+=Ht*se[Rt+qt];Rt+=p.outChannels}}}}}}return t.makeTensorInfo(E.shape,E.dtype,le)}const jte={kernelName:R0,backendName:"cpu",kernelFunc:cM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:d}=r;Ye([s,i],"conv2dBackpropFilter");const f=ka(l),p=Sr(s.shape,d,o,1,a,c,!1,f),{strideHeight:g,strideWidth:y,filterHeight:w,filterWidth:x}=p,I=p.dataFormat==="channelsLast",C=new Cr(p.filterShape,"float32"),k=p.padInfo.left,E=p.padInfo.top,_=t.data.get(s.dataId).values,L=t.data.get(i.dataId).values,P=new Cr(s.shape,s.dtype,_),A=new Cr(i.shape,i.dtype,L);for(let $=0;$<w;++$){const D=Math.max(0,Math.ceil((E-$)/g)),R=Math.min(p.outHeight,(p.inHeight+E-$)/g);for(let M=0;M<x;++M){const O=Math.max(0,Math.ceil((k-M)/y)),Z=Math.min(p.outWidth,(p.inWidth+k-M)/y);for(let q=0;q<p.inChannels;++q)for(let se=0;se<p.outChannels;++se){let le=0;for(let j=0;j<p.batchSize;++j)for(let Q=D;Q<R;++Q){const ee=$+Q*g-E;for(let U=O;U<Z;++U){const H=M+U*y-k;I?le+=P.get(j,ee,H,q)*A.get(j,Q,U,se):le+=P.get(j,q,ee,H)*A.get(j,se,Q,U)}}C.set(le,$,M,q,se)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const qte={kernelName:DI,backendName:"cpu",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:d}=r;Ye([s,i],"conv2dBackpropInput");const f=tt(i.shape),p=tt(s.shape);let g=ka(c);const y=Sr(o,i.shape,a,1,l,d,!1,g),w=new Cr(y.inShape,"float32"),x=w.values,I=t.data.get(s.dataId).values,C=t.data.get(i.dataId).values,[k,E,_]=f,{batchSize:L,filterHeight:P,filterWidth:A,inChannels:$,inHeight:D,inWidth:R,outChannels:M,outHeight:O,outWidth:Z,strideHeight:q,strideWidth:se}=y;g=y.dataFormat;const le=P-1-y.padInfo.top,j=A-1-y.padInfo.left,Q=g==="channelsLast",ee=w.strides[0],U=Q?w.strides[1]:w.strides[2],H=Q?w.strides[2]:1,ue=Q?1:w.strides[1],Ie=p[0],be=Q?p[1]:p[2],ke=Q?p[2]:1,De=Q?1:p[1];for(let Fe=0;Fe<L;++Fe)for(let Ae=0;Ae<$;++Ae)for(let Ge=0;Ge<D;++Ge){const st=Ge-le,Et=Math.max(0,Math.ceil(st/q)),gt=Math.min(O,(P+st)/q);for(let Wt=0;Wt<R;++Wt){const Rt=Wt-j,kt=Math.max(0,Math.ceil(Rt/se)),Ht=Math.min(Z,(A+Rt)/se);let qt=0;for(let nn=Et;nn<gt;++nn){const pn=nn*q-st;for(let yn=kt;yn<Ht;++yn){const Tr=yn*se-Rt,Dn=Ie*Fe+be*nn+ke*yn,En=k*(P-1-pn)+E*(A-1-Tr)+_*Ae;for(let Tt=0;Tt<M;++Tt){const Jt=I[Dn+De*Tt],Pn=C[En+Tt];qt+=Jt*Pn}}}const mr=ee*Fe+U*Ge+H*Wt+ue*Ae;x[mr]=qt}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Xte={kernelName:N0,backendName:"cpu",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r;Ye([s,i],"conv3d");const c=Pl(s.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:y,dilationWidth:w,padInfo:x}=c,I=x.front,C=x.left,k=x.top,E=new Cr(c.outShape,s.dtype),_=t.data.get(s.dataId).values,L=t.data.get(i.dataId).values,P=E.values,A=tt(s.shape),$=tt(i.shape);for(let D=0;D<c.batchSize;++D){const R=D*A[0],M=D*E.strides[0];for(let O=0;O<c.outDepth;++O){const Z=M+O*E.strides[1],q=O*c.strideDepth-I;for(let se=0;se<d;++se){const le=q+se*g;if(le<0||le>=c.inDepth)continue;const j=se*$[0],Q=R+le*A[1];for(let ee=0;ee<c.outHeight;++ee){const U=Z+ee*E.strides[2],H=ee*c.strideHeight-k;for(let ue=0;ue<f;++ue){const Ie=H+ue*y;if(Ie<0||Ie>=c.inHeight)continue;const be=j+ue*$[1],ke=Q+Ie*A[2];for(let De=0;De<c.outWidth;++De){const Fe=U+De*c.outChannels,Ae=De*c.strideWidth-C;for(let Ge=0;Ge<p;++Ge){const st=Ae+Ge*w;if(st<0||st>=c.inWidth)continue;const Et=be+Ge*$[2],gt=ke+st*c.inChannels;let Wt=Et;for(let Rt=0;Rt<c.inChannels;++Rt){const kt=_[gt+Rt];for(let Ht=0;Ht<c.outChannels;++Ht)P[Fe+Ht]+=kt*L[Wt+Ht];Wt+=c.outChannels}}}}}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const Qte={kernelName:A0,backendName:"cpu",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r;Ye([s,i],"conv3dBackpropFilterV2");const c=tt(s.shape),d=tt(i.shape),f=Pl(s.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,y=f.strideWidth,w=f.filterDepth,x=f.filterHeight,I=f.filterWidth,C=new Cr(f.filterShape,"float32"),k=C.values,[E,_,L,P]=C.strides,A=t.data.get(i.dataId).values,[$,D,R,M]=d,O=t.data.get(s.dataId).values,[Z,q,se,le]=c,j=f.padInfo.front,Q=f.padInfo.left,ee=f.padInfo.top;for(let U=0;U<w;++U){const H=Math.max(0,Math.ceil((j-U)/p)),ue=Math.min(f.outDepth,(f.inDepth+j-U)/p),Ie=U*E;for(let be=0;be<x;++be){const ke=Math.max(0,Math.ceil((ee-be)/g)),De=Math.min(f.outHeight,(f.inHeight+ee-be)/g),Fe=be*_+Ie;for(let Ae=0;Ae<I;++Ae){const Ge=Math.max(0,Math.ceil((Q-Ae)/y)),st=Math.min(f.outWidth,(f.inWidth+Q-Ae)/y),Et=Ae*L+Fe;for(let gt=0;gt<f.inChannels;++gt){const Wt=gt*P+Et;for(let Rt=0;Rt<f.outChannels;++Rt){let kt=0;for(let Ht=0;Ht<f.batchSize;++Ht){const qt=Ht*Z,mr=Ht*$;for(let nn=H;nn<ue;++nn){const yn=(U+nn*p-j)*q+qt,Tr=nn*D+mr;for(let Dn=ke;Dn<De;++Dn){const Tt=(be+Dn*g-ee)*se+yn,Jt=Dn*R+Tr;for(let Pn=Ge;Pn<st;++Pn){const Wn=(Ae+Pn*y-Q)*le+Tt,ys=Pn*M+Jt;kt+=O[Wn+gt]*A[ys+Rt]}}}}k[Wt+Rt]=kt}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const Zte={kernelName:PI,backendName:"cpu",kernelFunc:Jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ene(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r;Ye([s],"conv3dBackpropInputV2");const c=tt(s.shape),d=tt(i.shape),f=Pl(l,i.shape,a,1,o),p=new Cr(f.inShape,"float32"),g=p.values,[y,w,x,I]=p.strides,C=t.data.get(s.dataId).values,[k,E,_,L]=c,P=t.data.get(i.dataId).values,[A,$,D,R]=d,{batchSize:M,filterDepth:O,filterHeight:Z,filterWidth:q,inChannels:se,inDepth:le,inHeight:j,inWidth:Q,outChannels:ee,outDepth:U,outHeight:H,outWidth:ue,strideDepth:Ie,strideHeight:be,strideWidth:ke}=f,De=O-1-f.padInfo.front,Fe=Z-1-f.padInfo.top,Ae=q-1-f.padInfo.left;for(let Ge=0;Ge<M;++Ge)for(let st=0;st<se;++st)for(let Et=0;Et<le;++Et){const gt=Et-De,Wt=Math.max(0,Math.ceil(gt/Ie)),Rt=Math.min(U,(O+gt)/Ie);for(let kt=0;kt<j;++kt){const Ht=kt-Fe,qt=Math.max(0,Math.ceil(Ht/be)),mr=Math.min(H,(Z+Ht)/be);for(let nn=0;nn<Q;++nn){const pn=nn-Ae,yn=Math.max(0,Math.ceil(pn/ke)),Tr=Math.min(ue,(q+pn)/ke);let Dn=0;for(let En=Wt;En<Rt;++En){const Tt=En*Ie-gt;for(let Jt=qt;Jt<mr;++Jt){const Pn=Jt*be-Ht;for(let Os=yn;Os<Tr;++Os){const Wn=Os*ke-pn,ys=k*Ge+E*En+_*Jt+L*Os,Zs=A*(O-1-Tt)+$*(Z-1-Pn)+D*(q-1-Wn)+R*st;for(let Ls=0;Ls<ee;++Ls){const Bo=C[ys+Ls],ro=P[Zs+Ls];Dn+=Bo*ro}}}}g[y*Ge+w*Et+x*kt+I*nn+st]=Dn}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const tne={kernelName:FI,backendName:"cpu",kernelFunc:ene};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne=on(Hf,n=>Math.cos(n)),rne={kernelName:Hf,backendName:"cpu",kernelFunc:nne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sne=on(qf,n=>Math.cosh(n)),ine={kernelName:qf,backendName:"cpu",kernelFunc:sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[d,f,p,g]=s.shape,y=i.shape[0],[w,x]=a,I=It([y,w,x,g],"float32"),C=t.data.get(i.dataId).values,k=t.data.get(o.dataId).values,E=t.data.get(s.dataId).values,_=tt(s.shape),L=tt(I.shape);for(let P=0;P<y;P++){const A=P*4,$=C[A],D=C[A+1],R=C[A+2],M=C[A+3],O=k[P];if(O>=d)continue;const Z=w>1?(R-$)*(f-1)/(w-1):0,q=x>1?(M-D)*(p-1)/(x-1):0;for(let se=0;se<w;se++){const le=w>1?$*(f-1)+se*Z:.5*($+R)*(f-1);if(le<0||le>f-1){for(let j=0;j<x;j++)for(let Q=0;Q<g;Q++){const ee=Q+j*L[2]+se*L[1]+P*L[0];I.values[ee]=c}continue}if(l==="bilinear"){const j=Math.floor(le),Q=Math.ceil(le),ee=le-j;for(let U=0;U<x;U++){const H=x>1?D*(p-1)+U*q:.5*(D+M)*(p-1);if(H<0||H>p-1){for(let ke=0;ke<g;ke++){const De=ke+U*L[2]+se*L[1]+P*L[0];I.values[De]=c}continue}const ue=Math.floor(H),Ie=Math.ceil(H),be=H-ue;for(let ke=0;ke<g;ke++){let De=ke+ue*_[2]+j*_[1]+O*_[0];const Fe=E[De];De=ke+Ie*_[2]+j*_[1]+O*_[0];const Ae=E[De];De=ke+ue*_[2]+Q*_[1]+O*_[0];const Ge=E[De];De=ke+Ie*_[2]+Q*_[1]+O*_[0];const st=E[De],Et=Fe+(Ae-Fe)*be,gt=Ge+(st-Ge)*be;De=ke+U*L[2]+se*L[1]+P*L[0],I.values[De]=Et+(gt-Et)*ee}}}else for(let j=0;j<x;++j){const Q=x>1?D*(p-1)+j*q:.5*(D+M)*(p-1);if(Q<0||Q>p-1){for(let H=0;H<g;H++){const ue=H+j*L[2]+se*L[1]+P*L[0];I.values[ue]=c}continue}const ee=Math.round(Q),U=Math.round(le);for(let H=0;H<g;H++){const ue=H+ee*_[2]+U*_[1]+O*_[0],Ie=H+j*L[2]+se*L[1]+P*L[0];I.values[Ie]=E[ue]}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const ane={kernelName:LI,backendName:"cpu",kernelFunc:one};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Ye(s,"cumprod");const l=Rn([i],s.shape.length);let c=s;l!=null&&(c=ms({inputs:{x:s},backend:t,attrs:{perm:l}}));const d=zn(1,s.shape.length)[0];if(d!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${d}`);const f=Ds(c.dtype,"int32"),p=II(xe(c.shape),f),g=t.data.get(c.dataId).values,y=c.shape[c.shape.length-1],w=a?(I,C)=>I+y-C-1:(I,C)=>I+C;for(let I=0;I<g.length;I+=y)for(let C=0;C<y;C++){const k=w(I,C);if(C===0)p[k]=o?1:g[k];else{const E=w(I,C-1);p[k]=o?g[E]*p[E]:g[k]*p[E]}}const x=t.makeTensorInfo(c.shape,f,p);if(l!=null){const I=Fl(l),C=ms({inputs:{x},backend:t,attrs:{perm:I}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(c),C}return x}const une={kernelName:OI,backendName:"cpu",kernelFunc:lne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Ye(s,"cumsum");const l=Rn([i],s.shape.length);let c=s;l!=null&&(c=ms({inputs:{x:s},backend:t,attrs:{perm:l}}));const d=zn(1,s.shape.length)[0];if(d!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${d}`);const f=Ds(c.dtype,"int32"),p=Mr(xe(c.shape),f),g=t.data.get(c.dataId).values,y=c.shape[c.shape.length-1],w=a?(I,C)=>I+y-C-1:(I,C)=>I+C;for(let I=0;I<g.length;I+=y)for(let C=0;C<y;C++){const k=w(I,C);if(C===0)p[k]=o?0:g[k];else{const E=w(I,C-1);p[k]=o?g[E]+p[E]:g[k]+p[E]}}const x=t.makeTensorInfo(c.shape,f,p);if(l!=null){const I=Fl(l),C=ms({inputs:{x},backend:t,attrs:{perm:I}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(c),C}return x}const hne={kernelName:$0,backendName:"cpu",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,d=zS(l,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(s.shape.length===2){const l=t.bufferSync(s),c=t.bufferSync(i),d=hL(l,c,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const fne={kernelName:MI,backendName:"cpu",kernelFunc:dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r;z(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=s.shape[0],l=s.shape[1],c=s.shape[2],d=s.shape[3],f=l*i,p=c*i,g=d/(i*i),y=t.data.get(s.dataId).values,w=new Float32Array(a*f*p*g);let x=0;for(let I=0;I<a;++I)for(let C=0;C<f;++C){const k=Math.floor(C/i),E=C%i;for(let _=0;_<p;++_){const L=Math.floor(_/i),P=_%i,A=(E*i+P)*g;for(let $=0;$<g;++$){const R=$+A+d*(L+c*(k+l*I));w[x++]=y[R]}}}return t.makeTensorInfo([a,f,p,g],s.dtype,w)}const mne={kernelName:VI,backendName:"cpu",kernelFunc:pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;Ye([s,i],"depthwiseConv2DNative");const d=tt(s.shape),f=tt(i.shape);let p=l;p==null&&(p=[1,1]),z(zr(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=Sr(s.shape,i.shape,o,p,a,c,!0),{filterHeight:y,filterWidth:w,dilationHeight:x,dilationWidth:I,padInfo:C}=g,k=C.left,E=C.top,_=g.outChannels/g.inChannels,L=new Cr(g.outShape,s.dtype),P=t.data.get(s.dataId).values,A=t.data.get(i.dataId).values,$=L.values;for(let D=0;D<g.batchSize;++D){const R=D*d[0],M=D*L.strides[0];for(let O=0;O<g.outHeight;++O){const Z=M+O*L.strides[1],q=O*g.strideHeight-E;for(let se=0;se<y;++se){const le=q+se*x;if(le<0||le>=g.inHeight)continue;const j=se*f[0],Q=R+le*d[1];for(let ee=0;ee<g.outWidth;++ee){const U=Z+ee*L.strides[2],H=ee*g.strideWidth-k;for(let ue=0;ue<w;++ue){const Ie=H+ue*I;if(Ie<0||Ie>=g.inWidth)continue;const be=j+ue*f[1],ke=Q+Ie*g.inChannels;let De=U,Fe=be;for(let Ae=0;Ae<g.inChannels;++Ae){const Ge=P[ke+Ae];for(let st=0;st<_;++st)$[De+st]+=Ge*A[Fe+st];De+=_,Fe+=_}}}}}}return t.makeTensorInfo(L.shape,L.dtype,L.values)}const gne={kernelName:D0,backendName:"cpu",kernelFunc:hM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:d}=r;Ye([s,i],"depthwiseConv2dNativeBackpropFilter");const f=Sr(s.shape,d,o,a,l,c,!0),{strideHeight:p,strideWidth:g,filterHeight:y,filterWidth:w}=f,x=new Cr(f.filterShape,"float32"),I=f.padInfo.left,C=f.padInfo.top,k=f.outChannels/f.inChannels,E=t.data.get(s.dataId).values,_=new Cr(s.shape,s.dtype,E),L=t.data.get(i.dataId).values,P=new Cr(i.shape,i.dtype,L);for(let A=0;A<y;++A){const $=Math.max(0,Math.ceil((C-A)/p)),D=Math.min(f.outHeight,(f.inHeight+C-A)/p);for(let R=0;R<w;++R){const M=Math.max(0,Math.ceil((I-R)/g)),O=Math.min(f.outWidth,(f.inWidth+I-R)/g);for(let Z=0;Z<f.outChannels;++Z){const q=Math.trunc(Z/k),se=Z%k;let le=0;for(let j=0;j<f.batchSize;++j)for(let Q=$;Q<D;++Q){const ee=A+Q*p-C;for(let U=M;U<O;++U){const H=R+U*g-I;le+=_.get(j,ee,H,q)*P.get(j,Q,U,Z)}}x.set(le,A,R,q,se)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const vne={kernelName:zI,backendName:"cpu",kernelFunc:yne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:d}=r;Ye([s,i],"depthwiseConv2DNativeBackpropInput");const f=tt(s.shape),p=tt(i.shape),g=Sr(d,i.shape,o,a,l,c,!0),y=new Cr(g.inShape,"float32"),w=y.values,[x,I,C]=y.strides,k=t.data.get(s.dataId).values,[E,_,L]=f,P=t.data.get(i.dataId).values,[A,$,D]=p,{batchSize:R,filterHeight:M,filterWidth:O,inChannels:Z,inHeight:q,inWidth:se,outChannels:le,outHeight:j,outWidth:Q,strideHeight:ee,strideWidth:U}=g,H=M-1-g.padInfo.top,ue=O-1-g.padInfo.left,Ie=le/Z;for(let be=0;be<R;++be)for(let ke=0;ke<Z;++ke)for(let De=0;De<q;++De){const Fe=De-H,Ae=Math.max(0,Math.ceil(Fe/ee)),Ge=Math.min(j,(M+Fe)/ee);for(let st=0;st<se;++st){const Et=st-ue,gt=Math.max(0,Math.ceil(Et/U)),Wt=Math.min(Q,(O+Et)/U);let Rt=0;for(let kt=Ae;kt<Ge;++kt){const Ht=kt*ee-Fe;for(let qt=gt;qt<Wt;++qt){const mr=qt*U-Et,nn=E*be+_*kt+L*qt,pn=A*(M-1-Ht)+$*(O-1-mr)+D*ke;for(let yn=0;yn<Ie;++yn){const Tr=ke*Ie+yn,Dn=k[nn+Tr],En=P[pn+yn];Rt+=Dn*En}}}w[x*be+I*De+C*st+ke]=Rt}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const wne={kernelName:BI,backendName:"cpu",kernelFunc:xne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t}=n,{x:r}=e,s=xe(r.shape),i=t.data.get(r.dataId).values,o=It([s,s],r.dtype),a=o.values;for(let c=0;c<i.length;c++)a[c*s+c]=i[c];const l=[...r.shape,...r.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const Ine={kernelName:O$,backendName:"cpu",kernelFunc:bne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne={kernelName:P0,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:i,pad:o,dilations:a}=t,l=e,c=l.data.get(r.dataId).values,d=r.shape.length,f=l.data.get(s.dataId).values,p=s.shape.length,{batchSize:g,inHeight:y,inWidth:w,inChannels:x,outHeight:I,outWidth:C,padInfo:k,strideHeight:E,strideWidth:_,filterHeight:L,filterWidth:P,dilationHeight:A,dilationWidth:$,outShape:D}=Ap(r.shape,s.shape,i,o,"NHWC",a),R=xe(D),M=D.length,O=Ln(r.dtype,R);for(let q=0;q<g;++q)for(let se=0;se<I;++se){const le=se*E-k.top;for(let j=0;j<C;++j){const Q=j*_-k.left;for(let ee=0;ee<x;++ee){let U=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<L;++ue){const Ie=le+ue*A;if(Ie>=0&&Ie<y)for(let be=0;be<P;++be){const ke=Q+be*$;if(ke>=0&&ke<w){const De=To([q,Ie,ke,ee],d,tt(r.shape)),Fe=To([ue,be,ee],p,tt(s.shape)),Ae=c[De]+f[Fe];Ae>U&&(U=Ae)}}}const H=To([q,se,j,ee],M,tt(D));O[H]=U}}}return{dataId:l.write(Ku(O,r.dtype),D,r.dtype),shape:D,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sne={kernelName:M1,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,c=e,d=Hi(r.shape,c.data.get(r.dataId).values),f=Hi(s.shape,c.data.get(s.dataId).values),{batchSize:p,inHeight:g,inWidth:y,inChannels:w,outHeight:x,outWidth:I,padInfo:C,strideHeight:k,strideWidth:E,filterHeight:_,filterWidth:L,dilationHeight:P,dilationWidth:A,outShape:$}=Ap(r.shape,s.shape,o,a,"NHWC",l);z(i.rank===$.length,()=>`Error in ${M1}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const D=Hi($,c.data.get(i.dataId).values),R=$$(s.shape,s.dtype);for(let O=0;O<p;++O)for(let Z=0;Z<x;++Z){const q=Z*k-C.top;for(let se=0;se<I;++se){const le=se*E-C.left;for(let j=0;j<w;++j){let Q=Number.MIN_SAFE_INTEGER,ee=0,U=0;for(let H=0;H<_;++H){const ue=q+H*P;if(ue>=0&&ue<g)for(let Ie=0;Ie<L;++Ie){const be=le+Ie*A;if(be>=0&&be<y){const ke=d[O][ue][be][j]+f[H][Ie][j];ke>Q&&(Q=ke,ee=H,U=Ie)}}}R[ee][U][j]+=D[O][Z][se][j]}}}return{dataId:c.write(Ku(R,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ene={kernelName:L1,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,c=e,d=Hi(r.shape,c.data.get(r.dataId).values),f=Hi(s.shape,c.data.get(s.dataId).values),{batchSize:p,inHeight:g,inWidth:y,inChannels:w,outHeight:x,outWidth:I,padInfo:C,strideHeight:k,strideWidth:E,filterHeight:_,filterWidth:L,dilationHeight:P,dilationWidth:A,outShape:$}=Ap(r.shape,s.shape,o,a,"NHWC",l);z(i.rank===$.length,()=>`Error in ${L1}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const D=Hi($,c.data.get(i.dataId).values),R=$$(r.shape,r.dtype);for(let O=0;O<p;++O)for(let Z=0;Z<x;++Z){const q=Z*k-C.top;for(let se=0;se<I;++se){const le=se*E-C.left;for(let j=0;j<w;++j){let Q=Number.MIN_SAFE_INTEGER,ee=q<0?0:q,U=le<0?0:le;for(let H=0;H<_;++H){const ue=q+H*P;if(ue>=0&&ue<g)for(let Ie=0;Ie<L;++Ie){const be=le+Ie*A;if(be>=0&&be<y){const ke=d[O][ue][be][j]+f[H][Ie][j];ke>Q&&(Q=ke,ee=ue,U=be)}}}R[O][ee][U][j]+=D[O][Z][se][j]}}}return{dataId:c.write(Ku(R,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:i,options:o}=r,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=s.shape.slice(0,2),y=s.shape.length===2?1:s.shape[2],w=t.data.get(s.dataId).values,x=s.dtype==="float32"?255:1,I=new Uint8ClampedArray(g*p*4);for(let k=0;k<p*g;++k){const E=[0,0,0,255*c];for(let L=0;L<y;L++){const P=w[k*y+L];if(s.dtype==="float32"){if(P<0||P>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${P}.`)}else if(s.dtype==="int32"&&(P<0||P>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${P}.`);y===1?(E[0]=P*x,E[1]=P*x,E[2]=P*x):E[L]=P*x}const _=k*4;I[_+0]=Math.round(E[0]),I[_+1]=Math.round(E[1]),I[_+2]=Math.round(E[2]),I[_+3]=Math.round(E[3])}i.width=g,i.height=p;const C=new ImageData(I,g,p);return f.putImageData(C,0,0),s}const Tne={kernelName:B6,backendName:"cpu",kernelFunc:kne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qp(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ye(s,"sum");let a;s.dtype==="bool"?a=Rl({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):a=Vo({inputs:{x:s},backend:t});const l=a.shape.length,c=Ct(i,a.shape),d=Rn(c,l);let f=c,p=a;d!=null&&(p=ms({inputs:{x:a},backend:t,attrs:{perm:d}}),f=zn(f.length,l)),Er("sum",f,p.shape.length);const[g,y]=pr(p.shape,f),w=Ds(p.dtype,"int32");let x=zy(t,g,w);const I=xe(y),C=t.data.get(x.dataId).values,k=t.data.get(p.dataId).values;for(let E=0;E<C.length;++E){const _=E*I;let L=0;for(let P=0;P<I;++P)L+=k[_+P];C[E]=L}if(o){const E=qn(x.shape,c),_=x;x=fn({inputs:{x},backend:t,attrs:{shape:E}}),t.disposeIntermediateTensorInfo(_)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),x}const _ne={kernelName:fv,backendName:"cpu",kernelFunc:qp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=cS(s,i.length);dS(o.length,l,i);const{path:c,steps:d}=fS(a,l),f=d.length;let p=null,g=o.length;const y=[];for(let w=0;w<f;++w){for(const x of d[w]){const{permutationIndices:I,expandDims:C}=hS(g,l[x]);let k;pS(I)?k=i[x]:(k=ms({inputs:{x:i[x]},backend:t,attrs:{perm:I}}),y.push(k));const E=k.shape.slice();for(let _=0;_<C.length;++_)E.splice(C[_],0,1);Qt(k.shape,E)||(k=fn({inputs:{x:k},backend:t,attrs:{shape:E}}),y.push(k)),p===null?p=k:(p=Gv({inputs:{a:k,b:p},backend:t}),y.push(p))}w<f-1&&(c[w]>=0&&(p=qp({inputs:{x:p},backend:t,attrs:{axis:c[w]-(o.length-g),keepDims:!1}}),y.push(p)),g--)}for(const w of y)w!==p&&t.disposeIntermediateTensorInfo(w);return p}const Nne={kernelName:UI,backendName:"cpu",kernelFunc:Rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ane(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;Ye([r,s],"eluGrad");const i=new Float32Array(xe(s.shape)),o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?i[l]=a[l]:i[l]=a[l]*(c+1)}return t.makeTensorInfo(s.shape,"float32",i)}const $ne={kernelName:WI,backendName:"cpu",kernelFunc:Ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne=rS,Pne=sS,Fne=iS,One=oS,Lne=aS,Mne=lS,Vne=on(Yf,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+Dne*t);return e*(1-((((Mne*r+Lne)*r+One)*r+Fne)*r+Pne)*r*Math.exp(-t*t))}),zne={kernelName:Yf,backendName:"cpu",kernelFunc:Vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wy(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:i}=r,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(z(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),fn({inputs:{x:s},backend:t,attrs:{shape:a}})}const Bne={kernelName:O0,backendName:"cpu",kernelFunc:Wy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une=Un((n,e)=>n/e),HS=sr(Kf,Une),ub={kernelName:Kf,backendName:"cpu",kernelFunc:HS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dM(n,e,t){const r=n.shape,s=r[0],i=r[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[s,i],d=xe(c),f=Lr("float32",d),p=Lr("float32",d);for(let x=0;x<s;x++){const I=Bu({inputs:{x:a},backend:t,attrs:{begin:[x,0],size:[1,i]}}),C=Bu({inputs:{x:l},backend:t,attrs:{begin:[x,0],size:[1,i]}}),k=Ns({inputs:{real:I,imag:C},backend:t}),{real:E,imag:_}=Wne(k,e,t),L=wa(E,_);for(let P=0;P<i;P++){const A=uS(L,P);f[x*i+P]=A.real,p[x*i+P]=A.imag}t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k)}const g=t.makeTensorInfo(c,"float32",f),y=t.makeTensorInfo(c,"float32",p),w=Ns({inputs:{real:g,imag:y},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}function Wne(n,e,t){const r=xe(n.shape),s=t.data.get(n.dataId),i=t.data.get(s.complexTensorInfos.real.dataId).values,o=t.data.get(s.complexTensorInfos.imag.dataId).values;if(Gne(r)){const a=cb(i,o,r,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",$l(r,"float32")),p=Vo({inputs:{x:f},backend:t}),g=ub.kernelFunc({inputs:{a:c,b:f},backend:t}),y=ub.kernelFunc({inputs:{a:d,b:p},backend:t}),w=t.data.get(g.dataId).values,x=t.data.get(y.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),{real:w,imag:x}}return a}else{const a=wa(i,o),l=jne(a,r,e);return EP(l)}}function Gne(n){return(n&n-1)===0}function cb(n,e,t,r,s){if(t===1)return{real:n,imag:e};const i=wa(n,e),o=t/2,a=kP(i),l=a.real,c=a.imag,d=[l.length],f=s.makeTensorInfo(d,"float32",l),p=s.makeTensorInfo(d,"float32",c),g=Ns({inputs:{real:f,imag:p},backend:s}),y=TP(i),w=y.real,x=y.imag,I=[w.length],C=s.makeTensorInfo(I,"float32",w),k=s.makeTensorInfo(I,"float32",x),E=Ns({inputs:{real:C,imag:k},backend:s}),_=cb(l,c,o,r,s),L=_.real,P=_.imag,A=[L.length],$=s.makeTensorInfo(A,"float32",L),D=s.makeTensorInfo(A,"float32",P),R=Ns({inputs:{real:$,imag:D},backend:s}),M=cb(w,x,o,r,s),O=M.real,Z=M.imag,q=[O.length],se=s.makeTensorInfo(q,"float32",O),le=s.makeTensorInfo(q,"float32",Z),j=Ns({inputs:{real:se,imag:le},backend:s}),Q=RP(t,r),ee=[Q.real.length],U=s.makeTensorInfo(ee,"float32",Q.real),H=s.makeTensorInfo(ee,"float32",Q.imag),ue=Ns({inputs:{real:U,imag:H},backend:s}),Ie=Gv({inputs:{a:ue,b:j},backend:s}),be=wh({inputs:{a:R,b:Ie},backend:s}),ke=GS({inputs:{a:R,b:Ie},backend:s}),De=zu({inputs:{input:be},backend:s}),Fe=zu({inputs:{input:ke},backend:s}),Ae=bh({inputs:{input:be},backend:s}),Ge=bh({inputs:{input:ke},backend:s}),st=Ih({inputs:[De,Fe],backend:s,attrs:{axis:0}}),Et=Ih({inputs:[Ae,Ge],backend:s,attrs:{axis:0}}),gt=s.data.get(st.dataId).values,Wt=s.data.get(Et.dataId).values;return s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(E),s.disposeIntermediateTensorInfo($),s.disposeIntermediateTensorInfo(D),s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(se),s.disposeIntermediateTensorInfo(le),s.disposeIntermediateTensorInfo(j),s.disposeIntermediateTensorInfo(U),s.disposeIntermediateTensorInfo(H),s.disposeIntermediateTensorInfo(ue),s.disposeIntermediateTensorInfo(Ie),s.disposeIntermediateTensorInfo(be),s.disposeIntermediateTensorInfo(ke),s.disposeIntermediateTensorInfo(De),s.disposeIntermediateTensorInfo(Ae),s.disposeIntermediateTensorInfo(Fe),s.disposeIntermediateTensorInfo(Ge),s.disposeIntermediateTensorInfo(st),s.disposeIntermediateTensorInfo(Et),{real:gt,imag:Wt}}function jne(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let i=0,o=0;for(let a=0;a<e;a++){const l=NP(s*a,e,t),c=uS(n,a);i+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}t&&(i/=e,o/=e),_P(r,i,o,s)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hne(n){const{inputs:e,backend:t}=n,{input:r}=e,s=xe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=fn({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=dM(a,!1,t),c=fn({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const qne={kernelName:GI,backendName:"cpu",kernelFunc:Hne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qS(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:i}=t,o=i||Dh(s),a=Ln(o,xe(r));return Xne(a,s,o),e.makeTensorInfo(r,o,a)}const Kne={kernelName:jI,backendName:"cpu",kernelFunc:qS};function Xne(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne={kernelName:HI,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,i=Lr(r.dtype,xe(r.shape)),[o,a,l,c]=r.shape,d=s.data.get(r.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*c;for(let y=0;y<a;y++){const w=y*(l*c);for(let x=0;x<l;x++){const I=x*c;for(let C=0;C<c;C++){const k=Math.round(l-x-1),E=g+w+I+C;let _=d[E];if(k>=0&&k<l){const L=k*c,P=g+w+L+C;_=d[P]}i[E]=_}}}}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:y}=r;let w=cM({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const x=w;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const I=fn({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});w=wh({inputs:{a:w,b:I},backend:t}),t.disposeIntermediateTensorInfo(I)}else w=wh({inputs:{a:w,b:o},backend:t});t.disposeIntermediateTensorInfo(x)}if(g){const x=w;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const I=fn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=Uy(t,w,g,I,y),t.disposeIntermediateTensorInfo(I)}else w=Uy(t,w,g,a,y);t.disposeIntermediateTensorInfo(x)}return w}const Jne={kernelName:by,backendName:"cpu",kernelFunc:Qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:y}=r;let w=hM({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const x=w;w=wh({inputs:{a:w,b:o},backend:t}),t.disposeIntermediateTensorInfo(x)}if(g){const x=w;w=Uy(t,w,g,a,y),t.disposeIntermediateTensorInfo(x)}return w}const ere={kernelName:tD,backendName:"cpu",kernelFunc:Zne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=xe(r.shape),o=s.shape,a=o[o.length-1],[l,c,d,f]=HC(r,s);if(c===0)return t.makeTensorInfo(l,r.dtype,[]);const p=t.data.get(s.dataId).values,g=t.bufferSync(r),y=IL(p,g,r.dtype,c,a,d,f,r.shape,i);return t.makeTensorInfo(l,r.dtype,y.values)}const nre={kernelName:L$,backendName:"cpu",kernelFunc:tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r;Ye([s,i],"gatherV2");const l=Ct(o,s.shape)[0],c=t.data.get(i.dataId).values,d=s.shape[l];for(let E=0;E<c.length;++E){const _=c[E];z(_<=d-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=xe(i.shape),g=gS(s,i,l,f),y=fn({inputs:{x:s},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),w=fn({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),x=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],I=t.bufferSync(w),C=t.bufferSync(y),k=CL(C,I,x);return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(g.outputShape,k.dtype,k.values)}const sre={kernelName:M0,backendName:"cpu",kernelFunc:rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ire(n){const{inputs:e,backend:t}=n,{input:r}=e,s=xe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=fn({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=dM(a,!0,t),c=fn({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const ore={kernelName:qI,backendName:"cpu",kernelFunc:ire};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are=on(rp,n=>Number.isFinite(n)?1:0,"bool"),lre={kernelName:rp,backendName:"cpu",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ure=on(sp,n=>Math.abs(n)===1/0?1:0,"bool"),cre={kernelName:sp,backendName:"cpu",kernelFunc:ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hre=on(ip,n=>Number.isNaN(n)?1:0,"bool"),dre={kernelName:ip,backendName:"cpu",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=_L(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const pre={kernelName:M$,backendName:"cpu",kernelFunc:fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mre=on(ap,n=>Math.log1p(n)),gre={kernelName:ap,backendName:"cpu",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre=Un((n,e)=>n&&e),vre=sr(W0,yre,null,"bool"),xre={kernelName:W0,backendName:"cpu",kernelFunc:vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre=on(G0,n=>n?0:1,"bool"),bre={kernelName:G0,backendName:"cpu",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ire=Un((n,e)=>n||e),Cre=sr(j0,Ire,null,"bool"),Sre={kernelName:j0,backendName:"cpu",kernelFunc:Cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ere(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r;Ye(s,"LRN");const c=s.shape[3],d=c-1,f=t.data.get(s.dataId).values,p=xe(s.shape),g=new Float32Array(p);function y(w){const x=w%c;let I=w-x+Math.max(0,x-i);const C=w-x+Math.min(x+i,d);let k=0;for(;I<=C;I++){const E=f[I];k+=E*E}return k}for(let w=0;w<p;w++){const x=y(w),I=f[w]*Math.pow(o+a*x,-l);g[w]=I}return t.makeTensorInfo(s.shape,s.dtype,g)}const kre={kernelName:H0,backendName:"cpu",kernelFunc:Ere};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:d}=r;Ye(o,"LRNGrad");const f=xe(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,y=t.data.get(s.dataId).values,w=t.data.get(i.dataId).values,x=new Float32Array(f),I=f;for(let C=0;C<I;C++){const k=C%p,E=C-k+Math.max(0,k-a),_=C-k+Math.min(p,k+a+1);let L=0;for(let P=E;P<_;P++)L+=Math.pow(y[P],2);L=c*L+l;for(let P=E;P<_;P++){let A=-2*c*d*y[P]*w[C]/L;C===P&&(A+=Math.pow(L,-d)),A*=g[C],x[P]+=A}}return t.makeTensorInfo(o.shape,s.dtype,x)}const _re={kernelName:XI,backendName:"cpu",kernelFunc:Tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fM(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=t;let l=s.shape;const c=l.length,d=Ct(i,l);let f=d;const p=Rn(f,c);let g=a.data.get(s.dataId).values;if(p!=null){const E=new Array(c);for(let _=0;_<E.length;_++)E[_]=l[p[_]];g=US(g,l,s.dtype,p,E),f=zn(f.length,c),l=E}Ye(s,"max"),Er("max",f,c);const[y,w]=pr(l,f),x=xe(w),I=NL(g,x,y,s.dtype),C=a.write(I,y,s.dtype);let k=y;return o&&(k=qn(y,d)),{dataId:C,shape:k,dtype:s.dtype}}const Rre={kernelName:q0,backendName:"cpu",kernelFunc:fM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ye(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(zr(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=vi(s.shape,i,o,c,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&Qt(d.inShape,d.outShape))f=Vo({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,g=tt(s.shape),y=jS(p,s.shape,s.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,s.dtype,y.values)}return f}const Are={kernelName:K0,backendName:"cpu",kernelFunc:Nre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $re(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;Ye(s,"maxPool3d");const d=Ea(s.shape,i,o,1,a,l,c),f=t.data.get(s.dataId).values,p=uM(f,s.shape,s.dtype,tt(s.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const Dre={kernelName:X0,backendName:"cpu",kernelFunc:$re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;Ye([s,i],"maxPool3DGrad");const d=Ea(i.shape,o,a,1,l,c),f=t.bufferSync(i),p=Ite(f,d),g=d.strideDepth,y=d.strideHeight,w=d.strideWidth,x=d.dilationDepth,I=d.dilationHeight,C=d.dilationWidth,k=d.effectiveFilterDepth,E=d.effectiveFilterHeight,_=d.effectiveFilterWidth,L=k-1-d.padInfo.front,P=_-1-d.padInfo.left,A=E-1-d.padInfo.top,$=It(i.shape,"float32"),D=t.bufferSync(s);for(let R=0;R<d.batchSize;++R)for(let M=0;M<d.inChannels;++M)for(let O=0;O<d.inDepth;++O)for(let Z=0;Z<d.inHeight;++Z)for(let q=0;q<d.inWidth;++q){const se=O-L,le=Z-A,j=q-P;let Q=0;for(let ee=0;ee<k;ee+=x){const U=(se+ee)/g;if(!(U<0||U>=d.outDepth||Math.floor(U)!==U))for(let H=0;H<E;H+=I){const ue=(le+H)/y;if(!(ue<0||ue>=d.outHeight||Math.floor(ue)!==ue))for(let Ie=0;Ie<_;Ie+=C){const be=(j+Ie)/w;if(be<0||be>=d.outWidth||Math.floor(be)!==be)continue;const ke=k*E*_-1-p.get(R,U,ue,be,M),De=ee*E*_+H*_+Ie,Fe=ke===De?1:0;if(Fe===0)continue;const Ae=D.get(R,U,ue,be,M);Q+=Ae*Fe}}}$.set(Q,R,O,Z,q,M)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const Fre={kernelName:QI,backendName:"cpu",kernelFunc:Pre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Ye([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:d,dimRoundingMode:f}=r,p=vi(a.shape,l,c,1,d,f),g=t.data.get(a.dataId).values,y=It(p.outShape,a.dtype,lM(g,a.shape,a.dtype,p).values),w=p.strideHeight,x=p.strideWidth,I=p.dilationHeight,C=p.dilationWidth,k=p.effectiveFilterHeight,E=p.effectiveFilterWidth,_=E-1-p.padInfo.left,L=k-1-p.padInfo.top,P=It(a.shape,"float32"),A=t.data.get(s.dataId).values,$=It(s.shape,"float32",A);for(let D=0;D<p.batchSize;++D)for(let R=0;R<p.inChannels;++R)for(let M=0;M<p.inHeight;++M)for(let O=0;O<p.inWidth;++O){const Z=M-L,q=O-_;let se=0;for(let le=0;le<k;le+=I){const j=(Z+le)/w;if(!(j<0||j>=p.outHeight||Math.floor(j)!==j))for(let Q=0;Q<E;Q+=C){const ee=(q+Q)/x;if(ee<0||ee>=p.outWidth||Math.floor(ee)!==ee)continue;const U=k*E-1-y.get(D,j,ee,R),H=le*E+Q,ue=U===H?1:0;if(ue===0)continue;const Ie=$.get(D,j,ee,R);se+=Ie*ue}}P.set(se,D,M,O,R)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const Lre={kernelName:YI,backendName:"cpu",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(n,e,t,r,s){const i=tt(e),o=jS(n,e,t,i,s,"max"),a=lM(n,e,t,s,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vre={kernelName:V$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Ye(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,d=vi(r.shape,s,i,[1,1],o),[f,p]=Mre(c,r.shape,r.dtype,a,d),g=l.write(f,d.outShape,r.dtype),y=l.write(p,d.outShape,r.dtype);return[{dataId:g,shape:d.outShape,dtype:r.dtype},{dataId:y,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=Ct(i,s.shape),c=pr(s.shape,a)[1],d=xe(c),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=Rl({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});f.push(g);const y=HS({inputs:{a:g,b:p},backend:t});f.push(y);const w=qp({inputs:{x:y},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(x=>t.disposeIntermediateTensorInfo(x)),w}const Bre={kernelName:Y0,backendName:"cpu",kernelFunc:zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ye(s,"min");const a=Ct(i,s.shape);let l=a;const c=Rn(l,s.shape.length);let d=s;c!=null&&(d=ms({inputs:{x:s},backend:t,attrs:{perm:c}}),l=zn(l.length,s.shape.length)),Er("min",l,d.shape.length);const[f,p]=pr(d.shape,l),g=xe(p),y=Mr(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let I=0;I<y.length;++I){const C=I*g;let k=w[C];for(let E=0;E<g;++E){const _=w[C+E];(Number.isNaN(_)||_<k)&&(k=_)}y[I]=k}c!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(f,d.dtype,y);if(o){const I=qn(f,a),C=fn({inputs:{x},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(x),C}return x}const Wre={kernelName:Q0,backendName:"cpu",kernelFunc:Ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,mode:o}=r;Ye(s,"mirrorPad");const a=i.map((k,E)=>k[0]+s.shape[E]+k[1]),l=i.map(k=>k[0]),c=i.map((k,E)=>k[0]+s.shape[E]),d=o==="reflect"?0:1,f=t.data.get(s.dataId).values,p=s.shape.length,g=tt(s.shape),y=xe(a),w=a.length,x=tt(a),I=Lr(s.dtype,y);for(let k=0;k<y;k++){let E=Ph(k,w,x);for(let L=0;L<w;L++)E[L]<l[L]?E[L]=l[L]*2-E[L]-d:E[L]>=c[L]&&(E[L]=(c[L]-1)*2-E[L]+d);E=E.map((L,P)=>L-l[P]);const _=To(E,p,g);I[k]=f[_]}return{dataId:t.write(I,a,s.dtype),shape:a,dtype:s.dtype}}const jre={kernelName:J0,backendName:"cpu",kernelFunc:Gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hre=Un((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),qre=sr(cp,Hre),Kre={kernelName:cp,backendName:"cpu",kernelFunc:qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=s.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Ct([a],s.shape),c=fM({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=qn(c.shape,l),f=fn({inputs:{x:c},backend:t,attrs:{shape:d}}),p=GS({inputs:{a:s,b:f},backend:t}),g=vL({inputs:{x:p},backend:t}),y=qp({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),w=fn({inputs:{x:y},backend:t,attrs:{shape:d}}),x=HS({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),x}const Xre={kernelName:gv,backendName:"cpu",kernelFunc:pM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yre(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r;Ye(s,"multinomial");const l=a?s:pM({inputs:{logits:s},backend:t,attrs:{dim:-1}}),c=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[c,i],g=Mr(xe(p),"int32");for(let y=0;y<c;++y){const w=y*d,x=new Float32Array(d-1);x[0]=f[w];for(let k=1;k<x.length;++k)x[k]=x[k-1]+f[w+k];const I=AC.alea(o.toString()),C=y*i;for(let k=0;k<i;++k){const E=I();g[C+k]=x.length;for(let _=0;_<x.length;_++)if(E<x[_]){g[C+k]=_;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const Qre={kernelName:z$,backendName:"cpu",kernelFunc:Yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jre=zC;function Zre(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;Ye(s,"NonMaxSuppression");const c=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=Jre(c,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const ese={kernelName:JI,backendName:"cpu",kernelFunc:Zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse=BC;function nse(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Ye(s,"NonMaxSuppressionPadded");const d=t.data.get(s.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=tse(d,f,o,a,l,c);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const rse={kernelName:ZI,backendName:"cpu",kernelFunc:nse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse=UC;function ise(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Ye(s,"NonMaxSuppressionWithScore");const d=t.data.get(s.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,y=l,w=c,{selectedIndices:x,selectedScores:I}=sse(d,f,p,g,y,w);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([I.length],"float32",new Float32Array(I))]}const ose={kernelName:eC,backendName:"cpu",kernelFunc:ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r;Ye(s,"oneHot");const c=xe(s.shape),d=new Float32Array(c*o);d.fill(l);const f=t.data.get(s.dataId).values;for(let p=0;p<c;++p)f[p]>=0&&f[p]<o&&(d[p*o+f[p]]=a);return t.makeTensorInfo([...s.shape,o],i,d)}const lse={kernelName:nv,backendName:"cpu",kernelFunc:ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gy(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=zu({inputs:{input:r},backend:t}),i=Gy({inputs:{x:s},backend:t}),o=bh({inputs:{input:r},backend:t}),a=Gy({inputs:{x:o},backend:t}),l=Ns({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qS({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const use={kernelName:xv,backendName:"cpu",kernelFunc:Gy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mM(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=zu({inputs:{input:r},backend:t}),i=mM({inputs:{x:s},backend:t}),o=bh({inputs:{input:r},backend:t}),a=Gy({inputs:{x:o},backend:t}),l=Ns({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qS({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const cse={kernelName:tv,backendName:"cpu",kernelFunc:mM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gM(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return Wy({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{bI(i,d.shape,"All tensors passed to stack must have matching shapes"),z(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Wy({inputs:{input:d},backend:t,attrs:{dim:s}});return a.push(f),f}),c=Ih({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),c}const hse={kernelName:rv,backendName:"cpu",kernelFunc:gM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;Ye(s,"pad");const a=i.map((C,k)=>C[0]+s.shape[k]+C[1]),l=i.map(C=>C[0]),c=t.data.get(s.dataId).values,d=xe(s.shape),f=s.shape.length,p=tt(s.shape),g=xe(a),y=a.length,w=tt(a),x=Lr(s.dtype,g);o!==0&&x.fill(o);for(let C=0;C<d;C++){const E=Ph(C,f,p).map((L,P)=>L+l[P]),_=To(E,y,w);x[_]=c[C]}return{dataId:t.write(x,a,s.dtype),shape:a,dtype:s.dtype}}const yM={kernelName:sv,backendName:"cpu",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=Un((n,e)=>Math.pow(n,e)),pse=sr(dp,fse),mse={kernelName:dp,backendName:"cpu",kernelFunc:pse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,a=s.map(x=>t.data.get(x.dataId).values),l=s.map(x=>x.shape),c=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values,[f,p,g]=OL(a,l,c,i.shape,i.dtype,d,o.shape),y=f.map(x=>t.makeTensorInfo([x.length],"int32",x)),w=t.makeTensorInfo(g,i.dtype,p);return y.concat([w])}const yse={kernelName:B$,backendName:"cpu",kernelFunc:gse};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vse(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[c,d]=LL(o,r.shape,r.dtype,a,s.shape,l,i.shape),f=t.makeTensorInfo([c.length],"int32",c),p=t.makeTensorInfo([d.length],r.dtype,d);return[f,p]}const xse={kernelName:U$,backendName:"cpu",kernelFunc:vse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(x=>t.data.get(x.dataId).values),g=a.map(x=>x.shape),[y,w]=ML(c,s.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(y,i.dtype,w)}const bse={kernelName:W$,backendName:"cpu",kernelFunc:wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:i,step:o}=t,a=VL(r,s,o,i);return e.makeTensorInfo([a.length],i,a)}const Cse={kernelName:tC,backendName:"cpu",kernelFunc:Ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sse=on(fp,n=>1/n),Ese={kernelName:fp,backendName:"cpu",kernelFunc:Sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Ye(s,"resizeBilinear");const l=tt(s.shape),[c,d]=a,[f,p,g,y]=s.shape,w=t.data.get(s.dataId).values,x=new Float32Array(xe([f,c,d,y])),I=[i&&c>1?p-1:p,i&&d>1?g-1:g],C=[i&&c>1?c-1:c,i&&d>1?d-1:d];let k=0;const E=I[0]/C[0],_=I[1]/C[1];for(let L=0;L<f;L++)for(let P=0;P<c;P++){let A;o?A=E*(P+.5)-.5:A=E*P;const $=Math.max(0,Math.floor(A)),D=A-$,R=Math.min(p-1,Math.ceil(A)),M=L*l[0]+$*l[1],O=L*l[0]+R*l[1];for(let Z=0;Z<d;Z++){let q;o?q=_*(Z+.5)-.5:q=_*Z;const se=Math.max(0,Math.floor(q)),le=q-se,j=Math.min(g-1,Math.ceil(q)),Q=M+se*l[2],ee=O+se*l[2],U=M+j*l[2],H=O+j*l[2];for(let ue=0;ue<y;ue++){const Ie=w[Q+ue],be=w[ee+ue],ke=w[U+ue],De=w[H+ue],Fe=Ie+(ke-Ie)*le,Ae=be+(De-be)*le,Ge=Fe+(Ae-Fe)*D;x[k++]=Ge}}}return t.makeTensorInfo([f,c,d,y],"float32",x)}const Tse={kernelName:uv,backendName:"cpu",kernelFunc:kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Ye([i,s],"resizeBilinearGrad");const a=tt(s.shape),[l,c,d,f]=s.shape,[,p,g]=i.shape,y=new Float32Array(l*c*d*f),w=[o&&p>1?c-1:c,o&&g>1?d-1:d],x=[o&&p>1?p-1:p,o&&g>1?g-1:g],I=w[0]/x[0],C=w[1]/x[1],k=t.data.get(i.dataId).values;let E=0;for(let _=0;_<l;_++){const L=_*a[0];for(let P=0;P<p;P++){const A=P*I,$=Math.floor(A),D=Math.min(Math.ceil(A),c-1),R=L+$*a[1],M=L+D*a[1],O=A-$,Z=1-O;for(let q=0;q<g;q++){const se=q*C,le=Math.floor(se),j=Math.min(Math.ceil(se),d-1),Q=se-le,ee=1-Q,U=R+le*a[2],H=R+j*a[2],ue=M+le*a[2],Ie=M+j*a[2],be=Z*ee,ke=Z*Q,De=O*ee,Fe=O*Q;for(let Ae=0;Ae<f;Ae++){const Ge=k[E++];y[U+Ae]+=Ge*be,y[H+Ae]+=Ge*ke,y[ue+Ae]+=Ge*De,y[Ie+Ae]+=Ge*Fe}}}}return t.makeTensorInfo([l,d,c,f],"float32",y)}const Rse={kernelName:sC,backendName:"cpu",kernelFunc:_se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Ye(s,"resizeNearestNeighbor");const l=tt(s.shape),[c,d]=a,[f,p,g,y]=s.shape,w=t.data.get(s.dataId).values,x=new Float32Array(f*c*d*y),I=[i&&c>1?p-1:p,i&&d>1?g-1:g],C=[i&&c>1?c-1:c,i&&d>1?d-1:d],k=I[0]/C[0],E=I[1]/C[1];let _=0;for(let L=0;L<f;L++){const P=L*l[0];for(let A=0;A<c;A++){const $=o?k*(A+.5):k*A;let D=Math.min(p-1,i?Math.round($):Math.floor($));o&&(D=Math.max(0,D));const R=P+D*l[1];for(let M=0;M<d;M++){const O=o?E*(M+.5):E*M;let Z=Math.min(g-1,i?Math.round(O):Math.floor(O));o&&(Z=Math.max(0,Z));const q=R+Z*l[2];for(let se=0;se<y;se++){const le=w[q+se];x[_++]=le}}}}return t.makeTensorInfo([f,c,d,y],s.dtype,x)}const Ase={kernelName:lv,backendName:"cpu",kernelFunc:Nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Ye([i,s],"resizeNearestNeighborGrad");const a=tt(s.shape),l=tt(i.shape),[c,d,f,p]=s.shape,[,g,y]=i.shape,w=new Float32Array(c*d*f*p),x=t.data.get(i.dataId).values,I=[o&&g>1?d-1:d,o&&y>1?f-1:f],C=[o&&g>1?g-1:g,o&&y>1?y-1:y],k=I[0]/C[0],E=I[1]/C[1],_=1/k,L=1/E,P=Math.ceil(_)*2+2,A=Math.ceil(L)*2+2;for(let $=0;$<c;$++){const D=$*a[0];for(let R=0;R<d;R++){const M=D+R*a[1],O=Math.floor(R*_),Z=Math.floor(O-P/2);for(let q=0;q<f;q++){const se=M+q*a[2],le=Math.floor(q*L),j=Math.floor(le-A/2);for(let Q=0;Q<p;Q++){let ee=0;for(let U=0;U<P;U++){const H=U+Z;if(H<0||H>=g)continue;const ue=D+H*l[1],Ie=H*k,be=Math.min(d-1,o?Math.round(Ie):Math.floor(Ie));if(R===be)for(let ke=0;ke<A;ke++){const De=ke+j;if(De<0||De>=y)continue;const Fe=ue+De*l[2],Ae=De*E,Ge=Math.min(f-1,o?Math.round(Ae):Math.floor(Ae));q===Ge&&(ee+=x[Fe+Q])}}w[se+Q]=ee}}}}return t.makeTensorInfo(s.shape,s.dtype,w)}const Dse={kernelName:rC,backendName:"cpu",kernelFunc:$se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r;Ye(s,"reverse");const o=s.shape.length,a=Ct(i,s.shape);if(o===0)return Vo({inputs:{x:s},backend:t});const l=new Cr(s.shape,s.dtype),c=t.bufferSync(s);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=s.shape[g]-1-p[g]),l.set(c.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const Fse={kernelName:cv,backendName:"cpu",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose={kernelName:hC,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=Lr(r.dtype,xe(r.shape)),[c,d,f,p]=r.shape,[g,y]=eS(o,d,f),w=255,x=Math.sin(s),I=Math.cos(s),C=a.data.get(r.dataId).values;for(let E=0;E<c;E++){const _=E*f*d*p;for(let L=0;L<d;L++){const P=L*(f*p);for(let A=0;A<f;A++){const $=A*p;for(let D=0;D<p;D++){const R=[c,L,A,D],M=R[2],O=R[1];let Z=(M-g)*I-(O-y)*x,q=(M-g)*x+(O-y)*I;Z=Math.round(Z+g),q=Math.round(q+y);let se=i;if(typeof i!="number"&&(D===3?se=w:se=i[D]),Z>=0&&Z<f&&q>=0&&q<d){const j=q*(f*p),Q=Z*p,ee=_+j+Q+D;se=C[ee]}const le=_+P+$+D;l[le]=se}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse=on(gp,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),Mse={kernelName:gp,backendName:"cpu",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:f}=Qu(i,s,o),p=!0,g=t.bufferSync(s),y=t.bufferSync(i),w=xu(g,y,o,f,c,l,a,d,0,p);return t.makeTensorInfo(o,w.dtype,w.values)}const zse={kernelName:G$,backendName:"cpu",kernelFunc:Vse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function Use(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function Wse(n,e,t,r,s,i){const o=Ln("int32",t*s);for(let a=0;a<t;++a){const l=n.slice(a*r,(a+1)*r),c=a*s;for(let d=0;d<s;++d)o[c+d]=i==="left"?Bse(l,e[d+c]):Use(l,e[d+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,c=Wse(a,l,s.shape[0],s.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}const jse={kernelName:H$,backendName:"cpu",kernelFunc:Gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e;Ye([r,s,i],"select");const o=r.shape.length,a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,d=Ds(s.dtype,i.dtype),f=Mr(xe(s.shape),d);let p=0;const g=o===0||o>1||s.shape.length===1?1:xe(s.shape.slice(1));for(let y=0;y<a.length;y++)for(let w=0;w<g;w++)a[y]===1?f[p++]=l[y]:f[p++]=c[y];return t.makeTensorInfo(s.shape,d,f)}const qse={kernelName:hv,backendName:"cpu",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kse=Av,Xse=$v,Yse=on(vp,n=>n>=0?Xse*n:Kse*(Math.exp(n)-1)),Qse={kernelName:vp,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse=on(bp,n=>n<0?-1:n>0?1:0),Zse={kernelName:bp,backendName:"cpu",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie=on(xp,n=>Math.sin(n)),tie={kernelName:xp,backendName:"cpu",kernelFunc:eie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nie=on(wp,n=>Math.sinh(n)),rie={kernelName:wp,backendName:"cpu",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sie=11920928955078125e-23,pN=Math.log(sie)+2,iie=on(Cp,n=>{const e=n>-pN,t=n<pN,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),oie={kernelName:Cp,backendName:"cpu",kernelFunc:iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;Ye([s],"spaceToBatchND");const a=xe(i),l=[[0,0]];l.push(...o);for(let L=1+i.length;L<s.shape.length;++L)l.push([0,0]);const c=yM.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),d=Op(c.shape,i,a,!1),f=Lp(d.length,i.length,!1),p=Mp(c.shape,i,a,!1),w=fn({inputs:{x:c},backend:t,attrs:{shape:d}}),C=ms({inputs:{x:w},backend:t,attrs:{perm:f}}),_=fn({inputs:{x:C},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(C),_}const lie={kernelName:pv,backendName:"cpu",kernelFunc:aie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uie(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,p,g,y,w]=WL(a,r.shape,r.dtype,l,s.dtype,c,d);return[t.makeTensorInfo(p,r.dtype,f),t.makeTensorInfo([p[0]],s.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(x=>Number(x)))),t.makeTensorInfo([w.length],r.dtype,new Int32Array(w))]}const cie={kernelName:q$,backendName:"cpu",kernelFunc:uie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hie(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(s.dataId).values),a=t.data.get(r.dataId).values,l=Array.from(t.data.get(i.dataId).values),[c,d,f]=GL(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(d,r.dtype,c),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const die={kernelName:K$,backendName:"cpu",kernelFunc:hie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fie(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[c,d]=WS(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(d,r.dtype,c)}const pie={kernelName:X$,backendName:"cpu",kernelFunc:fie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[c,d]=WS(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(d,r.dtype,c)}const gie={kernelName:Y$,backendName:"cpu",kernelFunc:mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:d,strides:f,outputSize:p}=Qu(i,s,a),g=!1,y=t.bufferSync(s);let w;switch(i.dtype){case"bool":{const x=t.bufferSync(i),I=!!t.data.get(o.dataId).values[0];w=xu(y,x,a,p,d,c,l,f,I,g);break}case"float32":{const x=t.bufferSync(i),I=t.data.get(o.dataId).values[0];w=xu(y,x,a,p,d,c,l,f,I,g);break}case"int32":{const x=t.bufferSync(i),I=t.data.get(o.dataId).values[0];w=xu(y,x,a,p,d,c,l,f,I,g);break}case"string":{const x=t.bufferSync(i),I=Sl(t.data.get(o.dataId).values[0]);w=xu(y,x,a,p,d,c,l,f,I,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,w.dtype,w.values)}const vie={kernelName:Q$,backendName:"cpu",kernelFunc:yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=Ct(o,s.shape)[0],l=mS(s,i,a),c=new Array(s.shape.length).fill(0),d=s.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=Bu({inputs:{x:s},backend:t,attrs:{begin:c,size:p}});return c[a]+=f,g})}const wie={kernelName:mv,backendName:"cpu",kernelFunc:xie};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bie={kernelName:iC,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;Ye(t,"square");const s=r.data.get(t.dataId).values,i=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];i[a]=l*l}return{dataId:r.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iie=on(Np,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),Cie={kernelName:Np,backendName:"cpu",kernelFunc:Iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=r;Ye(s,"stridedSlice");const{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:x,isSimpleSlice:I,begin:C,end:k,strides:E}=QC(s.shape,i,o,a,l,c,d,f,p);let _;if(w)_=fn({inputs:{x:s},backend:t,attrs:{shape:y}});else if(x||I){z(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const L=KC(C,k,E),P=Bu({inputs:{x:s},backend:t,attrs:{begin:C,size:L}});_=fn({inputs:{x:P},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(P)}else{const L=t.bufferSync(s),P=qL(g,L,E,C);_=t.makeTensorInfo(y,P.dtype,P.values)}return _}const Eie={kernelName:aC,backendName:"cpu",kernelFunc:Sie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[y,w]=KL(p,g,s,i,o,a,l,c);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const Tie={kernelName:J$,backendName:"cpu",kernelFunc:kie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ie(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[c,d,f]=XL(a,l,s),p=d.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Rie={kernelName:Z$,backendName:"cpu",kernelFunc:_ie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nie(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=YL(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const Aie={kernelName:eD,backendName:"cpu",kernelFunc:Nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ie=on(Tp,n=>Math.tan(n)),Die={kernelName:Tp,backendName:"cpu",kernelFunc:$ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pie=on(_p,n=>Math.tanh(n)),Fie={kernelName:_p,backendName:"cpu",kernelFunc:Pie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:d}=Qu(i,s,r.shape),f=!1,p=t.bufferSync(s),g=t.bufferSync(i),y=t.bufferSync(r),w=xu(p,g,r.shape,d,l,a,o,c,y,f);return t.makeTensorInfo(r.shape,w.dtype,w.values)}const Lie={kernelName:j$,backendName:"cpu",kernelFunc:Oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;Ye(s,"tile");const o=JL(t.bufferSync(s),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const Vie={kernelName:Rp,backendName:"cpu",kernelFunc:Mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zie(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r;Ye(s,"topk");const a=t.data.get(s.dataId).values,[l,c]=eM(a,s.shape,s.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const Bie={kernelName:lC,backendName:"cpu",kernelFunc:zie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=t,[d,f,p,g]=s.shape,[y,w]=c??[f,p],x=[d,y,w,g],I=tt(s.shape),C=I[0],k=I[1],E=I[2],_=tt(x),L=_[0],P=_[1],A=_[2],$=Lr(s.dtype,xe(x));$.fill(l);const D=r.data.get(s.dataId).values,R=r.data.get(i.dataId).values;for(let O=0;O<d;++O){const Z=i.shape[0]===1?R:R.subarray(O*8,O*8+8);for(let q=0;q<y;++q)for(let se=0;se<w;++se)for(let le=0;le<g;++le){let j;const Q=Z[6]*se+Z[7]*q+1;if(Q===0)continue;const ee=(Z[0]*se+Z[1]*q+Z[2])/Q,U=(Z[3]*se+Z[4]*q+Z[5])/Q,H=mN(ee,p,a),ue=mN(U,f,a);switch(o){case"nearest":j=Kie(D,f,p,C,k,E,O,ue,H,le,l);break;case"bilinear":j=Xie(D,f,p,C,k,E,O,ue,H,le,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const Ie=O*L+q*P+se*A+le;$[Ie]=j}return r.makeTensorInfo(x,s.dtype,$)}return{dataId:r.write($,x,s.dtype),shape:s.shape,dtype:s.dtype}}const Wie={kernelName:uC,backendName:"cpu",kernelFunc:Uie};function mN(n,e,t){switch(t){case"reflect":return Gie(n,e);case"wrap":return jie(n,e);case"nearest":return qie(n,e);case"constant":default:return Hie(n)}}function Gie(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return _u(0,t,e-1)}function jie(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return _u(0,t,e-1)}function Hie(n,e){return n}function qie(n,e){return _u(0,n,e-1)}function Gd(n,e,t,r,s,i,o,a,l,c,d){const f=o*r+a*s+l*i+c;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function Kie(n,e,t,r,s,i,o,a,l,c,d){const f=Math.round(a),p=Math.round(l);return Gd(n,e,t,r,s,i,o,f,p,c,d)}function Xie(n,e,t,r,s,i,o,a,l,c,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,y=p+1,w=(y-l)*Gd(n,e,t,r,s,i,o,f,p,c,d)+(l-p)*Gd(n,e,t,r,s,i,o,f,y,c,d),x=(y-l)*Gd(n,e,t,r,s,i,o,g,p,c,d)+(l-p)*Gd(n,e,t,r,s,i,o,g,y,c,d);return(g-a)*w+(a-f)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Ye(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=tM(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const Qie={kernelName:cC,backendName:"cpu",kernelFunc:Yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s.shape.length,a=s.shape[i],l=new Array(o-1);let c=0;for(let g=0;g<o;g++)g!==i&&(l[c++]=s.shape[g]);const d=new Array(o).fill(0),f=s.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[i]=g;const y=Bu({inputs:{x:s},backend:t,attrs:{begin:d,size:f}});p[g]=fn({inputs:{x:y},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(y)}return p}const Zie={kernelName:yv,backendName:"cpu",kernelFunc:Jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r;Ye(s,"unsortedSegmentSum");const a=s.shape.length,l=i.shape.length,c=[],d=[],f=a-l;let p=i;for(let y=0;y<f;++y){const w=Wy({inputs:{input:p},backend:t,attrs:{dim:y+1}});p=w,d.push(w)}for(let y=0;y<o;++y){const w=$l(y,"int32"),x=t.makeTensorInfo([],"int32",w),I=gL({inputs:{a:x,b:p},backend:t}),C=Rl({inputs:{x:I},backend:t,attrs:{dtype:"float32"}}),k=Gv({inputs:{a:C,b:s},backend:t}),E=qp({inputs:{x:k},backend:t,attrs:{axis:0,keepDims:!1}});c.push(E),d.push(x),d.push(I),d.push(C),d.push(k),d.push(E)}const g=gM({inputs:c,backend:t,attrs:{axis:0}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const toe={kernelName:vv,backendName:"cpu",kernelFunc:eoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const noe=[Yee,NZ,Jee,ete,OZ,nte,ste,ote,lte,cte,dte,pte,gte,xte,bte,Ste,kte,_te,Nte,Kee,$te,Pte,Ote,MZ,Mte,PZ,zZ,zte,AZ,Ute,Gte,jte,qte,Xte,Qte,Zte,tne,rne,ine,ane,une,hne,fne,mne,gne,vne,wne,Ine,Cne,Sne,Ene,Tne,Nne,Bee,$ne,BZ,zne,UZ,Bne,GZ,qne,Kne,Yne,HZ,KZ,Jne,ere,nre,sre,YZ,JZ,$Z,ore,Wte,lre,cre,dre,Uee,eee,nee,pre,see,gre,xre,bre,Sre,kre,_re,Rre,oee,Are,Dre,Fre,Lre,Vre,Bre,Wre,lee,jre,Kre,Qre,cee,dee,ese,rse,ose,pee,lse,cse,hse,yM,mse,Gee,yee,yse,xse,bse,Cse,DZ,ub,Ese,jee,Hee,qee,Tse,Rse,Ase,Dse,Fse,Ose,Mse,Eee,zse,jse,qse,Qse,Tee,Zse,tie,rie,_ee,Xre,oie,lie,cie,die,pie,gie,vie,wie,Aee,bie,Dee,Fee,Cie,Eie,Tie,Rie,Aie,Vee,_ne,Die,Fie,Lie,Vie,Bie,Wie,mee,Qie,Zie,toe,use];for(const n of noe)nD(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pu={},Ig={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function roe(n,e){pu[n]=e}function Zi(n,e){if(!(n in pu)||e!=null){const r=ioe(n,e);if(r!==null)pu[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=pu[n];return t==null||t.isContextLost()?(delete pu[n],Zi(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),pu[n])}function soe(n){if(!pe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function ioe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??soe(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete pu[n]},!1),pe().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ig.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Ig)||t.getContext("experimental-webgl",Ig):t.getContext("webgl2",Ig)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vf;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(vf||(vf={}));var qs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(qs||(qs={}));var br;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(br||(br={}));function Kp(n,e){return[e,n]}function ooe(n,e){return n*e}function Cg(n){const e=xe(n),t=Math.ceil(e/4);return D1(t)}function Bh(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function aoe(n,e){const[t,r]=Bh(n,e);return t*r*4}function KS(n,e){const t=n;let r,s,i,o,a,l,c,d,f,p;return pe().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,c=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(r=n.RGBA,s=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,c=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(n,e){const t=e();return pe().getBool("DEBUG")&&loe(n),t}function loe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+doe(n,e))}const uoe=596e-10,coe=65504;function hoe(n){return!!(pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||uoe<Math.abs(n)&&Math.abs(n)<coe)}function doe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Sg(n,e){return Ta(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function foe(n,e){const t=Ta(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ve(n,()=>n.shaderSource(t,e)),Ve(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function poe(n,e){const t=Ta(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ve(n,()=>n.shaderSource(t,e)),Ve(n,()=>n.compileShader(t)),pe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw vM(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const moe=/ERROR: [0-9]+:([0-9]+):/g;function vM(n,e){const t=moe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),i=s.length.toString().length+2,o=s.map((f,p)=>Zc((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,r-1),c=o.slice(r-1,r),d=o.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Zc(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function goe(n){return Ta(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function yoe(n,e){if(Ve(n,()=>n.linkProgram(e)),!pe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function e1(n,e){if(Ve(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function voe(n,e){const t=Ta(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ve(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Ve(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function xoe(n,e){const t=Ta(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ve(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Ve(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function woe(n){return Ta(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function boe(n,e){const t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function Ioe(n){return Ta(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function gN(n,e,t,r,s,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Ve(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),Ve(n,()=>n.vertexAttribPointer(a,s,n.FLOAT,!1,i,o)),Ve(n,()=>n.enableVertexAttribArray(a)),!0)}function Coe(n,e,t){_oe(n,t),Ve(n,()=>n.activeTexture(n.TEXTURE0+t)),Ve(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function Soe(n,e,t){return Ta(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function Eoe(n,e,t){return n.getUniformLocation(e,t)}function koe(n,e,t,r){Ve(n,()=>Coe(n,e,r)),Ve(n,()=>n.uniform1i(t,r))}function t1(n,e,t){Ve(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Ve(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function yN(n,e){Ve(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Ve(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Eg(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Toe(n,e))}function Toe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Ta(n,e,t){const r=Ve(n,()=>e());if(r==null)throw new Error(t);return r}function _oe(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function Ch(n,e=2){return xe(n.slice(0,n.length-e))}function Sh(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function kg(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Ch(n),...Sh(n)]),e}function Roe(n,e=!1){let t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=pe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&pe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?wI(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Al(n).newShape);let s=xe(n),i=null;n.length<=1&&s<=t?i=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Ch(n);let l=2,c=2;n.length&&([l,c]=Sh(n)),s=a*(l/2)*(c/2),i=D1(s).map(d=>d*2)}else i=D1(s);return i}function Tg(n){return n%2===0}function jy(n,e){if(n=n.slice(-2),e=e.slice(-2),Qt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||Tg(t)&&Tg(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Tg(n[0])&&Tg(e[0])}let n1,r1;function Noe(n){if(n1==null){const e=Zi(n);n1=e.getParameter(e.MAX_TEXTURE_SIZE)}return n1}function Aoe(n){if(r1==null){const e=Zi(n);r1=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,r1)}function $oe(n){if(n===0)return 0;let e;const t=Zi(n);return mi(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:mi(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function mi(n,e){return n.getExtension(e)!=null}function vN(n){try{if(Zi(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Doe(n){if(n===0)return!1;const e=Zi(n);if(n===1){if(!mi(e,"OES_texture_float"))return!1}else if(!mi(e,"EXT_color_buffer_float"))return!1;return hb(e)}function Poe(n){if(n===0)return!1;const e=Zi(n);if(n===1){if(!mi(e,"OES_texture_float")||!mi(e,"WEBGL_color_buffer_float"))return!1}else{if(mi(e,"EXT_color_buffer_float"))return hb(e);const r="EXT_color_buffer_half_float";if(mi(e,r)){const s=e.getExtension(r);return Foe(e,s)}return!1}return hb(e)}function hb(n){const e=KS(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function Foe(n,e){const t=KS(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),a}function Ooe(n){return n!==2?!1:Zi(n).fenceSync!=null}function Xp(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&z(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Je=pe();Je.registerFlag("HAS_WEBGL",()=>Je.getNumber("WEBGL_VERSION")>0);Je.registerFlag("WEBGL_VERSION",()=>vN(2)?2:vN(1)?1:0);Je.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Je.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Je.get("WEBGL_VERSION")===2);Je.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Je.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Je.registerFlag("WEBGL_PACK",()=>Je.getBool("HAS_WEBGL"));Je.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_CLIP",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_REDUCE",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_LAZILY_UNPACK",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_CONV_IM2COL",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Noe(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Aoe(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Je.getNumber("WEBGL_VERSION");return n===0?0:$oe(n)});Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!mD());Je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Doe(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Je.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Poe(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Ooe(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Je.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Je.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Je.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>mD()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Je.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Je.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Je.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Je.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Je.registerFlag("WEBGL_EXP_CONV",()=>!1);Je.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Je.getBool("IS_TEST"));Je.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Je.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Je.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Je.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ss(){let n,e,t,r,s,i,o,a,l,c;return pe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",i="outputColor",o="out vec4 outputColor;",a=pe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(n,e,t="index"){const r=tt(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / ${s}`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${s}`:`index -= ${n[i]} * ${s}`;return`${o}; ${a};`}).join("")}function jv(n,e,t="index"){const r=tt(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function Loe(n,e){const t=n.length,r=n.map(i=>`${e}[${i}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let i=t-3;i>=0;--i)s[i]=`(${s[i+1]} * ${r[i+1]})`;return s}function Moe(n,e,t="index"){const r=n.map((i,o)=>o),s=Loe(r,e);return s.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${s[o]}`,l=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${s[o]}`:`index -= ${n[o]} * ${s[o]}`;return`${a}; ${l};`}).join("")}function XS(n){const e=tt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function YS(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const xM=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:wM}=E7;function Voe(n,e,t){const r=[];if(n.forEach(g=>{const y=xe(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?r.push(`uniform float ${g.name}${y>1?`[${y}]`:""};`):(r.push(`uniform sampler2D ${g.name};`),r.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:w}=QS(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(w.length){case 1:r.push(`uniform int ${g.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${g.name}Shape;`);break}r.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{r.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const s=r.join(`
`),i=n.map(g=>zoe(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=ss(),l=Woe(a);let c,d,f=Hoe(a);return e.isPacked?(c=Boe(e.logicalShape,o,t.enableShapeUniforms),d=joe(a)):(c=Uoe(e.logicalShape,o,t.enableShapeUniforms),d=Goe(a)),t.packedInputs&&(f+=Yoe),[f,l,d,s,c,i,t.userCode].join(`
`)}function Uh(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return lae(n,e);case 1:return cae(n,e);case 2:return dae(n,e);case 3:return pae(n,e);case 4:return gae(n,e);case 5:return yae(n);case 6:return vae(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function bM(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return aae(n);case 1:return uae(n,e);case 2:return hae(n,e);case 3:return fae(n,e);default:return mae(n,e)}}function zoe(n,e,t=!1,r){let s="";t?s+=bM(n,r):s+=Uh(n,r);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?s+=xae(n,e):s+=wae(n,e)),s}function Boe(n,e,t){switch(n.length){case 0:return IM();case 1:return Qoe(n,e,t);case 2:return iae(n,e,t);case 3:return Zoe(n,e,t);default:return tae(n,e,t)}}function Uoe(n,e,t){switch(n.length){case 0:return IM();case 1:return Joe(n,e,t);case 2:return oae(n,e,t);case 3:return eae(n,e,t);case 4:return nae(n,e,t);case 5:return rae(n,e);case 6:return sae(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function Woe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function Goe(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function joe(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function Hoe(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${qoe}
    ${Koe}
    ${Xoe}
  `}const qoe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Koe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Xoe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yoe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function IM(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Qoe(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function Joe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Zoe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),i=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function eae(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${jv(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=ec(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function tae(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),i=s*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)o*=n[n.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${l});
    }
  `}function nae(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${jv(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=ec(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function rae(n,e){const t=ec(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function sae(n,e){const t=ec(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function iae(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Qt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function oae(n,e,t){return Qt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function tc(n){return`offset${n}`}function aae(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=ss();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function lae(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,i]=n.shapeInfo.texShape;if(s===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=tc(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function uae(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,i=ss();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function cae(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Wh(n)}
      }
    `;const s=n.shapeInfo.texShape,i=s[0],o=s[1];if(o===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=tc(t);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function hae(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=ss();if(i!=null&&Qt(t,i))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function dae(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Qt(t,i)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=Al(t),l=o;if(l.length<t.length){const p=Gh(n,l),g=["row","col"];return`
      ${Uh(p,e)}
      float ${s}(int row, int col) {
        return ${s}(${jh(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Wh(n)}
      }
    `;const c=i[0],d=i[1],f=tc(r);return d===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${c}, ${d}, index);
    return sampleTexture(${r}, uv);
  }
`}function fae(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],y=Gh(n,p),w=["b","row","col"];return`
        ${bM(y,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${jh(w,g)});
        }
      `}const a=ss();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=o[0],c=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function pae(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Al(t),c=a;if(c.length<t.length){const w=Gh(n,c),x=["row","col","depth"];return`
        ${Uh(w,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${jh(x,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Wh(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `;const y=tc(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${y};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function mae(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=ss();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",y=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let w=2;w<o-1;w++)g=`int b${w}, `+g,p*=i[o-w-1],y=`b${w} * ${p} + `+y;return`
    vec4 ${r}(${g}) {
      int index = ${y};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${c});
      return ${s.texture2D}(${t}, uv);
    }
  `}function gae(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:c}=Al(t);if(l.length<t.length){const C=Gh(n,l),k=["row","col","depth","depth2"];return`
      ${Uh(C,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${jh(k,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Wh(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],y=`int stride2 = ${r}Shape[3];`,w=`int stride1 = ${r}Shape[2] * stride2;`,x=`int stride0 = ${r}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${y}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(g===i&&d==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;const I=tc(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${w}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${I});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${I});
      return sampleTexture(${r}, uv);
    }
  `}function yae(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],i=e[3]*s,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:c}=Al(e);if(l.length<e.length){const w=Gh(n,l),x=["row","col","depth","depth2","depth3"];return`
      ${Uh(w)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${jh(x,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${s})) +
          depth3;
        ${Wh(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===s&&d==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=tc(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${s} + depth3 + ${y};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function vae(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:i}=Al(e);if(s.length<e.length){const x=Gh(n,s),I=["row","col","depth","depth2","depth3","depth4"];return`
      ${Uh(x)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${jh(I,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,d=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Wh(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],y=p[1];if(y===d&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===o&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=tc(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${w};
      vec2 uv = uvFromFlat(${g}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Wh(n){const e=n.name,t=xe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function xae(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=wM(n.shapeInfo.logicalShape,e.logicalShape),l=ln(o),c=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(C=>`coords.${f[C+c]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((C,k)=>`coords.${f[k+c]}`).join(", ");let g="return outputValue;";const w=xe(n.shapeInfo.logicalShape)===1,I=xe(e.logicalShape)===1;if(i===1&&!w&&!I)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!I)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const C=i-2,k=i-1;a.indexOf(C)>-1&&a.indexOf(k)>-1?g="return vec4(outputValue.x);":a.indexOf(C)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(k)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${r}(${p});
      ${g}
    }
  `}function wae(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&Qt(o,i))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=ln(l),d=wM(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(w=>`coords.${g[w+f]} = 0;`).join(`
`);let y="";return l<2&&a>0?y="coords":y=n.shapeInfo.logicalShape.map((w,x)=>`coords.${g[x+f]}`).join(", "),`
    float ${s}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${y});
    }
  `}function ln(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function QS(n,e,t){const{newShape:r,keptDims:s}=Al(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):r,l=!n&&i>1&&!Qt(e,t)&&r.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function Gh(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function jh(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(n,e,t,r){const s=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=s.map(d=>d.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=Voe(s,o,e),l=poe(n.gl,a),c=n.createProgram(l);return pe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},CM(n,e,c)))}function CM(n,e,t){const r=[],s=[];let i,o,a,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),pe().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),r.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)s.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:r,customUniformLocations:s,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function xN(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,i=e[r],o=i.shape;if(!Qt(s,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!Qt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Iae(n,e,t,r,s){e.program.enableShapeUniforms||(xN(e.inShapeInfos,t),xN([e.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),pe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:y}=QS(e.program.packedInputs,c.shape,c.texData.texShape);switch(y.length){case 1:n.gl.uniform1iv(p,new Int32Array(y));break;case 2:n.gl.uniform2iv(p,new Int32Array(y));break;case 3:n.gl.uniform3iv(p,new Int32Array(y));break;case 4:n.gl.uniform4iv(p,new Int32Array(y));break}}if(g&&n.gl.uniform2i(g,c.texData.texShape[0],c.texData.texShape[1]),d!=null){if(c.isUniform){if(xe(c.shape)<2)n.gl.uniform1f(d,c.uniformValues[0]);else{let y=c.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),n.gl.uniform1fv(d,y)}continue}c.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=tt(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],d=e.customUniformLocations[l],f=s[l];if(c.type==="float")n.gl.uniform1fv(d,f);else if(c.type==="vec2")n.gl.uniform2fv(d,f);else if(c.type==="vec3")n.gl.uniform3fv(d,f);else if(c.type==="vec4")n.gl.uniform4fv(d,f);else if(c.type==="int")n.gl.uniform1iv(d,f);else if(c.type==="ivec2")n.gl.uniform2iv(d,f);else if(c.type==="ivec3")n.gl.uniform3iv(d,f);else if(c.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function Cae(n,e,t){let r="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:d,keptDims:f}=QS(n.packedInputs,o.shape,l);let p="",g="",y="";if(d.length===1&&n.packedInputs){const _=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${_[0]>1}_${_[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const _=tt(d);y=`${_[0]===l[1]}_${_[_.length-1]===l[1]}`}const w=o.shape.length,x=d.length===2&&Qt(o.shape,l),I=xe(o.shape)===1,C=yh(o.shape,t.shape),k=!n.packedInputs&&w===t.shape.length&&Qt(l,t.texData.texShape),E=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${w}_${k}_${c?f:""}_${d.length}_${I}_${C}_${x}_${p}_${g}_${y}_${E}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${l}_${a}`}});const s=n.userCode;let i=n.constructor.name;return i+="_"+r+"_"+s+`${pe().getNumber("WEBGL_VERSION")}`,i}function Ur(n){return pe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sae{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=vf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ss();this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?jv(["r","c","d"],e):ec(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=vf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ss();this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?jv(["r","c","d"],e):ec(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kae{constructor(e){this.variableNames=["A"],this.outTexUsage=qs.DOWNLOAD;const t=ss();this.outputShape=e,this.userCode=`
      ${xM}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=qs.DOWNLOAD;const t=ss();this.outputShape=e,this.userCode=`
      ${xM}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ae={R:0,G:1,B:2,A:3};class wN{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ss();this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const l=r[a];o+=`
          if(offset == ${a}) {
            result = values[${_ae[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?YS():XS(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${o}
        }
        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rae{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ss();this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length);let s="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?YS():XS(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(n){const e=ss(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return foe(n,t)}function Aae(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return voe(n,e)}function $ae(n){const e=new Uint16Array([0,1,2,2,1,3]);return xoe(n,e)}function Yp(n,e,t,r,s,i){boe(e,t);const o=woe(n),a=n.TEXTURE_2D;return Ve(n,()=>n.bindTexture(a,o)),Ve(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Ve(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Ve(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Ve(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),pe().getNumber("WEBGL_VERSION")===1?Ve(n,()=>n.texImage2D(a,0,r,e,t,0,s,i,null)):Ve(n,()=>n.texStorage2D(a,1,r,e,t)),Ve(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function SM(n){return n.internalFormatFloat}function Dae(n,e,t,r){const[s,i]=Kp(e,t);return Yp(n,s,i,SM(r),r.textureFormatFloat,n.FLOAT)}function EM(n){return n.internalFormatHalfFloat}function Pae(n,e,t,r){const[s,i]=Kp(e,t);return Yp(n,s,i,EM(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function kM(n){return n.downloadTextureFormat}function Fae(n,e,t,r){const[s,i]=Kp(e,t);return Yp(n,s,i,kM(r),n.RGBA,n.UNSIGNED_BYTE)}function TM(n){return n.internalFormatPackedFloat}function Oae(n,e,t,r){const[s,i]=Bh(e,t);return Yp(n,s,i,TM(r),n.RGBA,n.FLOAT)}function _M(n){return n.internalFormatPackedHalfFloat}function Lae(n,e,t,r){const[s,i]=Bh(e,t);return Yp(n,s,i,_M(r),n.RGBA,r.textureTypeHalfFloat)}function Mae(n,e,t){return Ve(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),gN(n,e,"clipSpacePos",t,3,20,0)&&gN(n,e,"uv",t,2,20,12)}function Vae(n,e,t,r,s,i){Ve(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;s instanceof Uint8Array?(o=new Uint8Array(t*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*r*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(s),pe().getNumber("WEBGL_VERSION")===2?Ve(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,a,o)):Ve(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,r,0,n.RGBA,a,o)),Ve(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function zae(n,e,t){Ve(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?pe().getNumber("WEBGL_VERSION")===2?Ve(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Ve(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):pe().getNumber("WEBGL_VERSION")===2?Ve(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Ve(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Ve(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Bae(n,e,t,r){const s=n.createBuffer();Ve(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const a=4*4*e*t;return Ve(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Ve(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Ve(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function Uae(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function Wae(n,e,t,r){const[s,i]=Kp(e,t),o=4,a=new Uint8Array(ooe(e*t,o));return Ve(n,()=>n.readPixels(0,0,s,i,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Gae(n,e,t,r,s,i,o,a){const l=n,c=new Float32Array(aoe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function jae(n,e,t){const r=new Float32Array(e*t*4);return Ve(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s1{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=pe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,roe(t,e)):this.gl=Zi(t),e=this.gl,pe().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Ve(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Ve(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Ve(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Ve(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ve(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Ve(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Ve(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Ve(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),pe().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Sg(this.gl,i),mi(this.gl,o))this.textureHalfFloatExtension=Sg(this.gl,o);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),mi(this.gl,s))this.colorBufferHalfFloatExtension=Sg(this.gl,s);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",mi(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(mi(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Aae(this.gl),this.indexBuffer=$ae(this.gl),this.framebuffer=Ioe(this.gl),this.textureConfig=KS(this.gl,this.textureHalfFloatExtension)}get debug(){return pe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ve(e,()=>e.finish()),Ve(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ve(e,()=>e.deleteFramebuffer(this.framebuffer)),Ve(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ve(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ve(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),Dae(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Pae(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Fae(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),zae(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),Vae(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Lae(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),Oae(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(yN(this.gl,this.framebuffer),this.outputTexture=null),Ve(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>Wae(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,i,o){return Gae(this.gl,e,t,r,s,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return Uae(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=Bae(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(pe().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=s.clientWaitSync(i,0,0);return o===s.ALREADY_SIGNALED||o===s.CONDITION_SATISFIED},t=i}else pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>jae(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=Nae(t));const r=goe(t);Ve(t,()=>t.attachShader(r,this.vertexShader)),Ve(t,()=>t.attachShader(r,e)),yoe(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&e1(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Ve(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Mae(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ve(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&e1(this.gl,this.program),Ve(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?Soe(this.gl,e,t):Eoe(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Ve(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),koe(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,i]=Bh(t,r);this.setOutputMatrixTextureDriver(e,s,i)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&e1(this.gl,this.program),Eg(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ve(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ve(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Sg(this.gl,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await eR(()=>this.disposed||this.isQueryAvailable(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=Hae(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in pe().platform&&(r=pe().platform.setTimeoutCustom.bind(pe().platform)),eR(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),t1(this.gl,e,this.framebuffer),this.debug&&Eg(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(t1(this.gl,this.outputTexture,this.framebuffer),this.debug&&Eg(this.gl)):yN(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;t1(s,e,this.framebuffer),this.debug&&Eg(s),this.outputTexture=e,Ve(s,()=>s.viewport(0,0,t,r)),Ve(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Ve(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Hae(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:qae,bincountImpl:RM,bincountReduceImpl:Kae,bitwiseAndImpl:Xae,castImpl:Yae,ceilImpl:Qae,concatImpl:Jae,equalImpl:Zae,expImpl:ele,expm1Impl:tle,floorImpl:nle,gatherNdImpl:rle,gatherV2Impl:sle,greaterImpl:ile,greaterEqualImpl:ole,lessImpl:ale,lessEqualImpl:lle,linSpaceImpl:ule,logImpl:cle,maxImpl:hle,maximumImpl:dle,minimumImpl:fle,multiplyImpl:ple,negImpl:mle,notEqualImpl:gle,prodImpl:yle,raggedGatherImpl:vle,raggedRangeImpl:xle,raggedTensorToTensorImpl:wle,rangeImpl:ble,rsqrtImpl:Ile,scatterImpl:Cle,sigmoidImpl:Sle,simpleAbsImpl:NM,sliceImpl:Ele,sparseFillEmptyRowsImpl:kle,sparseReshapeImpl:Tle,sparseSegmentReductionImpl:AM,sqrtImpl:_le,staticRegexReplaceImpl:Rle,stridedSliceImpl:Nle,stringNGramsImpl:Ale,stringSplitImpl:$le,stringToHashBucketFastImpl:Dle,subImpl:Ple,tileImpl:Fle,topKImpl:Ole,transposeImpl:JS,uniqueImpl:Lle}=zee;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $M(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function es(n,e){return e===1?[n]:$M(n,e)}function Mle(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vle{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Ur(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=es("rc",this.rank),r=ln(this.rank),s=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let i=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DM{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length);let r="";for(let s=0;s<4;s++){let i="thisRC = rc;";s%2===1&&(i+="thisRC.z += 1;"),s>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${zle(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?YS():XS(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function zle(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Moe(["r","c","d"],"inputShape"):ec(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ble{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=IN(t,r),i=CN(e,s,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=bN(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return s===br.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===br.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===br.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===br.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===br.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const i=IN(r,s),o=CN(t,i,s);o in this.freeTextures||(this.freeTextures[o]=[]);const a=bN(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=pe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],d=c&&c.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[d]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Ule(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function bN(n,e,t,r,s){const i=Wle(e,r);let o;if(s){const[l,c]=Bh(n[0],n[1]);o=l*c}else{const[l,c]=Kp(n[0],n[1]);o=l*c}const a=Ule(t,i);return o*a}function Wle(n,e){switch(n){case br.PACKED_2X2_FLOAT32:return TM(e);case br.PACKED_2X2_FLOAT16:return _M(e);case br.UNPACKED_FLOAT32:return SM(e);case br.UNPACKED_FLOAT16:return EM(e);case br.PACKED_4X1_UNSIGNED_BYTE:return kM(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Gle(n){return pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?br.PACKED_2X2_FLOAT32:br.UNPACKED_FLOAT32:n?br.PACKED_2X2_FLOAT16:br.UNPACKED_FLOAT16}function IN(n,e){if(n===qs.UPLOAD)return br.PACKED_2X2_FLOAT32;if(n===qs.RENDER||n==null)return Gle(e);if(n===qs.DOWNLOAD||n===qs.PIXELS)return br.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function CN(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bo{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const wi="if (isnan(x)) return x;",jle="return x;",SN="return abs(x);",Hle="return (x >= 0.0) ? x : (exp(x) - 1.0);",qle=wi+`
  return (x < 0.0) ? 0.0 : x;
`,Kle=wi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,el="return x;",Xle="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle="return x;",Qle=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Jle=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Zle=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eue="return 1.0 / (1.0 + exp(-1.0 * x));";class ll{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tue{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length);const t=e.length,r=es("rc",t),s=ln(t),i=Mle(t,r),o=r.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue=tP,rue=1e-7,sue=1e-4,_g={};function iue(n){return n in _g||(_g[n]={}),_g[n]}const oue=pe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),aue=600;function lue(){return pe().global.screen==null?1024:pe().global.screen.height*pe().global.screen.width*window.devicePixelRatio*aue/1024/1024}class Hv extends xI{nextDataId(){return Hv.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!pe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof s1)t=e;else{const r=Zi(pe().getNumber("WEBGL_VERSION"),e);t=new s1(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Zi(pe().getNumber("WEBGL_VERSION"));t=new s1(r),this.binaryCache=iue(pe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Ble(this.gpgpu),this.numMBBeforeWarning=lue(),this.texData=new T$(this,go())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,i,o){const a=this.makeTensorInfo(t,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,i]},l.texShape=[s,i];const c=kg(t),d=new wN(c,!1,o),f=this.runWebGLProgram(d,[a],r,[[s,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,r){if((pe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||pe().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:qs.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,i){if(pe().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:qs.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new ll(a,el):p=new bo(a,el);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:s}],s),y=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const c=this.activeTimers!=null;let d;c&&(d=cs());let f;if(s==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=wa(p,g)}else f=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=cs()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const y=this.pendingRead.get(e);return new Promise(w=>y.push(w))}const t=this.texData.get(e),{values:r,shape:s,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let y;l?y=new ll(s,el):y=new bo(s,el);const w=this.runWebGLProgram(y,[{dataId:e,shape:s,dtype:o}],o),x=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),x}if(r!=null)return this.convertAndCacheOnCPU(e);if(pe().getBool("DEBUG")&&!pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&pe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,d;if(o!=="complex64"&&pe().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const y=this.texData.get(d.dataId);c=this.gpgpu.createBufferFromTexture(y.texture.texture,...Cg(s))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const y=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),w=y[0],x=y[1];f=wa(w,x)}else if(c==null)f=this.getValuesFromTexture(e);else{const y=xe(s);f=this.gpgpu.downloadFloat32MatrixFromBuffer(c,y)}if(d!=null&&this.disposeIntermediateTensorInfo(d),c!=null){const y=this.gpgpu.gl;Ve(y,()=>y.deleteBuffer(c))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(y=>y(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&go().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:i,slice:o,dtype:a,isPacked:l,texture:c}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new ll(i,el):g=new bo(i,el);const y=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),w=this.readToGPU(y,t);return this.disposeIntermediateTensorInfo(y),w}if(c==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=go().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Sl(s));return It(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return It(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!hoe(r))throw pe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),i=xe(t);if(pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),y=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...Cg(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),y}const o=pe().getBool("WEBGL_PACK")&&s===!0,a=o?kg(t):t,l=o?new Tae(a):new kae(a),c=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),d=this.texData.get(c.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),f}timerAvailable(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const i=Ru(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ru(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=_6(l),a.getExtraProfileInfo=()=>l.map((c,d)=>({name:o[d],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:cs(),endMs:null}}endTimer(e){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=cs(),e)}async getQueryTime(e){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=oue){return pe().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&xe(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Hs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return nue(e.shape,t)}packedUnaryOp(e,t,r){const s=new ll(e.shape,t),i=this.compileAndRun(s,[e],r);return go().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=NM(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(pe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,SN,e.dtype);const t=new bo(e.shape,SN),r=this.compileAndRun(t,[e]);return go().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Ff(r[0])){const i=r.map(o=>pl(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return go().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new tue(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Vle(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[Ch(e.shape),...Sh(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},i=[Ch(t),...Sh(t)],o=new DM(i,r),a=!0,l=[r],c=this.runWebGLProgram(o,[s],e.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:i,dtype:o}=r;if(t!=null){const p=xe(i),g=t[0]*t[1]*4;z(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=kg(i);let l;s?l=new Eae(a):l=new Sae(a);const c=!0,d=[t??Cg(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,c,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,r,s,i=!1,o){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===vf.DENSE){const I=o??Cg(e.outputShape);l.texShape=I.map(C=>C*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),xe(a.shape)===0)return l.values=Lr(a.dtype,0),a;const c=[],d=t.map(I=>{if(I.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(I.dataId);if(C.texture==null){if(!e.packedInputs&&xe(I.shape)<=pe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:I.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=I.shape)}if(this.uploadToGPU(I.dataId),!!C.isPacked!=!!e.packedInputs)I=C.isPacked?this.unpackTensor(I):this.packTensor(I),c.push(I),C=this.texData.get(I.dataId);else if(C.isPacked&&!jy(C.shape,I.shape)){const k=I,E=I.shape;I.shape=C.shape,I=this.packedReshape(I,E),c.push(I),C=this.texData.get(I.dataId),k.shape=E}return{shape:I.shape,texData:C,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=Cae(e,d,f),g=this.getAndSaveBinary(p,()=>bae(this.gpgpu,e,d,f)),y=this.activeTimers!=null;let w;y&&(w=this.startTimer()),pe().get("ENGINE_COMPILE_ONLY")||Iae(this.gpgpu,g,d,f,s),c.forEach(I=>this.disposeIntermediateTensorInfo(I)),y&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const x=pe().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const I=cs();I-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=I)}if(!pe().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const I=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),I}return a}compileAndRun(e,t,r,s,i=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(pe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=de(()=>{if(!pe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=pe().getBool("DEBUG");pe().set("DEBUG",!1);const t=this.abs(Yt(1e-8)).dataSync()[0];if(pe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?rue:sue}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const c=this.activeTimers!=null;let d;c&&(d=cs());let f=t.texShape;if(f==null&&(f=Roe(r,l),t.texShape=f),i!=null){const p=kg(r);let g,y=f[1],w=f[0];const x=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!x)&&([y,w]=Bh(f[0],f[1])),l?g=new Rae(p,x):g=new wN(p,x);const I=x?[w,y]:f,C=this.makeTensorInfo(I,s),k=this.texData.get(C.dataId);x?k.usage=qs.PIXELS:k.usage=qs.UPLOAD,k.texShape=I,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),y,w,i);const E=[[w,y]],L=this.runWebGLProgram(g,[C],s,E,!0),P=this.texData.get(L.dataId);t.texShape=P.texShape,t.isPacked=P.isPacked,t.usage=P.usage,pe().get("ENGINE_COMPILE_ONLY")?this.disposeData(L.dataId):(t.texture=P.texture,t.values=null,this.texData.delete(L.dataId)),this.disposeIntermediateTensorInfo(C),c&&(this.uploadWaitMs+=cs()-d)}else{const p=this.acquireTexture(f,a,s,l);t.texture=p}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=uue(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*xy(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(i){throw i}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await wP(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(vM(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=CM(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:i,width:o,channels:a}=e,l=go().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(s,t,r,i,o,a);return go().makeTensorFromDataId(c,t,r,l)}}Hv.nextDataId=0;function uue(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */gD()&&xD("webgl",()=>new Hv,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Uu{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=yt(t,r),this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Hh{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=yt(t,r);const i=this.outputShape.length;this.enableShapeUniforms=Ur(i);let o="";if(s)if(i===0||xe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${ln(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=es("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const cue={kernelName:np,backendName:"webgl",kernelFunc:Fs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bl(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),a=Fs({inputs:{x:r},backend:t}),l=Fs({inputs:{x:s},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const hue={kernelName:$I,backendName:"webgl",kernelFunc:Bl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PM="return (a < 0.) ? b * a : a;",FM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function due(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r,o=t.makeTensorInfo([],"float32",$l(i,"float32")),a=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hh(FM,s.shape,o.shape):new Uu(PM,s.shape,o.shape),l=t.runWebGLProgram(a,[s,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const fue={kernelName:z0,backendName:"webgl",kernelFunc:due};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OM="return (a < 0.) ? b * a : a;",LM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function pue(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hh(LM,r.shape,s.shape):new Uu(OM,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],"float32")}const mue={kernelName:iv,backendName:"webgl",kernelFunc:pue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qh="if (isnan(x)) return x;";function Mt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:i})=>{const{x:o}=s,a=i,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const c=pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return c?d=new ll(o.shape,e):d=new bo(o.shape,n),a.runWebGLProgram(d,[o],l)}}function kr({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,d=a;if(r&&l.dtype==="complex64"){const y=d.texData.get(l.dataId),w=d.texData.get(c.dataId),[x,I]=[[y.complexTensorInfos.real,w.complexTensorInfos.real],[y.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(k=>{const[E,_]=k,L={dataId:E.dataId,dtype:E.dtype,shape:l.shape},P={dataId:_.dataId,dtype:_.dtype,shape:c.shape},A=new Uu(n,l.shape,c.shape);return d.runWebGLProgram(A,[L,P],Ds(E.dtype,_.dtype))}),C=Bl({inputs:{real:x,imag:I},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(I),C}const f=i||Ds(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||d.shouldExecuteOnCPU([l,c]))&&s!=null){const y=d.texData.get(l.dataId).values,w=d.texData.get(c.dataId).values,x=l.dtype==="string"?ba(y):y,I=l.dtype==="string"?ba(w):w,[C,k]=s(l.shape,c.shape,x,I,f),E=d.makeTensorInfo(k,f),_=d.texData.get(E.dataId);return _.values=C,E}const p=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Hh(e,l.shape,c.shape,t):g=new Uu(n,l.shape,c.shape),d.runWebGLProgram(g,[l,c],f)}}function xf(n,e=!1){if(n==="linear")return e?Yle:jle;if(n==="relu")return e?Jle:qle;if(n==="elu")return e?Qle:Hle;if(n==="relu6")return e?Zle:Kle;if(n==="prelu")return e?LM:OM;if(n==="leakyrelu")return e?FM:PM;if(n==="sigmoid")return e?eue:Xle;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MM{constructor(e,t,r,s=!1,i=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Ur(this.outputShape.length);const d=s?e[1]:e[2],f=Math.ceil(d/2),p=s?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",y=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",I="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,I="result = activation(result);");const C=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let k="rc.x",E="rc.x";e[0]<t[0]?k=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(E=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${k};
        int batchB = ${E};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${w[0]});
          result += (${y[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${I}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class kN{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=yt(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TN="return a * b;";function eE(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=Ds(r.dtype,s.dtype);if(r.dtype==="complex64"){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),c=new kN(EN.REAL,r.shape,s.shape),d=new kN(EN.IMAG,r.shape,s.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],p=t.runWebGLProgram(c,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=Bl({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),y}if(t.shouldExecuteOnCPU([r,s])){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),[c,d]=ple(r.shape,s.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),p=t.texData.get(f.dataId);return p.values=c,f}let o;return pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Hh(TN,r.shape,s.shape):o=new Uu(TN,r.shape,s.shape),t.runWebGLProgram(o,[r,s],i)}const gue={kernelName:hp,backendName:"webgl",kernelFunc:eE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(n,e,t){const r=[Ch(n.shape),...Sh(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},i=[Ch(e),...Sh(e)],o=new DM(i,r),a=!0,l=[r],c=t.runWebGLProgram(o,[s],n.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Me(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=t,a=xe(s.shape),l=R$(i,a),c=xe(l);z(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(s.dataId);return d.isPacked&&!jy(s.shape,l)&&!(d.texture!==null&&jy(d.shape,l))?yue(s,l,o):(o.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const vue={kernelName:av,backendName:"webgl",kernelFunc:Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _N{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];const a=Math.floor(r/4)*4,l=r%4;let c="sumValue += dot(values, ones);";if(t!=null){const f=1/t;c=`sumValue += dot(values * ${ph(f)?f.toPrecision(2):f}, ones);`}let d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xue{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const d=Math.floor(r/4)*4,f=r%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let y="";i%r>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=Nv(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function rc(n,e,t,r){const s=wue(n.shape);let i=n;for(let o=0;o<s.length;o++){const{inSize:a,windowSize:l,outSize:c}=s[o];let d,f;t==="mean"?d=o===0?new _N({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new _N({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):d=new xue({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},t),f=i,i=r.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bue{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[t[o]];this.outputShape=r,this.rank=r.length;const s=ln(this.rank),i=Iue(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Iue(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cue{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let d=0;d<r.length;d++)r[d]=e[t[d]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=ln(this.rank),i=$M("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qv(n,e,t){const r=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Cue(n.shape,e):new bue(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(n,e,t,r){const s=e,i=n.shape.length,o=Ct(s,n.shape);let a=o;const l=Rn(a,i),c=l!=null;let d=n;c&&(d=qv(n,l,r),a=zn(a.length,i)),Er("sum",a,i);const[f,p]=pr(d.shape,a);let g=f;t&&(g=qn(f,o));const y=xe(p),x=xe(n.shape)/y,I=Me({inputs:{x:d},attrs:{shape:[x,y]},backend:r}),C=dC(n.dtype),k=rc(I,C,"sum",r),E=Me({inputs:{x:k},attrs:{shape:g},backend:r});return r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(k),c&&r.disposeIntermediateTensorInfo(d),E}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kv(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;return Sue(s,i,o,t)}const Eue={kernelName:fv,backendName:"webgl",kernelFunc:Kv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:i}=r,o=t,a=s.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=s.shape[i[d]];let c;if(o.shouldExecuteOnCPU([s])){const f=o.texData.get(s.dataId).values,p=JS(f,s.shape,s.dtype,i,l);c=o.makeTensorInfo(l,s.dtype);const g=o.texData.get(c.dataId);g.values=p}else c=qv(s,i,o);return c}const kue={kernelName:eh,backendName:"webgl",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VM=1e3;function Hy({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=n.shape.length,d=e.shape.length,f=t?n.shape[c-2]:n.shape[c-1],p=r?e.shape[d-1]:e.shape[d-2],g=t?n.shape[c-1]:n.shape[c-2],y=r?e.shape[d-2]:e.shape[d-1],w=n.shape.slice(0,-2),x=e.shape.slice(0,-2),I=xe(w),C=xe(x),E=yt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,y]);z(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const _=t?[I,f,g]:[I,g,f],L=r?[C,y,p]:[C,p,y],P=Me({inputs:{x:n},backend:s,attrs:{shape:_}}),A=Me({inputs:{x:e},backend:s,attrs:{shape:L}}),$=[P,A],D=Math.max(I,C),R=t?P.shape[1]:P.shape[2],M=i!=null,O=o!=null,Z=l==="leakyrelu",q=l!=null?xf(l,!0):null,se=M||O||Z||q!=null;let le;if((g===1||y===1)&&R>VM&&se===!1){let Q=P,ee=A;t&&(Q=rs({inputs:{x:P},backend:s,attrs:{perm:[0,2,1]}}),$.push(Q)),r&&(ee=rs({inputs:{x:A},backend:s,attrs:{perm:[0,2,1]}}),$.push(ee));const U=y!==1,H=y===1;let ue=Q;U&&(ue=Me({inputs:{x:Q},backend:s,attrs:{shape:[D,R,1]}}),$.push(ue));const Ie=y===1?2:1;let be=ee;H&&(be=Me({inputs:{x:ee},backend:s,attrs:{shape:[D,1,R]}}),$.push(be));const ke=eE({inputs:{a:ue,b:be},backend:s});le=Kv({inputs:{x:ke},backend:s,attrs:{axis:Ie,keepDims:!0}}),$.push(ke)}else{const Q=Ds(n.dtype,e.dtype),ee=new MM(_,L,[D,g,y],t,r,M,q,O,Z),U=[P,A];if(i!=null&&U.push(i),O&&U.push(o),Z){const H=s.makeTensorInfo([],"float32",$l(a,"float32"));U.push(H),$.push(H)}le=s.runWebGLProgram(ee,U,Q)}const j=Me({inputs:{x:le},backend:s,attrs:{shape:E}});$.push(le);for(const Q of $)s.disposeIntermediateTensorInfo(Q);return j}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:d,leakyreluAlpha:f}=r;return Hy({a:s,b:i,transposeA:l,transposeB:c,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const _ue={kernelName:wy,backendName:"webgl",kernelFunc:Tue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RN="return abs(x);";function Rue(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const i=t.texData.get(r.dataId),o=NM(i.values);return t.makeTensorInfo(r.shape,r.dtype,o)}let s;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new ll(r.shape,RN):s=new bo(r.shape,RN),t.runWebGLProgram(s,[r],r.dtype)}const Nue={kernelName:w0,backendName:"webgl",kernelFunc:Rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aue=wi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,$ue=Mt({opSnippet:Aue}),Due={kernelName:Of,backendName:"webgl",kernelFunc:$ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue=wi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Fue=Mt({opSnippet:Pue}),Oue={kernelName:Lf,backendName:"webgl",kernelFunc:Fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NN="return a + b;",Lue=kr({opSnippet:NN,packedOpSnippet:NN,supportsComplex:!0,cpuKernelImpl:qae}),Mue={kernelName:Fh,backendName:"webgl",kernelFunc:Lue};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vue{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zue{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qg(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return Fs({inputs:{x:r[0]},backend:t});if(r.length>pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),c=Qg({inputs:r.slice(0,l),backend:t}),d=Qg({inputs:r.slice(l),backend:t});return Qg({inputs:[c,d],backend:t})}const s=r.map(l=>l.dtype).reduce((l,c)=>Ds(l,c)),i=r.map(l=>l.shape),a=pe().getBool("WEBGL_PACK")?new zue(r[0].shape,i):new Vue(r[0].shape,i);return t.runWebGLProgram(a,r,s)}const Bue={kernelName:EI,backendName:"webgl",kernelFunc:Qg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=Ct(i,s.shape);let c=l;const d=Rn(c,a);let f=s;d!=null&&(f=rs({inputs:{x:s},backend:t,attrs:{perm:d}}),c=zn(c.length,a)),Er("all",c,a);const[p,g]=pr(f.shape,c),y=xe(g),w=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),x=rc(w,w.dtype,"all",t);let I;if(o){const C=qn(p,l);I=Me({inputs:{x},backend:t,attrs:{shape:C}})}else I=Me({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(f),I}const Wue={kernelName:kI,backendName:"webgl",kernelFunc:Uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=Ct(i,s.shape);let c=l;const d=Rn(c,a);let f=s;d!=null&&(f=rs({inputs:{x:s},backend:t,attrs:{perm:d}}),c=zn(c.length,a)),Er("any",c,a);const[p,g]=pr(f.shape,c),y=xe(g),w=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),x=rc(w,w.dtype,"any",t);let I;if(o){const C=qn(p,l);I=Me({inputs:{x},backend:t,attrs:{shape:C}})}else I=Me({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(f),I}const jue={kernelName:TI,backendName:"webgl",kernelFunc:Gue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hue{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class que{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,z(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=ln(l),d=es("coords",l);let f,p;if(o===1){p=l+1;const A=ln(p);f=`
        ${A} sourceLocR = ${A}(${d.join()}, 0);
        ++${d[l-1]};
        ${A} sourceLocG = ${A}(${d.join()}, 0);
        ++${d[l-2]};
        ${A} sourceLocA = ${A}(${d.join()}, 0);
        --${d[l-1]};
        ${A} sourceLocB = ${A}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${c} sourceLocR = coords;
        ++${d[l-1]};
        ${c} sourceLocG = coords;
        ++${d[l-2]};
        ${c} sourceLocA = coords;
        --${d[l-1]};
        ${c} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),y="."+g[p-1],w=g.map(A=>"int "+A),x=es("sourceLocR",p-1).concat("inIdx.r"),I=es("sourceLocG",p-1).concat("inIdx.g"),C=es("sourceLocB",p-1).concat("inIdx.b"),k=es("sourceLocA",p-1).concat("inIdx.a"),E=r==="max"?"greaterThan":"lessThan",_=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${I.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${k.join()})));`,L=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${I.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${k.join()}) : 0.)`,P=s?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${P}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${L};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${L};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${E}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zM(n,e,t,r=null){let s=e.shape[0],i=e.shape[1];r!=null&&(s=r.shape[0],i=r.shape[1]);const o=Nv(i),a={windowSize:o,inSize:i,batchSize:s,outSize:Math.ceil(i/o)},l=new Hue(a,t,r==null),c=[e];r!=null&&c.push(r);const d=n.runWebGLProgram(l,c,"int32");if(d.shape[1]===1)return d;const f=zM(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function BM(n,e,t,r=null){const s=r!=null?r.shape:e.shape,i=s[s.length-1],o=Nv(i),a=new que(s,o,t,r==null),l=r==null?[e]:[e,r],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const d=BM(n,e,t,c);return n.disposeIntermediateTensorInfo(c),d}return c}function UM(n,e,t,r){const s=[t];if(Er("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!pe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[c,d]=pr(l.shape,s),f=xe(d),p=Me({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=zM(n,p,r);i.push(g);const y=Me({inputs:{x:g},backend:n,attrs:{shape:c}});return i.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}return BM(n,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=Ct(i,s.shape);const a=Rn(o,s.shape.length);let l=s;const c=[];a!=null&&(l=rs({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),o=zn(o.length,l.shape.length)),Er("argMax",[o[0]],l.shape.length);const d=UM(t,l,o[0],"max");return c.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const Xue={kernelName:b0,backendName:"webgl",kernelFunc:Kue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yue(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=Ct(i,s.shape);const a=Rn(o,s.shape.length);let l=s;const c=[];a!=null&&(l=rs({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),o=zn(o.length,l.shape.length)),Er("argMin",[o[0]],l.shape.length);const d=UM(t,l,o[0],"min");return c.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const Que={kernelName:I0,backendName:"webgl",kernelFunc:Yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue=wi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Zue=Mt({opSnippet:Jue}),ece={kernelName:Mf,backendName:"webgl",kernelFunc:Zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce=wi+"return log(x + sqrt(x * x + 1.0));",nce=Mt({opSnippet:tce}),rce={kernelName:Vf,backendName:"webgl",kernelFunc:nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce=wi+`
  return atan(x);
`,ice=Mt({opSnippet:sce}),oce={kernelName:zf,backendName:"webgl",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ace=ZS+`
  return atan(a, b);
`,lce=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+nc+`
  return result;
`,uce=kr({opSnippet:ace,packedOpSnippet:lce}),cce={kernelName:Uf,backendName:"webgl",kernelFunc:uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce=wi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,dce=Mt({opSnippet:hce}),fce={kernelName:Bf,backendName:"webgl",kernelFunc:dce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wf{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,I=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(w||(C="-1.0 / 1e-20"),r){const A=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${A} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?i?x:I:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let E=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(E="avgValue / max(count, 1.0)");const _=Math.floor(o/4)*4,L=o%4,P=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${y});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${P}
          }

          int xC = xCCorner + ${_};
          if (${L===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${L===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${L===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${P}
          }
        }
        setOutput(${E});
      }
    `}}class tE{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,y=e.effectiveFilterHeight,w=e.effectiveFilterWidth,x=e.padInfo.front,I=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const k=t==="avg";let E="0.0";if(k||(E="-1.0 / 1e-20"),r){const D=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${x}, ${I}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${D} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${y} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let L=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(L="avgValue / max(count, 1.0)");const P=Math.floor(o/4)*4,A=o%4,$=`
      if (${k}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${x}, ${I}, ${C});
      const float initializationValue = ${E};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${E});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${P}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${P};
            if (${A===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${A===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${A===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${L});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pce(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Xp(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(zr(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=vi(s.shape,i,o,c,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Qt(d.inShape,d.outShape))return Fs({inputs:{x:s},backend:t});const f=new wf(d,"avg",!1);return t.runWebGLProgram(f,[s],"float32")}const mce={kernelName:C0,backendName:"webgl",kernelFunc:pce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r,d=[1,1,1],f=Ea(s.shape,i,o,d,a,l,c),p=new tE(f,"avg",!1);return t.runWebGLProgram(p,[s],"float32")}const yce={kernelName:S0,backendName:"webgl",kernelFunc:gce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vce{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=c-1-e.padInfo.left,p=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class xce{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=f-1-e.padInfo.front,w=p-1-e.padInfo.top,x=g-1-e.padInfo.left,I=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${w}, ${x});
      const float avgMultiplier = float(${I});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=r,f=[1,1,1],p=Ea(o.shape,a,l,f,c,d),g=new xce(p);return t.runWebGLProgram(g,[s],o.dtype)}const bce={kernelName:RI,backendName:"webgl",kernelFunc:wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Xp([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,d=vi(o.shape,a,l,1,c),f=new vce(d);return t.runWebGLProgram(f,[s],o.dtype)}const Cce={kernelName:_I,backendName:"webgl",kernelFunc:Ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;return Hy({a:s,b:i,transposeA:o,transposeB:a,backend:t})}const Ece={kernelName:E0,backendName:"webgl",kernelFunc:Sce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kce{constructor(e,t,r,s,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],yt(e,t),yt(e,r);let a="0.0";s!=null&&(yt(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(yt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tce{constructor(e,t,r,s,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],yt(e,t),yt(e,r);let a="vec4(0.0)";s!=null&&(yt(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(yt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:i,offset:o,scale:a}=n;z(s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[r,s,i];let d=null;o!=null&&(d=o.shape,c.push(o));let f=null;a!=null&&(f=a.shape,c.push(a));const p=pe().getBool("WEBGL_PACK_NORMALIZATION")?new Tce(r.shape,s.shape,i.shape,d,f,l):new kce(r.shape,s.shape,i.shape,d,f,l);return e.runWebGLProgram(p,c,c[0].dtype)},Rce={kernelName:L0,backendName:"webgl",kernelFunc:_ce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nce{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=ln(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=Ace(this.rank);let s;const i=e.map((o,a)=>`sourceLoc.${db[a]} = start[${a}] + coords.${db[a]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const db=["x","y","z","w","u","v"];function Ace(n){if(n===1)return"sourceLoc";if(n<=6)return db.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ce{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=ln(this.rank),r=es("coords",this.rank),s=es("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,o=`getChannel(getSource(${s.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${o};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${s[f]} = ${r[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(n,e,t,r){const s=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,s),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=YC(e,tt(n.shape));s.slice&&(a+=s.slice.flatOffset),o.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||n.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),i}function Kh(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r,[a,l]=Rv(s,i,o);if(qC(s,a,l),xe(l)===0)return t.makeTensorInfo(l,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const f=t.texData.get(s.dataId),p=Ele(f.values,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,p)}const{isPacked:c}=t.texData.get(s.dataId),d=XC(s.shape,a,l);if(c||!d){const f=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $ce(l):new Nce(l),p=[a];return t.runWebGLProgram(f,[s],s.dtype,p)}return t.uploadToGPU(s.dataId),Dce(s,a,l,t)}const Pce={kernelName:dv,backendName:"webgl",kernelFunc:Kh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;z(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((C,k)=>C*k),l=Op(s.shape,i,a),c=Lp(l.length,i.length),d=Mp(s.shape,i,a),f=tS(o,i.length),p=nS(d,o,i.length),g=[],y=Me({inputs:{x:s},backend:t,attrs:{shape:l}}),w=rs({inputs:{x:y},backend:t,attrs:{perm:c}}),x=Me({inputs:{x:w},backend:t,attrs:{shape:d}}),I=Kh({inputs:{x},backend:t,attrs:{begin:f,size:p}});return g.push(y),g.push(w),g.push(x),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),I},Oce={kernelName:k0,backendName:"webgl",kernelFunc:Fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.readSync(s.dataId),l=t.readSync(i.dataId),c=RM(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}const Mce={kernelName:NI,backendName:"webgl",kernelFunc:Lce};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,zce=`
  return float(int(a.r) & int(b.r));
`;function Bce(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=pe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||o===1){const l=t.texData.get(r.dataId).values,c=t.texData.get(s.dataId).values,[d,f]=Xae(r.shape,s.shape,l,c,r.dtype),p=t.makeTensorInfo(f,r.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return i?a=new Hh(Vce,r.shape,s.shape,!1):a=new Uu(zce,r.shape,s.shape),t.runWebGLProgram(a,[r,s],r.dtype)}const Uce={kernelName:AI,backendName:"webgl",kernelFunc:Bce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wce(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.readSync(r.dataId),o=t.readSync(s.dataId),a=yt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Gce={kernelName:F$,backendName:"webgl",kernelFunc:Wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce="return float(a != b);",WM=kr({opSnippet:jce,cpuKernelImpl:gle,dtype:"bool"}),Hce={kernelName:ev,backendName:"webgl",kernelFunc:WM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qp(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Fs({inputs:{x:s.complexTensorInfos.real},backend:t})}const qce={kernelName:nC,backendName:"webgl",kernelFunc:Qp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kce="return float(int(x));";function Xce(n,e){const t=new bo(n.shape,Kce),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fb(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return Fs({inputs:{x:s},backend:t});const o=cr(s.shape),a=fb({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),l=Bl({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const o=Qp({inputs:{input:s},backend:t}),a=fb({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!N$(s.dtype,i)){const o=Fs({inputs:{x:s},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId).values,[a,l,c]=Yae(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,c)}if(i==="int32")return Xce(s,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Lr("bool",1)),l=WM({inputs:{a:s,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${i}`)}const Yce={kernelName:Wf,backendName:"webgl",kernelFunc:fb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AN="return ceil(x);",Qce=Mt({opSnippet:AN,packedOpSnippet:AN,cpuKernelImpl:Qae}),Jce={kernelName:Gf,backendName:"webgl",kernelFunc:Qce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zce{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ehe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function the(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:i,clipValueMax:o}=r;let a;pe().getBool("WEBGL_PACK_CLIP")?a=new ehe(s.shape):a=new Zce(s.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[s],s.dtype,l)}const nhe={kernelName:jf,backendName:"webgl",kernelFunc:the};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rhe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function she(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),i=new rhe(r.shape),o=[$N(r,s.complexTensorInfos.real),$N(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const ihe={kernelName:T0,backendName:"webgl",kernelFunc:she};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ohe{constructor(e){this.outputShape=[],this.outputShape=Ro(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];r.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const s=t.length,i=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ahe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ro(e,t);const r=this.outputShape,s=r.length,i=ln(s),o=es("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((w,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const c=a[t],d=a.slice(-2),f=a.join();let p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let w=1;w<l.length;w++){const x=l[w-1];p+=`
        if (${c} < ${l[w]}  && ${c} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${Rg(a,c,x)}),
            vec2(${Rg(d,c,x)}));
        }`}const g=l.length,y=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${Rg(a,c,y)}),
          vec2(${Rg(d,c,y)}));`,this.userCode=`
      float getValue(${a.map(w=>"int "+w)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[s-1]} = ${o[s-1]} + 1;
        if (${o[s-1]} < ${r[s-1]}) {
          result.g = getValue(${o});
        }

        ${o[s-2]} = ${o[s-2]} + 1;
        if (${o[s-2]} < ${r[s-2]}) {
          result.a = getValue(${o});
        }

        ${o[s-1]} = ${o[s-1]} - 1;
        if (${o[s-2]} < ${r[s-2]} &&
            ${o[s-1]} < ${r[s-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Rg(n,e,t){const r=n.indexOf(e);return n.map((i,o)=>o===r?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xv(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Fs({inputs:{x:s.complexTensorInfos.imag},backend:t})}const lhe={kernelName:KI,backendName:"webgl",kernelFunc:Xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jd(n,e,t){const r=n[0].dtype;if(r==="complex64"){const g=n.map(C=>Qp({inputs:{input:C},backend:t})),y=n.map(C=>Xv({inputs:{input:C},backend:t})),w=jd(g,e,t),x=jd(y,e,t),I=Bl({inputs:{real:w,imag:x},backend:t});return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),y.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),I}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const g=n.map(E=>{const L=[-1,xe(E.shape.slice(e))];return Me({inputs:{x:E},backend:t,attrs:{shape:L}})}),y=g.map(E=>({vals:t.readSync(E.dataId),shape:E.shape})),w=Ro(g.map(E=>E.shape),1),x=g[0].shape[0]===1,I=Jae(y,w,r,x),C=Ro(n.map(E=>E.shape),e),k=t.makeTensorInfo(C,r,I);return g.forEach(E=>t.disposeIntermediateTensorInfo(E)),k}const i=n.filter(g=>xe(g.shape)>0),o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new bo(n[0].shape,el):new ll(n[0].shape,el);return t.runWebGLProgram(g,n,r)}const a=pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let w=0;w<i.length;w+=a){const x=i.slice(w,w+a);g.push(jd(x,e,t))}const y=jd(g,e,t);for(const w of g)t.disposeIntermediateTensorInfo(w);return y}if(o){const g=new ahe(i.map(y=>y.shape),e);return t.runWebGLProgram(g,i,r)}const{tensors2D:l,outShape:c}=uhe(i,e,t),d=new ohe(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,r);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Me({inputs:{x:f},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(f),p}function uhe(n,e,t){const r=Ro(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Me({inputs:{x:i},attrs:{shape:[-1,xe(i.shape.slice(e))]},backend:t})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=Ct(s,e[0].shape)[0],o=e.map(c=>c.shape);JC(o,i);const a=Ro(e.map(c=>c.shape),i);if(xe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>xe(c.shape)>0);return l.length===1?Fs({inputs:{x:l[0]},backend:t}):jd(l,i,t)}const che={kernelName:_0,backendName:"webgl",kernelFunc:GM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jM{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,x=e.dataFormat==="channelsLast",I=x?1:2,C=x?2:3,k=x?3:1;let E="",_="";r&&(s?E=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?E=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:E=`
          float activation(float x) {
            ${r}
          }
        `,_="result = activation(result);");const L=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${E}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${k}];

        ivec2 xRCCorner =
            ivec2(coords[${I}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${L}
        ${_}
        setOutput(result);
      }
    `}}class hhe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HM{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)p+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;p+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)p+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(f+1)/2;x++){const I=x*2;if(p+=`
           xC = xCCorner + ${I*l};
           `,a===1){if(I<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }
               `,l===1&&I>0?p+=`
                 xC${I} = vec4(xTexelC${I-2}.zw, xTexelC${I}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${I} = vec4(previous.zw, xTexelC${I}.xy);
                   } else {
                     xC${I} = vec4(0.0, 0.0, xTexelC${I}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 xC${I} = xTexelC${I};
                 `,I+1<d)){const C=o%2===0?wI(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                     xTexelC${I+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${I+1}.zw = vec2(0.0);
                     }
                     xTexelC${I+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${I+1} = vec4(previous.zw, xTexelC${I+1}.xy);
                     } else {
                      xC${I+1} = vec4(0.0, 0.0, xTexelC${I+1}.xy);
                     }
                     `:p+=`
                     xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.xy);
                     `):C===1?p+=`
                     xC${I+1} = xTexelC${I};
                     `:p+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                       xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${I+1}.zw = vec2(0.0);
                       }
                       xTexelC${I+1}Ready = 1;
                     }

                     xC${I+1} = xTexelC${I+1};
                     `}}else I<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${I+1}Ready == 0) {
                   xTexelC${I+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${I+1}.zw = vec2(0.0);
                   }
                   xTexelC${I+1}Ready = 1;
                 }

                 xC${I} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
               `,I+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${I+1} = vec4(xTexelC${I+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                   xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I+1}.zw = vec2(0.);
                   }
                   xTexelC${I+1}Ready = 1;
                 }

                 xC${I} = vec4(
                   xTexelC${I}.xy, xTexelC${I+1}.xy);
               `,I+1<d&&(p+=`
                   xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
                 `)));I<d&&(p+=`
             wTexel = getW(r, ${I}, d1, d2);
             dotProd += xC${I}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${I}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,I+1<d&&(p+=`
               wTexel = getW(r, ${I+1}, d1, d2);
               dotProd += xC${I+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${I+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",y="";r&&(s?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:g=`vec4 activation(vec4 x) {
           ${r}
         }`,y="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${y}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dhe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Ur(this.outputShape.length);const{dataFormat:r}=t,s=ss(),i=r==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)c+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qy(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function qM({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,c=r.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",y=!1,w=!1;let x;const I=[];if(i!=null){const E=qy(i.shape,g);E!=null&&(i=Me({inputs:{x:i},backend:r,attrs:{shape:E}}),I.push(i))}if(s!=null){const E=qy(s.shape,g);E!=null&&(s=Me({inputs:{x:s},backend:r,attrs:{shape:E}}),I.push(s))}if(!((f===1||p===1)&&d>VM)&&c.isPacked&&g&&c.texture!=null&&l[2]%2!==0&&Qt(c.shape.slice(-3),l.slice(-3))){const E=l[0]*l[1]*(l[2]+1),_={dataId:n.dataId,shape:[1,E,t.inChannels],dtype:n.dtype},L=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,z(jy(c.shape,_.shape),()=>`packed reshape ${c.shape} to ${_.shape} isn't free`);const P=Me({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});I.push(P);const A=Hy({a:_,b:P,backend:r,transposeA:y,transposeB:w,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),$=r.texData.get(A.dataId);z($.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=L,$.shape=t.outShape,x=Fs({inputs:{x:A},backend:r}),x.shape=t.outShape,I.push(A)}else{const E=t.outHeight*t.outWidth,_=Me({inputs:{x:n},backend:r,attrs:{shape:g?[t.batchSize,E,t.inChannels]:[t.batchSize,t.inChannels,E]}}),L=Me({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),P=Hy({a:g?_:L,b:g?L:_,transposeA:!g,transposeB:w,backend:r,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o});x=Me({inputs:{x:P},backend:r,attrs:{shape:t.outShape}}),I.push(_),I.push(L),I.push(P)}for(const E of I)r.disposeIntermediateTensorInfo(E);return x}function KM({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,y=g==="channelsLast",w=l*c*d,x=p*f,I=[t.batchSize,w,x],C=!0,k=!1,E=[];if(i!=null){const j=qy(i.shape,y);j!=null&&(i=Me({inputs:{x:i},backend:r,attrs:{shape:j}}),E.push(i))}if(s!=null){const j=qy(s.shape,y);j!=null&&(s=Me({inputs:{x:s},backend:r,attrs:{shape:j}}),E.push(s))}const _=Me({inputs:{x:e},backend:r,attrs:{shape:[1,w,xe(e.shape)/w]}});E.push(_);const L=new dhe(I,t),P=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],A=r.runWebGLProgram(L,[n],"float32",P),$=Me({inputs:{x:A},backend:r,attrs:{shape:I}});E.push(A),E.push($);const D=s!=null,R=i!=null,M=a==="leakyrelu",O=a?xf(a,!0):null,Z=new MM(y?$.shape:_.shape,y?_.shape:$.shape,y?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],C,k,D,O,R,M),q=y?[$,_]:[_,$];if(s&&q.push(s),R&&q.push(i),M){const j=r.makeTensorInfo([],"float32",$l(o,"float32"));q.push(j),E.push(j)}const se=r.runWebGLProgram(Z,q,"float32"),le=Me({inputs:{x:se},backend:r,attrs:{shape:t.outShape}});E.push(se);for(const j of E)r.disposeIntermediateTensorInfo(j);return le}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:d}=r,f=ka(l),p=Sr(s.shape,i.shape,o,c,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=qM({x:s,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const w=new HM(p),x=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(w,[s,i],"float32",x)}else if(pe().getBool("WEBGL_CONV_IM2COL"))g=KM({x:s,filter:i,convInfo:p,backend:t});else{const w=new jM(p);g=t.runWebGLProgram(w,[s,i],"float32")}const y=Me({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),y}const phe={kernelName:R0,backendName:"webgl",kernelFunc:fhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mhe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ghe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=r-1-e.padInfo.left,c=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class yhe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class vhe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,c=r-1-e.padInfo.top,d=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:d}=r,f=ka(l),p=Sr(s.shape,d,o,1,a,c,!1,f),g=new mhe(p);return t.runWebGLProgram(g,[s,i],"float32")}const whe={kernelName:DI,backendName:"webgl",kernelFunc:xhe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bhe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Ur(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,i=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:d}=r,f=ka(c),p=Sr(o,i.shape,a,1,l,d,!1,f);if(pe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],y=new bhe(p);return t.runWebGLProgram(y,[s,i],"float32",g)}else{const g=new ghe(p);return t.runWebGLProgram(g,[s,i],"float32")}}const Che={kernelName:N0,backendName:"webgl",kernelFunc:Ihe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,c=Pl(s.shape,i.shape,o,l,a),d=new hhe(c);return t.runWebGLProgram(d,[s,i],"float32")}const Ehe={kernelName:A0,backendName:"webgl",kernelFunc:She};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function khe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r,c=Pl(s.shape,l,o,1,a),d=new yhe(c);return t.runWebGLProgram(d,[s,i],"float32")}const The={kernelName:PI,backendName:"webgl",kernelFunc:khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _he(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r,c=Pl(l,i.shape,a,1,o),d=new vhe(c);return t.runWebGLProgram(d,[s,i],"float32")}const Rhe={kernelName:FI,backendName:"webgl",kernelFunc:_he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nhe=qh+`
  return cos(x);
`,Ahe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${nc}
  return result;
`,$he=Mt({opSnippet:Nhe,packedOpSnippet:Ahe}),Dhe={kernelName:Hf,backendName:"webgl",kernelFunc:$he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Phe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Fhe=Mt({opSnippet:Phe}),Ohe={kernelName:qf,backendName:"webgl",kernelFunc:Fhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lhe{constructor(e,t,r,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[d]=t,[f,p]=r;this.outputShape=[d,f,p,c];const g=s==="bilinear"?1:0,[y,w]=[`${a-1}.0`,`${l-1}.0`],[x,I,C]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[k,E,_]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${k});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${I};
        float width_scale = ${E};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mhe=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,d=new Lhe(s.shape,i.shape,a,l,c);return t.runWebGLProgram(d,[s,i,o],"float32")},Vhe={kernelName:LI,backendName:"webgl",kernelFunc:Mhe};var bf;(function(n){n.Prod="*",n.Sum="+"})(bf||(bf={}));class DN{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===bf.Prod?"1.0":"0.0",a=r?o:`getX(${PN(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",d="";r?(c=s?`end != ${l-1}`:"end != 0",d=s?"end + 1":"end - 1"):(c=s?`end + pow2 < ${l}`:"end >= pow2",d=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ln(i)} coords = getOutputCoords();
        int end = ${FN(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${d};
          ${FN(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${PN(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function PN(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function FN(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XM(n,e,t,r,s,i){const o=e.shape.length,a=Rn([r],o);let l=e;a!=null&&(l=rs({inputs:{x:e},backend:t,attrs:{perm:a}}));const c=zn(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const d=l.shape[c];let f=Fs({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new DN(n,l.shape,!1,i),y=[[p]],w=f;f=t.runWebGLProgram(g,[f],f.dtype,y),t.disposeIntermediateTensorInfo(w)}if(s){const p=new DN(n,l.shape,s,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=Fl(a),g=rs({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return XM(bf.Prod,s,t,i,o,a)}const Bhe={kernelName:OI,backendName:"webgl",kernelFunc:zhe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return XM(bf.Sum,s,t,i,o,a)}const Whe={kernelName:$0,backendName:"webgl",kernelFunc:Uhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ghe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.readSync(s.dataId),c=t.readSync(i.dataId),d=RM(l,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(s.shape.length===2){const l=t.bufferSync(s),c=t.bufferSync(i),d=Kae(l,c,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const jhe={kernelName:MI,backendName:"webgl",kernelFunc:Ghe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hhe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r,a=s.shape[0],l=o==="NHWC"?s.shape[1]:s.shape[2],c=o==="NHWC"?s.shape[2]:s.shape[3],d=o==="NHWC"?s.shape[3]:s.shape[1],f=l*i,p=c*i,g=d/(i*i),y=o==="NHWC"?[a,f,p,g]:[a,g,f,p],w=new Hhe(y,i,o);return t.runWebGLProgram(w,[s],s.dtype)}const Khe={kernelName:VI,backendName:"webgl",kernelFunc:qhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YM{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",d="";r&&(s?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QM{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let I=0;I<f;I++)g+=`
          vec4 xTexelC${I*2};
          int xTexelC${I*2}Ready;
          vec4 xTexelC${I*2+1};
          int xTexelC${I*2+1}Ready;
          vec4 xC${I};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let I=0;I<f;I++)g+=`
          xTexelC${I*2} = vec4(0.0);
          xTexelC${I*2}Ready = 0;
          xTexelC${I*2+1} = vec4(0.0);
          xTexelC${I*2+1}Ready = 0;
          xC${I} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let I=0;I<(p+1)/2;I++){const C=I*2;if(g+=`
          xC = xCCorner + ${C*c};
          `,l===1){if(C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,c===1&&C>0?g+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<f)){const k=a%2===0?wI(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${k};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,c>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:g+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):k===1?g+=`
                    xC${C+1} = xTexelC${C};
                    `:g+=`
                    xCOffset = xC + ${k};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<f&&(g+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<f&&(g+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<f&&(g+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let y="",w="";r&&(s?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:y=`vec4 activation(vec4 x) {
          ${r}
        }`,w="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;let d=l;d==null&&(d=[1,1]),z(zr(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Sr(s.shape,i.shape,o,d,a,c,!0);let p;pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new QM(f):p=new YM(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[s,i],"float32",g)}const Yhe={kernelName:D0,backendName:"webgl",kernelFunc:Xhe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qhe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Jhe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:d}=r,f=Sr(s.shape,d,o,a,l,c,!0),p=new Qhe(f);return t.runWebGLProgram(p,[s,i],"float32")}const ede={kernelName:zI,backendName:"webgl",kernelFunc:Zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:d}=r,f=Sr(d,i.shape,o,a,l,c,!0),p=new Jhe(f);return t.runWebGLProgram(p,[s,i],"float32")}const nde={kernelName:BI,backendName:"webgl",kernelFunc:tde};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rde{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sde(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],i=xe(r.shape),o=Me({inputs:{x:r},backend:t,attrs:{shape:[i]}}),a=new rde(i),l=t.runWebGLProgram(a,[o],o.dtype),c=Me({inputs:{x:l},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}const ide={kernelName:O$,backendName:"webgl",kernelFunc:sde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ode{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:d}=e,{top:f,left:p}=s;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ade(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,c=Ap(s.shape,i.shape,o,a,"NHWC",l);let d;const f=new ode(c);d=t.runWebGLProgram(f,[s,i],"float32");const p=Me({inputs:{x:d},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(d),p}const lde={kernelName:P0,backendName:"webgl",kernelFunc:ade};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ude(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=cS(s,i.length);dS(o.length,l,i);const{path:c,steps:d}=fS(a,l),f=d.length;let p=null,g=o.length;const y=[];for(let w=0;w<f;++w){for(const x of d[w]){const{permutationIndices:I,expandDims:C}=hS(g,l[x]);let k;pS(I)?k=i[x]:(k=rs({inputs:{x:i[x]},backend:t,attrs:{perm:I}}),y.push(k));const E=k.shape.slice();for(let _=0;_<C.length;++_)E.splice(C[_],0,1);Qt(k.shape,E)||(k=Me({inputs:{x:k},backend:t,attrs:{shape:E}}),y.push(k)),p===null?p=k:(p=eE({inputs:{a:k,b:p},backend:t}),y.push(p))}w<f-1&&(c[w]>=0&&(p=Kv({inputs:{x:p},backend:t,attrs:{axis:c[w]-(o.length-g),keepDims:!1}}),y.push(p)),g--)}for(const w of y)w!==p&&t.disposeIntermediateTensorInfo(w);return p}const cde={kernelName:UI,backendName:"webgl",kernelFunc:ude};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hde="return (x >= 0.0) ? x : (exp(x) - 1.0);",dde=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,fde=Mt({opSnippet:hde,packedOpSnippet:dde}),pde={kernelName:Xf,backendName:"webgl",kernelFunc:fde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mde="return (b >= 0.0) ? a : a * (b + 1.0);",gde=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,yde=n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hh(gde,r.shape,s.shape):new Uu(mde,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],r.dtype)},vde={kernelName:WI,backendName:"webgl",kernelFunc:yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde=`
  return vec4(equal(a, b));
`,wde="return float(a == b);",bde=kr({opSnippet:wde,packedOpSnippet:xde,dtype:"bool",cpuKernelImpl:Zae}),Ide={kernelName:F0,backendName:"webgl",kernelFunc:bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cde=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${rS};
  float a1 = ${sS};
  float a2 = ${iS};
  float a3 = ${oS};
  float a4 = ${aS};
  float a5 = ${lS};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Sde=Mt({opSnippet:Cde}),Ede={kernelName:Yf,backendName:"webgl",kernelFunc:Sde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kde=qh+`
  return exp(x);
`,Tde=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JM=Mt({opSnippet:kde,packedOpSnippet:Tde,cpuKernelImpl:ele,dtype:"float32"}),_de={kernelName:Qf,backendName:"webgl",kernelFunc:JM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pb(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(z(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+s+1),a.splice(l,0,1),Me({inputs:{x:i},backend:r,attrs:{shape:a}})}const Rde={kernelName:O0,backendName:"webgl",kernelFunc:pb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ON="return exp(x) - 1.0;",Nde=Mt({opSnippet:ON,packedOpSnippet:ON,cpuKernelImpl:tle}),Ade={kernelName:Jf,backendName:"webgl",kernelFunc:Nde};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LN{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZM(n,e,t){const r=t.texData.get(n.dataId),s=xe(n.shape),i=n.shape[n.shape.length-1],o=s/i,a=Me({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,c=new LN("real",l,e),d=new LN("imag",l,e),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(c,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=Bl({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const w=Me({inputs:{x:y},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(y),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $de(n){const{inputs:e,backend:t}=n,{input:r}=e;return ZM(r,!1,t)}const Dde={kernelName:GI,backendName:"webgl",kernelFunc:$de};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pde{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jp(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:i}=t;if(i=i||Dh(s),i==="string"){const o=Ln(i,xe(r));return o.fill(s),e.makeTensorInfo(r,i,o)}else{const o=new Pde(r,s),a=[[s]];return e.runWebGLProgram(o,[],i,a)}}const Fde={kernelName:jI,backendName:"webgl",kernelFunc:Jp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ode{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lde={kernelName:HI,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new Ode(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN="return floor(x);",Mde=Mt({opSnippet:MN,packedOpSnippet:MN,cpuKernelImpl:nle}),Vde={kernelName:Zf,backendName:"webgl",kernelFunc:Mde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zde=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Bde=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Ude=kr({opSnippet:zde,packedOpSnippet:Bde,dtype:"int32"}),Wde={kernelName:ep,backendName:"webgl",kernelFunc:Ude};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gde{constructor(e){this.variableNames=["A"];const t=ss(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jde{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ss(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hde={kernelName:W6,backendName:"webgl",kernelFunc:qde};let Bc,i1=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function qde(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:i}=r,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,c]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],d=[c,l],f=[c,l,i];if(a||o){const w=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Bc==null||w!==i1)&&(i1=w,Bc=document.createElement("canvas").getContext("2d",{willReadFrequently:i1})),Bc.canvas.width=l,Bc.canvas.height=c,Bc.drawImage(s,0,0,l,c),s=Bc.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=qs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),s);const g=pe().getBool("WEBGL_PACK")?new jde(f):new Gde(f),y=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:y}=r,w=ka(d),x=Sr(s.shape,i.shape,l,f,c,p,!1,w);let I;const C=[],k=o!=null,E=a!=null,_=g==="leakyrelu",L=()=>{const A=[s,i],$=(D,R)=>{if(R==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const M=Me({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return C.push(M),M}return D};if(k&&A.push($(o,d)),E&&A.push($(a,d)),_){const D=t.makeTensorInfo([],"float32",$l(y,"float32"));A.push(D),C.push(D)}return A};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))I=qM({x:s,filter:i,convInfo:x,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:y});else if(x.strideWidth<=2&&w==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const A=g?xf(g,!0):null,$=new HM(x,k,A,E,_),D=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],R=L();I=t.runWebGLProgram($,R,"float32",D)}else if(pe().getBool("WEBGL_CONV_IM2COL"))I=KM({x:s,filter:i,convInfo:x,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:y});else{const A=g?xf(g,!1):null,$=new jM(x,k,A,E,_),D=L();I=t.runWebGLProgram($,D,"float32")}const P=Me({inputs:{x:I},backend:t,attrs:{shape:x.outShape}});return C.push(I),C.forEach(A=>t.disposeIntermediateTensorInfo(A)),P}const Xde={kernelName:by,backendName:"webgl",kernelFunc:Kde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=r,y=[];let w=d;w==null&&(w=[1,1]),z(zr(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const x=Sr(s.shape,i.shape,l,w,c,f,!0),I=pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,C=p?xf(p,I):null,k=[s,i],E=o!=null,_=a!=null,L=p==="leakyrelu";if(E&&k.push(o),_&&k.push(a),L){const D=t.makeTensorInfo([],"float32",$l(g,"float32"));k.push(D),y.push(D)}let P;I?P=new QM(x,E,C,_,L):P=new YM(x,E,C,_,L);const A=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],$=t.runWebGLProgram(P,k,"float32",A);return y.forEach(D=>t.disposeIntermediateTensorInfo(D)),$}const Qde={kernelName:tD,backendName:"webgl",kernelFunc:Yde};class Jde{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const i=ln(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=s.shape,o=i[i.length-1],a=xe(r.shape),[l,c,d,f]=HC(r,s),p=Me({inputs:{x:s},backend:t,attrs:{shape:[c,o]}}),g=Me({inputs:{x:r},backend:t,attrs:{shape:[xe(r.shape)/d,d]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const I=t.readSync(s.dataId),C=t.bufferSync(r),k=rle(I,C,r.dtype,c,o,d,f,r.shape,a);return t.makeTensorInfo(l,r.dtype,k.values)}const y=new Jde(o,f,[c,d],r.shape),w=t.runWebGLProgram(y,[g,p],g.dtype),x=Me({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),x}const efe={kernelName:L$,backendName:"webgl",kernelFunc:Zde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tfe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=ln(this.rank),s=nfe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function nfe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r,l=Ct(o,s.shape)[0];if(pe().get("DEBUG")){const C=t.readSync(i.dataId),k=s.shape[l];for(let E=0;E<C.length;++E){const _=C[E];z(_<=k-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${k-1}]`)}}const c=gS(s,i,l,a),d=xe(i.shape),f=[],p=Me({inputs:{x:s},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),g=Me({inputs:{x:i},backend:t,attrs:{shape:[c.batchSize,d/c.batchSize]}});f.push(p),f.push(g);const y=[c.batchSize,c.outerSize,d/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const C=t.bufferSync(g),k=t.bufferSync(p),E=sle(k,C,y);return f.forEach(_=>t.disposeIntermediateTensorInfo(_)),t.makeTensorInfo(c.outputShape,E.dtype,E.values)}const w=new tfe(p.shape,y),x=t.runWebGLProgram(w,[p,g],p.dtype);f.push(x);const I=Me({inputs:{x},backend:t,attrs:{shape:c.outputShape}});return f.forEach(C=>t.disposeIntermediateTensorInfo(C)),I}const rfe={kernelName:M0,backendName:"webgl",kernelFunc:eV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sfe="return float(a > b);",ife=`
  return vec4(greaterThan(a, b));
`,ofe=kr({opSnippet:sfe,packedOpSnippet:ife,cpuKernelImpl:ile,dtype:"bool"}),afe={kernelName:V0,backendName:"webgl",kernelFunc:ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lfe="return float(a >= b);",ufe=`
  return vec4(greaterThanEqual(a, b));
`,cfe=kr({opSnippet:lfe,packedOpSnippet:ufe,dtype:"bool",cpuKernelImpl:ole}),hfe={kernelName:tp,backendName:"webgl",kernelFunc:cfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dfe(n){const{inputs:e,backend:t}=n,{input:r}=e;return ZM(r,!0,t)}const ffe={kernelName:qI,backendName:"webgl",kernelFunc:dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pfe="return float(!isnan(x) && !isinf(x));",mfe=Mt({opSnippet:pfe,dtype:"bool"}),gfe={kernelName:rp,backendName:"webgl",kernelFunc:mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe="return float(isinf(x));",vfe=Mt({opSnippet:yfe,dtype:"bool"}),xfe={kernelName:sp,backendName:"webgl",kernelFunc:vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wfe="return float(isnan(x));",bfe=Mt({opSnippet:wfe,dtype:"bool"}),Ife={kernelName:ip,backendName:"webgl",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cfe="return float(a < b);",Sfe=`
  return vec4(lessThan(a, b));
`,Efe=kr({opSnippet:Cfe,packedOpSnippet:Sfe,cpuKernelImpl:ale,dtype:"bool"}),kfe={kernelName:B0,backendName:"webgl",kernelFunc:Efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe="return float(a <= b);",_fe=`
  return vec4(lessThanEqual(a, b));
`,Rfe=kr({opSnippet:Tfe,packedOpSnippet:_fe,cpuKernelImpl:lle,dtype:"bool"}),Nfe={kernelName:U0,backendName:"webgl",kernelFunc:Rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Afe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=ule(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const $fe={kernelName:M$,backendName:"webgl",kernelFunc:Afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dfe=qh+`
  return x < 0.0 ? 0./0. : log(x);
`,Pfe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Ffe=Mt({opSnippet:Dfe,packedOpSnippet:Pfe,cpuKernelImpl:cle}),Ofe={kernelName:op,backendName:"webgl",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lfe=qh+`
  return log(1.0 + x);
`,Mfe=Mt({opSnippet:Lfe}),Vfe={kernelName:ap,backendName:"webgl",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zfe="return float(a >= 1.0 && b >= 1.0);",Bfe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Ufe=kr({opSnippet:zfe,packedOpSnippet:Bfe,dtype:"bool"}),Wfe={kernelName:W0,backendName:"webgl",kernelFunc:Ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gfe="return float(!(x >= 1.0));",jfe=Mt({opSnippet:Gfe}),Hfe={kernelName:G0,backendName:"webgl",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qfe="return float(a >= 1.0 || b >= 1.0);",Kfe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Xfe=kr({opSnippet:qfe,packedOpSnippet:Kfe,dtype:"bool"}),Yfe={kernelName:j0,backendName:"webgl",kernelFunc:Xfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qfe{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jfe{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zfe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r,c=pe().getBool("WEBGL_PACK_NORMALIZATION")?new Jfe(s.shape,i,o,a,l):new Qfe(s.shape,i,o,a,l);return t.runWebGLProgram(c,[s],s.dtype)},epe={kernelName:H0,backendName:"webgl",kernelFunc:Zfe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tpe{constructor(e,t,r,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const npe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:d}=r,f=new tpe(s.shape,a,l,c,d);return t.runWebGLProgram(f,[s,i,o],s.dtype)},rpe={kernelName:XI,backendName:"webgl",kernelFunc:npe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function spe(n,e,t,r){const s=xe(e),o=xe(n.shape)/s,a=Me({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=rc(a,n.dtype,"max",r),c=Me({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=s.shape.length,l=Ct(i,s.shape);let c=l;const d=Rn(c,a),f=d!=null,p=t.shouldExecuteOnCPU([s]);let g=s;if(f){if(p){const k=t.texData.get(g.dataId).values,E=new Array(a);for(let P=0;P<E.length;P++)E[P]=s.shape[d[P]];const _=JS(k,s.shape,s.dtype,d,E);g=t.makeTensorInfo(E,s.dtype);const L=t.texData.get(g.dataId);L.values=_}else g=qv(s,d,t);c=zn(c.length,a)}Er("max",c,a);const[y,w]=pr(g.shape,c);let x=y;o&&(x=qn(y,l));let I;if(p){const k=t.texData.get(g.dataId).values,E=hle(k,xe(w),x,s.dtype);I=t.makeTensorInfo(x,s.dtype);const _=t.texData.get(I.dataId);_.values=E}else I=spe(g,w,x,t);return f&&t.disposeIntermediateTensorInfo(g),I}const ipe={kernelName:q0,backendName:"webgl",kernelFunc:tV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ope=ZS+`
  return max(a, b);
`,ape=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+nc+`
  return result;
`,lpe=kr({opSnippet:ope,packedOpSnippet:ape,cpuKernelImpl:dle}),upe={kernelName:lp,backendName:"webgl",kernelFunc:lpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Xp(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(zr(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=vi(s.shape,i,o,c,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Qt(d.inShape,d.outShape))return Fs({inputs:{x:s},backend:t});const f=new wf(d,"max",!1);return t.runWebGLProgram(f,[s],s.dtype)}const hpe={kernelName:K0,backendName:"webgl",kernelFunc:cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=r,d=[1,1,1],f=Ea(s.shape,i,o,d,a,c,l),p=new tE(f,"max",!1);return t.runWebGLProgram(p,[s],s.dtype)}const fpe={kernelName:X0,backendName:"webgl",kernelFunc:dpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ppe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class mpe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=c-1-e.padInfo.top,g=d-1-e.padInfo.left,y=l*c*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gpe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=r,f=[1,1,1],p=Ea(o.shape,a,l,f,c,d),g=new tE(p,"max",!0),y=t.runWebGLProgram(g,[o],o.dtype),w=new mpe(p),x=t.runWebGLProgram(w,[s,y],o.dtype);return t.disposeIntermediateTensorInfo(y),x}const ype={kernelName:QI,backendName:"webgl",kernelFunc:gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vpe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Xp([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:d,dimRoundingMode:f}=r,p=vi(a.shape,l,c,1,d,f),g=!0,y=new wf(p,"max",g),w=t.runWebGLProgram(y,[a],a.dtype),x=new ppe(p),I=t.runWebGLProgram(x,[s,w],a.dtype);return t.disposeIntermediateTensorInfo(w),I}const xpe={kernelName:YI,backendName:"webgl",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(n,e,t,r){let s=new wf(t,"max",!1);const i=r.runWebGLProgram(s,[n],"float32");s=new wf(t,"max",!0,!0,e);const o=r.runWebGLProgram(s,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpe={kernelName:V$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;z(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const c=[1,1];z(zr(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const d=vi(r.shape,s,i,c,o),[f,p]=wpe(r,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipe(n,e,t,r){const s=xe(e),o=xe(n.shape)/s,a=Me({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=rc(a,"float32","mean",r),c=Me({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cpe={kernelName:Y0,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:i}=e,o=t,a=r.shape.length,l=Ct(i,r.shape);let c=l;const d=Rn(c,a),f=d!=null,p=o.shouldExecuteOnCPU([r]),g=[];let y=r;if(f){if(p){const E=o.texData.get(y.dataId).values,_=new Array(a);for(let A=0;A<_.length;A++)_[A]=r.shape[d[A]];const L=JS(E,r.shape,r.dtype,d,_);y=o.makeTensorInfo(_,r.dtype);const P=o.texData.get(y.dataId);P.values=L}else y=qv(r,d,o);g.push(y),c=zn(c.length,a)}Er("sum",c,a);const[w,x]=pr(y.shape,c);let I=w;s&&(I=qn(w,l));const C=Ipe(y,x,I,o);for(const k of g)o.disposeIntermediateTensorInfo(k);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=Ct(i,s.shape);let c=l;const d=Rn(c,a);let f=s;d!=null&&(f=rs({inputs:{x:s},backend:t,attrs:{perm:d}}),c=zn(c.length,s.shape.length)),Er("min",c,a);const[p,g]=pr(f.shape,c),y=xe(g),w=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),x=rc(w,w.dtype,"min",t);let I;if(o){const C=qn(p,l);I=Me({inputs:{x},backend:t,attrs:{shape:C}})}else I=Me({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(f),I}const Epe={kernelName:Q0,backendName:"webgl",kernelFunc:Spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kpe=ZS+`
  return min(a, b);
`,Tpe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+nc+`
  return result;
`,_pe=kr({opSnippet:kpe,packedOpSnippet:Tpe,cpuKernelImpl:fle}),Rpe={kernelName:up,backendName:"webgl",kernelFunc:_pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Npe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const s=e.length,i=ln(s),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),c=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ape{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((y,w)=>y[0]+e[w]+y[1]);const s=e.length,i=ln(s),o=t.map(y=>y[0]).join(","),a=t.map((y,w)=>y[0]+e[w]).join(","),l=es("rc",s),c=es("source",s),d=`${l[s-1]} < ${this.outputShape[s-1]}`,f=s===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1;let g="";if(s===1){const y=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${f});
        ${l[s-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${f});
        }
      `}else{const y=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${f});
        ${l[s-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${f});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${y}
          result[2] = getChannel(getX(${c.join()}), ${f});
          ${l[s-1]} += 1;
          if(${d}) {
            ${y}
            result[3] = getChannel(getX(${c.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:i}=t,o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ape(r.shape,s,i):new Npe(r.shape,s,i);return e.runWebGLProgram(o,[r],r.dtype)},Dpe={kernelName:J0,backendName:"webgl",kernelFunc:$pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ppe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Fpe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+nc+`
  return result;
`,Ope=kr({opSnippet:Ppe,packedOpSnippet:Fpe}),Lpe={kernelName:cp,backendName:"webgl",kernelFunc:Ope};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mpe{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vpe=`
if (a == b) {
  return 1.0;
};
return a / b;`,zpe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,nV=kr({opSnippet:Vpe,packedOpSnippet:zpe,checkOutOfBounds:!0}),Bpe={kernelName:Kf,backendName:"webgl",kernelFunc:nV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VN="return a - b;",rV=kr({opSnippet:VN,packedOpSnippet:VN,supportsComplex:!0,cpuKernelImpl:Ple}),Upe={kernelName:kp,backendName:"webgl",kernelFunc:rV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=Ct([i],s.shape),a=tV({inputs:{x:s},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=qn(a.shape,o),c=Me({inputs:{x:a},backend:t,attrs:{shape:l}}),d=rV({inputs:{a:s,b:c},backend:t}),f=JM({inputs:{x:d},backend:t}),p=Kv({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Me({inputs:{x:p},backend:t,attrs:{shape:l}}),y=nV({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),y}const Wpe={kernelName:gv,backendName:"webgl",kernelFunc:sV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gpe(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r,l=a?s:sV({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),c=l.shape[0],d=l.shape[1],f=new Mpe(c,d,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const jpe={kernelName:z$,backendName:"webgl",kernelFunc:Gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hpe=wi+`
  return -x;
`,qpe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Kpe(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId),[o,a]=mle(i.values,r.shape,r.dtype);return t.makeTensorInfo(a,r.dtype,o)}let s;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new ll(r.shape,qpe):s=new bo(r.shape,Hpe),t.runWebGLProgram(s,[r],r.dtype)}const Xpe={kernelName:Z0,backendName:"webgl",kernelFunc:Kpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ype=zC;function Qpe(n){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,c=t.readSync(s.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=Ype(c,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Jpe={kernelName:JI,backendName:"webgl",kernelFunc:Qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zpe=BC;function eme(n){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,d=t.readSync(s.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=Zpe(d,f,o,a,l,c);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const tme={kernelName:ZI,backendName:"webgl",kernelFunc:eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nme=UC;function rme(n){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,d=t.readSync(s.dataId),f=t.readSync(i.dataId),p=o,g=a,y=l,w=c,{selectedIndices:x,selectedScores:I}=nme(d,f,p,g,y,w);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([I.length],"float32",new Float32Array(I))]}const sme={kernelName:eC,backendName:"webgl",kernelFunc:rme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ime{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r,c=xe(s.shape),d=new ime(c,o,a,l),f=Me({inputs:{x:s},backend:t,attrs:{shape:[c]}}),p=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...s.shape,o],y=Me({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),y},ame={kernelName:nv,backendName:"webgl",kernelFunc:ome};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ky(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=Qp({inputs:{input:r},backend:t}),i=Ky({inputs:{x:s},backend:t}),o=Xv({inputs:{input:r},backend:t}),a=Ky({inputs:{x:o},backend:t}),l=Bl({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Jp({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const lme={kernelName:xv,backendName:"webgl",kernelFunc:Ky};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=Qp({inputs:{input:r},backend:t}),i=iV({inputs:{x:s},backend:t}),o=Xv({inputs:{input:r},backend:t}),a=Ky({inputs:{x:o},backend:t}),l=Bl({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Jp({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const ume={kernelName:tv,backendName:"webgl",kernelFunc:iV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cme(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return pb({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{bI(i,d.shape,"All tensors passed to stack must have matching shapes"),z(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=pb({inputs:{input:d},backend:t,attrs:{dim:s}});return a.push(f),f}),c=GM({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),c}const hme={kernelName:rv,backendName:"webgl",kernelFunc:cme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dme{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,d)=>c[0]+e[d]+c[1]);const s=e.length,i=ln(s),o=t.map(c=>c[0]).join(","),a=t.map((c,d)=>c[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fme{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,x)=>w[0]+e[x]+w[1]);const s=e.length,i=ln(s),o=t.map(w=>w[0]).join(","),a=t.map((w,x)=>w[0]+e[x]).join(","),l=es("rc",s),c=es("source",s),d=`${l[s-1]} < ${this.outputShape[s-1]}`,f=s===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${d}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${d}) {`],g=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let y="";for(let w=0,x=s===1?2:4;w<x;w++)y+=`
        ${p[w]}
        if (${g}) {
          result[${w}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${w}] = getChannel(getX(${c.join()}), ${f});
        }
      `;y+=s===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oV=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;if(xe(s.shape)===0){const c=i.map((d,f)=>d[0]+s.shape[f]+d[1]);return Jp({backend:t,attrs:{shape:c,value:o,dtype:s.dtype}})}const a=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fme(s.shape,i,o):new dme(s.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[s],s.dtype,l)},pme={kernelName:sv,backendName:"webgl",kernelFunc:oV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mme=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,gme=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+nc+`
  return result;
`,yme=kr({opSnippet:mme,packedOpSnippet:gme}),vme={kernelName:dp,backendName:"webgl",kernelFunc:yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=[],c=Ct(i,s.shape);let d=c;const f=Rn(d,a);let p=s;f!=null&&(p=rs({inputs:{x:s},backend:t,attrs:{perm:f}}),d=zn(d.length,a),l.push(p)),Er("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const y=t.texData.get(p.dataId).values,{outVals:w,outShape:x,outDtype:I}=yle(p.shape,p.dtype,y,d);g=t.makeTensorInfo(x,I,w)}else{const[y,w]=pr(p.shape,d),x=xe(w),I=Me({inputs:{x:p},backend:t,attrs:{shape:[-1,x]}}),C=dC(s.dtype),k=rc(I,C,"prod",t);g=Me({inputs:{x:k},backend:t,attrs:{shape:y}}),l.push(I),l.push(k)}if(o){l.push(g);const y=qn(g.shape,c);g=Me({inputs:{x:g},backend:t,attrs:{shape:y}})}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const wme={kernelName:ov,backendName:"webgl",kernelFunc:xme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bme(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(I=>t.readSync(I.dataId)),c=s.map(I=>I.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,y]=vle(l,c,d,i.shape,i.dtype,f,o.shape,a),w=p.map(I=>t.makeTensorInfo([I.length],"int32",I)),x=t.makeTensorInfo(y,i.dtype,g);return w.concat([x])}const Ime={kernelName:B$,backendName:"webgl",kernelFunc:bme};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[c,d]=xle(o,r.shape,r.dtype,a,s.shape,l,i.shape),f=t.makeTensorInfo([c.length],"int32",c),p=t.makeTensorInfo([d.length],r.dtype,d);return[f,p]}const Sme={kernelName:U$,backendName:"webgl",kernelFunc:Cme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eme(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.readSync(s.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(x=>t.readSync(x.dataId)),g=a.map(x=>x.shape),[y,w]=wle(c,s.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(y,i.dtype,w)}const kme={kernelName:W$,backendName:"webgl",kernelFunc:Eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aV=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:i,dtype:o}=t,a=ble(r,s,i,o);return e.makeTensorInfo([a.length],o,a)},Tme={kernelName:tC,backendName:"webgl",kernelFunc:aV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me="return 1.0 / x;",Rme=Mt({opSnippet:_me}),Nme={kernelName:fp,backendName:"webgl",kernelFunc:Rme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ame=wi+`
  return (x < 0.0) ? 0.0 : x;
`,$me=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dme=Mt({opSnippet:Ame,packedOpSnippet:$me}),Pme={kernelName:pp,backendName:"webgl",kernelFunc:Dme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fme=wi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ome=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Lme=Mt({opSnippet:Fme,packedOpSnippet:Ome}),Mme={kernelName:mp,backendName:"webgl",kernelFunc:Lme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vme{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,r,c];const d=[s&&t>1?a-1:a,s&&r>1?l-1:l],f=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zme{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,r,c];const d=[s&&t>1?a-1:a,s&&r>1?l-1:l],f=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,c]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zme(s.shape,l,c,i,o):new Vme(s.shape,l,c,i,o);return t.runWebGLProgram(d,[s],"float32")}const Ume={kernelName:uv,backendName:"webgl",kernelFunc:Bme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wme{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],c=[r&&o>1?o-1:o,r&&a>1?a-1:a],d=l[0]/c[0],f=l[1]/c[1],p=1/d,g=1/f,y=Math.ceil(p)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gme(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new Wme(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const jme={kernelName:sC,backendName:"webgl",kernelFunc:Gme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hme{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,r,c];const d=[s&&t>1?a-1:a,s&&r>1?l-1:l],f=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qme{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,r,c];const d=[s&&t>1?a-1:a,s&&r>1?l-1:l],f=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kme(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,c]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new qme(s.shape,l,c,i,o):new Hme(s.shape,l,c,i,o);return t.runWebGLProgram(d,[s],s.dtype)}const Xme={kernelName:lv,backendName:"webgl",kernelFunc:Kme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yme{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],c=[r&&o>1?o-1:o,r&&a>1?a-1:a],d=l[0]/c[0],f=l[1]/c[1],p=1/d,g=1/f,y=Math.ceil(p)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new Yme(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const Jme={kernelName:rC,backendName:"webgl",kernelFunc:Qme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zme{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>s(l)).join(","),o=ln(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ege{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=es("rc",r),i=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,a=ln(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${i}){
            result.g = ${c(s.slice())};
          }
          if(${o}) {
            result.b = ${d(s.slice())};
            if(${i}) {
              result.a = ${f(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(y){return p(y)}function c(y){return y[r-1]="("+y[r-1]+" + 1)",p(y)}function d(y){return y[r-2]="("+y[r-2]+" + 1)",p(y)}function f(y){return y[r-1]="("+y[r-1]+" + 1)",y[r-2]="("+y[r-2]+" + 1)",p(y)}function p(y){const w=e.map((C,k)=>g(k,y)),x=w.join(","),I=w.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${I}))`}function g(y,w){return t.indexOf(y)!==-1&&e[y]!==1?`${e[y]} - ${w[y]} - 1`:`${w[y]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r,o=s.shape.length,a=Ct(i,s.shape);if(o===0)return Fs({inputs:{x:s},backend:t});const l=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ege(s.shape,a):new Zme(s.shape,a);return t.runWebGLProgram(l,[s],s.dtype)}const nge={kernelName:cv,backendName:"webgl",kernelFunc:tge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rge{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sge={kernelName:hC,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=new rge(r.shape,i),[c,d]=eS(o,r.shape[1],r.shape[2]),f=[[c,d,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[r],r.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ige=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,oge=Mt({opSnippet:ige}),age={kernelName:gp,backendName:"webgl",kernelFunc:oge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lge="return inversesqrt(x);",uge=Mt({opSnippet:lge,cpuKernelImpl:Ile}),cge={kernelName:yp,backendName:"webgl",kernelFunc:uge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nE{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=ln(i.length),d=ln(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const p=`getIndices(${f})`;let g="";s===1?g="i":s===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const x=`getDefaultValue(${w})`,I=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${I};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${y};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hge{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=ln(i.length),d=ln(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const p=`getIndices(${f})`;let g="";s===1?g="i":s===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const x=`getDefaultValue(${w})`,I=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${I};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${y};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:f}=Qu(i,s,o),p=[f/c,c];if(f===0)return t.makeTensorInfo(o,s.dtype);const g=Me({inputs:{x:s},backend:t,attrs:{shape:[l,a]}}),y=Me({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;pe().getBool("WEBGL_PACK")?x=new hge(l,a,g.shape.length,y.shape.length,d,p):x=new nE(l,a,g.shape.length,y.shape.length,d,p);const I=t.runWebGLProgram(x,[y,g,w],y.dtype),C=Me({inputs:{x:I},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(w),C}const fge={kernelName:G$,backendName:"webgl",kernelFunc:dge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pge{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=pe().getNumber("WEBGL_VERSION")===2?i:o,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mge(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=new pge(s.shape[0],s.shape[1],i.shape[1],o),l=[[s.shape[1]]];return t.runWebGLProgram(a,[s,i],"int32",l)}const gge={kernelName:H$,backendName:"webgl",kernelFunc:mge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yge{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let d=0;d<t.length;d++)c.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);s=l.join(),i=c.join()}const o=ln(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vge(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e,o=new yge(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(o,[r,s,i],Ds(s.dtype,i.dtype))}const xge={kernelName:hv,backendName:"webgl",kernelFunc:vge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wge=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Av};
  float scale = ${$v};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,bge=Mt({opSnippet:wge}),Ige={kernelName:vp,backendName:"webgl",kernelFunc:bge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cge=qh+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Sge=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ege=Mt({opSnippet:Cge,packedOpSnippet:Sge,cpuKernelImpl:Sle}),kge={kernelName:Ip,backendName:"webgl",kernelFunc:Ege};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tge=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,_ge=Mt({opSnippet:Tge}),Rge={kernelName:bp,backendName:"webgl",kernelFunc:_ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nge=qh+`
  return sin(x);
`,Age=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${nc}
  return result;
`,$ge=Mt({opSnippet:Nge,packedOpSnippet:Age}),Dge={kernelName:xp,backendName:"webgl",kernelFunc:$ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Fge=Mt({opSnippet:Pge}),Oge={kernelName:wp,backendName:"webgl",kernelFunc:Fge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lge=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Mge=Mt({opSnippet:Lge}),Vge={kernelName:Cp,backendName:"webgl",kernelFunc:Mge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zge=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;z(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((I,C)=>I*C),l=[[0,0]];l.push(...o);for(let I=1+i.length;I<s.shape.length;++I)l.push([0,0]);const c=[],d=oV({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),f=Op(d.shape,i,a,!1),p=Lp(f.length,i.length,!1),g=Mp(d.shape,i,a,!1),y=Me({inputs:{x:d},backend:t,attrs:{shape:f}}),w=rs({inputs:{x:y},backend:t,attrs:{perm:p}}),x=Me({inputs:{x:w},backend:t,attrs:{shape:g}});return c.push(d),c.push(y),c.push(w),c.forEach(I=>t.disposeIntermediateTensorInfo(I)),x},Bge={kernelName:pv,backendName:"webgl",kernelFunc:zge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uge(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(r.dataId),l=t.readSync(s.dataId),c=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,p,g,y,w]=kle(a,r.shape,r.dtype,l,s.dtype,c,d);return[t.makeTensorInfo(p,r.dtype,f),t.makeTensorInfo([p[0]],s.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(x=>Number(x)))),t.makeTensorInfo([w.length],r.dtype,new Int32Array(w))]}const Wge={kernelName:q$,backendName:"webgl",kernelFunc:Uge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gge(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(s.dataId)),a=t.readSync(r.dataId),l=Array.from(t.readSync(i.dataId)),[c,d,f]=Tle(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(d,r.dtype,c),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const jge={kernelName:K$,backendName:"webgl",kernelFunc:Gge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hge(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[c,d]=AM(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(d,r.dtype,c)}const qge={kernelName:X$,backendName:"webgl",kernelFunc:Hge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kge(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[c,d]=AM(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(d,r.dtype,c)}const Xge={kernelName:Y$,backendName:"webgl",kernelFunc:Kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yge(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:d,strides:f,outputSize:p}=Qu(i,s,a),g=!1;if(i.dtype==="string"){const I=t.bufferSync(s),C=t.bufferSync(i),k=Sl(t.readSync(o.dataId)[0]),E=Cle(I,C,a,p,d,c,l,f,k,g);return t.makeTensorInfo(a,E.dtype,E.values)}const y=new nE(c,l,s.shape.length,i.shape.length,f,[p,1],g),w=t.runWebGLProgram(y,[i,s,o],i.dtype),x=Me({inputs:{x:w},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(w),x}const Qge={kernelName:Q$,backendName:"webgl",kernelFunc:Yge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=Ct(o,s.shape)[0],l=mS(s,i,a),c=s.shape.length,d=new Array(c).fill(0),f=s.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const y=Kh({inputs:{x:s},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,y})}const Zge={kernelName:mv,backendName:"webgl",kernelFunc:Jge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zN="return sqrt(x);",eye=Mt({opSnippet:zN,packedOpSnippet:zN,cpuKernelImpl:_le}),tye={kernelName:Sp,backendName:"webgl",kernelFunc:eye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nye="return x * x;",rye=Mt({opSnippet:nye}),sye={kernelName:iC,backendName:"webgl",kernelFunc:rye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BN="return (a - b) * (a - b);",iye=kr({opSnippet:BN,packedOpSnippet:BN}),oye={kernelName:Ep,backendName:"webgl",kernelFunc:iye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(s.dataId),o=ba(i),a=Rle(o,"string",r);return t.makeTensorInfo(s.shape,"string",a)}const lye={kernelName:oC,backendName:"webgl",kernelFunc:aye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uye({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=wi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new bo(r.shape,s);return t.runWebGLProgram(i,[r],r.dtype)}const cye={kernelName:Np,backendName:"webgl",kernelFunc:uye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hye{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,i=ln(r.length),o=ln(r.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=r.map((c,d)=>(l++,r.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=r,{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:x,isSimpleSlice:I,begin:C,end:k,strides:E}=QC(s.shape,i,o,a,l,c,d,f,p);let _;if(w)_=Me({inputs:{x:s},backend:t,attrs:{shape:y}});else if(x||I){z(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const P=KC(C,k,E),A=Kh({inputs:{x:s},backend:t,attrs:{begin:C,size:P}});_=Me({inputs:{x:A},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(A)}else if(t.shouldExecuteOnCPU([s])){const A=t.readSync(s.dataId),$=It(s.shape,s.dtype,A),D=Nle(g,$,E,C);_=t.makeTensorInfo(y,s.dtype,D.values)}else{const A=new hye(C,E,g);_=t.runWebGLProgram(A,[s],s.dtype)}const L=Me({inputs:{x:_},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(_),L}const fye={kernelName:aC,backendName:"webgl",kernelFunc:dye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pye(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[y,w]=Ale(p,g,s,i,o,a,l,c);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const mye={kernelName:J$,backendName:"webgl",kernelFunc:pye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gye(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[c,d,f]=$le(a,l,s),p=d.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const yye={kernelName:Z$,backendName:"webgl",kernelFunc:gye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vye(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=Dle(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const xye={kernelName:eD,backendName:"webgl",kernelFunc:vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wye="return tan(x);",bye=Mt({opSnippet:wye}),Iye={kernelName:Tp,backendName:"webgl",kernelFunc:bye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cye=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Sye=Mt({opSnippet:Cye}),Eye={kernelName:_p,backendName:"webgl",kernelFunc:Sye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kye(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:f}=Qu(o,i,s.shape),p=[f/c,c];if(f===0)return t.makeTensorInfo(s.shape,i.dtype);const g=Me({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),y=Me({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),w=Me({inputs:{x:s},backend:t,attrs:{shape:p}}),x=new nE(l,a,g.shape.length,y.shape.length,d,p,!1,!0),I=t.runWebGLProgram(x,[y,g,w],w.dtype),C=Me({inputs:{x:I},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(I),C}const Tye={kernelName:j$,backendName:"webgl",kernelFunc:kye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ye{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*t[o];this.outputShape=r,this.rank=r.length;const s=ln(this.rank),i=Rye(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Rye(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;if(s.dtype==="string"||s.shape.length>5){const l=t.readSync(s.dataId),c=s.dtype==="string"?l.map(p=>Sl(p)):l,d=It(s.shape,s.dtype,c),f=Fle(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new _ye(s.shape,i);return t.runWebGLProgram(o,[s],s.dtype)}const Nye={kernelName:Rp,backendName:"webgl",kernelFunc:lV};class Aye{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class $ye{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function UN(n){let e=1;for(;e<n;)e*=2;return e}function Dye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r,a=pe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=pe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,d=c[c.length-1];if(t.shouldExecuteOnCPU([s])||d<a||i>l){const D=t.readSync(s.dataId),[R,M]=Ole(D,c,s.dtype,i,o);return[t.makeTensorInfo(R.shape,R.dtype,R.values),t.makeTensorInfo(M.shape,M.dtype,M.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,s.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(d===1)return[s,Jp({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const f=t.texData.get(s.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(s):s,w=xe(c)/d,x=Me({inputs:{x:g},attrs:{shape:[w,d]},backend:t});p&&lu(t,g);const I=UN(i),C=UN(d);let k=null;const E=()=>k===null?[x,x]:[x,k],_=(D,R,M)=>{const O=E(),Z=new Aye(M),se=[[d],[k===null?1:0],[Number.NEGATIVE_INFINITY],[D],[R]],le=k;k=t.runWebGLProgram(Z,O,"int32",se),lu(t,le)};for(let D=1;D<I;D*=2){const R=D*2;for(let M=D;M>=1;M/=2)_(R,M,[w,C])}for(let D=C;D>I;D/=2){const R=E(),M=new $ye([w,D/2]),Z=[[d],[k===null?1:0],[I]],q=k;k=t.runWebGLProgram(M,R,"int32",Z),lu(t,q);const se=I/2,le=se*2;for(let j=se;j>=1;j/=2)_(le,j,k.shape)}let L=k;k=Kh({inputs:{x:k},backend:t,attrs:{begin:0,size:[w,i]}}),lu(t,L);let P=eV({inputs:{x,indices:k},backend:t,attrs:{axis:1,batchDims:1}});lu(t,x);const A=c.slice(0,-1);A.push(i),L=k,k=Me({inputs:{x:k},attrs:{shape:A},backend:t}),lu(t,L);const $=P;return P=Me({inputs:{x:P},attrs:{shape:A},backend:t}),lu(t,$),[P,k]}const Pye={kernelName:lC,backendName:"webgl",kernelFunc:Dye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fye{constructor(e,t,r,s,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=r,[d,f,p,g]=s.shape,[y,w]=c??[f,p],x=[d,y,w,g],I=new Fye(f,p,o,a,l,x);return t.runWebGLProgram(I,[s,i],"float32")}const Lye={kernelName:uC,backendName:"webgl",kernelFunc:Oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mye(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Xp(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=Lle(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const Vye={kernelName:cC,backendName:"webgl",kernelFunc:Mye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s,a=o.shape.length,l=s.shape[i],c=new Array(a-1);let d=0;for(let w=0;w<a;w++)w!==i&&(c[d++]=o.shape[w]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const y=new Array(l);for(let w=0;w<y.length;w++){p[i]=w;const x=Kh({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),I=Me({inputs:{x},backend:t,attrs:{shape:c}});y[w]=I,f.push(x)}return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const Bye={kernelName:yv,backendName:"webgl",kernelFunc:zye};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uye{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/r);this.outputShape=[s,a];const l="0.0",c="sumValue",d=Math.floor(r/4)*4,f=r%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%r>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let y="";i%r>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r,a=s.shape.length,l=[];let c=0;const d=Rn([c],a);let f=s;d!=null&&(f=rs({inputs:{x:s},backend:t,attrs:{perm:d}}),l.push(f),c=zn(1,a)[0]);const p=WP(f.shape,c,o),g=xe([f.shape[c]]),y=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(y);const w=dC(s.dtype),x=(E,_,L,P,A)=>{const $=E.shape[0],D=E.shape[1],R=UP(D,A),M={windowSize:R,inSize:D,batchSize:$,numSegments:A},O=new Uye(M,_),Z=t.compileAndRun(O,[E,L],P);if(l.push(Z),Z.shape[1]===A)return Z;const q=aV({backend:t,attrs:{start:0,stop:A,step:1,dtype:"float32"}}),se=lV({inputs:{x:q},backend:t,attrs:{reps:[D/R]}});return l.push(q),l.push(se),x(Z,_,se,P,A)},I=x(y,"unsortedSegmentSum",i,w,o),C=Me({inputs:{x:I},backend:t,attrs:{shape:p}});let k=C;if(d!=null){l.push(C);const E=Fl(d);k=rs({inputs:{x:k},backend:t,attrs:{perm:E}})}return l.forEach(E=>t.disposeIntermediateTensorInfo(E)),k}const Gye={kernelName:vv,backendName:"webgl",kernelFunc:Wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jye=[_ue,Nue,Due,Oue,Mue,Bue,Wue,jue,Xue,Que,ece,rce,oce,cce,fce,mce,yce,bce,Cce,Ece,Rce,Oce,Mce,Uce,Gce,Yce,Jce,nhe,hue,ihe,che,phe,whe,Che,Ehe,The,Rhe,Dhe,Ohe,Vhe,Bhe,Whe,jhe,Khe,Yhe,ede,nde,ide,lde,cde,pde,vde,Ide,Ede,_de,Rde,Ade,Dde,Fde,Lde,Vde,Wde,Hde,Xde,Qde,efe,rfe,afe,hfe,cue,ffe,lhe,gfe,xfe,Ife,fue,kfe,Nfe,$fe,Ofe,Vfe,Wfe,Hfe,Yfe,epe,rpe,ipe,upe,hpe,fpe,ype,xpe,bpe,Cpe,Epe,Rpe,Dpe,Lpe,jpe,gue,Xpe,Jpe,tme,sme,Hce,ame,ume,hme,pme,vme,mue,wme,Ime,Sme,kme,Tme,qce,Bpe,Nme,Pme,Mme,vue,Ume,jme,Xme,Jme,nge,sge,age,cge,fge,gge,xge,Ige,kge,Rge,Dge,Oge,Pce,Wpe,Vge,Bge,Wge,jge,qge,Xge,Qge,Zge,tye,sye,oye,lye,cye,fye,mye,yye,xye,Upe,Eue,Iye,Eye,Tye,Nye,Pye,Lye,kue,Vye,Bye,Gye,lme];for(const n of jye)nD(n);function Hye({user:n}){const[e,t]=ge.useState(null),[r,s]=ge.useState(null),[i,o]=ge.useState(null),a=g=>{const y=g.target.files[0];if(y){const w=new FileReader;w.onloadend=()=>{t(w.result)},w.readAsDataURL(y)}},l=()=>{t(null),s(null)},c=(g,y)=>new Promise(w=>{const x=new Image;x.src=g,x.onload=()=>{const I=document.createElement("canvas"),C=I.getContext("2d");I.width=y[0],I.height=y[1],C.drawImage(x,0,0,y[0],y[1]);const E=C.getImageData(0,0,y[0],y[1]).data;for(let P=0;P<E.length;P+=4){const A=E[P],$=E[P+1],D=E[P+2],R=.2989*A+.587*$+.114*D;E[P]=E[P+1]=E[P+2]=R}const _=new Float32Array(y[0]*y[1]);for(let P=0,A=0;P<E.length;P+=4,A++)_[A]=E[P]/255;const L=th(_,[1,y[0],y[1],1]);w(L)}}),d=async g=>{if(g.preventDefault(),e)try{const y=await aZ("/model/model.json");y?c(e,[256,256]).then(w=>{w&&w.shape?y.predict(w).array().then(async I=>{const C=Math.max(...I[0]),k=I[0].indexOf(C);await f(),s(k.toString())}).catch(I=>{console.error("Error converting predictions to array:",I)}):console.error("No tensor was returned.")}).catch(w=>{console.error("Error preprocessing image:",w)}):console.error("Model loading failed")}catch(y){console.error("Error loading model:",y)}else console.log("No image uploaded yet!")},f=async()=>{try{if(!e){console.error("No image selected");return}const g=e,y=new FormData;y.append("file",g),y.append("upload_preset","BrainTumorClassifierAI-upload-preset"),y.append("cloud_name","dfzjzaedj");const x=await(await fetch("https://api.cloudinary.com/v1_1/dfzjzaedj/image/upload",{method:"POST",body:y})).json();x.secure_url?o(x.secure_url):console.error("Error uploading image:",x.error)}catch(g){console.error("Error uploading image:",g)}},p=async()=>{try{const g=Array.from(document.querySelectorAll("#key-features-content li")).map(I=>I.textContent.trim()),y=Array.from(document.querySelectorAll("#recommendations-content li")).map(I=>I.textContent.trim()),w=Array.from(document.querySelectorAll("#differential-diagnoses-content li")).map(I=>I.textContent.trim()),x=document.querySelector("#tumor-type-content").textContent.trim();await hj(K2(f0,"radiology_reports"),{image_url:i,tumor_type:x,key_features:g,recommendations:y,differential_diagnoses:w,timestamp:new Date().toISOString(),user_id:n.uid})}catch(g){console.error("Error adding document: ",g)}};return ge.useEffect(()=>{r&&p().then(()=>{alert("Your report has been saved succesfully")})},[r]),te.jsxs(te.Fragment,{children:[te.jsx(p0,{}),te.jsxs("div",{className:"container-hero",children:[te.jsx("section",{className:"msg-cta interpret-cta",children:te.jsx("h1",{children:"Get Instant Interpretation for Your Brain MRI Images"})}),te.jsxs("section",{className:"upload-img",children:[e&&te.jsxs("div",{className:"img-preview",children:[te.jsx("img",{src:e,alt:"Uploaded"}),te.jsx("a",{className:"close-btn",onClick:l,children:"x"})]}),te.jsx("input",{type:"file",accept:"image/*",onChange:a,style:{display:"none"},id:"image-upload-input"}),!e&&te.jsx("label",{htmlFor:"image-upload-input",children:te.jsx("a",{className:"btn upload-img-btn",children:"Upload Image"})}),e&&te.jsx("a",{className:"btn submit-btn",onClick:d,children:"Start scanning!"})]}),te.jsx("section",{className:"result-container",children:r&&te.jsxs("div",{children:[te.jsx("h3",{children:"Radiology Report"}),te.jsxs("div",{className:"findings",children:[te.jsx("div",{children:te.jsx("strong",{children:"Tumor type:"})}),te.jsx("div",{id:"tumor-type-content",children:r==="0"?"Glioma":r==="1"?"Pituitary":r==="2"?"Meningioma":""}),te.jsx("div",{children:te.jsx("strong",{children:"Key features (general):"})}),te.jsx("div",{id:"key-features-content",children:r==="0"?te.jsxs("ul",{children:[te.jsx("li",{children:"Enhancement Patterns: High-grade gliomas often exhibit ring or heterogeneous enhancement; low-grade gliomas may show no or faint enhancement."}),te.jsx("li",{children:"Edema: High-grade gliomas are associated with significant peritumoral edema."}),te.jsx("li",{children:"Necrosis: Central necrosis is common in glioblastomas (Grade IV)."}),te.jsx("li",{children:"Margins: High-grade gliomas often have poorly defined, infiltrative margins."})]}):r==="1"?te.jsxs("ul",{children:[te.jsx("li",{children:"Size: Tumors < 10 mm are microadenomas, while those > 10 mm are macroadenomas."}),te.jsx("li",{children:"Mass Effect: Potential optic chiasm compression (causing bitemporal hemianopia) or lateral invasion into the cavernous sinus."}),te.jsx("li",{children:"Enhancement: Tumor tissue enhances less than normal pituitary gland; cystic or necrotic components may be present in larger tumors."})]}):r==="2"?te.jsxs("ul",{children:[te.jsx("li",{children:"Enhancement: Homogeneous and intense enhancement; a dural tail is a hallmark."}),te.jsx("li",{children:"Margins: Typically well-defined but may become irregular in atypical or malignant cases."}),te.jsx("li",{children:"Bone Changes: Calcification or hyperostosis may be present."}),te.jsx("li",{children:"Edema: Associated brain edema can vary with tumor aggressiveness."})]}):""}),te.jsx("div",{children:te.jsx("strong",{children:"Recommendations:"})}),te.jsx("div",{id:"recommendations-content",children:r==="0"?te.jsxs("ul",{children:[te.jsx("li",{children:"Suggest advanced imaging (e.g., spectroscopy, perfusion) for assessing tumor grade and treatment planning."}),te.jsx("li",{children:"Highlight the need to evaluate for mass effect or midline shift."})]}):r==="1"?te.jsxs("ul",{children:[te.jsx("li",{children:"Suggest correlating with clinical symptoms to rule out functional adenomas."}),te.jsx("li",{children:"Advise checking for cavernous sinus involvement or optic chiasm compression for surgical planning."})]}):r==="2"?te.jsxs("ul",{children:[te.jsx("li",{children:"Suggest noting proximity to venous sinuses and critical neurovascular structures."}),te.jsx("li",{children:"Highlight atypical features (e.g., irregular borders, heterogeneous enhancement)."})]}):""}),te.jsx("div",{children:te.jsx("strong",{children:"Differential diagnoses:"})}),te.jsx("div",{id:"differential-diagnoses-content",children:r==="0"?te.jsx("ul",{children:te.jsx("li",{children:"Brain metastases, abscess, or demyelinating lesions."})}):r==="1"?te.jsx("ul",{children:te.jsx("li",{children:"Rathke's cleft cyst, craniopharyngioma."})}):r==="2"?te.jsx("ul",{children:te.jsx("li",{children:"Dural metastases, hemangiopericytoma."})}):""})]})]})})]})]})}const o1=({children:n})=>{const[e,t]=ge.useState(null),[r,s]=ge.useState(!0);return ge.useEffect(()=>{const i=uI.onAuthStateChanged(o=>{t(o),s(!1)});return()=>i()},[]),r?te.jsx("div",{children:"Loading..."}):e?n({user:e}):te.jsx(VH,{to:"/auth/signin",state:{from:window.location.pathname}})};class mb{constructor(e="",t="",r="",s="",i=[],o=[],a=[]){this.id=e,this.timestamp=t,this.tumorType=r,this.imageUrl=s,this.keyFeatures=i,this.recommendations=o,this.differentialDiagnoses=a}}function qye({user:n}){const[e,t]=ge.useState([]),r=async()=>{try{const s=K2(f0,"radiology_reports"),i=rj(s,sj("user_id","==",n.uid)),o=await uj(i),a=[];o.forEach(l=>{a.push(new mb(l.id,l.data().timestamp,l.data().tumor_type,l.data().image_url))}),t(a)}catch(s){console.error("Error retrieving documents:",s)}};return ge.useEffect(()=>{r()}),te.jsxs(te.Fragment,{children:[te.jsx(p0,{}),te.jsx("div",{className:"container-report",children:e.length>0?e.map((s,i)=>te.jsxs("div",{className:"report",children:[te.jsx("div",{children:te.jsx("img",{src:s.imageUrl,alt:""})}),te.jsx("div",{className:"metadata",children:te.jsx("p",{className:"report-title",children:te.jsxs("strong",{children:[s.tumorType,"_",s.timestamp]})})}),te.jsx("div",{children:te.jsx("a",{href:`/my/mri/${s.id}`,className:"btn btn-view-report",children:"View"})})]},i)):te.jsx("p",{children:"You have not uploaded any MRI yet!"})})]})}function Kye(){const[n,e]=ge.useState(new mb),{id:t}=bH(),r=async()=>{try{const s=Jb(f0,"radiology_reports",t),i=await lj(s),o=new mb(i.id,i.data().timestamp,i.data().tumor_type,i.data().image_url,i.data().key_features,i.data().recommendations,i.data().differential_diagnoses);e(o)}catch(s){console.error("Error retrieving documents:",s)}};return ge.useEffect(()=>{r()}),te.jsxs(te.Fragment,{children:[te.jsx(p0,{}),te.jsx("div",{className:"container-hero",children:te.jsx("section",{className:"result-container",children:n&&te.jsxs("div",{children:[te.jsx("h3",{children:"Radiology Report"}),te.jsx("img",{src:n.imageUrl,alt:""}),te.jsxs("div",{className:"findings",children:[te.jsx("div",{children:te.jsx("strong",{children:"Tumor type:"})}),te.jsx("div",{id:"tumor-type-content",children:n.tumorType}),te.jsx("div",{children:te.jsx("strong",{children:"Key features (general):"})}),te.jsx("div",{id:"key-features-content",children:n.keyFeatures.map((s,i)=>te.jsx("li",{children:s},i))}),te.jsx("div",{children:te.jsx("strong",{children:"Recommendations:"})}),te.jsx("div",{id:"recommendations-content",children:n.recommendations.map((s,i)=>te.jsx("li",{children:s},i))}),te.jsx("div",{children:te.jsx("strong",{children:"Differential diagnoses:"})}),te.jsx("div",{id:"differential-diagnoses-content",children:n.differentialDiagnoses.map((s,i)=>te.jsx("li",{children:s},i))})]})]})})})]})}const Xye=c6([{path:"/",element:te.jsx(bj,{})},{path:"/auth/signin",element:te.jsx(S6,{})},{path:"/interpret",element:te.jsx(o1,{children:({user:n})=>te.jsx(Hye,{user:n})})},{path:"/my/mri",element:te.jsx(o1,{children:({user:n})=>te.jsx(qye,{user:n})})},{path:"/my/mri/:id",element:te.jsx(o1,{children:({user:n})=>te.jsx(Kye,{user:n})})}]);b3.createRoot(document.getElementById("root")).render(te.jsx(ge.StrictMode,{children:te.jsx(C6,{router:Xye})}));
